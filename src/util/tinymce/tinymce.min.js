!function(){"use strict";var typeOf=function(x){if(null===x)return"null";if(void 0===x)return"undefined";var t=typeof x;return"object"===t&&(Array.prototype.isPrototypeOf(x)||x.constructor&&"Array"===x.constructor.name)?"array":"object"===t&&(String.prototype.isPrototypeOf(x)||x.constructor&&"String"===x.constructor.name)?"string":t},isEquatableType=function(x){return-1!==["undefined","boolean","number","string","function","xml","null"].indexOf(x)},sort=function(xs,compareFn){var clone;return Array.prototype.slice.call(xs).sort(compareFn)},contramap=function(eqa,f){return eq((function(x,y){return eqa.eq(f(x),f(y))}))},eq=function(f){return{eq:f}},tripleEq,eqString=eq((function(x,y){return x===y})),eqArray=function(eqa){return eq((function(x,y){if(x.length!==y.length)return!1;for(var len=x.length,i=0;i<len;i++)if(!eqa.eq(x[i],y[i]))return!1;return!0}))},eqSortedArray=function(eqa,compareFn){return contramap(eqArray(eqa),(function(xs){return sort(xs,compareFn)}))},eqRecord=function(eqa){return eq((function(x,y){var kx=Object.keys(x),ky=Object.keys(y);if(!eqSortedArray(eqString).eq(kx,ky))return!1;for(var len=kx.length,i=0;i<len;i++){var q=kx[i];if(!eqa.eq(x[q],y[q]))return!1}return!0}))},eqAny=eq((function(x,y){if(x===y)return!0;var tx=typeOf(x),ty;return tx===typeOf(y)&&(isEquatableType(tx)?x===y:"array"===tx?eqArray(eqAny).eq(x,y):"object"===tx&&eqRecord(eqAny).eq(x,y))})),noop=function(){},compose=function(fa,fb){return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return fa(fb.apply(null,args))}},compose1=function(fbc,fab){return function(a){return fbc(fab(a))}},constant=function(value){return function(){return value}},identity=function(x){return x};function curry(fn){for(var initialArgs=[],_i=1;_i<arguments.length;_i++)initialArgs[_i-1]=arguments[_i];return function(){for(var restArgs=[],_i=0;_i<arguments.length;_i++)restArgs[_i]=arguments[_i];var all=initialArgs.concat(restArgs);return fn.apply(null,all)}}var not=function(f){return function(t){return!f(t)}},die=function(msg){return function(){throw new Error(msg)}},apply=function(f){return f()},call=function(f){f()},never=constant(!1),always=constant(!0),none=function(){return NONE},NONE=function(){var eq=function(o){return o.isNone()},call=function(thunk){return thunk()},id=function(n){return n},me;return{fold:function(n,_s){return n()},is:never,isSome:never,isNone:always,getOr:id,getOrThunk:call,getOrDie:function(msg){throw new Error(msg||"error: getOrDie called on none.")},getOrNull:constant(null),getOrUndefined:constant(void 0),or:id,orThunk:call,map:none,each:noop,bind:none,exists:never,forall:always,filter:none,equals:eq,equals_:eq,toArray:function(){return[]},toString:constant("none()")}}(),some=function(a){var constant_a=constant(a),self=function(){return me},bind=function(f){return f(a)},me={fold:function(n,s){return s(a)},is:function(v){return a===v},isSome:always,isNone:never,getOr:constant_a,getOrThunk:constant_a,getOrDie:constant_a,getOrNull:constant_a,getOrUndefined:constant_a,or:self,orThunk:self,map:function(f){return some(f(a))},each:function(f){f(a)},bind:bind,exists:bind,forall:bind,filter:function(f){return f(a)?me:NONE},toArray:function(){return[a]},toString:function(){return"some("+a+")"},equals:function(o){return o.is(a)},equals_:function(o,elementEq){return o.fold(never,(function(b){return elementEq(a,b)}))}};return me},from=function(value){return null==value?NONE:some(value)},Optional={some:some,none:none,from:from},typeOf$1=function(x){var t=typeof x;return null===x?"null":"object"===t&&(Array.prototype.isPrototypeOf(x)||x.constructor&&"Array"===x.constructor.name)?"array":"object"===t&&(String.prototype.isPrototypeOf(x)||x.constructor&&"String"===x.constructor.name)?"string":t},isType=function(type){return function(value){return typeOf$1(value)===type}},isSimpleType=function(type){return function(value){return typeof value===type}},eq$1=function(t){return function(a){return t===a}},isString=isType("string"),isObject=isType("object"),isArray=isType("array"),isNull=eq$1(null),isBoolean=isSimpleType("boolean"),isUndefined=eq$1(void 0),isNullable=function(a){return null==a},isNonNullable=function(a){return!isNullable(a)},isFunction=isSimpleType("function"),isNumber=isSimpleType("number"),nativeSlice=Array.prototype.slice,nativeIndexOf=Array.prototype.indexOf,nativePush=Array.prototype.push,rawIndexOf=function(ts,t){return nativeIndexOf.call(ts,t)},indexOf=function(xs,x){var r=rawIndexOf(xs,x);return-1===r?Optional.none():Optional.some(r)},contains=function(xs,x){return rawIndexOf(xs,x)>-1},exists=function(xs,pred){for(var i=0,len=xs.length;i<len;i++){var x;if(pred(xs[i],i))return!0}return!1},map=function(xs,f){for(var len=xs.length,r=new Array(len),i=0;i<len;i++){var x=xs[i];r[i]=f(x,i)}return r},each=function(xs,f){for(var i=0,len=xs.length;i<len;i++){var x;f(xs[i],i)}},eachr=function(xs,f){for(var i=xs.length-1;i>=0;i--){var x;f(xs[i],i)}},partition=function(xs,pred){for(var pass=[],fail=[],i=0,len=xs.length;i<len;i++){var x=xs[i],arr;(pred(x,i)?pass:fail).push(x)}return{pass:pass,fail:fail}},filter=function(xs,pred){for(var r=[],i=0,len=xs.length;i<len;i++){var x=xs[i];pred(x,i)&&r.push(x)}return r},foldr=function(xs,f,acc){return eachr(xs,(function(x){acc=f(acc,x)})),acc},foldl=function(xs,f,acc){return each(xs,(function(x){acc=f(acc,x)})),acc},findUntil=function(xs,pred,until){for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(pred(x,i))return Optional.some(x);if(until(x,i))break}return Optional.none()},find=function(xs,pred){return findUntil(xs,pred,never)},findIndex=function(xs,pred){for(var i=0,len=xs.length;i<len;i++){var x;if(pred(xs[i],i))return Optional.some(i)}return Optional.none()},flatten=function(xs){for(var r=[],i=0,len=xs.length;i<len;++i){if(!isArray(xs[i]))throw new Error("Arr.flatten item "+i+" was not an array, input: "+xs);nativePush.apply(r,xs[i])}return r},bind=function(xs,f){return flatten(map(xs,f))},forall=function(xs,pred){for(var i=0,len=xs.length;i<len;++i){var x;if(!0!==pred(xs[i],i))return!1}return!0},reverse=function(xs){var r=nativeSlice.call(xs,0);return r.reverse(),r},difference=function(a1,a2){return filter(a1,(function(x){return!contains(a2,x)}))},mapToObject=function(xs,f){for(var r={},i=0,len=xs.length;i<len;i++){var x=xs[i];r[String(x)]=f(x,i)}return r},sort$1=function(xs,comparator){var copy=nativeSlice.call(xs,0);return copy.sort(comparator),copy},get=function(xs,i){return i>=0&&i<xs.length?Optional.some(xs[i]):Optional.none()},head=function(xs){return get(xs,0)},last=function(xs){return get(xs,xs.length-1)},from$1=isFunction(Array.from)?Array.from:function(x){return nativeSlice.call(x)},findMap=function(arr,f){for(var i=0;i<arr.length;i++){var r=f(arr[i],i);if(r.isSome())return r}return Optional.none()},keys=Object.keys,hasOwnProperty=Object.hasOwnProperty,each$1=function(obj,f){for(var props=keys(obj),k=0,len=props.length;k<len;k++){var i=props[k],x;f(obj[i],i)}},map$1=function(obj,f){return tupleMap(obj,(function(x,i){return{k:i,v:f(x,i)}}))},tupleMap=function(obj,f){var r={};return each$1(obj,(function(x,i){var tuple=f(x,i);r[tuple.k]=tuple.v})),r},objAcc=function(r){return function(x,i){r[i]=x}},internalFilter=function(obj,pred,onTrue,onFalse){var r={};return each$1(obj,(function(x,i){(pred(x,i)?onTrue:onFalse)(x,i)})),r},bifilter=function(obj,pred){var t={},f={};return internalFilter(obj,pred,objAcc(t),objAcc(f)),{t:t,f:f}},filter$1=function(obj,pred){var t={};return internalFilter(obj,pred,objAcc(t),noop),t},mapToArray=function(obj,f){var r=[];return each$1(obj,(function(value,name){r.push(f(value,name))})),r},values=function(obj){return mapToArray(obj,(function(v){return v}))},get$1=function(obj,key){return has(obj,key)?Optional.from(obj[key]):Optional.none()},has=function(obj,key){return hasOwnProperty.call(obj,key)},hasNonNullableKey=function(obj,key){return has(obj,key)&&void 0!==obj[key]&&null!==obj[key]},equal=function(a1,a2,eq){return void 0===eq&&(eq=eqAny),eqRecord(eq).eq(a1,a2)},isArray$1=Array.isArray,toArray=function(obj){if(isArray$1(obj))return obj;for(var array=[],i=0,l=obj.length;i<l;i++)array[i]=obj[i];return array},each$2=function(o,cb,s){var n,l;if(!o)return!1;if(s=s||o,void 0!==o.length){for(n=0,l=o.length;n<l;n++)if(!1===cb.call(s,o[n],n,o))return!1}else for(n in o)if(o.hasOwnProperty(n)&&!1===cb.call(s,o[n],n,o))return!1;return!0},map$2=function(array,callback){var out=[];return each$2(array,(function(item,index){out.push(callback(item,index,array))})),out},filter$2=function(a,f){var o=[];return each$2(a,(function(v,index){f&&!f(v,index,a)||o.push(v)})),o},indexOf$1=function(a,v){if(a)for(var i=0,l=a.length;i<l;i++)if(a[i]===v)return i;return-1},reduce=function(collection,iteratee,accumulator,thisArg){for(var acc=isUndefined(accumulator)?collection[0]:accumulator,i=0;i<collection.length;i++)acc=iteratee.call(thisArg,acc,collection[i],i);return acc},findIndex$1=function(array,predicate,thisArg){var i,l;for(i=0,l=array.length;i<l;i++)if(predicate.call(thisArg,array[i],i,array))return i;return-1},last$1=function(collection){return collection[collection.length-1]},__assign=function(){return(__assign=Object.assign||function __assign(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)};function __rest(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]]);return t}function __spreadArrays(){for(var s=0,i=0,il=arguments.length;i<il;i++)s+=arguments[i].length;for(var r=Array(s),k=0,i=0;i<il;i++)for(var a=arguments[i],j=0,jl=a.length;j<jl;j++,k++)r[k]=a[j];return r}var cached=function(f){var called=!1,r;return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return called||(called=!0,r=f.apply(null,args)),r}},DeviceType=function(os,browser,userAgent,mediaMatch){var isiPad=os.isiOS()&&!0===/ipad/i.test(userAgent),isiPhone=os.isiOS()&&!isiPad,isMobile=os.isiOS()||os.isAndroid(),isTouch=isMobile||mediaMatch("(pointer:coarse)"),isTablet=isiPad||!isiPhone&&isMobile&&mediaMatch("(min-device-width:768px)"),isPhone=isiPhone||isMobile&&!isTablet,iOSwebview=browser.isSafari()&&os.isiOS()&&!1===/safari/i.test(userAgent),isDesktop=!isPhone&&!isTablet&&!iOSwebview;return{isiPad:constant(isiPad),isiPhone:constant(isiPhone),isTablet:constant(isTablet),isPhone:constant(isPhone),isTouch:constant(isTouch),isAndroid:os.isAndroid,isiOS:os.isiOS,isWebView:constant(iOSwebview),isDesktop:constant(isDesktop)}},firstMatch=function(regexes,s){for(var i=0;i<regexes.length;i++){var x=regexes[i];if(x.test(s))return x}},find$1=function(regexes,agent){var r=firstMatch(regexes,agent);if(!r)return{major:0,minor:0};var group=function(i){return Number(agent.replace(r,"$"+i))};return nu(group(1),group(2))},detect=function(versionRegexes,agent){var cleanedAgent=String(agent).toLowerCase();return 0===versionRegexes.length?unknown():find$1(versionRegexes,cleanedAgent)},unknown=function(){return nu(0,0)},nu=function(major,minor){return{major:major,minor:minor}},Version={nu:nu,detect:detect,unknown:unknown},detect$1=function(candidates,userAgent){var agent=String(userAgent).toLowerCase();return find(candidates,(function(candidate){return candidate.search(agent)}))},detectBrowser,detectOs,UaString_detectBrowser=function(browsers,userAgent){return detect$1(browsers,userAgent).map((function(browser){var version=Version.detect(browser.versionRegexes,userAgent);return{current:browser.name,version:version}}))},UaString_detectOs=function(oses,userAgent){return detect$1(oses,userAgent).map((function(os){var version=Version.detect(os.versionRegexes,userAgent);return{current:os.name,version:version}}))},removeFromStart=function(str,numChars){return str.substring(numChars)},checkRange=function(str,substr,start){return""===substr||str.length>=substr.length&&str.substr(start,start+substr.length)===substr},removeLeading=function(str,prefix){return startsWith(str,prefix)?removeFromStart(str,prefix.length):str},contains$1=function(str,substr){return-1!==str.indexOf(substr)},startsWith=function(str,prefix){return checkRange(str,prefix,0)},blank=function(r){return function(s){return s.replace(r,"")}},trim=blank(/^\s+|\s+$/g),lTrim=blank(/^\s+/g),rTrim=blank(/\s+$/g),normalVersionRegex=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,checkContains=function(target){return function(uastring){return contains$1(uastring,target)}},browsers=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(uastring){return contains$1(uastring,"edge/")&&contains$1(uastring,"chrome")&&contains$1(uastring,"safari")&&contains$1(uastring,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,normalVersionRegex],search:function(uastring){return contains$1(uastring,"chrome")&&!contains$1(uastring,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(uastring){return contains$1(uastring,"msie")||contains$1(uastring,"trident")}},{name:"Opera",versionRegexes:[normalVersionRegex,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:checkContains("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:checkContains("firefox")},{name:"Safari",versionRegexes:[normalVersionRegex,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(uastring){return(contains$1(uastring,"safari")||contains$1(uastring,"mobile/"))&&contains$1(uastring,"applewebkit")}}],oses=[{name:"Windows",search:checkContains("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(uastring){return contains$1(uastring,"iphone")||contains$1(uastring,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:checkContains("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:checkContains("mac os x"),versionRegexes:[/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:checkContains("linux"),versionRegexes:[]},{name:"Solaris",search:checkContains("sunos"),versionRegexes:[]},{name:"FreeBSD",search:checkContains("freebsd"),versionRegexes:[]},{name:"ChromeOS",search:checkContains("cros"),versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/]}],PlatformInfo={browsers:constant(browsers),oses:constant(oses)},edge="Edge",chrome="Chrome",ie="IE",opera="Opera",firefox="Firefox",safari="Safari",unknown$1=function(){return nu$1({current:void 0,version:Version.unknown()})},nu$1=function(info){var current=info.current,version=info.version,isBrowser=function(name){return function(){return current===name}};return{current:current,version:version,isEdge:isBrowser(edge),isChrome:isBrowser(chrome),isIE:isBrowser(ie),isOpera:isBrowser(opera),isFirefox:isBrowser(firefox),isSafari:isBrowser(safari)}},Browser={unknown:unknown$1,nu:nu$1,edge:constant(edge),chrome:constant(chrome),ie:constant(ie),opera:constant(opera),firefox:constant(firefox),safari:constant(safari)},windows="Windows",ios="iOS",android="Android",linux="Linux",osx="OSX",solaris="Solaris",freebsd="FreeBSD",chromeos="ChromeOS",unknown$2=function(){return nu$2({current:void 0,version:Version.unknown()})},nu$2=function(info){var current=info.current,version=info.version,isOS=function(name){return function(){return current===name}};return{current:current,version:version,isWindows:isOS(windows),isiOS:isOS(ios),isAndroid:isOS(android),isOSX:isOS(osx),isLinux:isOS(linux),isSolaris:isOS(solaris),isFreeBSD:isOS(freebsd),isChromeOS:isOS(chromeos)}},OperatingSystem={unknown:unknown$2,nu:nu$2,windows:constant(windows),ios:constant(ios),android:constant(android),linux:constant(linux),osx:constant(osx),solaris:constant(solaris),freebsd:constant(freebsd),chromeos:constant(chromeos)},detect$2,PlatformDetection_detect=function(userAgent,mediaMatch){var browsers=PlatformInfo.browsers(),oses=PlatformInfo.oses(),browser=UaString_detectBrowser(browsers,userAgent).fold(Browser.unknown,Browser.nu),os=UaString_detectOs(oses,userAgent).fold(OperatingSystem.unknown,OperatingSystem.nu),deviceType;return{browser:browser,os:os,deviceType:DeviceType(os,browser,userAgent,mediaMatch)}},mediaMatch=function(query){return window.matchMedia(query).matches},platform=cached((function(){return PlatformDetection_detect(navigator.userAgent,mediaMatch)})),detect$3=function(){return platform()},userAgent=navigator.userAgent,platform$1=detect$3(),browser=platform$1.browser,os=platform$1.os,deviceType=platform$1.deviceType,webkit=/WebKit/.test(userAgent)&&!browser.isEdge(),fileApi="FormData"in window&&"FileReader"in window&&"URL"in window&&!!URL.createObjectURL,windowsPhone=-1!==userAgent.indexOf("Windows Phone"),Env={opera:browser.isOpera(),webkit:webkit,ie:!(!browser.isIE()&&!browser.isEdge())&&browser.version.major,gecko:browser.isFirefox(),mac:os.isOSX()||os.isiOS(),iOS:deviceType.isiPad()||deviceType.isiPhone(),android:os.isAndroid(),contentEditable:!0,transparentSrc:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",caretAfter:!0,range:window.getSelection&&"Range"in window,documentMode:browser.isIE()?document.documentMode||7:10,fileApi:fileApi,ceFalse:!0,cacheSuffix:null,container:null,experimentalShadowDom:!1,canHaveCSP:!browser.isIE(),desktop:deviceType.isDesktop(),windowsPhone:windowsPhone,browser:{current:browser.current,version:browser.version,isChrome:browser.isChrome,isEdge:browser.isEdge,isFirefox:browser.isFirefox,isIE:browser.isIE,isOpera:browser.isOpera,isSafari:browser.isSafari},os:{current:os.current,version:os.version,isAndroid:os.isAndroid,isChromeOS:os.isChromeOS,isFreeBSD:os.isFreeBSD,isiOS:os.isiOS,isLinux:os.isLinux,isOSX:os.isOSX,isSolaris:os.isSolaris,isWindows:os.isWindows},deviceType:{isDesktop:deviceType.isDesktop,isiPad:deviceType.isiPad,isiPhone:deviceType.isiPhone,isPhone:deviceType.isPhone,isTablet:deviceType.isTablet,isTouch:deviceType.isTouch,isWebView:deviceType.isWebView}},whiteSpaceRegExp=/^\s*|\s*$/g,trim$1=function(str){return null==str?"":(""+str).replace(whiteSpaceRegExp,"")},is=function(obj,type){return type?!("array"!==type||!isArray$1(obj))||typeof obj===type:void 0!==obj},makeMap,hasOwnProperty$1,create,extend,walk=function(o,f,n,s){s=s||this,o&&(n&&(o=o[n]),each$2(o,(function(o,i){if(!1===f.call(s,o,i,n))return!1;walk(o,f,n,s)})))},createNS,resolve,explode=function(s,d){return!s||is(s,"array")?s:map$2(s.split(d||","),trim$1)},_addCacheSuffix,Tools={trim:trim$1,isArray:isArray$1,is:is,toArray:toArray,makeMap:function(items,delim,map){var i;for(delim=delim||",","string"==typeof(items=items||[])&&(items=items.split(delim)),map=map||{},i=items.length;i--;)map[items[i]]={};return map},each:each$2,map:map$2,grep:filter$2,inArray:indexOf$1,hasOwn:function(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)},extend:function(obj){for(var exts=[],_i=1;_i<arguments.length;_i++)exts[_i-1]=arguments[_i];for(var i=0;i<exts.length;i++){var ext=exts[i];for(var name_1 in ext)if(ext.hasOwnProperty(name_1)){var value=ext[name_1];void 0!==value&&(obj[name_1]=value)}}return obj},create:function(s,p,root){var self=this,sp,scn,c,de=0,cn=(s=/^((static) )?([\w.]+)(:([\w.]+))?/.exec(s))[3].match(/(^|\.)(\w+)$/i)[2],ns=this.createNS(s[3].replace(/\.\w+$/,""),root);if(!ns[cn]){if("static"===s[2])return ns[cn]=p,void(this.onCreate&&this.onCreate(s[2],s[3],ns[cn]));p[cn]||(p[cn]=noop,de=1),ns[cn]=p[cn],this.extend(ns[cn].prototype,p),s[5]&&(sp=this.resolve(s[5]).prototype,scn=s[5].match(/\.(\w+)$/i)[1],c=ns[cn],ns[cn]=de?function(){return sp[scn].apply(this,arguments)}:function(){return this.parent=sp[scn],c.apply(this,arguments)},ns[cn].prototype[cn]=ns[cn],this.each(sp,(function(f,n){ns[cn].prototype[n]=sp[n]})),this.each(p,(function(f,n){sp[n]?ns[cn].prototype[n]=function(){return this.parent=sp[n],f.apply(this,arguments)}:n!==cn&&(ns[cn].prototype[n]=f)}))),this.each(p.static,(function(f,n){ns[cn][n]=f}))}},walk:walk,createNS:function(n,o){var i,v;for(o=o||window,n=n.split("."),i=0;i<n.length;i++)o[v=n[i]]||(o[v]={}),o=o[v];return o},resolve:function(n,o){var i,l;for(o=o||window,i=0,l=(n=n.split(".")).length;i<l&&(o=o[n[i]]);i++);return o},explode:explode,_addCacheSuffix:function(url){var cacheSuffix=Env.cacheSuffix;return cacheSuffix&&(url+=(-1===url.indexOf("?")?"?":"&")+cacheSuffix),url}},fromHtml=function(html,scope){var doc,div=(scope||document).createElement("div");if(div.innerHTML=html,!div.hasChildNodes()||div.childNodes.length>1)throw console.error("HTML does not have a single root node",html),new Error("HTML must have a single root node");return fromDom(div.childNodes[0])},fromTag=function(tag,scope){var doc,node=(scope||document).createElement(tag);return fromDom(node)},fromText=function(text,scope){var doc,node=(scope||document).createTextNode(text);return fromDom(node)},fromDom=function(node){if(null==node)throw new Error("Node cannot be null or undefined");return{dom:node}},fromPoint,SugarElement={fromHtml:fromHtml,fromTag:fromTag,fromText:fromText,fromDom:fromDom,fromPoint:function(docElm,x,y){return Optional.from(docElm.dom.elementFromPoint(x,y)).map(fromDom)}},toArray$1=function(target,f){var r=[],recurse=function(e){return r.push(e),f(e)},cur=f(target);do{cur=cur.bind(recurse)}while(cur.isSome());return r},compareDocumentPosition=function(a,b,match){return 0!=(a.compareDocumentPosition(b)&match)},documentPositionContainedBy=function(a,b){return compareDocumentPosition(a,b,Node.DOCUMENT_POSITION_CONTAINED_BY)},COMMENT=8,DOCUMENT=9,DOCUMENT_FRAGMENT=11,ELEMENT=1,TEXT=3,is$1=function(element,selector){var dom=element.dom;if(1!==dom.nodeType)return!1;var elem=dom;if(void 0!==elem.matches)return elem.matches(selector);if(void 0!==elem.msMatchesSelector)return elem.msMatchesSelector(selector);if(void 0!==elem.webkitMatchesSelector)return elem.webkitMatchesSelector(selector);if(void 0!==elem.mozMatchesSelector)return elem.mozMatchesSelector(selector);throw new Error("Browser lacks native selectors")},bypassSelector=function(dom){return 1!==dom.nodeType&&9!==dom.nodeType&&11!==dom.nodeType||0===dom.childElementCount},all=function(selector,scope){var base=void 0===scope?document:scope.dom;return bypassSelector(base)?[]:map(base.querySelectorAll(selector),SugarElement.fromDom)},one=function(selector,scope){var base=void 0===scope?document:scope.dom;return bypassSelector(base)?Optional.none():Optional.from(base.querySelector(selector)).map(SugarElement.fromDom)},eq$2=function(e1,e2){return e1.dom===e2.dom},regularContains=function(e1,e2){var d1=e1.dom,d2=e2.dom;return d1!==d2&&d1.contains(d2)},ieContains=function(e1,e2){return documentPositionContainedBy(e1.dom,e2.dom)},contains$2=function(e1,e2){return detect$3().browser.isIE()?ieContains(e1,e2):regularContains(e1,e2)},Global="undefined"!=typeof window?window:Function("return this;")(),name=function(element){var r;return element.dom.nodeName.toLowerCase()},type=function(element){return element.dom.nodeType},isType$1=function(t){return function(element){return type(element)===t}},isComment=function(element){return 8===type(element)||"#comment"===name(element)},isElement=isType$1(1),isText=isType$1(3),isDocument=isType$1(9),isDocumentFragment=isType$1(11),owner=function(element){return SugarElement.fromDom(element.dom.ownerDocument)},documentOrOwner=function(dos){return isDocument(dos)?dos:owner(dos)},documentElement=function(element){return SugarElement.fromDom(documentOrOwner(element).dom.documentElement)},defaultView=function(element){return SugarElement.fromDom(documentOrOwner(element).dom.defaultView)},parent=function(element){return Optional.from(element.dom.parentNode).map(SugarElement.fromDom)},parents=function(element,isRoot){for(var stop=isFunction(isRoot)?isRoot:never,dom=element.dom,ret=[];null!==dom.parentNode&&void 0!==dom.parentNode;){var rawParent=dom.parentNode,p=SugarElement.fromDom(rawParent);if(ret.push(p),!0===stop(p))break;dom=rawParent}return ret},siblings=function(element){var filterSelf=function(elements){return filter(elements,(function(x){return!eq$2(element,x)}))};return parent(element).map(children).map(filterSelf).getOr([])},prevSibling=function(element){return Optional.from(element.dom.previousSibling).map(SugarElement.fromDom)},nextSibling=function(element){return Optional.from(element.dom.nextSibling).map(SugarElement.fromDom)},prevSiblings=function(element){return reverse(toArray$1(element,prevSibling))},nextSiblings=function(element){return toArray$1(element,nextSibling)},children=function(element){return map(element.dom.childNodes,SugarElement.fromDom)},child=function(element,index){var cs=element.dom.childNodes;return Optional.from(cs[index]).map(SugarElement.fromDom)},firstChild=function(element){return child(element,0)},lastChild=function(element){return child(element,element.dom.childNodes.length-1)},childNodesCount=function(element){return element.dom.childNodes.length},getHead=function(doc){var b=doc.dom.head;if(null==b)throw new Error("Head is not available yet");return SugarElement.fromDom(b)},isShadowRoot=function(dos){return isDocumentFragment(dos)&&isNonNullable(dos.dom.host)},supported=isFunction(Element.prototype.attachShadow)&&isFunction(Node.prototype.getRootNode),isSupported=constant(supported),getRootNode=supported?function(e){return SugarElement.fromDom(e.dom.getRootNode())}:documentOrOwner,getStyleContainer=function(dos){return isShadowRoot(dos)?dos:getHead(documentOrOwner(dos))},getShadowRoot=function(e){var r=getRootNode(e);return isShadowRoot(r)?Optional.some(r):Optional.none()},getShadowHost=function(e){return SugarElement.fromDom(e.dom.host)},getOriginalEventTarget=function(event){if(isSupported()&&isNonNullable(event.target)){var el=SugarElement.fromDom(event.target);if(isElement(el)&&isOpenShadowHost(el)&&event.composed&&event.composedPath){var composedPath=event.composedPath();if(composedPath)return head(composedPath)}}return Optional.from(event.target)},isOpenShadowHost=function(element){return isNonNullable(element.dom.shadowRoot)},before=function(marker,element){var parent$1;parent(marker).each((function(v){v.dom.insertBefore(element.dom,marker.dom)}))},after=function(marker,element){var sibling;nextSibling(marker).fold((function(){var parent$1;parent(marker).each((function(v){append(v,element)}))}),(function(v){before(v,element)}))},prepend=function(parent,element){var firstChild$1;firstChild(parent).fold((function(){append(parent,element)}),(function(v){parent.dom.insertBefore(element.dom,v.dom)}))},append=function(parent,element){parent.dom.appendChild(element.dom)},wrap=function(element,wrapper){before(element,wrapper),append(wrapper,element)},before$1=function(marker,elements){each(elements,(function(x){before(marker,x)}))},append$1=function(parent,elements){each(elements,(function(x){append(parent,x)}))},empty=function(element){element.dom.textContent="",each(children(element),(function(rogue){remove(rogue)}))},remove=function(element){var dom=element.dom;null!==dom.parentNode&&dom.parentNode.removeChild(dom)},unwrap=function(wrapper){var children$1=children(wrapper);children$1.length>0&&before$1(wrapper,children$1),remove(wrapper)},inBody=function(element){var dom=isText(element)?element.dom.parentNode:element.dom;if(null==dom||null===dom.ownerDocument)return!1;var doc=dom.ownerDocument;return getShadowRoot(SugarElement.fromDom(dom)).fold((function(){return doc.body.contains(dom)}),compose1(inBody,getShadowHost))},r=function(left,top){var translate;return{left:left,top:top,translate:function(x,y){return r(left+x,top+y)}}},SugarPosition=r,boxPosition=function(dom){var box=dom.getBoundingClientRect();return SugarPosition(box.left,box.top)},firstDefinedOrZero=function(a,b){return void 0!==a?a:void 0!==b?b:0},absolute=function(element){var doc=element.dom.ownerDocument,body=doc.body,win=doc.defaultView,html=doc.documentElement;if(body===element.dom)return SugarPosition(body.offsetLeft,body.offsetTop);var scrollTop=firstDefinedOrZero(null==win?void 0:win.pageYOffset,html.scrollTop),scrollLeft=firstDefinedOrZero(null==win?void 0:win.pageXOffset,html.scrollLeft),clientTop=firstDefinedOrZero(html.clientTop,body.clientTop),clientLeft=firstDefinedOrZero(html.clientLeft,body.clientLeft);return viewport(element).translate(scrollLeft-clientLeft,scrollTop-clientTop)},viewport=function(element){var dom=element.dom,doc,body=dom.ownerDocument.body;return body===dom?SugarPosition(body.offsetLeft,body.offsetTop):inBody(element)?boxPosition(dom):SugarPosition(0,0)},get$2=function(_DOC){var doc=void 0!==_DOC?_DOC.dom:document,x=doc.body.scrollLeft||doc.documentElement.scrollLeft,y=doc.body.scrollTop||doc.documentElement.scrollTop;return SugarPosition(x,y)},to=function(x,y,_DOC){var doc,win=(void 0!==_DOC?_DOC.dom:document).defaultView;win&&win.scrollTo(x,y)},intoView=function(element,alignToTop){var isSafari;detect$3().browser.isSafari()&&isFunction(element.dom.scrollIntoViewIfNeeded)?element.dom.scrollIntoViewIfNeeded(!1):element.dom.scrollIntoView(alignToTop)},get$3=function(_win){var win=void 0===_win?window:_win;return Optional.from(win.visualViewport)},bounds=function(x,y,width,height){return{x:x,y:y,width:width,height:height,right:x+width,bottom:y+height}},getBounds=function(_win){var win=void 0===_win?window:_win,doc=win.document,scroll=get$2(SugarElement.fromDom(doc));return get$3(win).fold((function(){var html=win.document.documentElement,width=html.clientWidth,height=html.clientHeight;return bounds(scroll.left,scroll.top,width,height)}),(function(visualViewport){return bounds(Math.max(visualViewport.pageLeft,scroll.left),Math.max(visualViewport.pageTop,scroll.top),visualViewport.width,visualViewport.height)}))},isNodeType=function(type){return function(node){return!!node&&node.nodeType===type}},isRestrictedNode=function(node){return!!node&&!Object.getPrototypeOf(node)},isElement$1=isNodeType(1),matchNodeNames=function(names){var lowercasedNames=names.map((function(s){return s.toLowerCase()}));return function(node){if(node&&node.nodeName){var nodeName=node.nodeName.toLowerCase();return contains(lowercasedNames,nodeName)}return!1}},matchStyleValues=function(name,values){var items=values.toLowerCase().split(" ");return function(node){var i,cssValue;if(isElement$1(node))for(i=0;i<items.length;i++){var computed=node.ownerDocument.defaultView.getComputedStyle(node,null);if((cssValue=computed?computed.getPropertyValue(name):null)===items[i])return!0}return!1}},hasAttribute=function(attrName){return function(node){return isElement$1(node)&&node.hasAttribute(attrName)}},hasAttributeValue=function(attrName,attrValue){return function(node){return isElement$1(node)&&node.getAttribute(attrName)===attrValue}},isBogus=function(node){return isElement$1(node)&&node.hasAttribute("data-mce-bogus")},isBogusAll=function(node){return isElement$1(node)&&"all"===node.getAttribute("data-mce-bogus")},isTable=function(node){return isElement$1(node)&&"TABLE"===node.tagName},hasContentEditableState=function(value){return function(node){if(isElement$1(node)){if(node.contentEditable===value)return!0;if(node.getAttribute("data-mce-contenteditable")===value)return!0}return!1}},isTextareaOrInput=matchNodeNames(["textarea","input"]),isText$1=isNodeType(3),isComment$1=isNodeType(8),isDocument$1=isNodeType(9),isDocumentFragment$1=isNodeType(11),isBr=matchNodeNames(["br"]),isImg=matchNodeNames(["img"]),isContentEditableTrue=hasContentEditableState("true"),isContentEditableFalse=hasContentEditableState("false"),isTableCell=matchNodeNames(["td","th"]),isMedia=matchNodeNames(["video","audio","object","embed"]),isSupported$1=function(dom){return void 0!==dom.style&&isFunction(dom.style.getPropertyValue)},rawSet=function(dom,key,value){if(!(isString(value)||isBoolean(value)||isNumber(value)))throw console.error("Invalid call to Attribute.set. Key ",key,":: Value ",value,":: Element ",dom),new Error("Attribute value was not simple");dom.setAttribute(key,value+"")},set=function(element,key,value){rawSet(element.dom,key,value)},setAll=function(element,attrs){var dom=element.dom;each$1(attrs,(function(v,k){rawSet(dom,k,v)}))},get$4=function(element,key){var v=element.dom.getAttribute(key);return null===v?void 0:v},getOpt=function(element,key){return Optional.from(get$4(element,key))},has$1=function(element,key){var dom=element.dom;return!(!dom||!dom.hasAttribute)&&dom.hasAttribute(key)},remove$1=function(element,key){element.dom.removeAttribute(key)},clone=function(element){return foldl(element.dom.attributes,(function(acc,attr){return acc[attr.name]=attr.value,acc}),{})},internalSet=function(dom,property,value){if(!isString(value))throw console.error("Invalid call to CSS.set. Property ",property,":: Value ",value,":: Element ",dom),new Error("CSS value must be a string: "+value);isSupported$1(dom)&&dom.style.setProperty(property,value)},setAll$1=function(element,css){var dom=element.dom;each$1(css,(function(v,k){internalSet(dom,k,v)}))},get$5=function(element,property){var dom=element.dom,styles,r=window.getComputedStyle(dom).getPropertyValue(property);return""!==r||inBody(element)?r:getUnsafeProperty(dom,property)},getUnsafeProperty=function(dom,property){return isSupported$1(dom)?dom.style.getPropertyValue(property):""},getRaw=function(element,property){var dom=element.dom,raw=getUnsafeProperty(dom,property);return Optional.from(raw).filter((function(r){return r.length>0}))},getAllRaw=function(element){var css={},dom=element.dom;if(isSupported$1(dom))for(var i=0;i<dom.style.length;i++){var ruleName=dom.style.item(i);css[ruleName]=dom.style[ruleName]}return css},reflow=function(e){return e.dom.offsetWidth},browser$1=detect$3().browser,firstElement=function(nodes){return find(nodes,isElement)},getTableCaptionDeltaY=function(elm){return browser$1.isFirefox()&&"table"===name(elm)?firstElement(children(elm)).filter((function(elm){return"caption"===name(elm)})).bind((function(caption){return firstElement(nextSiblings(caption)).map((function(body){var bodyTop=body.dom.offsetTop,captionTop=caption.dom.offsetTop,captionHeight=caption.dom.offsetHeight;return bodyTop<=captionTop?-captionHeight:0}))})).getOr(0):0},hasChild=function(elm,child){return elm.children&&contains(elm.children,child)},getPos=function(body,elm,rootElm){var x=0,y=0,offsetParent,doc=body.ownerDocument,pos;if(rootElm=rootElm||body,elm){if(rootElm===body&&elm.getBoundingClientRect&&"static"===get$5(SugarElement.fromDom(body),"position"))return{x:x=(pos=elm.getBoundingClientRect()).left+(doc.documentElement.scrollLeft||body.scrollLeft)-doc.documentElement.clientLeft,y:y=pos.top+(doc.documentElement.scrollTop||body.scrollTop)-doc.documentElement.clientTop};for(offsetParent=elm;offsetParent&&offsetParent!==rootElm&&offsetParent.nodeType&&!hasChild(offsetParent,rootElm);)x+=offsetParent.offsetLeft||0,y+=offsetParent.offsetTop||0,offsetParent=offsetParent.offsetParent;for(offsetParent=elm.parentNode;offsetParent&&offsetParent!==rootElm&&offsetParent.nodeType&&!hasChild(offsetParent,rootElm);)x-=offsetParent.scrollLeft||0,y-=offsetParent.scrollTop||0,offsetParent=offsetParent.parentNode;y+=getTableCaptionDeltaY(SugarElement.fromDom(elm))}return{x:x,y:y}},exports$1={},module$1={exports:exports$1};!function(define,exports,module,require){!function(f){if("object"==typeof exports&&void 0!==module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;(g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).EphoxContactWrapper=f()}}((function(){return function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,(function(r){var n;return o(e[i][1][r]||r)}),p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(require,module,exports){var process=module.exports={},cachedSetTimeout,cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(fun){if(cachedSetTimeout===setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(fun,0);try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(marker);try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var queue=[],draining=!1,currentQueue,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var timeout=runTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,runClearTimeout(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(name){return[]},process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}],2:[function(require,module,exports){(function(setImmediate){!function(root){var setTimeoutFunc=setTimeout;function noop(){}function bind(fn,thisArg){return function(){fn.apply(thisArg,arguments)}}function Promise(fn){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof fn)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],doResolve(fn,this)}function handle(self,deferred){for(;3===self._state;)self=self._value;0!==self._state?(self._handled=!0,Promise._immediateFn((function(){var cb=1===self._state?deferred.onFulfilled:deferred.onRejected;if(null!==cb){var ret;try{ret=cb(self._value)}catch(e){return void reject(deferred.promise,e)}resolve(deferred.promise,ret)}else(1===self._state?resolve:reject)(deferred.promise,self._value)}))):self._deferreds.push(deferred)}function resolve(self,newValue){try{if(newValue===self)throw new TypeError("A promise cannot be resolved with itself.");if(newValue&&("object"==typeof newValue||"function"==typeof newValue)){var then=newValue.then;if(newValue instanceof Promise)return self._state=3,self._value=newValue,void finale(self);if("function"==typeof then)return void doResolve(bind(then,newValue),self)}self._state=1,self._value=newValue,finale(self)}catch(e){reject(self,e)}}function reject(self,newValue){self._state=2,self._value=newValue,finale(self)}function finale(self){2===self._state&&0===self._deferreds.length&&Promise._immediateFn((function(){self._handled||Promise._unhandledRejectionFn(self._value)}));for(var i=0,len=self._deferreds.length;i<len;i++)handle(self,self._deferreds[i]);self._deferreds=null}function Handler(onFulfilled,onRejected,promise){this.onFulfilled="function"==typeof onFulfilled?onFulfilled:null,this.onRejected="function"==typeof onRejected?onRejected:null,this.promise=promise}function doResolve(fn,self){var done=!1;try{fn((function(value){done||(done=!0,resolve(self,value))}),(function(reason){done||(done=!0,reject(self,reason))}))}catch(ex){if(done)return;done=!0,reject(self,ex)}}Promise.prototype.catch=function(onRejected){return this.then(null,onRejected)},Promise.prototype.then=function(onFulfilled,onRejected){var prom=new this.constructor(noop);return handle(this,new Handler(onFulfilled,onRejected,prom)),prom},Promise.all=function(arr){var args=Array.prototype.slice.call(arr);return new Promise((function(resolve,reject){if(0===args.length)return resolve([]);var remaining=args.length;function res(i,val){try{if(val&&("object"==typeof val||"function"==typeof val)){var then=val.then;if("function"==typeof then)return void then.call(val,(function(val){res(i,val)}),reject)}args[i]=val,0==--remaining&&resolve(args)}catch(ex){reject(ex)}}for(var i=0;i<args.length;i++)res(i,args[i])}))},Promise.resolve=function(value){return value&&"object"==typeof value&&value.constructor===Promise?value:new Promise((function(resolve){resolve(value)}))},Promise.reject=function(value){return new Promise((function(resolve,reject){reject(value)}))},Promise.race=function(values){return new Promise((function(resolve,reject){for(var i=0,len=values.length;i<len;i++)values[i].then(resolve,reject)}))},Promise._immediateFn="function"==typeof setImmediate?function(fn){setImmediate(fn)}:function(fn){setTimeoutFunc(fn,0)},Promise._unhandledRejectionFn=function _unhandledRejectionFn(err){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",err)},Promise._setImmediateFn=function _setImmediateFn(fn){Promise._immediateFn=fn},Promise._setUnhandledRejectionFn=function _setUnhandledRejectionFn(fn){Promise._unhandledRejectionFn=fn},void 0!==module&&module.exports?module.exports=Promise:root.Promise||(root.Promise=Promise)}(this)}).call(this,require("timers").setImmediate)},{timers:3}],3:[function(require,module,exports){(function(setImmediate,clearImmediate){var nextTick=require("process/browser.js").nextTick,apply=Function.prototype.apply,slice=Array.prototype.slice,immediateIds={},nextImmediateId=0;function Timeout(id,clearFn){this._id=id,this._clearFn=clearFn}exports.setTimeout=function(){return new Timeout(apply.call(setTimeout,window,arguments),clearTimeout)},exports.setInterval=function(){return new Timeout(apply.call(setInterval,window,arguments),clearInterval)},exports.clearTimeout=exports.clearInterval=function(timeout){timeout.close()},Timeout.prototype.unref=Timeout.prototype.ref=function(){},Timeout.prototype.close=function(){this._clearFn.call(window,this._id)},exports.enroll=function(item,msecs){clearTimeout(item._idleTimeoutId),item._idleTimeout=msecs},exports.unenroll=function(item){clearTimeout(item._idleTimeoutId),item._idleTimeout=-1},exports._unrefActive=exports.active=function(item){clearTimeout(item._idleTimeoutId);var msecs=item._idleTimeout;msecs>=0&&(item._idleTimeoutId=setTimeout((function onTimeout(){item._onTimeout&&item._onTimeout()}),msecs))},exports.setImmediate="function"==typeof setImmediate?setImmediate:function(fn){var id=nextImmediateId++,args=!(arguments.length<2)&&slice.call(arguments,1);return immediateIds[id]=!0,nextTick((function onNextTick(){immediateIds[id]&&(args?fn.apply(null,args):fn.call(null),exports.clearImmediate(id))})),id},exports.clearImmediate="function"==typeof clearImmediate?clearImmediate:function(id){delete immediateIds[id]}}).call(this,require("timers").setImmediate,require("timers").clearImmediate)},{"process/browser.js":1,timers:3}],4:[function(require,module,exports){var promisePolyfill=require("promise-polyfill"),Global="undefined"!=typeof window?window:Function("return this;")();module.exports={boltExport:Global.Promise||promisePolyfill}},{"promise-polyfill":2}]},{},[4])(4)}))}(void 0,exports$1,module$1,void 0);var Promise=module$1.exports.boltExport,nu$3=function(baseFn){var data=Optional.none(),callbacks=[],map=function(f){return nu$3((function(nCallback){get((function(data){nCallback(f(data))}))}))},get=function(nCallback){isReady()?call(nCallback):callbacks.push(nCallback)},set=function(x){isReady()||(data=Optional.some(x),run(callbacks),callbacks=[])},isReady=function(){return data.isSome()},run=function(cbs){each(cbs,call)},call=function(cb){data.each((function(x){setTimeout((function(){cb(x)}),0)}))};return baseFn(set),{get:get,map:map,isReady:isReady}},pure=function(a){return nu$3((function(callback){callback(a)}))},LazyValue={nu:nu$3,pure:pure},errorReporter=function(err){setTimeout((function(){throw err}),0)},make=function(run){var get=function(callback){run().then(callback,errorReporter)},map,bind,anonBind,toLazy,toCached,toPromise;return{map:function(fab){return make((function(){return run().then(fab)}))},bind:function(aFutureB){return make((function(){return run().then((function(v){return aFutureB(v).toPromise()}))}))},anonBind:function(futureB){return make((function(){return run().then((function(){return futureB.toPromise()}))}))},toLazy:function(){return LazyValue.nu(get)},toCached:function(){var cache=null;return make((function(){return null===cache&&(cache=run()),cache}))},toPromise:run,get:get}},nu$4,pure$1,Future_nu=function(baseFn){return make((function(){return new Promise(baseFn)}))},Future_pure=function(a){return make((function(){return Promise.resolve(a)}))},par=function(asyncValues,nu){return nu((function(callback){var r=[],count=0,cb=function(i){return function(value){r[i]=value,++count>=asyncValues.length&&callback(r)}};0===asyncValues.length?callback([]):each(asyncValues,(function(asyncValue,i){asyncValue.get(cb(i))}))}))},par$1=function(futures){return par(futures,Future_nu)},value=function(o){var is,or=function(_opt){return value(o)},orThunk=function(_f){return value(o)},map=function(f){return value(f(o))},mapError=function(_f){return value(o)},each=function(f){f(o)},bind=function(f){return f(o)},fold=function(_,onValue){return onValue(o)},exists=function(f){return f(o)},forall=function(f){return f(o)},toOptional=function(){return Optional.some(o)};return{is:function(v){return o===v},isValue:always,isError:never,getOr:constant(o),getOrThunk:constant(o),getOrDie:constant(o),or:or,orThunk:orThunk,fold:fold,map:map,mapError:mapError,each:each,bind:bind,exists:exists,forall:forall,toOptional:toOptional}},error=function(message){var getOrThunk,getOrDie,or,orThunk,map,mapError,bind,fold;return{is:never,isValue:never,isError:always,getOr:identity,getOrThunk:function(f){return f()},getOrDie:function(){return die(String(message))()},or:function(opt){return opt},orThunk:function(f){return f()},fold:function(onError,_){return onError(message)},map:function(_f){return error(message)},mapError:function(f){return error(f(message))},each:noop,bind:function(_f){return error(message)},exists:never,forall:always,toOptional:Optional.none}},fromOption=function(opt,err){return opt.fold((function(){return error(err)}),value)},Result={value:value,error:error,fromOption:fromOption},generate,Adt_generate=function(cases){if(!isArray(cases))throw new Error("cases must be an array");if(0===cases.length)throw new Error("there must be at least one case");var constructors=[],adt={};return each(cases,(function(acase,count){var keys$1=keys(acase);if(1!==keys$1.length)throw new Error("one and only one name per case");var key=keys$1[0],value=acase[key];if(void 0!==adt[key])throw new Error("duplicate key detected:"+key);if("cata"===key)throw new Error("cannot have a case named cata (sorry)");if(!isArray(value))throw new Error("case arguments must be an array");constructors.push(key),adt[key]=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var argLength=args.length;if(argLength!==value.length)throw new Error("Wrong number of arguments to case "+key+". Expected "+value.length+" ("+value+"), got "+argLength);var match=function(branches){var branchKeys=keys(branches),allReqd;if(constructors.length!==branchKeys.length)throw new Error("Wrong number of arguments to match. Expected: "+constructors.join(",")+"\nActual: "+branchKeys.join(","));if(!forall(constructors,(function(reqKey){return contains(branchKeys,reqKey)})))throw new Error("Not all branches were specified when using match. Specified: "+branchKeys.join(", ")+"\nRequired: "+constructors.join(", "));return branches[key].apply(null,args)};return{fold:function(){for(var foldArgs=[],_i=0;_i<arguments.length;_i++)foldArgs[_i]=arguments[_i];if(foldArgs.length!==cases.length)throw new Error("Wrong number of arguments to fold. Expected "+cases.length+", got "+foldArgs.length);var target=foldArgs[count];return target.apply(null,args)},match:match,log:function(label){console.log(label,{constructors:constructors,constructor:key,params:args})}}}})),adt},comparison=Adt_generate([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]),unite=function(result){return result.fold(identity,identity)};function ClosestOrAncestor(is,ancestor,scope,a,isRoot){return is(scope,a)?Optional.some(scope):isFunction(isRoot)&&isRoot(scope)?Optional.none():ancestor(scope,a,isRoot)}var ancestor=function(scope,predicate,isRoot){for(var element=scope.dom,stop=isFunction(isRoot)?isRoot:never;element.parentNode;){element=element.parentNode;var el=SugarElement.fromDom(element);if(predicate(el))return Optional.some(el);if(stop(el))break}return Optional.none()},closest=function(scope,predicate,isRoot){var is;return ClosestOrAncestor((function(s,test){return test(s)}),ancestor,scope,predicate,isRoot)},sibling=function(scope,predicate){var element=scope.dom;return element.parentNode?child$1(SugarElement.fromDom(element.parentNode),(function(x){return!eq$2(scope,x)&&predicate(x)})):Optional.none()},child$1=function(scope,predicate){var pred=function(node){return predicate(SugarElement.fromDom(node))},result;return find(scope.dom.childNodes,pred).map(SugarElement.fromDom)},ancestor$1=function(scope,selector,isRoot){return ancestor(scope,(function(e){return is$1(e,selector)}),isRoot)},descendant=function(scope,selector){return one(selector,scope)},closest$1=function(scope,selector,isRoot){var is;return ClosestOrAncestor((function(element,selector){return is$1(element,selector)}),ancestor$1,scope,selector,isRoot)},promise=function(){var bind=function(fn,thisArg){return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];fn.apply(thisArg,args)}},isArray=Array.isArray||function(value){return"[object Array]"===Object.prototype.toString.call(value)},Promise=function(fn){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof fn)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],doResolve(fn,bind(resolve,this),bind(reject,this))},asap=Promise.immediateFn||"function"==typeof setImmediate&&setImmediate||function(fn){return setTimeout(fn,1)};function handle(deferred){var me=this;null!==this._state?asap((function(){var cb=me._state?deferred.onFulfilled:deferred.onRejected;if(null!==cb){var ret;try{ret=cb(me._value)}catch(e){return void deferred.reject(e)}deferred.resolve(ret)}else(me._state?deferred.resolve:deferred.reject)(me._value)})):this._deferreds.push(deferred)}function resolve(newValue){try{if(newValue===this)throw new TypeError("A promise cannot be resolved with itself.");if(newValue&&("object"==typeof newValue||"function"==typeof newValue)){var then=newValue.then;if("function"==typeof then)return void doResolve(bind(then,newValue),bind(resolve,this),bind(reject,this))}this._state=!0,this._value=newValue,finale.call(this)}catch(e){reject.call(this,e)}}function reject(newValue){this._state=!1,this._value=newValue,finale.call(this)}function finale(){for(var i=0,len=this._deferreds.length;i<len;i++)handle.call(this,this._deferreds[i]);this._deferreds=null}function Handler(onFulfilled,onRejected,resolve,reject){this.onFulfilled="function"==typeof onFulfilled?onFulfilled:null,this.onRejected="function"==typeof onRejected?onRejected:null,this.resolve=resolve,this.reject=reject}var doResolve=function(fn,onFulfilled,onRejected){var done=!1;try{fn((function(value){done||(done=!0,onFulfilled(value))}),(function(reason){done||(done=!0,onRejected(reason))}))}catch(ex){if(done)return;done=!0,onRejected(ex)}};return Promise.prototype.catch=function(onRejected){return this.then(null,onRejected)},Promise.prototype.then=function(onFulfilled,onRejected){var me=this;return new Promise((function(resolve,reject){handle.call(me,new Handler(onFulfilled,onRejected,resolve,reject))}))},Promise.all=function(){for(var values=[],_i=0;_i<arguments.length;_i++)values[_i]=arguments[_i];var args=Array.prototype.slice.call(1===values.length&&isArray(values[0])?values[0]:values);return new Promise((function(resolve,reject){if(0===args.length)return resolve([]);for(var remaining=args.length,res=function(i,val){try{if(val&&("object"==typeof val||"function"==typeof val)){var then=val.then;if("function"==typeof then)return void then.call(val,(function(val){res(i,val)}),reject)}args[i]=val,0==--remaining&&resolve(args)}catch(ex){reject(ex)}},i=0;i<args.length;i++)res(i,args[i])}))},Promise.resolve=function(value){return value&&"object"==typeof value&&value.constructor===Promise?value:new Promise((function(resolve){resolve(value)}))},Promise.reject=function(value){return new Promise((function(resolve,reject){reject(value)}))},Promise.race=function(values){return new Promise((function(resolve,reject){for(var i=0,len=values.length;i<len;i++)values[i].then(resolve,reject)}))},Promise},promiseObj=window.Promise?window.Promise:promise(),requestAnimationFramePromise,requestAnimationFrame=function(callback,element){for(var requestAnimationFrameFunc=window.requestAnimationFrame,vendors=["ms","moz","webkit"],featurefill=function(cb){window.setTimeout(cb,0)},i=0;i<vendors.length&&!requestAnimationFrameFunc;i++)requestAnimationFrameFunc=window[vendors[i]+"RequestAnimationFrame"];requestAnimationFrameFunc||(requestAnimationFrameFunc=featurefill),requestAnimationFrameFunc(callback,element)},wrappedSetTimeout=function(callback,time){return"number"!=typeof time&&(time=0),setTimeout(callback,time)},wrappedSetInterval=function(callback,time){return"number"!=typeof time&&(time=1),setInterval(callback,time)},wrappedClearTimeout,wrappedClearInterval,debounce=function(callback,time){var timer,func=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];clearTimeout(timer),timer=wrappedSetTimeout((function(){callback.apply(this,args)}),time)};return func.stop=function(){clearTimeout(timer)},func},Delay={requestAnimationFrame:function(callback,element){requestAnimationFramePromise?requestAnimationFramePromise.then(callback):requestAnimationFramePromise=new promiseObj((function(resolve){element||(element=document.body),requestAnimationFrame(resolve,element)})).then(callback)},setTimeout:wrappedSetTimeout,setInterval:wrappedSetInterval,setEditorTimeout:function(editor,callback,time){return wrappedSetTimeout((function(){editor.removed||callback()}),time)},setEditorInterval:function(editor,callback,time){var timer=wrappedSetInterval((function(){editor.removed?clearInterval(timer):callback()}),time);return timer},debounce:debounce,throttle:debounce,clearInterval:function(id){return clearInterval(id)},clearTimeout:function(id){return clearTimeout(id)}},StyleSheetLoader=function(documentOrShadowRoot,settings){void 0===settings&&(settings={});var idCount=0,loadedStates={},edos=SugarElement.fromDom(documentOrShadowRoot),doc=documentOrOwner(edos),maxLoadTime=settings.maxLoadTime||5e3,_setReferrerPolicy,addStyle=function(element){append(getStyleContainer(edos),element)},removeStyle=function(id){var styleContainer=getStyleContainer(edos);descendant(styleContainer,"#"+id).each(remove)},getOrCreateState=function(url){return get$1(loadedStates,url).getOrThunk((function(){return{id:"mce-u"+idCount++,passed:[],failed:[],count:0}}))},load=function(url,success,failure){var link,urlWithSuffix=Tools._addCacheSuffix(url),state=getOrCreateState(urlWithSuffix);loadedStates[urlWithSuffix]=state,state.count++;var resolve=function(callbacks,status){for(var i=callbacks.length;i--;)callbacks[i]();state.status=status,state.passed=[],state.failed=[],link&&(link.onload=null,link.onerror=null,link=null)},passed=function(){return resolve(state.passed,2)},failed=function(){return resolve(state.failed,3)},wait=function(testCallback,waitCallback){testCallback()||(Date.now()-startTime<maxLoadTime?Delay.setTimeout(waitCallback):failed())},waitForWebKitLinkLoaded=function(){wait((function(){for(var styleSheets=documentOrShadowRoot.styleSheets,i=styleSheets.length;i--;){var styleSheet,owner=styleSheets[i].ownerNode;if(owner&&owner.id===link.id)return passed(),!0}return!1}),waitForWebKitLinkLoaded)};if(success&&state.passed.push(success),failure&&state.failed.push(failure),1!==state.status)if(2!==state.status)if(3!==state.status){state.status=1;var linkElem=SugarElement.fromTag("link",doc.dom);setAll(linkElem,{rel:"stylesheet",type:"text/css",id:state.id});var startTime=Date.now();settings.contentCssCors&&set(linkElem,"crossOrigin","anonymous"),settings.referrerPolicy&&set(linkElem,"referrerpolicy",settings.referrerPolicy),(link=linkElem.dom).onload=waitForWebKitLinkLoaded,link.onerror=failed,addStyle(linkElem),set(linkElem,"href",urlWithSuffix)}else failed();else passed()},loadF=function(url){return Future_nu((function(resolve){load(url,compose(resolve,constant(Result.value(url))),compose(resolve,constant(Result.error(url))))}))},loadAll,unload=function(url){var urlWithSuffix=Tools._addCacheSuffix(url);get$1(loadedStates,urlWithSuffix).each((function(state){var count;0===--state.count&&(delete loadedStates[urlWithSuffix],removeStyle(state.id))}))},unloadAll=function(urls){each(urls,(function(url){unload(url)}))};return{load:load,loadAll:function(urls,success,failure){par$1(map(urls,loadF)).get((function(result){var parts=partition(result,(function(r){return r.isValue()}));parts.fail.length>0?failure(parts.fail.map(unite)):success(parts.pass.map(unite))}))},unload:unload,unloadAll:unloadAll,_setReferrerPolicy:function(referrerPolicy){settings.referrerPolicy=referrerPolicy}}},create$1,instance=function(){var map=new WeakMap,forElement;return{forElement:function(referenceElement,settings){var root,rootDom=getRootNode(referenceElement).dom;return Optional.from(map.get(rootDom)).getOrThunk((function(){var sl=StyleSheetLoader(rootDom,settings);return map.set(rootDom,sl),sl}))}}}(),DomTreeWalker=function(){function DomTreeWalker(startNode,rootNode){this.node=startNode,this.rootNode=rootNode,this.current=this.current.bind(this),this.next=this.next.bind(this),this.prev=this.prev.bind(this),this.prev2=this.prev2.bind(this)}return DomTreeWalker.prototype.current=function(){return this.node},DomTreeWalker.prototype.next=function(shallow){return this.node=this.findSibling(this.node,"firstChild","nextSibling",shallow),this.node},DomTreeWalker.prototype.prev=function(shallow){return this.node=this.findSibling(this.node,"lastChild","previousSibling",shallow),this.node},DomTreeWalker.prototype.prev2=function(shallow){return this.node=this.findPreviousNode(this.node,"lastChild","previousSibling",shallow),this.node},DomTreeWalker.prototype.findSibling=function(node,startName,siblingName,shallow){var sibling,parent;if(node){if(!shallow&&node[startName])return node[startName];if(node!==this.rootNode){if(sibling=node[siblingName])return sibling;for(parent=node.parentNode;parent&&parent!==this.rootNode;parent=parent.parentNode)if(sibling=parent[siblingName])return sibling}}},DomTreeWalker.prototype.findPreviousNode=function(node,startName,siblingName,shallow){var sibling,parent,child;if(node){if(sibling=node[siblingName],this.rootNode&&sibling===this.rootNode)return;if(sibling){if(!shallow)for(child=sibling[startName];child;child=child[startName])if(!child[startName])return child;return sibling}if((parent=node.parentNode)&&parent!==this.rootNode)return parent}},DomTreeWalker}(),blocks=["article","aside","details","div","dt","figcaption","footer","form","fieldset","header","hgroup","html","main","nav","section","summary","body","p","dl","multicol","dd","figure","address","center","blockquote","h1","h2","h3","h4","h5","h6","listing","xmp","pre","plaintext","menu","dir","ul","ol","li","hr","table","tbody","thead","tfoot","th","tr","td","caption"],tableCells=["td","th"],tableSections=["thead","tbody","tfoot"],textBlocks=["h1","h2","h3","h4","h5","h6","p","div","address","pre","form","blockquote","center","dir","fieldset","header","footer","article","section","hgroup","aside","nav","figure"],headings,listItems=["li","dd","dt"],lists=["ul","ol","dl"],wsElements=["pre","script","textarea","style"],lazyLookup=function(items){var lookup;return function(node){return(lookup=lookup||mapToObject(items,always)).hasOwnProperty(name(node))}},isHeading=lazyLookup(["h1","h2","h3","h4","h5","h6"]),isBlock=lazyLookup(blocks),isTable$1=function(node){return"table"===name(node)},isInline=function(node){return isElement(node)&&!isBlock(node)},isBr$1=function(node){return isElement(node)&&"br"===name(node)},isTextBlock=lazyLookup(textBlocks),isList=lazyLookup(lists),isListItem=lazyLookup(listItems),isTableSection=lazyLookup(tableSections),isTableCell$1=lazyLookup(tableCells),isWsPreserveElement=lazyLookup(wsElements),ancestor$2=function(scope,selector,isRoot){return ancestor$1(scope,selector,isRoot).isSome()},zeroWidth="\ufeff",nbsp=" ",isZwsp,removeZwsp,ZWSP="\ufeff",isZwsp$1=function(char){return"\ufeff"===char},trim$2=function(s){return s.replace(/\uFEFF/g,"")},isElement$2=isElement$1,isText$2=isText$1,isCaretContainerBlock=function(node){return isText$2(node)&&(node=node.parentNode),isElement$2(node)&&node.hasAttribute("data-mce-caret")},isCaretContainerInline=function(node){return isText$2(node)&&isZwsp$1(node.data)},isCaretContainer=function(node){return isCaretContainerBlock(node)||isCaretContainerInline(node)},hasContent=function(node){return node.firstChild!==node.lastChild||!isBr(node.firstChild)},insertInline=function(node,before){var sibling,doc,textNode=node.ownerDocument.createTextNode(ZWSP),parentNode=node.parentNode;if(before){if(sibling=node.previousSibling,isText$2(sibling)){if(isCaretContainer(sibling))return sibling;if(endsWithCaretContainer(sibling))return sibling.splitText(sibling.data.length-1)}parentNode.insertBefore(textNode,node)}else{if(sibling=node.nextSibling,isText$2(sibling)){if(isCaretContainer(sibling))return sibling;if(startsWithCaretContainer(sibling))return sibling.splitText(1),sibling}node.nextSibling?parentNode.insertBefore(textNode,node.nextSibling):parentNode.appendChild(textNode)}return textNode},isBeforeInline=function(pos){var container=pos.container();return!!isText$1(container)&&(container.data.charAt(pos.offset())===ZWSP||pos.isAtStart()&&isCaretContainerInline(container.previousSibling))},isAfterInline=function(pos){var container=pos.container();return!!isText$1(container)&&(container.data.charAt(pos.offset()-1)===ZWSP||pos.isAtEnd()&&isCaretContainerInline(container.nextSibling))},createBogusBr=function(){var br=document.createElement("br");return br.setAttribute("data-mce-bogus","1"),br},insertBlock=function(blockName,node,before){var doc,blockNode=node.ownerDocument.createElement(blockName);blockNode.setAttribute("data-mce-caret",before?"before":"after"),blockNode.setAttribute("data-mce-bogus","all"),blockNode.appendChild(createBogusBr());var parentNode=node.parentNode;return before?parentNode.insertBefore(blockNode,node):node.nextSibling?parentNode.insertBefore(blockNode,node.nextSibling):parentNode.appendChild(blockNode),blockNode},startsWithCaretContainer=function(node){return isText$2(node)&&node.data[0]===ZWSP},endsWithCaretContainer=function(node){return isText$2(node)&&node.data[node.data.length-1]===ZWSP},trimBogusBr=function(elm){var brs=elm.getElementsByTagName("br"),lastBr=brs[brs.length-1];isBogus(lastBr)&&lastBr.parentNode.removeChild(lastBr)},showCaretContainerBlock=function(caretContainer){return caretContainer&&caretContainer.hasAttribute("data-mce-caret")?(trimBogusBr(caretContainer),caretContainer.removeAttribute("data-mce-caret"),caretContainer.removeAttribute("data-mce-bogus"),caretContainer.removeAttribute("style"),caretContainer.removeAttribute("_moz_abspos"),caretContainer):null},isRangeInCaretContainerBlock=function(range){return isCaretContainerBlock(range.startContainer)},isContentEditableTrue$1=isContentEditableTrue,isContentEditableFalse$1=isContentEditableFalse,isBr$2=isBr,isText$3=isText$1,isInvalidTextElement=matchNodeNames(["script","style","textarea"]),isAtomicInline=matchNodeNames(["img","input","textarea","hr","iframe","video","audio","object","embed"]),isTable$2=matchNodeNames(["table"]),isCaretContainer$1=isCaretContainer,isCaretCandidate=function(node){return!isCaretContainer$1(node)&&(isText$3(node)?!isInvalidTextElement(node.parentNode):isAtomicInline(node)||isBr$2(node)||isTable$2(node)||isNonUiContentEditableFalse(node))},isUnselectable=function(node){return isElement$1(node)&&"true"===node.getAttribute("unselectable")},isNonUiContentEditableFalse=function(node){return!1===isUnselectable(node)&&isContentEditableFalse$1(node)},isInEditable=function(node,root){for(node=node.parentNode;node&&node!==root;node=node.parentNode){if(isNonUiContentEditableFalse(node))return!1;if(isContentEditableTrue$1(node))return!0}return!0},isAtomicContentEditableFalse=function(node){return!!isNonUiContentEditableFalse(node)&&!0!==foldl(from$1(node.getElementsByTagName("*")),(function(result,elm){return result||isContentEditableTrue$1(elm)}),!1)},isAtomic=function(node){return isAtomicInline(node)||isAtomicContentEditableFalse(node)},isEditableCaretCandidate=function(node,root){return isCaretCandidate(node)&&isInEditable(node,root)},whiteSpaceRegExp$1=/^[ \t\r\n]*$/,isWhitespaceText=function(text){return whiteSpaceRegExp$1.test(text)},hasWhitespacePreserveParent=function(node,rootNode){var rootElement=SugarElement.fromDom(rootNode),startNode=SugarElement.fromDom(node);return ancestor$2(startNode,"pre,code",curry(eq$2,rootElement))},isWhitespace=function(node,rootNode){return isText$1(node)&&isWhitespaceText(node.data)&&!1===hasWhitespacePreserveParent(node,rootNode)},isNamedAnchor=function(node){return isElement$1(node)&&"A"===node.nodeName&&!node.hasAttribute("href")&&(node.hasAttribute("name")||node.hasAttribute("id"))},isContent=function(node,rootNode){return isCaretCandidate(node)&&!1===isWhitespace(node,rootNode)||isNamedAnchor(node)||isBookmark(node)},isBookmark=hasAttribute("data-mce-bookmark"),isBogus$1=hasAttribute("data-mce-bogus"),isBogusAll$1=hasAttributeValue("data-mce-bogus","all"),isEmptyNode=function(targetNode,skipBogus){var node,brCount=0;if(isContent(targetNode,targetNode))return!1;if(!(node=targetNode.firstChild))return!0;var walker=new DomTreeWalker(node,targetNode);do{if(skipBogus){if(isBogusAll$1(node)){node=walker.next(!0);continue}if(isBogus$1(node)){node=walker.next();continue}}if(isBr(node))brCount++,node=walker.next();else{if(isContent(node,targetNode))return!1;node=walker.next()}}while(node);return brCount<=1},isEmpty=function(elm,skipBogus){return void 0===skipBogus&&(skipBogus=!0),isEmptyNode(elm.dom,skipBogus)},isSpan=function(node){return"span"===node.nodeName.toLowerCase()},isInlineContent=function(node,root){return isNonNullable(node)&&(isContent(node,root)||isInline(SugarElement.fromDom(node)))},surroundedByInlineContent=function(node,root){var prev=new DomTreeWalker(node,root).prev(!1),next=new DomTreeWalker(node,root).next(!1),prevIsInline=isUndefined(prev)||isInlineContent(prev,root),nextIsInline=isUndefined(next)||isInlineContent(next,root);return prevIsInline&&nextIsInline},isBookmarkNode=function(node){return isSpan(node)&&"bookmark"===node.getAttribute("data-mce-type")},isKeepTextNode=function(node,root){return isText$1(node)&&node.data.length>0&&surroundedByInlineContent(node,root)},isKeepElement=function(node){return!!isElement$1(node)&&node.childNodes.length>0},isDocument$2=function(node){return isDocumentFragment$1(node)||isDocument$1(node)},trimNode=function(dom,node,root){var rootNode=root||node;if(isElement$1(node)&&isBookmarkNode(node))return node;for(var children=node.childNodes,i=children.length-1;i>=0;i--)trimNode(dom,children[i],rootNode);if(isElement$1(node)){var currentChildren=node.childNodes;1===currentChildren.length&&isBookmarkNode(currentChildren[0])&&node.parentNode.insertBefore(currentChildren[0],node)}return isDocument$2(node)||isContent(node,rootNode)||isKeepElement(node)||isKeepTextNode(node,rootNode)||dom.remove(node),node},makeMap$1=Tools.makeMap,attrsCharsRegExp=/[&<>\"\u0060\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,textCharsRegExp=/[<>&\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,rawCharsRegExp=/[<>&\"\']/g,entityRegExp=/&#([a-z0-9]+);?|&([a-z0-9]+);/gi,asciiMap={128:"€",130:"‚",131:"ƒ",132:"„",133:"…",134:"†",135:"‡",136:"ˆ",137:"‰",138:"Š",139:"‹",140:"Œ",142:"Ž",145:"‘",146:"’",147:"“",148:"”",149:"•",150:"–",151:"—",152:"˜",153:"™",154:"š",155:"›",156:"œ",158:"ž",159:"Ÿ"},baseEntities={'"':"&quot;","'":"&#39;","<":"&lt;",">":"&gt;","&":"&amp;","`":"&#96;"},reverseEntities={"&lt;":"<","&gt;":">","&amp;":"&","&quot;":'"',"&apos;":"'"},nativeDecode=function(text){var elm=SugarElement.fromTag("div").dom;return elm.innerHTML=text,elm.textContent||elm.innerText||text},buildEntitiesLookup=function(items,radix){var i,chr,entity,lookup={};if(items){for(items=items.split(","),radix=radix||10,i=0;i<items.length;i+=2)chr=String.fromCharCode(parseInt(items[i],radix)),baseEntities[chr]||(entity="&"+items[i+1]+";",lookup[chr]=entity,lookup[entity]=chr);return lookup}},namedEntities=buildEntitiesLookup("50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro",32),encodeRaw=function(text,attr){return text.replace(attr?attrsCharsRegExp:textCharsRegExp,(function(chr){return baseEntities[chr]||chr}))},encodeAllRaw,encodeNumeric=function(text,attr){return text.replace(attr?attrsCharsRegExp:textCharsRegExp,(function(chr){return chr.length>1?"&#"+(1024*(chr.charCodeAt(0)-55296)+(chr.charCodeAt(1)-56320)+65536)+";":baseEntities[chr]||"&#"+chr.charCodeAt(0)+";"}))},encodeNamed=function(text,attr,entities){return entities=entities||namedEntities,text.replace(attr?attrsCharsRegExp:textCharsRegExp,(function(chr){return baseEntities[chr]||entities[chr]||chr}))},getEncodeFunc=function(name,entities){var entitiesMap=buildEntitiesLookup(entities)||namedEntities,encodeNamedAndNumeric=function(text,attr){return text.replace(attr?attrsCharsRegExp:textCharsRegExp,(function(chr){return void 0!==baseEntities[chr]?baseEntities[chr]:void 0!==entitiesMap[chr]?entitiesMap[chr]:chr.length>1?"&#"+(1024*(chr.charCodeAt(0)-55296)+(chr.charCodeAt(1)-56320)+65536)+";":"&#"+chr.charCodeAt(0)+";"}))},encodeCustomNamed=function(text,attr){return encodeNamed(text,attr,entitiesMap)},nameMap=makeMap$1(name.replace(/\+/g,","));return nameMap.named&&nameMap.numeric?encodeNamedAndNumeric:nameMap.named?entities?encodeCustomNamed:encodeNamed:nameMap.numeric?encodeNumeric:encodeRaw},decode,Entities={encodeRaw:encodeRaw,encodeAllRaw:function(text){return(""+text).replace(rawCharsRegExp,(function(chr){return baseEntities[chr]||chr}))},encodeNumeric:encodeNumeric,encodeNamed:encodeNamed,getEncodeFunc:getEncodeFunc,decode:function(text){return text.replace(entityRegExp,(function(all,numeric){return numeric?(numeric="x"===numeric.charAt(0).toLowerCase()?parseInt(numeric.substr(1),16):parseInt(numeric,10))>65535?(numeric-=65536,String.fromCharCode(55296+(numeric>>10),56320+(1023&numeric))):asciiMap[numeric]||String.fromCharCode(numeric):reverseEntities[all]||namedEntities[all]||nativeDecode(all)}))}},mapCache={},dummyObj={},makeMap$2=Tools.makeMap,each$3=Tools.each,extend$1=Tools.extend,explode$1=Tools.explode,inArray=Tools.inArray,split=function(items,delim){return(items=Tools.trim(items))?items.split(delim||" "):[]},compileSchema=function(type){var schema={},globalAttributes,blockContent,phrasingContent,flowContent,html4BlockContent,html4PhrasingContent,add=function(name,attributes,children){var ni,attributesOrder,element,arrayToMap=function(array,obj){var map={},i,l;for(i=0,l=array.length;i<l;i++)map[array[i]]=obj||{};return map};attributes=attributes||"","string"==typeof(children=children||[])&&(children=split(children));var names=split(name);for(ni=names.length;ni--;)element={attributes:arrayToMap(attributesOrder=split([globalAttributes,attributes].join(" "))),attributesOrder:attributesOrder,children:arrayToMap(children,dummyObj)},schema[names[ni]]=element},addAttrs=function(name,attributes){var ni,schemaItem,i,l,names=split(name);ni=names.length;for(var attrs=split(attributes);ni--;)for(schemaItem=schema[names[ni]],i=0,l=attrs.length;i<l;i++)schemaItem.attributes[attrs[i]]={},schemaItem.attributesOrder.push(attrs[i])};return mapCache[type]?mapCache[type]:(globalAttributes="id accesskey class dir lang style tabindex title role mail-address",blockContent="address blockquote div dl fieldset form h1 h2 h3 h4 h5 h6 hr menu ol p pre table ul",phrasingContent="a abbr b bdo br button cite code del dfn em embed i iframe img input ins kbd label map noscript object q s samp script select small span strong sub sup textarea u var #text #comment","html4"!==type&&(globalAttributes+=" contenteditable contextmenu draggable dropzone hidden spellcheck translate",blockContent+=" article aside details dialog figure main header footer hgroup section nav",phrasingContent+=" audio canvas command datalist mark meter output picture progress time wbr video ruby bdi keygen"),"html5-strict"!==type&&(globalAttributes+=" xml:lang",phrasingContent=[phrasingContent,html4PhrasingContent="acronym applet basefont big font strike tt"].join(" "),each$3(split(html4PhrasingContent),(function(name){add(name,"",phrasingContent)})),blockContent=[blockContent,html4BlockContent="center dir isindex noframes"].join(" "),flowContent=[blockContent,phrasingContent].join(" "),each$3(split(html4BlockContent),(function(name){add(name,"",flowContent)}))),flowContent=flowContent||[blockContent,phrasingContent].join(" "),add("html","manifest","head body"),add("head","","base command link meta noscript script style title"),add("title hr noscript br"),add("base","href target"),add("link","href rel media hreflang type sizes hreflang"),add("meta","name http-equiv content charset"),add("style","media type scoped"),add("script","src async defer type charset"),add("body","onafterprint onbeforeprint onbeforeunload onblur onerror onfocus onhashchange onload onmessage onoffline ononline onpagehide onpageshow onpopstate onresize onscroll onstorage onunload",flowContent),add("address dt dd div caption","",flowContent),add("h1 h2 h3 h4 h5 h6 pre p abbr code var samp kbd sub sup i b u bdo span legend em strong small s cite dfn","",phrasingContent),add("blockquote","cite",flowContent),add("ol","reversed start type","li"),add("ul","","li"),add("li","value",flowContent),add("dl","","dt dd"),add("a","href target rel media hreflang type",phrasingContent),add("q","cite",phrasingContent),add("ins del","cite datetime",flowContent),add("img","src sizes srcset alt usemap ismap width height"),add("iframe","src name width height",flowContent),add("embed","src type width height"),add("object","data type typemustmatch name usemap form width height",[flowContent,"param"].join(" ")),add("param","name value"),add("map","name",[flowContent,"area"].join(" ")),add("area","alt coords shape href target rel media hreflang type"),add("table","border","caption colgroup thead tfoot tbody tr"+("html4"===type?" col":"")),add("colgroup","span","col"),add("col","span"),add("tbody thead tfoot","","tr"),add("tr","","td th"),add("td","colspan rowspan headers",flowContent),add("th","colspan rowspan headers scope abbr",flowContent),add("form","accept-charset action autocomplete enctype method name novalidate target",flowContent),add("fieldset","disabled form name",[flowContent,"legend"].join(" ")),add("label","form for",phrasingContent),add("input","accept alt autocomplete checked dirname disabled form formaction formenctype formmethod formnovalidate formtarget height list max maxlength min multiple name pattern readonly required size src step type value width"),add("button","disabled form formaction formenctype formmethod formnovalidate formtarget name type value","html4"===type?flowContent:phrasingContent),add("select","disabled form multiple name required size","option optgroup"),add("optgroup","disabled label","option"),add("option","disabled label selected value"),add("textarea","cols dirname disabled form maxlength name readonly required rows wrap"),add("menu","type label",[flowContent,"li"].join(" ")),add("noscript","",flowContent),"html4"!==type&&(add("wbr"),add("ruby","",[phrasingContent,"rt rp"].join(" ")),add("figcaption","",flowContent),add("mark rt rp summary bdi","",phrasingContent),add("canvas","width height",flowContent),add("video","src crossorigin poster preload autoplay mediagroup loop muted controls width height buffered",[flowContent,"track source"].join(" ")),add("audio","src crossorigin preload autoplay mediagroup loop muted controls buffered volume",[flowContent,"track source"].join(" ")),add("picture","","img source"),add("source","src srcset type media sizes"),add("track","kind src srclang label default"),add("datalist","",[phrasingContent,"option"].join(" ")),add("article section nav aside main header footer","",flowContent),add("hgroup","","h1 h2 h3 h4 h5 h6"),add("figure","",[flowContent,"figcaption"].join(" ")),add("time","datetime",phrasingContent),add("dialog","open",flowContent),add("command","type label icon disabled checked radiogroup command"),add("output","for form name",phrasingContent),add("progress","value max",phrasingContent),add("meter","value min max low high optimum",phrasingContent),add("details","open",[flowContent,"summary"].join(" ")),add("keygen","autofocus challenge disabled form keytype name")),"html5-strict"!==type&&(addAttrs("script","language xml:space"),addAttrs("style","xml:space"),addAttrs("object","declare classid code codebase codetype archive standby align border hspace vspace"),addAttrs("embed","align name hspace vspace"),addAttrs("param","valuetype type"),addAttrs("a","charset name rev shape coords"),addAttrs("br","clear"),addAttrs("applet","codebase archive code object alt name width height align hspace vspace"),addAttrs("img","name longdesc align border hspace vspace"),addAttrs("iframe","longdesc frameborder marginwidth marginheight scrolling align"),addAttrs("font basefont","size color face"),addAttrs("input","usemap align"),addAttrs("select"),addAttrs("textarea"),addAttrs("h1 h2 h3 h4 h5 h6 div p legend caption","align"),addAttrs("ul","type compact"),addAttrs("li","type"),addAttrs("ol dl menu dir","compact"),addAttrs("pre","width xml:space"),addAttrs("hr","align noshade size width"),addAttrs("isindex","prompt"),addAttrs("table","summary width frame rules cellspacing cellpadding align bgcolor"),addAttrs("col","width align char charoff valign"),addAttrs("colgroup","width align char charoff valign"),addAttrs("thead","align char charoff valign"),addAttrs("tr","align char charoff valign bgcolor"),addAttrs("th","axis align char charoff valign nowrap bgcolor width height"),addAttrs("form","accept"),addAttrs("td","abbr axis scope align char charoff valign nowrap bgcolor width height"),addAttrs("tfoot","align char charoff valign"),addAttrs("tbody","align char charoff valign"),addAttrs("area","nohref"),addAttrs("body","background bgcolor text link vlink alink")),"html4"!==type&&(addAttrs("input button select textarea","autofocus"),addAttrs("input textarea","placeholder"),addAttrs("a","download"),addAttrs("link script img","crossorigin"),addAttrs("img","loading"),addAttrs("iframe","sandbox seamless allowfullscreen loading")),each$3(split("a form meter progress dfn"),(function(name){schema[name]&&delete schema[name].children[name]})),delete schema.caption.children.table,delete schema.script,mapCache[type]=schema,schema)},compileElementMap=function(value,mode){var styles;return value&&(styles={},"string"==typeof value&&(value={"*":value}),each$3(value,(function(value,key){styles[key]=styles[key.toUpperCase()]="map"===mode?makeMap$2(value,/[, ]/):explode$1(value,/[, ]/)}))),styles},Schema=function(settings){var elements={},children={},patternElements=[],customElementsMap={},specialElements={},createLookupTable=function(option,defaultValue,extendWith){var value=settings[option];return value?value=makeMap$2(value,/[, ]/,makeMap$2(value.toUpperCase(),/[, ]/)):(value=mapCache[option])||(value=makeMap$2(defaultValue," ",makeMap$2(defaultValue.toUpperCase()," ")),value=extend$1(value,extendWith),mapCache[option]=value),value},schemaItems=compileSchema((settings=settings||{}).schema);!1===settings.verify_html&&(settings.valid_elements="*[*]");var validStyles=compileElementMap(settings.valid_styles),invalidStyles=compileElementMap(settings.invalid_styles,"map"),validClasses=compileElementMap(settings.valid_classes,"map"),whiteSpaceElementsMap=createLookupTable("whitespace_elements","pre script noscript style textarea video audio iframe object code"),selfClosingElementsMap=createLookupTable("self_closing_elements","colgroup dd dt li option p td tfoot th thead tr"),shortEndedElementsMap=createLookupTable("short_ended_elements","area base basefont br col frame hr img input isindex link meta param embed source wbr track"),boolAttrMap=createLookupTable("boolean_attributes","checked compact declare defer disabled ismap multiple nohref noresize noshade nowrap readonly selected autoplay loop controls"),nonEmptyOrMoveCaretBeforeOnEnter="td th iframe video audio object script code",nonEmptyElementsMap=createLookupTable("non_empty_elements",nonEmptyOrMoveCaretBeforeOnEnter+" pre",shortEndedElementsMap),moveCaretBeforeOnEnterElementsMap=createLookupTable("move_caret_before_on_enter_elements",nonEmptyOrMoveCaretBeforeOnEnter+" table",shortEndedElementsMap),textBlockElementsMap=createLookupTable("text_block_elements","h1 h2 h3 h4 h5 h6 p div address pre form blockquote center dir fieldset header footer article section hgroup aside main nav figure"),blockElementsMap=createLookupTable("block_elements","hr table tbody thead tfoot th tr td li ol ul caption dl dt dd noscript menu isindex option datalist select optgroup figcaption details summary",textBlockElementsMap),textInlineElementsMap=createLookupTable("text_inline_elements","span strong b em i font strike u var cite dfn code mark q sup sub samp");each$3((settings.special||"script noscript iframe noframes noembed title style textarea xmp").split(" "),(function(name){specialElements[name]=new RegExp("</"+name+"[^>]*>","gi")}));var patternToRegExp=function(str){return new RegExp("^"+str.replace(/([?+*])/g,".$1")+"$")},addValidElements=function(validElements){var ei,el,ai,al,matches,element,attr,attrData,elementName,attrName,attrType,attributes,attributesOrder,prefix,outputName,globalAttributes,globalAttributesOrder,value,elementRuleRegExp=/^([#+\-])?([^\[!\/]+)(?:\/([^\[!]+))?(?:(!?)\[([^\]]+)])?$/,attrRuleRegExp=/^([!\-])?(\w+[\\:]:\w+|[^=:<]+)?(?:([=:<])(.*))?$/,hasPatternsRegExp=/[*?+]/;if(validElements){var validElementsArr=split(validElements,",");for(elements["@"]&&(globalAttributes=elements["@"].attributes,globalAttributesOrder=elements["@"].attributesOrder),ei=0,el=validElementsArr.length;ei<el;ei++)if(matches=elementRuleRegExp.exec(validElementsArr[ei])){if(prefix=matches[1],elementName=matches[2],outputName=matches[3],attrData=matches[5],element={attributes:attributes={},attributesOrder:attributesOrder=[]},"#"===prefix&&(element.paddEmpty=!0),"-"===prefix&&(element.removeEmpty=!0),"!"===matches[4]&&(element.removeEmptyAttrs=!0),globalAttributes&&(each$1(globalAttributes,(function(value,key){attributes[key]=value})),attributesOrder.push.apply(attributesOrder,globalAttributesOrder)),attrData)for(ai=0,al=(attrData=split(attrData,"|")).length;ai<al;ai++)if(matches=attrRuleRegExp.exec(attrData[ai])){if(attr={},attrType=matches[1],attrName=matches[2].replace(/[\\:]:/g,":"),prefix=matches[3],value=matches[4],"!"===attrType&&(element.attributesRequired=element.attributesRequired||[],element.attributesRequired.push(attrName),attr.required=!0),"-"===attrType){delete attributes[attrName],attributesOrder.splice(inArray(attributesOrder,attrName),1);continue}prefix&&("="===prefix&&(element.attributesDefault=element.attributesDefault||[],element.attributesDefault.push({name:attrName,value:value}),attr.defaultValue=value),":"===prefix&&(element.attributesForced=element.attributesForced||[],element.attributesForced.push({name:attrName,value:value}),attr.forcedValue=value),"<"===prefix&&(attr.validValues=makeMap$2(value,"?"))),hasPatternsRegExp.test(attrName)?(element.attributePatterns=element.attributePatterns||[],attr.pattern=patternToRegExp(attrName),element.attributePatterns.push(attr)):(attributes[attrName]||attributesOrder.push(attrName),attributes[attrName]=attr)}globalAttributes||"@"!==elementName||(globalAttributes=attributes,globalAttributesOrder=attributesOrder),outputName&&(element.outputName=elementName,elements[outputName]=element),hasPatternsRegExp.test(elementName)?(element.pattern=patternToRegExp(elementName),patternElements.push(element)):elements[elementName]=element}}},setValidElements=function(validElements){elements={},patternElements=[],addValidElements(validElements),each$3(schemaItems,(function(element,name){children[name]=element.children}))},addCustomElements=function(customElements){var customElementRegExp=/^(~)?(.+)$/;customElements&&(mapCache.text_block_elements=mapCache.block_elements=null,each$3(split(customElements,","),(function(rule){var matches=customElementRegExp.exec(rule),inline="~"===matches[1],cloneName=inline?"span":"div",name=matches[2];if(children[name]=children[cloneName],customElementsMap[name]=cloneName,inline||(blockElementsMap[name.toUpperCase()]={},blockElementsMap[name]={}),!elements[name]){var customRule=elements[cloneName];delete(customRule=extend$1({},customRule)).removeEmptyAttrs,delete customRule.removeEmpty,elements[name]=customRule}each$3(children,(function(element,elmName){element[cloneName]&&(children[elmName]=element=extend$1({},children[elmName]),element[name]=element[cloneName])}))})))},addValidChildren=function(validChildren){var childRuleRegExp=/^([+\-]?)([A-Za-z0-9_\-.\u00b7\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u037d\u037f-\u1fff\u200c-\u200d\u203f-\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]+)\[([^\]]+)]$/;mapCache[settings.schema]=null,validChildren&&each$3(split(validChildren,","),(function(rule){var matches=childRuleRegExp.exec(rule),parent,prefix;matches&&(prefix=matches[1],parent=prefix?children[matches[2]]:children[matches[2]]={"#comment":{}},parent=children[matches[2]],each$3(split(matches[3],"|"),(function(child){"-"===prefix?delete parent[child]:parent[child]={}})))}))},getElementRule=function(name){var element=elements[name],i;if(element)return element;for(i=patternElements.length;i--;)if((element=patternElements[i]).pattern.test(name))return element};settings.valid_elements?setValidElements(settings.valid_elements):(each$3(schemaItems,(function(element,name){elements[name]={attributes:element.attributes,attributesOrder:element.attributesOrder},children[name]=element.children})),"html5"!==settings.schema&&each$3(split("strong/b em/i"),(function(item){var items=split(item,"/");elements[items[1]].outputName=items[0]})),each$3(split("ol ul sub sup blockquote span font a table tbody strong em b i"),(function(name){elements[name]})),each$3(split("p h1 h2 h3 h4 h5 h6 th td pre div address caption li"),(function(name){elements[name].paddEmpty=!0})),each$3(split("span"),(function(name){elements[name].removeEmptyAttrs=!0}))),addCustomElements(settings.custom_elements),addValidChildren(settings.valid_children),addValidElements(settings.extended_valid_elements),addValidChildren("+ol[ul|ol],+ul[ul|ol]"),each$3({dd:"dl",dt:"dl",li:"ul ol",td:"tr",th:"tr",tr:"tbody thead tfoot",tbody:"table",thead:"table",tfoot:"table",legend:"fieldset",area:"map",param:"video audio object"},(function(parents,item){elements[item]&&(elements[item].parentsRequired=split(parents))})),settings.invalid_elements&&each$3(explode$1(settings.invalid_elements),(function(item){elements[item]&&delete elements[item]})),getElementRule("span")||addValidElements("span[!data-mce-type|*]");var getValidStyles,getInvalidStyles,getValidClasses,getBoolAttrs,getBlockElements,getTextBlockElements,getTextInlineElements,getShortEndedElements,getSelfClosingElements,getNonEmptyElements,getMoveCaretBeforeOnEnterElements,getWhiteSpaceElements,getSpecialElements,isValidChild,isValid=function(name,attr){var attrPatterns,i,rule=getElementRule(name);if(rule){if(!attr)return!0;if(rule.attributes[attr])return!0;if(attrPatterns=rule.attributePatterns)for(i=attrPatterns.length;i--;)if(attrPatterns[i].pattern.test(name))return!0}return!1},getCustomElements;return{children:children,elements:elements,getValidStyles:function(){return validStyles},getValidClasses:function(){return validClasses},getBlockElements:function(){return blockElementsMap},getInvalidStyles:function(){return invalidStyles},getShortEndedElements:function(){return shortEndedElementsMap},getTextBlockElements:function(){return textBlockElementsMap},getTextInlineElements:function(){return textInlineElementsMap},getBoolAttrs:function(){return boolAttrMap},getElementRule:getElementRule,getSelfClosingElements:function(){return selfClosingElementsMap},getNonEmptyElements:function(){return nonEmptyElementsMap},getMoveCaretBeforeOnEnterElements:function(){return moveCaretBeforeOnEnterElementsMap},getWhiteSpaceElements:function(){return whiteSpaceElementsMap},getSpecialElements:function(){return specialElements},isValidChild:function(name,child){var parent=children[name.toLowerCase()];return!(!parent||!parent[child.toLowerCase()])},isValid:isValid,getCustomElements:function(){return customElementsMap},addValidElements:addValidElements,setValidElements:setValidElements,addCustomElements:addCustomElements,addValidChildren:addValidChildren}},toHex=function(match,r,g,b){var hex=function(val){return(val=parseInt(val,10).toString(16)).length>1?val:"0"+val};return"#"+hex(r)+hex(g)+hex(b)},Styles=function(settings,schema){var _this=this,rgbRegExp=/rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\s*\)/gi,urlOrStrRegExp=/(?:url(?:(?:\(\s*\"([^\"]+)\"\s*\))|(?:\(\s*\'([^\']+)\'\s*\))|(?:\(\s*([^)\s]+)\s*\))))|(?:\'([^\']+)\')|(?:\"([^\"]+)\")/gi,styleRegExp=/\s*([^:]+):\s*([^;]+);?/g,trimRightRegExp=/\s+$/,i,encodingLookup={},validStyles,invalidStyles,invisibleChar="\ufeff";settings=settings||{},schema&&(validStyles=schema.getValidStyles(),invalidStyles=schema.getInvalidStyles());var encodingItems="\\\" \\' \\; \\: ; : \ufeff".split(" ");for(i=0;i<encodingItems.length;i++)encodingLookup[encodingItems[i]]="\ufeff"+i,encodingLookup["\ufeff"+i]=encodingItems[i];return{toHex:function(color){return color.replace(rgbRegExp,toHex)},parse:function(css){var styles={},matches,name,value,isEncoded,urlConverter=settings.url_converter,urlConverterScope=settings.url_converter_scope||_this,compress=function(prefix,suffix,noJoin){var top=styles[prefix+"-top"+suffix];if(top){var right=styles[prefix+"-right"+suffix];if(right){var bottom=styles[prefix+"-bottom"+suffix];if(bottom){var left=styles[prefix+"-left"+suffix];if(left){var box=[top,right,bottom,left];for(i=box.length-1;i--&&box[i]===box[i+1];);i>-1&&noJoin||(styles[prefix+suffix]=-1===i?box[0]:box.join(" "),delete styles[prefix+"-top"+suffix],delete styles[prefix+"-right"+suffix],delete styles[prefix+"-bottom"+suffix],delete styles[prefix+"-left"+suffix])}}}}},canCompress=function(key){var value=styles[key],i;if(value){for(i=(value=value.split(" ")).length;i--;)if(value[i]!==value[0])return!1;return styles[key]=value[0],!0}},compress2=function(target,a,b,c){canCompress(a)&&canCompress(b)&&canCompress(c)&&(styles[target]=styles[a]+" "+styles[b]+" "+styles[c],delete styles[a],delete styles[b],delete styles[c])},encode=function(str){return isEncoded=!0,encodingLookup[str]},decode=function(str,keepSlashes){return isEncoded&&(str=str.replace(/\uFEFF[0-9]/g,(function(str){return encodingLookup[str]}))),keepSlashes||(str=str.replace(/\\([\'\";:])/g,"$1")),str},decodeSingleHexSequence=function(escSeq){return String.fromCharCode(parseInt(escSeq.slice(1),16))},decodeHexSequences=function(value){return value.replace(/\\[0-9a-f]+/gi,decodeSingleHexSequence)},processUrl=function(match,url,url2,url3,str,str2){if(str=str||str2)return"'"+(str=decode(str)).replace(/\'/g,"\\'")+"'";if(url=decode(url||url2||url3),!settings.allow_script_urls){var scriptUrl=url.replace(/[\s\r\n]+/g,"");if(/(java|vb)script:/i.test(scriptUrl))return"";if(!settings.allow_svg_data_urls&&/^data:image\/svg/i.test(scriptUrl))return""}return urlConverter&&(url=urlConverter.call(urlConverterScope,url,"style")),"url('"+url.replace(/\'/g,"\\'")+"')"};if(css){for(css=(css=css.replace(/[\u0000-\u001F]/g,"")).replace(/\\[\"\';:\uFEFF]/g,encode).replace(/\"[^\"]+\"|\'[^\']+\'/g,(function(str){return str.replace(/[;:]/g,encode)}));matches=styleRegExp.exec(css);)if(styleRegExp.lastIndex=matches.index+matches[0].length,name=matches[1].replace(trimRightRegExp,"").toLowerCase(),value=matches[2].replace(trimRightRegExp,""),name&&value){if(name=decodeHexSequences(name),value=decodeHexSequences(value),-1!==name.indexOf("\ufeff")||-1!==name.indexOf('"'))continue;if(!settings.allow_script_urls&&("behavior"===name||/expression\s*\(|\/\*|\*\//.test(value)))continue;"font-weight"===name&&"700"===value?value="bold":"color"!==name&&"background-color"!==name||(value=value.toLowerCase()),value=(value=value.replace(rgbRegExp,toHex)).replace(urlOrStrRegExp,processUrl),styles[name]=isEncoded?decode(value,!0):value}compress("border","",!0),compress("border","-width"),compress("border","-color"),compress("border","-style"),compress("padding",""),compress("margin",""),compress2("border","border-width","border-style","border-color"),"medium none"===styles.border&&delete styles.border,"none"===styles["border-image"]&&delete styles["border-image"]}return styles},serialize:function(styles,elementName){var css="",serializeStyles=function(name){var value,styleList=validStyles[name];if(styleList)for(var i_1=0,l=styleList.length;i_1<l;i_1++)name=styleList[i_1],(value=styles[name])&&(css+=(css.length>0?" ":"")+name+": "+value+";")},isValid=function(name,elementName){var styleMap=invalidStyles["*"];return(!styleMap||!styleMap[name])&&!((styleMap=invalidStyles[elementName])&&styleMap[name])};return elementName&&validStyles?(serializeStyles("*"),serializeStyles(elementName)):each$1(styles,(function(value,name){!value||invalidStyles&&!isValid(name,elementName)||(css+=(css.length>0?" ":"")+name+": "+value+";")})),css}}},eventExpandoPrefix="mce-data-",mouseEventRe=/^(?:mouse|contextmenu)|click/,deprecated={keyLocation:1,layerX:1,layerY:1,returnValue:1,webkitMovementX:1,webkitMovementY:1,keyIdentifier:1,mozPressure:1},hasIsDefaultPrevented=function(event){return event.isDefaultPrevented===returnTrue||event.isDefaultPrevented===returnFalse},returnFalse=never,returnTrue=always,addEvent=function(target,name,callback,capture){target.addEventListener?target.addEventListener(name,callback,capture||!1):target.attachEvent&&target.attachEvent("on"+name,callback)},removeEvent=function(target,name,callback,capture){target.removeEventListener?target.removeEventListener(name,callback,capture||!1):target.detachEvent&&target.detachEvent("on"+name,callback)},isMouseEvent=function(event){return mouseEventRe.test(event.type)},fix=function(originalEvent,data){var name,event=data||{};for(name in originalEvent)deprecated[name]||(event[name]=originalEvent[name]);if(event.target||(event.target=event.srcElement||document),event.composedPath&&(event.composedPath=function(){return originalEvent.composedPath()}),originalEvent&&isMouseEvent(originalEvent)&&void 0===originalEvent.pageX&&void 0!==originalEvent.clientX){var eventDoc=event.target.ownerDocument||document,doc=eventDoc.documentElement,body=eventDoc.body;event.pageX=originalEvent.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0),event.pageY=originalEvent.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)}return event.preventDefault=function(){event.defaultPrevented=!0,event.isDefaultPrevented=returnTrue,originalEvent&&(originalEvent.preventDefault?originalEvent.preventDefault():originalEvent.returnValue=!1)},event.stopPropagation=function(){event.cancelBubble=!0,event.isPropagationStopped=returnTrue,originalEvent&&(originalEvent.stopPropagation?originalEvent.stopPropagation():originalEvent.cancelBubble=!0)},event.stopImmediatePropagation=function(){event.isImmediatePropagationStopped=returnTrue,event.stopPropagation()},!1===hasIsDefaultPrevented(event)&&(event.isDefaultPrevented=!0===event.defaultPrevented?returnTrue:returnFalse,event.isPropagationStopped=!0===event.cancelBubble?returnTrue:returnFalse,event.isImmediatePropagationStopped=returnFalse),void 0===event.metaKey&&(event.metaKey=!1),event},bindOnReady=function(win,callback,eventUtils){var doc=win.document,event={type:"ready"};if(eventUtils.domLoaded)callback(event);else{var isDocReady,readyHandler=function(){removeEvent(win,"DOMContentLoaded",readyHandler),removeEvent(win,"load",readyHandler),eventUtils.domLoaded||(eventUtils.domLoaded=!0,callback(event)),win=null};(function(){return"complete"===doc.readyState||"interactive"===doc.readyState&&doc.body})()?readyHandler():addEvent(win,"DOMContentLoaded",readyHandler),eventUtils.domLoaded||addEvent(win,"load",readyHandler)}},EventUtils=function(){function EventUtils(){this.domLoaded=!1,this.events={},this.count=1,this.expando="mce-data-"+(+new Date).toString(32),this.hasMouseEnterLeave="onmouseenter"in document.documentElement,this.hasFocusIn="onfocusin"in document.documentElement,this.count=1}return EventUtils.prototype.bind=function(target,names,callback,scope){var self=this,id,callbackList,i,name,fakeName,nativeHandler,capture,win=window,defaultNativeHandler=function(evt){self.executeHandlers(fix(evt||win.event),id)};if(target&&3!==target.nodeType&&8!==target.nodeType){target[self.expando]?id=target[self.expando]:(id=self.count++,target[self.expando]=id,self.events[id]={}),scope=scope||target;var namesList=names.split(" ");for(i=namesList.length;i--;)nativeHandler=defaultNativeHandler,fakeName=capture=!1,"DOMContentLoaded"===(name=namesList[i])&&(name="ready"),self.domLoaded&&"ready"===name&&"complete"===target.readyState?callback.call(scope,fix({type:name})):(self.hasMouseEnterLeave||(fakeName=self.mouseEnterLeave[name])&&(nativeHandler=function(evt){var current=evt.currentTarget,related=evt.relatedTarget;if(related&&current.contains)related=current.contains(related);else for(;related&&related!==current;)related=related.parentNode;related||((evt=fix(evt||win.event)).type="mouseout"===evt.type?"mouseleave":"mouseenter",evt.target=current,self.executeHandlers(evt,id))}),self.hasFocusIn||"focusin"!==name&&"focusout"!==name||(capture=!0,fakeName="focusin"===name?"focus":"blur",nativeHandler=function(evt){(evt=fix(evt||win.event)).type="focus"===evt.type?"focusin":"focusout",self.executeHandlers(evt,id)}),(callbackList=self.events[id][name])?"ready"===name&&self.domLoaded?callback(fix({type:name})):callbackList.push({func:callback,scope:scope}):(self.events[id][name]=callbackList=[{func:callback,scope:scope}],callbackList.fakeName=fakeName,callbackList.capture=capture,callbackList.nativeHandler=nativeHandler,"ready"===name?bindOnReady(target,nativeHandler,self):addEvent(target,fakeName||name,nativeHandler,capture)));return target=callbackList=null,callback}},EventUtils.prototype.unbind=function(target,names,callback){var callbackList,i,ci,name,eventMap;if(!target||3===target.nodeType||8===target.nodeType)return this;var id=target[this.expando];if(id){if(eventMap=this.events[id],names){var namesList=names.split(" ");for(i=namesList.length;i--;)if(callbackList=eventMap[name=namesList[i]]){if(callback)for(ci=callbackList.length;ci--;)if(callbackList[ci].func===callback){var nativeHandler=callbackList.nativeHandler,fakeName=callbackList.fakeName,capture=callbackList.capture;(callbackList=callbackList.slice(0,ci).concat(callbackList.slice(ci+1))).nativeHandler=nativeHandler,callbackList.fakeName=fakeName,callbackList.capture=capture,eventMap[name]=callbackList}callback&&0!==callbackList.length||(delete eventMap[name],removeEvent(target,callbackList.fakeName||name,callbackList.nativeHandler,callbackList.capture))}}else each$1(eventMap,(function(callbackList,name){removeEvent(target,callbackList.fakeName||name,callbackList.nativeHandler,callbackList.capture)})),eventMap={};for(name in eventMap)if(has(eventMap,name))return this;delete this.events[id];try{delete target[this.expando]}catch(ex){target[this.expando]=null}}return this},EventUtils.prototype.fire=function(target,name,args){var id;if(!target||3===target.nodeType||8===target.nodeType)return this;var event=fix(null,args);event.type=name,event.target=target;do{(id=target[this.expando])&&this.executeHandlers(event,id),target=target.parentNode||target.ownerDocument||target.defaultView||target.parentWindow}while(target&&!event.isPropagationStopped());return this},EventUtils.prototype.clean=function(target){var i,children;if(!target||3===target.nodeType||8===target.nodeType)return this;if(target[this.expando]&&this.unbind(target),target.getElementsByTagName||(target=target.document),target&&target.getElementsByTagName)for(this.unbind(target),i=(children=target.getElementsByTagName("*")).length;i--;)(target=children[i])[this.expando]&&this.unbind(target);return this},EventUtils.prototype.destroy=function(){this.events={}},EventUtils.prototype.cancel=function(e){return e&&(e.preventDefault(),e.stopImmediatePropagation()),!1},EventUtils.prototype.executeHandlers=function(evt,id){var container=this.events[id],callbackList=container&&container[evt.type];if(callbackList)for(var i=0,l=callbackList.length;i<l;i++){var callback=callbackList[i];if(callback&&!1===callback.func.call(callback.scope,evt)&&evt.preventDefault(),evt.isImmediatePropagationStopped())return}},EventUtils.Event=new EventUtils,EventUtils}(),support,Expr,getText,isXML,tokenize,compile,select,outermostContext,sortInput,hasDuplicate,setDocument,document$1,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,matches,contains$3,expando="sizzle"+-new Date,preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),sortOrder=function(a,b){return a===b&&(hasDuplicate=!0),0},strundefined="undefined",MAX_NEGATIVE=1<<31,hasOwn={}.hasOwnProperty,arr=[],pop=arr.pop,push_native=arr.push,push=arr.push,slice=arr.slice,indexOf$2=arr.indexOf||function(elem){for(var i=0,len=this.length;i<len;i++)if(this[i]===elem)return i;return-1},booleans="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",whitespace="[\\x20\\t\\r\\n\\f]",identifier="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",attributes="\\["+whitespace+"*("+identifier+")(?:"+whitespace+"*([*^$|!~]?=)"+whitespace+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+identifier+"))|)"+whitespace+"*\\]",pseudos=":("+identifier+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+attributes+")*)|.*)\\)|)",rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([>+~]|"+whitespace+")"+whitespace+"*"),rattributeQuotes=new RegExp("="+whitespace+"*([^\\]'\"]*?)"+whitespace+"*\\]","g"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp("^"+identifier+"$"),matchExpr={ID:new RegExp("^#("+identifier+")"),CLASS:new RegExp("^\\.("+identifier+")"),TAG:new RegExp("^("+identifier+"|[*])"),ATTR:new RegExp("^"+attributes),PSEUDO:new RegExp("^"+pseudos),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),bool:new RegExp("^(?:"+booleans+")$","i"),needsContext:new RegExp("^"+whitespace+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)","i")},rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rnative=/^[^{]+\{\s*\[native \w/,rquickExpr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rsibling=/[+~]/,rescape=/'|\\/g,runescape=new RegExp("\\\\([\\da-f]{1,6}"+whitespace+"?|("+whitespace+")|.)","ig"),funescape=function(_,escaped,escapedWhitespace){var high="0x"+escaped-65536;return high!=high||escapedWhitespace?escaped:high<0?String.fromCharCode(high+65536):String.fromCharCode(high>>10|55296,1023&high|56320)};try{push.apply(arr=slice.call(preferredDoc.childNodes),preferredDoc.childNodes),arr[preferredDoc.childNodes.length].nodeType}catch(e){push={apply:arr.length?function(target,els){push_native.apply(target,slice.call(els))}:function(target,els){for(var j=target.length,i=0;target[j++]=els[i++];);target.length=j-1}}}var Sizzle=function(selector,context,results,seed){var match,elem,m,nodeType,i,groups,old,nid,newContext,newSelector;if((context?context.ownerDocument||context:preferredDoc)!==document$1&&setDocument(context),results=results||[],!selector||"string"!=typeof selector)return results;if(1!==(nodeType=(context=context||document$1).nodeType)&&9!==nodeType)return[];if(documentIsHTML&&!seed){if(match=rquickExpr.exec(selector))if(m=match[1]){if(9===nodeType){if(!(elem=context.getElementById(m))||!elem.parentNode)return results;if(elem.id===m)return results.push(elem),results}else if(context.ownerDocument&&(elem=context.ownerDocument.getElementById(m))&&contains$3(context,elem)&&elem.id===m)return results.push(elem),results}else{if(match[2])return push.apply(results,context.getElementsByTagName(selector)),results;if((m=match[3])&&support.getElementsByClassName)return push.apply(results,context.getElementsByClassName(m)),results}if(support.qsa&&(!rbuggyQSA||!rbuggyQSA.test(selector))){if(nid=old=expando,newContext=context,newSelector=9===nodeType&&selector,1===nodeType&&"object"!==context.nodeName.toLowerCase()){for(groups=tokenize(selector),(old=context.getAttribute("id"))?nid=old.replace(rescape,"\\$&"):context.setAttribute("id",nid),nid="[id='"+nid+"'] ",i=groups.length;i--;)groups[i]=nid+toSelector(groups[i]);newContext=rsibling.test(selector)&&testContext(context.parentNode)||context,newSelector=groups.join(",")}if(newSelector)try{return push.apply(results,newContext.querySelectorAll(newSelector)),results}catch(qsaError){}finally{old||context.removeAttribute("id")}}}return select(selector.replace(rtrim,"$1"),context,results,seed)};function createCache(){var keys=[];function cache(key,value){return keys.push(key+" ")>Expr.cacheLength&&delete cache[keys.shift()],cache[key+" "]=value}return cache}function markFunction(fn){return fn[expando]=!0,fn}function siblingCheck(a,b){var cur=b&&a,diff=cur&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||1<<31)-(~a.sourceIndex||1<<31);if(diff)return diff;if(cur)for(;cur=cur.nextSibling;)if(cur===b)return-1;return a?1:-1}function createInputPseudo(type){return function(elem){var name;return"input"===elem.nodeName.toLowerCase()&&elem.type===type}}function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return("input"===name||"button"===name)&&elem.type===type}}function createPositionalPseudo(fn){return markFunction((function(argument){return argument=+argument,markFunction((function(seed,matches){for(var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;i--;)seed[j=matchIndexes[i]]&&(seed[j]=!(matches[j]=seed[j]))}))}))}function testContext(context){return context&&void 0!==context.getElementsByTagName&&context}function setFilters(){}function toSelector(tokens){for(var i=0,len=tokens.length,selector="";i<len;i++)selector+=tokens[i].value;return selector}function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base&&"parentNode"===dir,doneName=done++;return combinator.first?function(elem,context,xml){for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements)return matcher(elem,context,xml)}:function(elem,context,xml){var oldCache,outerCache,newCache=[dirruns,doneName];if(xml){for(;elem=elem[dir];)if((1===elem.nodeType||checkNonElements)&&matcher(elem,context,xml))return!0}else for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements){if((oldCache=(outerCache=elem[expando]||(elem[expando]={}))[dir])&&oldCache[0]===dirruns&&oldCache[1]===doneName)return newCache[2]=oldCache[2];if(outerCache[dir]=newCache,newCache[2]=matcher(elem,context,xml))return!0}}}function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){for(var i=matchers.length;i--;)if(!matchers[i](elem,context,xml))return!1;return!0}:matchers[0]}function multipleContexts(selector,contexts,results){for(var i=0,len=contexts.length;i<len;i++)Sizzle(selector,contexts[i],results);return results}function condense(unmatched,map,filter,context,xml){for(var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=null!=map;i<len;i++)(elem=unmatched[i])&&(filter&&!filter(elem,context,xml)||(newUnmatched.push(elem),mapped&&map.push(i)));return newUnmatched}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){return postFilter&&!postFilter[expando]&&(postFilter=setMatcher(postFilter)),postFinder&&!postFinder[expando]&&(postFinder=setMatcher(postFinder,postSelector)),markFunction((function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||multipleContexts(selector||"*",context.nodeType?[context]:context,[]),matcherIn=!preFilter||!seed&&selector?elems:condense(elems,preMap,preFilter,context,xml),matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher&&matcher(matcherIn,matcherOut,context,xml),postFilter)for(temp=condense(matcherOut,postMap),postFilter(temp,[],context,xml),i=temp.length;i--;)(elem=temp[i])&&(matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem));if(seed){if(postFinder||preFilter){if(postFinder){for(temp=[],i=matcherOut.length;i--;)(elem=matcherOut[i])&&temp.push(matcherIn[i]=elem);postFinder(null,matcherOut=[],temp,xml)}for(i=matcherOut.length;i--;)(elem=matcherOut[i])&&(temp=postFinder?indexOf$2.call(seed,elem):preMap[i])>-1&&(seed[temp]=!(results[temp]=elem))}}else matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut),postFinder?postFinder(null,results,matcherOut,xml):push.apply(results,matcherOut)}))}function matcherFromTokens(tokens){for(var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator((function(elem){return elem===checkContext}),implicitRelative,!0),matchAnyContext=addCombinator((function(elem){return indexOf$2.call(checkContext,elem)>-1}),implicitRelative,!0),matchers=[function(elem,context,xml){var ret=!leadingRelative&&(xml||context!==outermostContext)||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml));return checkContext=null,ret}];i<len;i++)if(matcher=Expr.relative[tokens[i].type])matchers=[addCombinator(elementMatcher(matchers),matcher)];else{if((matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches))[expando]){for(j=++i;j<len&&!Expr.relative[tokens[j].type];j++);return setMatcher(i>1&&elementMatcher(matchers),i>1&&toSelector(tokens.slice(0,i-1).concat({value:" "===tokens[i-2].type?"*":""})).replace(rtrim,"$1"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens(tokens=tokens.slice(j)),j<len&&toSelector(tokens))}matchers.push(matcher)}return elementMatcher(matchers)}function matcherFromGroupMatchers(elementMatchers,setMatchers){var bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,outermost){var elem,j,matcher,matchedCount=0,i="0",unmatched=seed&&[],setMatched=[],contextBackup=outermostContext,elems=seed||byElement&&Expr.find.TAG("*",outermost),dirrunsUnique=dirruns+=null==contextBackup?1:Math.random()||.1,len=elems.length;for(outermost&&(outermostContext=context!==document$1&&context);i!==len&&null!=(elem=elems[i]);i++){if(byElement&&elem){for(j=0;matcher=elementMatchers[j++];)if(matcher(elem,context,xml)){results.push(elem);break}outermost&&(dirruns=dirrunsUnique)}bySet&&((elem=!matcher&&elem)&&matchedCount--,seed&&unmatched.push(elem))}if(matchedCount+=i,bySet&&i!==matchedCount){for(j=0;matcher=setMatchers[j++];)matcher(unmatched,setMatched,context,xml);if(seed){if(matchedCount>0)for(;i--;)unmatched[i]||setMatched[i]||(setMatched[i]=pop.call(results));setMatched=condense(setMatched)}push.apply(results,setMatched),outermost&&!seed&&setMatched.length>0&&matchedCount+setMatchers.length>1&&Sizzle.uniqueSort(results)}return outermost&&(dirruns=dirrunsUnique,outermostContext=contextBackup),unmatched};return bySet?markFunction(superMatcher):superMatcher}support=Sizzle.support={},isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return!!documentElement&&"HTML"!==documentElement.nodeName},setDocument=Sizzle.setDocument=function(node){var hasCompare,doc=node?node.ownerDocument||node:preferredDoc,parent=doc.defaultView;function getTop(win){try{return win.top}catch(ex){}return null}return doc!==document$1&&9===doc.nodeType&&doc.documentElement?(document$1=doc,docElem=doc.documentElement,documentIsHTML=!isXML(doc),parent&&parent!==getTop(parent)&&(parent.addEventListener?parent.addEventListener("unload",(function(){setDocument()}),!1):parent.attachEvent&&parent.attachEvent("onunload",(function(){setDocument()}))),support.attributes=!0,support.getElementsByTagName=!0,support.getElementsByClassName=rnative.test(doc.getElementsByClassName),support.getById=!0,Expr.find.ID=function(id,context){if(void 0!==context.getElementById&&documentIsHTML){var m=context.getElementById(id);return m&&m.parentNode?[m]:[]}},Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId}},Expr.find.TAG=support.getElementsByTagName?function(tag,context){if(void 0!==context.getElementsByTagName)return context.getElementsByTagName(tag)}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if("*"===tag){for(;elem=results[i++];)1===elem.nodeType&&tmp.push(elem);return tmp}return results},Expr.find.CLASS=support.getElementsByClassName&&function(className,context){if(documentIsHTML)return context.getElementsByClassName(className)},rbuggyMatches=[],rbuggyQSA=[],support.disconnectedMatch=!0,rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|")),rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join("|")),hasCompare=rnative.test(docElem.compareDocumentPosition),contains$3=hasCompare||rnative.test(docElem.contains)?function(a,b){var adown=9===a.nodeType?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!(!bup||1!==bup.nodeType||!(adown.contains?adown.contains(bup):a.compareDocumentPosition&&16&a.compareDocumentPosition(bup)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},sortOrder=hasCompare?function(a,b){if(a===b)return hasDuplicate=!0,0;var compare=!a.compareDocumentPosition-!b.compareDocumentPosition;return compare||(1&(compare=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1)||!support.sortDetached&&b.compareDocumentPosition(a)===compare?a===doc||a.ownerDocument===preferredDoc&&contains$3(preferredDoc,a)?-1:b===doc||b.ownerDocument===preferredDoc&&contains$3(preferredDoc,b)?1:sortInput?indexOf$2.call(sortInput,a)-indexOf$2.call(sortInput,b):0:4&compare?-1:1)}:function(a,b){if(a===b)return hasDuplicate=!0,0;var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(!aup||!bup)return a===doc?-1:b===doc?1:aup?-1:bup?1:sortInput?indexOf$2.call(sortInput,a)-indexOf$2.call(sortInput,b):0;if(aup===bup)return siblingCheck(a,b);for(cur=a;cur=cur.parentNode;)ap.unshift(cur);for(cur=b;cur=cur.parentNode;)bp.unshift(cur);for(;ap[i]===bp[i];)i++;return i?siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc?-1:bp[i]===preferredDoc?1:0},doc):document$1},Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)},Sizzle.matchesSelector=function(elem,expr){if((elem.ownerDocument||elem)!==document$1&&setDocument(elem),expr=expr.replace(rattributeQuotes,"='$1']"),support.matchesSelector&&documentIsHTML&&(!rbuggyMatches||!rbuggyMatches.test(expr))&&(!rbuggyQSA||!rbuggyQSA.test(expr)))try{var ret=(void 0).call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&11!==elem.document.nodeType)return ret}catch(e){}return Sizzle(expr,document$1,null,[elem]).length>0},Sizzle.contains=function(context,elem){return(context.ownerDocument||context)!==document$1&&setDocument(context),contains$3(context,elem)},Sizzle.attr=function(elem,name){(elem.ownerDocument||elem)!==document$1&&setDocument(elem);var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):void 0;return void 0!==val?val:support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null},Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)},Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;if(hasDuplicate=!support.detectDuplicates,sortInput=!support.sortStable&&results.slice(0),results.sort(sortOrder),hasDuplicate){for(;elem=results[i++];)elem===results[i]&&(j=duplicates.push(i));for(;j--;)results.splice(duplicates[j],1)}return sortInput=null,results},getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(nodeType){if(1===nodeType||9===nodeType||11===nodeType){if("string"==typeof elem.textContent)return elem.textContent;for(elem=elem.firstChild;elem;elem=elem.nextSibling)ret+=getText(elem)}else if(3===nodeType||4===nodeType)return elem.nodeValue}else for(;node=elem[i++];)ret+=getText(node);return ret},(Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(match){return match[1]=match[1].replace(runescape,funescape),match[3]=(match[3]||match[4]||match[5]||"").replace(runescape,funescape),"~="===match[2]&&(match[3]=" "+match[3]+" "),match.slice(0,4)},CHILD:function(match){return match[1]=match[1].toLowerCase(),"nth"===match[1].slice(0,3)?(match[3]||Sizzle.error(match[0]),match[4]=+(match[4]?match[5]+(match[6]||1):2*("even"===match[3]||"odd"===match[3])),match[5]=+(match[7]+match[8]||"odd"===match[3])):match[3]&&Sizzle.error(match[0]),match},PSEUDO:function(match){var excess,unquoted=!match[6]&&match[2];return matchExpr.CHILD.test(match[0])?null:(match[3]?match[2]=match[4]||match[5]||"":unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,!0))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)&&(match[0]=match[0].slice(0,excess),match[2]=unquoted.slice(0,excess)),match.slice(0,3))}},filter:{TAG:function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return"*"===nodeNameSelector?function(){return!0}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName}},CLASS:function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))&&classCache(className,(function(elem){return pattern.test("string"==typeof elem.className&&elem.className||void 0!==elem.getAttribute&&elem.getAttribute("class")||"")}))},ATTR:function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);return null==result?"!="===operator:!operator||(result+="","="===operator?result===check:"!="===operator?result!==check:"^="===operator?check&&0===result.indexOf(check):"*="===operator?check&&result.indexOf(check)>-1:"$="===operator?check&&result.slice(-check.length)===check:"~="===operator?(" "+result+" ").indexOf(check)>-1:"|="===operator&&(result===check||result.slice(0,check.length+1)===check+"-"))}},CHILD:function(type,what,argument,first,last){var simple="nth"!==type.slice(0,3),forward="last"!==type.slice(-4),ofType="of-type"===what;return 1===first&&0===last?function(elem){return!!elem.parentNode}:function(elem,context,xml){var cache,outerCache,node,diff,nodeIndex,start,dir=simple!==forward?"nextSibling":"previousSibling",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType;if(parent){if(simple){for(;dir;){for(node=elem;node=node[dir];)if(ofType?node.nodeName.toLowerCase()===name:1===node.nodeType)return!1;start=dir="only"===type&&!start&&"nextSibling"}return!0}if(start=[forward?parent.firstChild:parent.lastChild],forward&&useCache){for(nodeIndex=(cache=(outerCache=parent[expando]||(parent[expando]={}))[type]||[])[0]===dirruns&&cache[1],diff=cache[0]===dirruns&&cache[2],node=nodeIndex&&parent.childNodes[nodeIndex];node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop();)if(1===node.nodeType&&++diff&&node===elem){outerCache[type]=[dirruns,nodeIndex,diff];break}}else if(useCache&&(cache=(elem[expando]||(elem[expando]={}))[type])&&cache[0]===dirruns)diff=cache[1];else for(;(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop())&&((ofType?node.nodeName.toLowerCase()!==name:1!==node.nodeType)||!++diff||(useCache&&((node[expando]||(node[expando]={}))[type]=[dirruns,diff]),node!==elem)););return(diff-=last)===first||diff%first==0&&diff/first>=0}}},PSEUDO:function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);return fn[expando]?fn(argument):fn.length>1?(args=[pseudo,pseudo,"",argument],Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction((function(seed,matches){for(var idx,matched=fn(seed,argument),i=matched.length;i--;)seed[idx=indexOf$2.call(seed,matched[i])]=!(matches[idx]=matched[i])})):function(elem){return fn(elem,0,args)}):fn}},pseudos:{not:markFunction((function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction((function(seed,matches,context,xml){for(var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;i--;)(elem=unmatched[i])&&(seed[i]=!(matches[i]=elem))})):function(elem,context,xml){return input[0]=elem,matcher(input,null,xml,results),input[0]=null,!results.pop()}})),has:markFunction((function(selector){return function(elem){return Sizzle(selector,elem).length>0}})),contains:markFunction((function(text){return text=text.replace(runescape,funescape),function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1}})),lang:markFunction((function(lang){return ridentifier.test(lang||"")||Sizzle.error("unsupported lang: "+lang),lang=lang.replace(runescape,funescape).toLowerCase(),function(elem){var elemLang;do{if(elemLang=documentIsHTML?elem.lang:elem.getAttribute("xml:lang")||elem.getAttribute("lang"))return(elemLang=elemLang.toLowerCase())===lang||0===elemLang.indexOf(lang+"-")}while((elem=elem.parentNode)&&1===elem.nodeType);return!1}})),target:function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id},root:function(elem){return elem===docElem},focus:function(elem){return elem===document$1.activeElement&&(!document$1.hasFocus||document$1.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex)},enabled:function(elem){return!1===elem.disabled},disabled:function(elem){return!0===elem.disabled},checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return"input"===nodeName&&!!elem.checked||"option"===nodeName&&!!elem.selected},selected:function(elem){return elem.parentNode&&elem.parentNode.selectedIndex,!0===elem.selected},empty:function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling)if(elem.nodeType<6)return!1;return!0},parent:function(elem){return!Expr.pseudos.empty(elem)},header:function(elem){return rheader.test(elem.nodeName)},input:function(elem){return rinputs.test(elem.nodeName)},button:function(elem){var name=elem.nodeName.toLowerCase();return"input"===name&&"button"===elem.type||"button"===name},text:function(elem){var attr;return"input"===elem.nodeName.toLowerCase()&&"text"===elem.type&&(null==(attr=elem.getAttribute("type"))||"text"===attr.toLowerCase())},first:createPositionalPseudo((function(){return[0]})),last:createPositionalPseudo((function(matchIndexes,length){return[length-1]})),eq:createPositionalPseudo((function(matchIndexes,length,argument){return[argument<0?argument+length:argument]})),even:createPositionalPseudo((function(matchIndexes,length){for(var i=0;i<length;i+=2)matchIndexes.push(i);return matchIndexes})),odd:createPositionalPseudo((function(matchIndexes,length){for(var i=1;i<length;i+=2)matchIndexes.push(i);return matchIndexes})),lt:createPositionalPseudo((function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument;--i>=0;)matchIndexes.push(i);return matchIndexes})),gt:createPositionalPseudo((function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument;++i<length;)matchIndexes.push(i);return matchIndexes}))}}).pseudos.nth=Expr.pseudos.eq,each(["radio","checkbox","file","password","image"],(function(i){Expr.pseudos[i]=createInputPseudo(i)})),each(["submit","reset"],(function(i){Expr.pseudos[i]=createButtonPseudo(i)})),setFilters.prototype=Expr.filters=Expr.pseudos,Expr.setFilters=new setFilters,tokenize=Sizzle.tokenize=function(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];if(cached)return parseOnly?0:cached.slice(0);for(soFar=selector,groups=[],preFilters=Expr.preFilter;soFar;){for(type in matched&&!(match=rcomma.exec(soFar))||(match&&(soFar=soFar.slice(match[0].length)||soFar),groups.push(tokens=[])),matched=!1,(match=rcombinators.exec(soFar))&&(matched=match.shift(),tokens.push({value:matched,type:match[0].replace(rtrim," ")}),soFar=soFar.slice(matched.length)),Expr.filter)Expr.filter.hasOwnProperty(type)&&(!(match=matchExpr[type].exec(soFar))||preFilters[type]&&!(match=preFilters[type](match))||(matched=match.shift(),tokens.push({value:matched,type:type,matches:match}),soFar=soFar.slice(matched.length)));if(!matched)break}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0)},compile=Sizzle.compile=function(selector,match){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];if(!cached){for(match||(match=tokenize(selector)),i=match.length;i--;)(cached=matcherFromTokens(match[i]))[expando]?setMatchers.push(cached):elementMatchers.push(cached);(cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers))).selector=selector}return cached},select=Sizzle.select=function(selector,context,results,seed){var i,tokens,token,type,find,compiled="function"==typeof selector&&selector,match=!seed&&tokenize(selector=compiled.selector||selector);if(results=results||[],1===match.length){if((tokens=match[0]=match[0].slice(0)).length>2&&"ID"===(token=tokens[0]).type&&support.getById&&9===context.nodeType&&documentIsHTML&&Expr.relative[tokens[1].type]){if(!(context=(Expr.find.ID(token.matches[0].replace(runescape,funescape),context)||[])[0]))return results;compiled&&(context=context.parentNode),selector=selector.slice(tokens.shift().value.length)}for(i=matchExpr.needsContext.test(selector)?0:tokens.length;i--&&(token=tokens[i],!Expr.relative[type=token.type]);)if((find=Expr.find[type])&&(seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&testContext(context.parentNode)||context))){if(tokens.splice(i,1),!(selector=seed.length&&toSelector(tokens)))return push.apply(results,seed),results;break}}return(compiled||compile(selector,match))(seed,context,!documentIsHTML,results,rsibling.test(selector)&&testContext(context.parentNode)||context),results},support.sortStable=expando.split("").sort(sortOrder).join("")===expando,support.detectDuplicates=!!hasDuplicate,setDocument(),support.sortDetached=!0;var doc=document,push$1=Array.prototype.push,slice$1=Array.prototype.slice,rquickExpr$1=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,Event=EventUtils.Event,skipUniques=Tools.makeMap("children,contents,next,prev"),isDefined=function(obj){return void 0!==obj},isString$1=function(obj){return"string"==typeof obj},isWindow=function(obj){return obj&&obj===obj.window},createFragment=function(html,fragDoc){var container=(fragDoc=fragDoc||doc).createElement("div"),frag=fragDoc.createDocumentFragment(),node;for(container.innerHTML=html;node=container.firstChild;)frag.appendChild(node);return frag},domManipulate=function(targetNodes,sourceItem,callback,reverse){var i;if(isString$1(sourceItem))sourceItem=createFragment(sourceItem,getElementDocument(targetNodes[0]));else if(sourceItem.length&&!sourceItem.nodeType){if(sourceItem=DomQuery.makeArray(sourceItem),reverse)for(i=sourceItem.length-1;i>=0;i--)domManipulate(targetNodes,sourceItem[i],callback,reverse);else for(i=0;i<sourceItem.length;i++)domManipulate(targetNodes,sourceItem[i],callback,reverse);return targetNodes}if(sourceItem.nodeType)for(i=targetNodes.length;i--;)callback.call(targetNodes[i],sourceItem);return targetNodes},hasClass=function(node,className){return node&&className&&-1!==(" "+node.className+" ").indexOf(" "+className+" ")},wrap$1=function(elements,wrapper,all){var lastParent,newWrapper;return wrapper=DomQuery(wrapper)[0],elements.each((function(){var self=this;all&&lastParent===this.parentNode?newWrapper.appendChild(this):(lastParent=this.parentNode,newWrapper=wrapper.cloneNode(!1),this.parentNode.insertBefore(newWrapper,this),newWrapper.appendChild(this))})),elements},numericCssMap=Tools.makeMap("fillOpacity fontWeight lineHeight opacity orphans widows zIndex zoom"," "),booleanMap=Tools.makeMap("checked compact declare defer disabled ismap multiple nohref noshade nowrap readonly selected"," "),propFix={for:"htmlFor",class:"className",readonly:"readOnly"},cssFix={float:"cssFloat"},attrHooks={},cssHooks={},DomQueryConstructor=function(selector,context){return new DomQuery.fn.init(selector,context)},inArray$1=function(item,array){var i;if(array.indexOf)return array.indexOf(item);for(i=array.length;i--;)if(array[i]===item)return i;return-1},whiteSpaceRegExp$2=/^\s*|\s*$/g,trim$3=function(str){return null==str?"":(""+str).replace(whiteSpaceRegExp$2,"")},each$4=function(obj,callback){var length,key,i,value;if(obj)if(void 0===(length=obj.length)){for(key in obj)if(obj.hasOwnProperty(key)&&(value=obj[key],!1===callback.call(value,key,value)))break}else for(i=0;i<length&&(value=obj[i],!1!==callback.call(value,i,value));i++);return obj},grep=function(array,callback){var out=[];return each$4(array,(function(i,item){callback(item,i)&&out.push(item)})),out},getElementDocument=function(element){return element?9===element.nodeType?element:element.ownerDocument:doc};DomQueryConstructor.fn=DomQueryConstructor.prototype={constructor:DomQueryConstructor,selector:"",context:null,length:0,init:function(selector,context){var self=this,match,node;if(!selector)return this;if(selector.nodeType)return this.context=this[0]=selector,this.length=1,this;if(context&&context.nodeType)this.context=context;else{if(context)return DomQuery(selector).attr(context);this.context=context=document}if(isString$1(selector)){if(this.selector=selector,!(match="<"===selector.charAt(0)&&">"===selector.charAt(selector.length-1)&&selector.length>=3?[null,selector,null]:rquickExpr$1.exec(selector)))return DomQuery(context).find(selector);if(match[1])for(node=createFragment(selector,getElementDocument(context)).firstChild;node;)push$1.call(this,node),node=node.nextSibling;else{if(!(node=getElementDocument(context).getElementById(match[2])))return this;if(node.id!==match[2])return this.find(selector);this.length=1,this[0]=node}}else this.add(selector,!1);return this},toArray:function(){return Tools.toArray(this)},add:function(items,sort){var self=this,nodes,i;if(isString$1(items))return this.add(DomQuery(items));if(!1!==sort)for(nodes=DomQuery.unique(this.toArray().concat(DomQuery.makeArray(items))),this.length=nodes.length,i=0;i<nodes.length;i++)this[i]=nodes[i];else push$1.apply(this,DomQuery.makeArray(items));return this},attr:function(name,value){var self=this,hook;if("object"==typeof name)each$4(name,(function(name,value){self.attr(name,value)}));else{if(!isDefined(value)){if(self[0]&&1===self[0].nodeType){if((hook=attrHooks[name])&&hook.get)return hook.get(self[0],name);if(booleanMap[name])return self.prop(name)?name:void 0;null===(value=self[0].getAttribute(name,2))&&(value=void 0)}return value}this.each((function(){var hook;if(1===this.nodeType){if((hook=attrHooks[name])&&hook.set)return void hook.set(this,value);null===value?this.removeAttribute(name,2):this.setAttribute(name,value,2)}}))}return self},removeAttr:function(name){return this.attr(name,null)},prop:function(name,value){var self=this;if("object"==typeof(name=propFix[name]||name))each$4(name,(function(name,value){self.prop(name,value)}));else{if(!isDefined(value))return self[0]&&self[0].nodeType&&name in self[0]?self[0][name]:value;this.each((function(){1===this.nodeType&&(this[name]=value)}))}return self},css:function(name,value){var self=this,elm,hook,camel=function(name){return name.replace(/-(\D)/g,(function(a,b){return b.toUpperCase()}))},dashed=function(name){return name.replace(/[A-Z]/g,(function(a){return"-"+a}))};if("object"==typeof name)each$4(name,(function(name,value){self.css(name,value)}));else if(isDefined(value))name=camel(name),"number"!=typeof value||numericCssMap[name]||(value=value.toString()+"px"),self.each((function(){var style=this.style;if((hook=cssHooks[name])&&hook.set)hook.set(this,value);else{try{this.style[cssFix[name]||name]=value}catch(ex){}null!==value&&""!==value||(style.removeProperty?style.removeProperty(dashed(name)):style.removeAttribute(name))}}));else{if(elm=self[0],(hook=cssHooks[name])&&hook.get)return hook.get(elm);if(!elm.ownerDocument.defaultView)return elm.currentStyle?elm.currentStyle[camel(name)]:"";try{return elm.ownerDocument.defaultView.getComputedStyle(elm,null).getPropertyValue(dashed(name))}catch(ex){return}}return self},remove:function(){for(var self=this,node,i=this.length;i--;)node=this[i],Event.clean(node),node.parentNode&&node.parentNode.removeChild(node);return this},empty:function(){for(var self=this,node,i=this.length;i--;)for(node=this[i];node.firstChild;)node.removeChild(node.firstChild);return this},html:function(value){var self=this,i;if(isDefined(value)){i=this.length;try{for(;i--;)this[i].innerHTML=value}catch(ex){DomQuery(this[i]).empty().append(value)}return this}return this[0]?this[0].innerHTML:""},text:function(value){var self=this,i;if(isDefined(value)){for(i=this.length;i--;)"innerText"in this[i]?this[i].innerText=value:this[0].textContent=value;return this}return this[0]?this[0].innerText||this[0].textContent:""},append:function(){return domManipulate(this,arguments,(function(node){(1===this.nodeType||this.host&&1===this.host.nodeType)&&this.appendChild(node)}))},prepend:function(){return domManipulate(this,arguments,(function(node){(1===this.nodeType||this.host&&1===this.host.nodeType)&&this.insertBefore(node,this.firstChild)}),!0)},before:function(){var self=this;return self[0]&&self[0].parentNode?domManipulate(self,arguments,(function(node){this.parentNode.insertBefore(node,this)})):self},after:function(){var self=this;return self[0]&&self[0].parentNode?domManipulate(self,arguments,(function(node){this.parentNode.insertBefore(node,this.nextSibling)}),!0):self},appendTo:function(val){return DomQuery(val).append(this),this},prependTo:function(val){return DomQuery(val).prepend(this),this},replaceWith:function(content){return this.before(content).remove()},wrap:function(content){return wrap$1(this,content)},wrapAll:function(content){return wrap$1(this,content,!0)},wrapInner:function(content){return this.each((function(){DomQuery(this).contents().wrapAll(content)})),this},unwrap:function(){return this.parent().each((function(){DomQuery(this).replaceWith(this.childNodes)}))},clone:function(){var result=[];return this.each((function(){result.push(this.cloneNode(!0))})),DomQuery(result)},addClass:function(className){return this.toggleClass(className,!0)},removeClass:function(className){return this.toggleClass(className,!1)},toggleClass:function(className,state){var self=this;return"string"!=typeof className?self:(-1!==className.indexOf(" ")?each$4(className.split(" "),(function(){self.toggleClass(this,state)})):self.each((function(index,node){var classState=hasClass(node,className);if(classState!==state){var existingClassName=node.className;classState?node.className=trim$3((" "+existingClassName+" ").replace(" "+className+" "," ")):node.className+=existingClassName?" "+className:className}})),self)},hasClass:function(className){return hasClass(this[0],className)},each:function(callback){return each$4(this,callback)},on:function(name,callback){return this.each((function(){Event.bind(this,name,callback)}))},off:function(name,callback){return this.each((function(){Event.unbind(this,name,callback)}))},trigger:function(name){return this.each((function(){"object"==typeof name?Event.fire(this,name.type,name):Event.fire(this,name)}))},show:function(){return this.css("display","")},hide:function(){return this.css("display","none")},slice:function(){return DomQuery(slice$1.apply(this,arguments))},eq:function(index){return-1===index?this.slice(index):this.slice(index,+index+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},find:function(selector){var i,l,ret=[];for(i=0,l=this.length;i<l;i++)DomQuery.find(selector,this[i],ret);return DomQuery(ret)},filter:function(selector){return DomQuery("function"==typeof selector?grep(this.toArray(),(function(item,i){return selector(i,item)})):DomQuery.filter(selector,this.toArray()))},closest:function(selector){var result=[];return selector instanceof DomQuery&&(selector=selector[0]),this.each((function(i,node){for(;node;){if("string"==typeof selector&&DomQuery(node).is(selector)){result.push(node);break}if(node===selector){result.push(node);break}node=node.parentNode}})),DomQuery(result)},offset:function(offset){var elm,doc,docElm,x=0,y=0,pos;return offset?this.css(offset):((elm=this[0])&&(docElm=(doc=elm.ownerDocument).documentElement,elm.getBoundingClientRect&&(x=(pos=elm.getBoundingClientRect()).left+(docElm.scrollLeft||doc.body.scrollLeft)-docElm.clientLeft,y=pos.top+(docElm.scrollTop||doc.body.scrollTop)-docElm.clientTop)),{left:x,top:y})},push:push$1,sort:Array.prototype.sort,splice:Array.prototype.splice},Tools.extend(DomQueryConstructor,{extend:Tools.extend,makeArray:function(object){return isWindow(object)||object.nodeType?[object]:Tools.toArray(object)},inArray:inArray$1,isArray:Tools.isArray,each:each$4,trim:trim$3,grep:grep,find:Sizzle,expr:Sizzle.selectors,unique:Sizzle.uniqueSort,text:Sizzle.getText,contains:Sizzle.contains,filter:function(expr,elems,not){var i=elems.length;for(not&&(expr=":not("+expr+")");i--;)1!==elems[i].nodeType&&elems.splice(i,1);return elems=1===elems.length?DomQuery.find.matchesSelector(elems[0],expr)?[elems[0]]:[]:DomQuery.find.matches(expr,elems)}});var dir=function(el,prop,until){var matched=[],cur=el[prop];for("string"!=typeof until&&until instanceof DomQuery&&(until=until[0]);cur&&9!==cur.nodeType;){if(void 0!==until){if(cur===until)break;if("string"==typeof until&&DomQuery(cur).is(until))break}1===cur.nodeType&&matched.push(cur),cur=cur[prop]}return matched},sibling$1=function(node,siblingName,nodeType,until){var result=[];for(until instanceof DomQuery&&(until=until[0]);node;node=node[siblingName])if(!nodeType||node.nodeType===nodeType){if(void 0!==until){if(node===until)break;if("string"==typeof until&&DomQuery(node).is(until))break}result.push(node)}return result},firstSibling=function(node,siblingName,nodeType){for(node=node[siblingName];node;node=node[siblingName])if(node.nodeType===nodeType)return node;return null};each$4({parent:function(node){var parent=node.parentNode;return parent&&11!==parent.nodeType?parent:null},parents:function(node){return dir(node,"parentNode")},next:function(node){return firstSibling(node,"nextSibling",1)},prev:function(node){return firstSibling(node,"previousSibling",1)},children:function(node){return sibling$1(node.firstChild,"nextSibling",1)},contents:function(node){return Tools.toArray(("iframe"===node.nodeName?node.contentDocument||node.contentWindow.document:node).childNodes)}},(function(name,fn){DomQueryConstructor.fn[name]=function(selector){var self=this,result=[];this.each((function(){var nodes=fn.call(result,this,selector,result);nodes&&(DomQuery.isArray(nodes)?result.push.apply(result,nodes):result.push(nodes))})),this.length>1&&(skipUniques[name]||(result=DomQuery.unique(result)),0===name.indexOf("parents")&&(result=result.reverse()));var wrappedResult=DomQuery(result);return selector?wrappedResult.filter(selector):wrappedResult}})),each$4({parentsUntil:function(node,until){return dir(node,"parentNode",until)},nextUntil:function(node,until){return sibling$1(node,"nextSibling",1,until).slice(1)},prevUntil:function(node,until){return sibling$1(node,"previousSibling",1,until).slice(1)}},(function(name,fn){DomQueryConstructor.fn[name]=function(selector,filter){var self=this,result=[];this.each((function(){var nodes=fn.call(result,this,selector,result);nodes&&(DomQuery.isArray(nodes)?result.push.apply(result,nodes):result.push(nodes))})),this.length>1&&(result=DomQuery.unique(result),0!==name.indexOf("parents")&&"prevUntil"!==name||(result=result.reverse()));var wrappedResult=DomQuery(result);return filter?wrappedResult.filter(filter):wrappedResult}})),DomQueryConstructor.fn.is=function(selector){return!!selector&&this.filter(selector).length>0},DomQueryConstructor.fn.init.prototype=DomQueryConstructor.fn,DomQueryConstructor.overrideDefaults=function(callback){var defaults,sub=function(selector,context){return defaults=defaults||callback(),0===arguments.length&&(selector=defaults.element),context||(context=defaults.context),new sub.fn.init(selector,context)};return DomQuery.extend(sub,this),sub},DomQueryConstructor.attrHooks=attrHooks,DomQueryConstructor.cssHooks=cssHooks;var DomQuery=DomQueryConstructor,each$5=Tools.each,grep$1=Tools.grep,isIE=Env.ie,simpleSelectorRe=/^([a-z0-9],?)+$/i,setupAttrHooks=function(styles,settings,getContext){var keepValues=settings.keep_values,keepUrlHook={set:function($elm,value,name){settings.url_converter&&(value=settings.url_converter.call(settings.url_converter_scope||getContext(),value,name,$elm[0])),$elm.attr("data-mce-"+name,value).attr(name,value)},get:function($elm,name){return $elm.attr("data-mce-"+name)||$elm.attr(name)}},attrHooks={style:{set:function($elm,value){null===value||"object"!=typeof value?(keepValues&&$elm.attr("data-mce-style",value),null!==value&&"string"==typeof value?($elm.removeAttr("style"),$elm.css(styles.parse(value))):$elm.attr("style",value)):$elm.css(value)},get:function($elm){var value=$elm.attr("data-mce-style")||$elm.attr("style");return value=styles.serialize(styles.parse(value),$elm[0].nodeName)}}};return keepValues&&(attrHooks.href=attrHooks.src=keepUrlHook),attrHooks},updateInternalStyleAttr=function(styles,$elm){var rawValue=$elm.attr("style"),value=styles.serialize(styles.parse(rawValue),$elm[0].nodeName);value||(value=null),$elm.attr("data-mce-style",value)},findNodeIndex=function(node,normalized){var idx=0,lastNodeType,nodeType;if(node)for(lastNodeType=node.nodeType,node=node.previousSibling;node;node=node.previousSibling)nodeType=node.nodeType,(!normalized||3!==nodeType||nodeType!==lastNodeType&&node.nodeValue.length)&&(idx++,lastNodeType=nodeType);return idx},DOMUtils=function(doc,settings){void 0===settings&&(settings={});var addedStyles={},win=window,files={},counter=0,stdMode=!0,boxModel=!0,styleSheetLoader=instance.forElement(SugarElement.fromDom(doc),{contentCssCors:settings.contentCssCors,referrerPolicy:settings.referrerPolicy}),boundEvents=[],schema=settings.schema?settings.schema:Schema({}),styles=Styles({url_converter:settings.url_converter,url_converter_scope:settings.url_converter_scope},settings.schema),events=settings.ownEvents?new EventUtils:EventUtils.Event,blockElementsMap=schema.getBlockElements(),$=DomQuery.overrideDefaults((function(){return{context:doc,element:self.getRoot()}})),isBlock,get=function(elm){return elm&&doc&&isString(elm)?doc.getElementById(elm):elm},$$=function(elm){return $("string"==typeof elm?get(elm):elm)},getAttrib=function(elm,name,defaultVal){var hook,value,$elm=$$(elm);return $elm.length&&(value=(hook=attrHooks[name])&&hook.get?hook.get($elm,name):$elm.attr(name)),void 0===value&&(value=defaultVal||""),value},getAttribs=function(elm){var node=get(elm);return node?node.attributes:[]},setAttrib=function(elm,name,value){""===value&&(value=null);var $elm=$$(elm),originalValue=$elm.attr(name);if($elm.length){var hook=attrHooks[name];hook&&hook.set?hook.set($elm,value,name):$elm.attr(name,value),originalValue!==value&&settings.onSetAttrib&&settings.onSetAttrib({attrElm:$elm,attrName:name,attrValue:value})}},clone=function(node,deep){if(!isIE||1!==node.nodeType||deep)return node.cloneNode(deep);var clone_1=doc.createElement(node.nodeName);return each$5(getAttribs(node),(function(attr){setAttrib(clone_1,attr.nodeName,getAttrib(node,attr.nodeName))})),clone_1},getRoot=function(){return settings.root_element||doc.body},getViewPort,getPos$1=function(elm,rootElm){return getPos(doc.body,get(elm),rootElm)},setStyle=function(elm,name,value){var $elm=isString(name)?$$(elm).css(name,value):$$(elm).css(name);settings.update_styles&&updateInternalStyleAttr(styles,$elm)},setStyles=function(elm,stylesArg){var $elm=$$(elm).css(stylesArg);settings.update_styles&&updateInternalStyleAttr(styles,$elm)},getStyle=function(elm,name,computed){var $elm=$$(elm);return computed?$elm.css(name):("float"===(name=name.replace(/-(\D)/g,(function(a,b){return b.toUpperCase()})))&&(name=Env.browser.isIE()?"styleFloat":"cssFloat"),$elm[0]&&$elm[0].style?$elm[0].style[name]:void 0)},getSize=function(elm){var w,h;return elm=get(elm),w=getStyle(elm,"width"),h=getStyle(elm,"height"),-1===w.indexOf("px")&&(w=0),-1===h.indexOf("px")&&(h=0),{w:parseInt(w,10)||elm.offsetWidth||elm.clientWidth,h:parseInt(h,10)||elm.offsetHeight||elm.clientHeight}},getRect,is=function(elm,selector){var i;if(!elm)return!1;if(!Array.isArray(elm)){if("*"===selector)return 1===elm.nodeType;if(simpleSelectorRe.test(selector)){var selectors=selector.toLowerCase().split(/,/),elmName=elm.nodeName.toLowerCase();for(i=selectors.length-1;i>=0;i--)if(selectors[i]===elmName)return!0;return!1}if(elm.nodeType&&1!==elm.nodeType)return!1}var elms=Array.isArray(elm)?elm:[elm];return Sizzle(selector,elms[0].ownerDocument||elms[0],null,elms).length>0},getParents=function(elm,selector,root,collect){var result=[],selectorVal,node=get(elm);for(collect=void 0===collect,root=root||("BODY"!==getRoot().nodeName?getRoot().parentNode:null),Tools.is(selector,"string")&&(selectorVal=selector,selector="*"===selector?function(node){return 1===node.nodeType}:function(node){return is(node,selectorVal)});node&&!(node===root||isNullable(node.nodeType)||isDocument$1(node)||isDocumentFragment$1(node));){if(!selector||"function"==typeof selector&&selector(node)){if(!collect)return[node];result.push(node)}node=node.parentNode}return collect?result:null},getParent,_findSib=function(node,selector,name){var func=selector;if(node)for("string"==typeof selector&&(func=function(node){return is(node,selector)}),node=node[name];node;node=node[name])if("function"==typeof func&&func(node))return node;return null},getNext,getPrev,select=function(selector,scope){return Sizzle(selector,get(scope)||settings.root_element||doc,[])},run=function(elm,func,scope){var result,node="string"==typeof elm?get(elm):elm;if(!node)return!1;if(Tools.isArray(node)&&(node.length||0===node.length))return result=[],each$5(node,(function(elm,i){elm&&result.push(func.call(scope,"string"==typeof elm?get(elm):elm,i))})),result;var context=scope||this;return func.call(context,node)},setAttribs=function(elm,attrs){$$(elm).each((function(i,node){each$5(attrs,(function(value,name){setAttrib(node,name,value)}))}))},setHTML=function(elm,html){var $elm=$$(elm);isIE?$elm.each((function(i,target){if(!1!==target.canHaveHTML){for(;target.firstChild;)target.removeChild(target.firstChild);try{target.innerHTML="<br>"+html,target.removeChild(target.firstChild)}catch(ex){DomQuery("<div></div>").html("<br>"+html).contents().slice(1).appendTo(target)}return html}})):$elm.html(html)},add=function(parentElm,name,attrs,html,create){return run(parentElm,(function(parentElm){var newElm="string"==typeof name?doc.createElement(name):name;return setAttribs(newElm,attrs),html&&("string"!=typeof html&&html.nodeType?newElm.appendChild(html):"string"==typeof html&&setHTML(newElm,html)),create?newElm:parentElm.appendChild(newElm)}))},create=function(name,attrs,html){return add(doc.createElement(name),name,attrs,html,!0)},decode,encode=Entities.encodeAllRaw,createHTML,createFragment=function(html){var node,container=doc.createElement("div"),frag=doc.createDocumentFragment();for(frag.appendChild(container),html&&(container.innerHTML=html);node=container.firstChild;)frag.appendChild(node);return frag.removeChild(container),frag},remove=function(node,keepChildren){var $node=$$(node);return keepChildren?$node.each((function(){for(var child;child=this.firstChild;)3===child.nodeType&&0===child.data.length?this.removeChild(child):this.parentNode.insertBefore(child,this)})).remove():$node.remove(),$node.length>1?$node.toArray():$node[0]},removeAllAttribs,parseStyle=function(cssText){return styles.parse(cssText)},serializeStyle=function(stylesArg,name){return styles.serialize(stylesArg,name)},addStyle=function(cssText){var head,styleElm;if(self!==DOMUtils.DOM&&doc===document){if(addedStyles[cssText])return;addedStyles[cssText]=!0}(styleElm=doc.getElementById("mceDefaultStyles"))||((styleElm=doc.createElement("style")).id="mceDefaultStyles",styleElm.type="text/css",(head=doc.getElementsByTagName("head")[0]).firstChild?head.insertBefore(styleElm,head.firstChild):head.appendChild(styleElm)),styleElm.styleSheet?styleElm.styleSheet.cssText+=cssText:styleElm.appendChild(doc.createTextNode(cssText))},loadCSS=function(urls){urls||(urls=""),each(urls.split(","),(function(url){files[url]=!0,styleSheetLoader.load(url,noop)}))},toggleClass=function(elm,cls,state){$$(elm).toggleClass(cls,state).each((function(){""===this.className&&DomQuery(this).attr("class",null)}))},addClass=function(elm,cls){$$(elm).addClass(cls)},removeClass,hasClass=function(elm,cls){return $$(elm).hasClass(cls)},show=function(elm){$$(elm).show()},hide=function(elm){$$(elm).hide()},isHidden=function(elm){return"none"===$$(elm).css("display")},uniqueId,getOuterHTML=function(elm){var node="string"==typeof elm?get(elm):elm;return isElement$1(node)?node.outerHTML:DomQuery("<div></div>").append(DomQuery(node).clone()).html()},setOuterHTML=function(elm,html){$$(elm).each((function(){try{if("outerHTML"in this)return void(this.outerHTML=html)}catch(ex){}remove(DomQuery(this).html(html),!0)}))},insertAfter=function(node,reference){var referenceNode=get(reference);return run(node,(function(node){var parent=referenceNode.parentNode,nextSibling=referenceNode.nextSibling;return nextSibling?parent.insertBefore(node,nextSibling):parent.appendChild(node),node}))},replace=function(newElm,oldElm,keepChildren){return run(oldElm,(function(oldElm){return Tools.is(oldElm,"array")&&(newElm=newElm.cloneNode(!0)),keepChildren&&each$5(grep$1(oldElm.childNodes),(function(node){newElm.appendChild(node)})),oldElm.parentNode.replaceChild(newElm,oldElm)}))},rename=function(elm,name){var newElm;return elm.nodeName!==name.toUpperCase()&&(newElm=create(name),each$5(getAttribs(elm),(function(attrNode){setAttrib(newElm,attrNode.nodeName,getAttrib(elm,attrNode.nodeName))})),replace(newElm,elm,!0)),newElm||elm},findCommonAncestor,toHex=function(rgbVal){return styles.toHex(Tools.trim(rgbVal))},isNonEmptyElement=function(node){if(isElement$1(node)){var isNamedAnchor="a"===node.nodeName.toLowerCase()&&!getAttrib(node,"href")&&getAttrib(node,"id");if(getAttrib(node,"name")||getAttrib(node,"data-mce-bookmark")||isNamedAnchor)return!0}return!1},isEmpty=function(node,elements){var type,name,brCount=0;if(isNonEmptyElement(node))return!1;if(node=node.firstChild){var walker=new DomTreeWalker(node,node.parentNode),whitespace=schema?schema.getWhiteSpaceElements():{};elements=elements||(schema?schema.getNonEmptyElements():null);do{if(type=node.nodeType,isElement$1(node)){var bogusVal=node.getAttribute("data-mce-bogus");if(bogusVal){node=walker.next("all"===bogusVal);continue}if(name=node.nodeName.toLowerCase(),elements&&elements[name]){if("br"===name){brCount++,node=walker.next();continue}return!1}if(isNonEmptyElement(node))return!1}if(8===type)return!1;if(3===type&&!isWhitespaceText(node.nodeValue))return!1;if(3===type&&node.parentNode&&whitespace[node.parentNode.nodeName]&&isWhitespaceText(node.nodeValue))return!1;node=walker.next()}while(node)}return brCount<=1},createRng=function(){return doc.createRange()},split=function(parentElm,splitElm,replacementElm){var range=createRng(),beforeFragment,afterFragment,parentNode;if(parentElm&&splitElm)return range.setStart(parentElm.parentNode,findNodeIndex(parentElm)),range.setEnd(splitElm.parentNode,findNodeIndex(splitElm)),beforeFragment=range.extractContents(),(range=createRng()).setStart(splitElm.parentNode,findNodeIndex(splitElm)+1),range.setEnd(parentElm.parentNode,findNodeIndex(parentElm)+1),afterFragment=range.extractContents(),(parentNode=parentElm.parentNode).insertBefore(trimNode(self,beforeFragment),parentElm),replacementElm?parentNode.insertBefore(replacementElm,parentElm):parentNode.insertBefore(splitElm,parentElm),parentNode.insertBefore(trimNode(self,afterFragment),parentElm),remove(parentElm),replacementElm||splitElm},bind=function(target,name,func,scope){if(Tools.isArray(target)){for(var i=target.length,rv=[];i--;)rv[i]=bind(target[i],name,func,scope);return rv}var output;return!settings.collect||target!==doc&&target!==win||boundEvents.push([target,name,func,scope]),events.bind(target,name,func,scope||self)},unbind=function(target,name,func){if(Tools.isArray(target)){for(var i=target.length,rv=[];i--;)rv[i]=unbind(target[i],name,func);return rv}if(boundEvents.length>0&&(target===doc||target===win))for(var i=boundEvents.length;i--;){var item=boundEvents[i];target!==item[0]||name&&name!==item[1]||func&&func!==item[2]||events.unbind(item[0],item[1],item[2])}return events.unbind(target,name,func)},fire=function(target,name,evt){return events.fire(target,name,evt)},getContentEditable=function(node){if(node&&isElement$1(node)){var contentEditable=node.getAttribute("data-mce-contenteditable");return contentEditable&&"inherit"!==contentEditable?contentEditable:"inherit"!==node.contentEditable?node.contentEditable:null}return null},getContentEditableParent=function(node){for(var root=getRoot(),state=null;node&&node!==root&&null===(state=getContentEditable(node));node=node.parentNode);return state},destroy=function(){if(boundEvents.length>0)for(var i=boundEvents.length;i--;){var item=boundEvents[i];events.unbind(item[0],item[1],item[2])}each$1(files,(function(_,url){styleSheetLoader.unload(url),delete files[url]})),Sizzle.setDocument&&Sizzle.setDocument()},isChildOf,dumpRng,self={doc:doc,settings:settings,win:win,files:files,stdMode:!0,boxModel:!0,styleSheetLoader:styleSheetLoader,boundEvents:boundEvents,styles:styles,schema:schema,events:events,isBlock:function(node){if("string"==typeof node)return!!blockElementsMap[node];if(node){var type=node.nodeType;if(type)return!(1!==type||!blockElementsMap[node.nodeName])}return!1},$:$,$$:$$,root:null,clone:clone,getRoot:getRoot,getViewPort:function(argWin){var vp=getBounds(argWin);return{x:vp.x,y:vp.y,w:vp.width,h:vp.height}},getRect:function(elm){elm=get(elm);var pos=getPos$1(elm),size=getSize(elm);return{x:pos.x,y:pos.y,w:size.w,h:size.h}},getSize:getSize,getParent:function(node,selector,root){var parents=getParents(node,selector,root,!1);return parents&&parents.length>0?parents[0]:null},getParents:getParents,get:get,getNext:function(node,selector){return _findSib(node,selector,"nextSibling")},getPrev:function(node,selector){return _findSib(node,selector,"previousSibling")},select:select,is:is,add:add,create:create,createHTML:function(name,attrs,html){var outHtml="",key;for(key in outHtml+="<"+name,attrs)attrs.hasOwnProperty(key)&&null!==attrs[key]&&void 0!==attrs[key]&&(outHtml+=" "+key+'="'+encode(attrs[key])+'"');return void 0!==html?outHtml+">"+html+"</"+name+">":outHtml+" />"},createFragment:createFragment,remove:remove,setStyle:setStyle,getStyle:getStyle,setStyles:setStyles,removeAllAttribs:function(e){return run(e,(function(e){var i,attrs=e.attributes;for(i=attrs.length-1;i>=0;i--)e.removeAttributeNode(attrs.item(i))}))},setAttrib:setAttrib,setAttribs:setAttribs,getAttrib:getAttrib,getPos:getPos$1,parseStyle:parseStyle,serializeStyle:serializeStyle,addStyle:addStyle,loadCSS:loadCSS,addClass:addClass,removeClass:function(elm,cls){toggleClass(elm,cls,!1)},hasClass:hasClass,toggleClass:toggleClass,show:show,hide:hide,isHidden:isHidden,uniqueId:function(prefix){return(prefix||"mce_")+counter++},setHTML:setHTML,getOuterHTML:getOuterHTML,setOuterHTML:setOuterHTML,decode:Entities.decode,encode:encode,insertAfter:insertAfter,replace:replace,rename:rename,findCommonAncestor:function(a,b){for(var ps=a,pe;ps;){for(pe=b;pe&&ps!==pe;)pe=pe.parentNode;if(ps===pe)break;ps=ps.parentNode}return!ps&&a.ownerDocument?a.ownerDocument.documentElement:ps},toHex:toHex,run:run,getAttribs:getAttribs,isEmpty:isEmpty,createRng:createRng,nodeIndex:findNodeIndex,split:split,bind:bind,unbind:unbind,fire:fire,getContentEditable:getContentEditable,getContentEditableParent:getContentEditableParent,destroy:destroy,isChildOf:function(node,parent){for(;node;){if(parent===node)return!0;node=node.parentNode}return!1},dumpRng:function(r){return"startContainer: "+r.startContainer.nodeName+", startOffset: "+r.startOffset+", endContainer: "+r.endContainer.nodeName+", endOffset: "+r.endOffset}},attrHooks=setupAttrHooks(styles,settings,(function(){return self}));return self};DOMUtils.DOM=DOMUtils(document),DOMUtils.nodeIndex=findNodeIndex;var DOM=DOMUtils.DOM,each$6=Tools.each,grep$2=Tools.grep,QUEUED=0,LOADING=1,LOADED=2,FAILED=3,ScriptLoader=function(){function ScriptLoader(settings){void 0===settings&&(settings={}),this.states={},this.queue=[],this.scriptLoadedCallbacks={},this.queueLoadedCallbacks=[],this.loading=0,this.settings=settings}return ScriptLoader.prototype._setReferrerPolicy=function(referrerPolicy){this.settings.referrerPolicy=referrerPolicy},ScriptLoader.prototype.loadScript=function(url,success,failure){var dom=DOM,elm,cleanup=function(){dom.remove(id),elm&&(elm.onerror=elm.onload=elm=null)},done=function(){cleanup(),success()},error=function(){cleanup(),isFunction(failure)?failure():"undefined"!=typeof console&&console.log&&console.log("Failed to load script: "+url)},id=dom.uniqueId();(elm=document.createElement("script")).id=id,elm.type="text/javascript",elm.src=Tools._addCacheSuffix(url),this.settings.referrerPolicy&&dom.setAttrib(elm,"referrerpolicy",this.settings.referrerPolicy),elm.onload=done,elm.onerror=error,(document.getElementsByTagName("head")[0]||document.body).appendChild(elm)},ScriptLoader.prototype.isDone=function(url){return 2===this.states[url]},ScriptLoader.prototype.markDone=function(url){this.states[url]=2},ScriptLoader.prototype.add=function(url,success,scope,failure){var state=this.states[url];this.queue.push(url),void 0===state&&(this.states[url]=0),success&&(this.scriptLoadedCallbacks[url]||(this.scriptLoadedCallbacks[url]=[]),this.scriptLoadedCallbacks[url].push({success:success,failure:failure,scope:scope||this}))},ScriptLoader.prototype.load=function(url,success,scope,failure){return this.add(url,success,scope,failure)},ScriptLoader.prototype.remove=function(url){delete this.states[url],delete this.scriptLoadedCallbacks[url]},ScriptLoader.prototype.loadQueue=function(success,scope,failure){this.loadScripts(this.queue,success,scope,failure)},ScriptLoader.prototype.loadScripts=function(scripts,success,scope,failure){var self=this,failures=[],execCallbacks=function(name,url){each$6(self.scriptLoadedCallbacks[url],(function(callback){isFunction(callback[name])&&callback[name].call(callback.scope)})),self.scriptLoadedCallbacks[url]=void 0};self.queueLoadedCallbacks.push({success:success,failure:failure,scope:scope||this});var loadScripts=function(){var loadingScripts=grep$2(scripts);if(scripts.length=0,each$6(loadingScripts,(function(url){2!==self.states[url]?3!==self.states[url]?1!==self.states[url]&&(self.states[url]=1,self.loading++,self.loadScript(url,(function(){self.states[url]=2,self.loading--,execCallbacks("success",url),loadScripts()}),(function(){self.states[url]=3,self.loading--,failures.push(url),execCallbacks("failure",url),loadScripts()}))):execCallbacks("failure",url):execCallbacks("success",url)})),!self.loading){var notifyCallbacks=self.queueLoadedCallbacks.slice(0);self.queueLoadedCallbacks.length=0,each$6(notifyCallbacks,(function(callback){0===failures.length?isFunction(callback.success)&&callback.success.call(callback.scope):isFunction(callback.failure)&&callback.failure.call(callback.scope,failures)}))}};loadScripts()},ScriptLoader.ScriptLoader=new ScriptLoader,ScriptLoader}(),Cell=function(initial){var value=initial,get,set;return{get:function(){return value},set:function(v){value=v}}},isRaw=function(str){return isObject(str)&&has(str,"raw")},isTokenised=function(str){return isArray(str)&&str.length>1},data={},currentCode=Cell("en"),getLanguageData=function(){return get$1(data,currentCode.get())},getData,setCode,getCode,add,translate,isRtl,hasCode,I18n={getData:function(){return map$1(data,(function(value){return __assign({},value)}))},setCode:function(newCode){newCode&&currentCode.set(newCode)},getCode:function(){return currentCode.get()},add:function(code,items){var langData=data[code];langData||(data[code]=langData={}),each$1(items,(function(translation,name){langData[name.toLowerCase()]=translation}))},translate:function(text){var langData=getLanguageData().getOr({}),toString=function(obj){return isFunction(obj)?Object.prototype.toString.call(obj):isEmpty(obj)?"":""+obj},isEmpty=function(text){return""===text||null==text},getLangData=function(text){var textstr=toString(text);return get$1(langData,textstr.toLowerCase()).map(toString).getOr(textstr)},removeContext=function(str){return str.replace(/{context:\w+}$/,"")};if(isEmpty(text))return"";if(isRaw(text))return toString(text.raw);if(isTokenised(text)){var values_1=text.slice(1),substitued;return removeContext(getLangData(text[0]).replace(/\{([0-9]+)\}/g,(function($1,$2){return has(values_1,$2)?toString(values_1[$2]):$1})))}return removeContext(getLangData(text))},isRtl:function(){return getLanguageData().bind((function(items){return get$1(items,"_dir")})).exists((function(dir){return"rtl"===dir}))},hasCode:function(code){return has(data,code)}},AddOnManager=function(){var items=[],urls={},lookup={},_listeners=[],runListeners=function(name,state){var matchedListeners=filter(_listeners,(function(listener){return listener.name===name&&listener.state===state}));each(matchedListeners,(function(listener){return listener.callback()}))},get,dependencies=function(name){var result;return lookup[name]&&(result=lookup[name].dependencies),result||[]},requireLangPack=function(name,languages){!1!==AddOnManager.languageLoad&&waitFor(name,(function(){var language=I18n.getCode(),wrappedLanguages;!language||languages&&-1===(","+(languages||"")+",").indexOf(","+language+",")||ScriptLoader.ScriptLoader.add(urls[name]+"/langs/"+language+".js")}),"loaded")},add=function(id,addOn,dependencies){var addOnConstructor=addOn;return items.push(addOnConstructor),lookup[id]={instance:addOnConstructor,dependencies:dependencies},runListeners(id,"added"),addOnConstructor},remove=function(name){delete urls[name],delete lookup[name]},createUrl=function(baseUrl,dep){return"object"==typeof dep?dep:"string"==typeof baseUrl?{prefix:"",resource:dep,suffix:""}:{prefix:baseUrl.prefix,resource:dep,suffix:baseUrl.suffix}},addComponents,loadDependencies=function(name,addOnUrl,success,scope){var deps=dependencies(name);each(deps,(function(dep){var newUrl=createUrl(addOnUrl,dep);load(newUrl.resource,newUrl,void 0,void 0)})),success&&(scope?success.call(scope):success.call(ScriptLoader))},load=function(name,addOnUrl,success,scope,failure){if(!urls[name]){var urlString="string"==typeof addOnUrl?addOnUrl:addOnUrl.prefix+addOnUrl.resource+addOnUrl.suffix;0!==urlString.indexOf("/")&&-1===urlString.indexOf("://")&&(urlString=AddOnManager.baseURL+"/"+urlString),urls[name]=urlString.substring(0,urlString.lastIndexOf("/"));var done=function(){runListeners(name,"loaded"),loadDependencies(name,addOnUrl,success,scope)};lookup[name]?done():ScriptLoader.ScriptLoader.add(urlString,done,scope,failure)}},waitFor=function(name,callback,state){void 0===state&&(state="added"),has(lookup,name)&&"added"===state?callback():has(urls,name)&&"loaded"===state?callback():_listeners.push({name:name,state:state,callback:callback})};return{items:items,urls:urls,lookup:lookup,_listeners:_listeners,get:function(name){if(lookup[name])return lookup[name].instance},dependencies:dependencies,requireLangPack:requireLangPack,add:add,remove:remove,createUrl:createUrl,addComponents:function(pluginName,scripts){var pluginUrl=urls[pluginName];each(scripts,(function(script){ScriptLoader.ScriptLoader.add(pluginUrl+"/"+script)}))},load:load,waitFor:waitFor}};AddOnManager.languageLoad=!0,AddOnManager.baseURL="",AddOnManager.PluginManager=AddOnManager(),AddOnManager.ThemeManager=AddOnManager();var first=function(fn,rate){var timer=null,cancel,throttle;return{cancel:function(){null!==timer&&(clearTimeout(timer),timer=null)},throttle:function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];null===timer&&(timer=setTimeout((function(){fn.apply(null,args),timer=null}),rate))}}},last$2=function(fn,rate){var timer=null,cancel,throttle;return{cancel:function(){null!==timer&&(clearTimeout(timer),timer=null)},throttle:function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];null!==timer&&clearTimeout(timer),timer=setTimeout((function(){fn.apply(null,args),timer=null}),rate)}}},read=function(element,attr){var value=get$4(element,attr);return void 0===value||""===value?[]:value.split(" ")},add$1=function(element,attr,id){var old,nu=read(element,attr).concat([id]);return set(element,attr,nu.join(" ")),!0},remove$2=function(element,attr,id){var nu=filter(read(element,attr),(function(v){return v!==id}));return nu.length>0?set(element,attr,nu.join(" ")):remove$1(element,attr),!1},supports=function(element){return void 0!==element.dom.classList},get$6=function(element){return read(element,"class")},add$2=function(element,clazz){return add$1(element,"class",clazz)},remove$3=function(element,clazz){return remove$2(element,"class",clazz)},add$3=function(element,clazz){supports(element)?element.dom.classList.add(clazz):add$2(element,clazz)},cleanClass=function(element){var classList;0===(supports(element)?element.dom.classList:get$6(element)).length&&remove$1(element,"class")},remove$4=function(element,clazz){var classList;supports(element)?element.dom.classList.remove(clazz):remove$3(element,clazz);cleanClass(element)},has$2=function(element,clazz){return supports(element)&&element.dom.classList.contains(clazz)},descendants=function(scope,predicate){var result=[];return each(children(scope),(function(x){predicate(x)&&(result=result.concat([x])),result=result.concat(descendants(x,predicate))})),result},descendants$1=function(scope,selector){return all(selector,scope)},annotation=constant("mce-annotation"),dataAnnotation=constant("data-mce-annotation"),dataAnnotationId=constant("data-mce-annotation-uid"),identify=function(editor,annotationName){var rng=editor.selection.getRng(),start=SugarElement.fromDom(rng.startContainer),root=SugarElement.fromDom(editor.getBody()),selector=annotationName.fold((function(){return"."+annotation()}),(function(an){return"["+dataAnnotation()+'="'+an+'"]'})),newStart=child(start,rng.startOffset).getOr(start),closest=closest$1(newStart,selector,(function(n){return eq$2(n,root)})),getAttr=function(c,property){return has$1(c,property)?Optional.some(get$4(c,property)):Optional.none()};return closest.bind((function(c){return getAttr(c,""+dataAnnotationId()).bind((function(uid){return getAttr(c,""+dataAnnotation()).map((function(name){var elements=findMarkers(editor,uid);return{uid:uid,name:name,elements:elements}}))}))}))},isAnnotation=function(elem){return isElement(elem)&&has$2(elem,annotation())},findMarkers=function(editor,uid){var body=SugarElement.fromDom(editor.getBody());return descendants$1(body,"["+dataAnnotationId()+'="'+uid+'"]')},findAll=function(editor,name){var body=SugarElement.fromDom(editor.getBody()),markers=descendants$1(body,"["+dataAnnotation()+'="'+name+'"]'),directory={};return each(markers,(function(m){var uid=get$4(m,dataAnnotationId()),nodesAlready=directory.hasOwnProperty(uid)?directory[uid]:[];directory[uid]=nodesAlready.concat([m])})),directory},setup=function(editor,_registry){var changeCallbacks=Cell({}),initData=function(){return{listeners:[],previous:Cell(Optional.none())}},withCallbacks=function(name,f){updateCallbacks(name,(function(data){return f(data),data}))},updateCallbacks=function(name,f){var callbackMap=changeCallbacks.get(),data,outputData=f(callbackMap.hasOwnProperty(name)?callbackMap[name]:initData());callbackMap[name]=outputData,changeCallbacks.set(callbackMap)},fireCallbacks=function(name,uid,elements){withCallbacks(name,(function(data){each(data.listeners,(function(f){return f(!0,name,{uid:uid,nodes:map(elements,(function(elem){return elem.dom}))})}))}))},fireNoAnnotation=function(name){withCallbacks(name,(function(data){each(data.listeners,(function(f){return f(!1,name)}))}))},onNodeChange=last$2((function(){var callbackMap=changeCallbacks.get(),annotations=sort$1(keys(callbackMap));each(annotations,(function(name){updateCallbacks(name,(function(data){var prev=data.previous.get();return identify(editor,Optional.some(name)).fold((function(){prev.isSome()&&(fireNoAnnotation(name),data.previous.set(Optional.none()))}),(function(_a){var uid=_a.uid,name=_a.name,elements=_a.elements;prev.is(uid)||(fireCallbacks(name,uid,elements),data.previous.set(Optional.some(uid)))})),{previous:data.previous,listeners:data.listeners}}))}))}),30),addListener;return editor.on("remove",(function(){onNodeChange.cancel()})),editor.on("NodeChange",(function(){onNodeChange.throttle()})),{addListener:function(name,f){updateCallbacks(name,(function(data){return{previous:data.previous,listeners:data.listeners.concat([f])}}))}}},setup$1=function(editor,registry){var identifyParserNode=function(span){return Optional.from(span.attr(dataAnnotation())).bind(registry.lookup)};editor.on("init",(function(){editor.serializer.addNodeFilter("span",(function(spans){each(spans,(function(span){identifyParserNode(span).each((function(settings){!1===settings.persistent&&span.unwrap()}))}))}))}))},create$2=function(){var annotations={},register,lookup;return{register:function(name,settings){annotations[name]={name:name,settings:settings}},lookup:function(name){return annotations.hasOwnProperty(name)?Optional.from(annotations[name]).map((function(a){return a.settings})):Optional.none()}}},unique=0,generate$1=function(prefix){var date,time=(new Date).getTime(),random;return prefix+"_"+Math.floor(1e9*Math.random())+ ++unique+String(time)},add$4=function(element,classes){each(classes,(function(x){add$3(element,x)}))},fromHtml$1=function(html,scope){var doc,div=(scope||document).createElement("div");return div.innerHTML=html,children(SugarElement.fromDom(div))},get$7=function(element){return element.dom.innerHTML},set$1=function(element,content){var owner$1,docDom=owner(element).dom,fragment=SugarElement.fromDom(docDom.createDocumentFragment()),contentElements=fromHtml$1(content,docDom);append$1(fragment,contentElements),empty(element),append(element,fragment)},clone$1=function(original,isDeep){return SugarElement.fromDom(original.dom.cloneNode(isDeep))},shallow=function(original){return clone$1(original,!1)},deep=function(original){return clone$1(original,!0)},TextWalker=function(startNode,rootNode,isBoundary){void 0===isBoundary&&(isBoundary=never);var walker=new DomTreeWalker(startNode,rootNode),walk=function(direction){var next;do{next=walker[direction]()}while(next&&!isText$1(next)&&!isBoundary(next));return Optional.from(next).filter(isText$1)};return{current:function(){return Optional.from(walker.current()).filter(isText$1)},next:function(){return walk("next")},prev:function(){return walk("prev")},prev2:function(){return walk("prev2")}}},TextSeeker=function(dom,isBoundary){var isBlockBoundary=isBoundary||function(node){return dom.isBlock(node)||isBr(node)||isContentEditableFalse(node)},walk=function(node,offset,walker,process){if(isText$1(node)){var newOffset=process(node,offset,node.data);if(-1!==newOffset)return Optional.some({container:node,offset:newOffset})}return walker().bind((function(next){return walk(next.container,next.offset,walker,process)}))},backwards,forwards;return{backwards:function(node,offset,process,root){var walker=TextWalker(node,root,isBlockBoundary);return walk(node,offset,(function(){return walker.prev().map((function(prev){return{container:prev,offset:prev.length}}))}),process).getOrNull()},forwards:function(node,offset,process,root){var walker=TextWalker(node,root,isBlockBoundary);return walk(node,offset,(function(){return walker.next().map((function(next){return{container:next,offset:0}}))}),process).getOrNull()}}},cat=function(arr){for(var r=[],push=function(x){r.push(x)},i=0;i<arr.length;i++)arr[i].each(push);return r},lift2=function(oa,ob,f){return oa.isSome()&&ob.isSome()?Optional.some(f(oa.getOrDie(),ob.getOrDie())):Optional.none()},lift3=function(oa,ob,oc,f){return oa.isSome()&&ob.isSome()&&oc.isSome()?Optional.some(f(oa.getOrDie(),ob.getOrDie(),oc.getOrDie())):Optional.none()},someIf=function(b,a){return b?Optional.some(a):Optional.none()},round=Math.round,clone$2=function(rect){return rect?{left:round(rect.left),top:round(rect.top),bottom:round(rect.bottom),right:round(rect.right),width:round(rect.width),height:round(rect.height)}:{left:0,top:0,bottom:0,right:0,width:0,height:0}},collapse=function(rect,toStart){return rect=clone$2(rect),toStart?rect.right=rect.left:(rect.left=rect.left+rect.width,rect.right=rect.left),rect.width=0,rect},isEqual=function(rect1,rect2){return rect1.left===rect2.left&&rect1.top===rect2.top&&rect1.bottom===rect2.bottom&&rect1.right===rect2.right},isValidOverflow=function(overflowY,rect1,rect2){return overflowY>=0&&overflowY<=Math.min(rect1.height,rect2.height)/2},isAbove=function(rect1,rect2){var halfHeight=Math.min(rect2.height/2,rect1.height/2);return rect1.bottom-halfHeight<rect2.top||!(rect1.top>rect2.bottom)&&isValidOverflow(rect2.top-rect1.bottom,rect1,rect2)},isBelow=function(rect1,rect2){return rect1.top>rect2.bottom||!(rect1.bottom<rect2.top)&&isValidOverflow(rect2.bottom-rect1.top,rect1,rect2)},containsXY=function(rect,clientX,clientY){return clientX>=rect.left&&clientX<=rect.right&&clientY>=rect.top&&clientY<=rect.bottom},getSelectedNode=function(range){var startContainer=range.startContainer,startOffset=range.startOffset;return startContainer.hasChildNodes()&&range.endOffset===startOffset+1?startContainer.childNodes[startOffset]:null},getNode=function(container,offset){return 1===container.nodeType&&container.hasChildNodes()&&(offset>=container.childNodes.length&&(offset=container.childNodes.length-1),container=container.childNodes[offset]),container},extendingChars=new RegExp("[̀-ͯ҃-҇҈-҉֑-ֽֿׁ-ׂׄ-ׇׅؐ-ًؚ-ٰٟۖ-ۜ۟-ۤۧ-۪ۨ-ܑۭܰ-݊ަ-ް߫-߳ࠖ-࠙ࠛ-ࠣࠥ-ࠧࠩ-࡙࠭-࡛ࣣ-ंऺ़ु-ै्॑-ॗॢ-ॣঁ়াু-ৄ্ৗৢ-ৣਁ-ਂ਼ੁ-ੂੇ-ੈੋ-੍ੑੰ-ੱੵઁ-ં઼ુ-ૅે-ૈ્ૢ-ૣଁ଼ାିୁ-ୄ୍ୖୗୢ-ୣஂாீ்ௗఀా-ీె-ైొ-్ౕ-ౖౢ-ౣಁ಼ಿೂೆೌ-್ೕ-ೖೢ-ೣഁാു-ൄ്ൗൢ-ൣ්ාි-ුූෟัิ-ฺ็-๎ັິ-ູົ-ຼ່-ໍ༘-ཱ༹༙༵༷-ཾྀ-྄྆-྇ྍ-ྗྙ-ྼ࿆ိ-ူဲ-့္-်ွ-ှၘ-ၙၞ-ၠၱ-ၴႂႅ-ႆႍႝ፝-፟ᜒ-᜔ᜲ-᜴ᝒ-ᝓᝲ-ᝳ឴-឵ិ-ួំ៉-៓៝᠋-᠍ᢩᤠ-ᤢᤧ-ᤨᤲ᤹-᤻ᨗ-ᨘᨛᩖᩘ-ᩞ᩠ᩢᩥ-ᩬᩳ-᩿᩼᪰-᪽᪾ᬀ-ᬃ᬴ᬶ-ᬺᬼᭂ᭫-᭳ᮀ-ᮁᮢ-ᮥᮨ-ᮩ᮫-ᮭ᯦ᯨ-ᯩᯭᯯ-ᯱᰬ-ᰳᰶ-᰷᳐-᳔᳒-᳢᳠-᳨᳭᳴᳸-᳹᷀-᷵᷼-᷿‌-‍⃐-⃜⃝-⃠⃡⃢-⃤⃥-⃰⳯-⵿⳱ⷠ-〪ⷿ-〭〮-゙〯-゚꙯꙰-꙲ꙴ-꙽ꚞ-ꚟ꛰-꛱ꠂ꠆ꠋꠥ-ꠦ꣄꣠-꣱ꤦ-꤭ꥇ-ꥑꦀ-ꦂ꦳ꦶ-ꦹꦼꧥꨩ-ꨮꨱ-ꨲꨵ-ꨶꩃꩌꩼꪰꪲ-ꪴꪷ-ꪸꪾ-꪿꫁ꫬ-ꫭ꫶ꯥꯨ꯭ﬞ︀-️︠-︯ﾞ-ﾟ]"),isExtendingChar=function(ch){return"string"==typeof ch&&ch.charCodeAt(0)>=768&&extendingChars.test(ch)},or=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return function(x){for(var i=0;i<args.length;i++)if(args[i](x))return!0;return!1}},and=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return function(x){for(var i=0;i<args.length;i++)if(!args[i](x))return!1;return!0}},isElement$3=isElement$1,isCaretCandidate$1=isCaretCandidate,isBlock$1=matchStyleValues("display","block table"),isFloated=matchStyleValues("float","left right"),isValidElementCaretCandidate=and(isElement$3,isCaretCandidate$1,not(isFloated)),isNotPre=not(matchStyleValues("white-space","pre pre-line pre-wrap")),isText$4=isText$1,isBr$3=isBr,nodeIndex=DOMUtils.nodeIndex,resolveIndex=getNode,createRange=function(doc){return"createRange"in doc?doc.createRange():DOMUtils.DOM.createRng()},isWhiteSpace=function(chr){return chr&&/[\r\n\t ]/.test(chr)},isRange=function(rng){return!!rng.setStart&&!!rng.setEnd},isHiddenWhiteSpaceRange=function(range){var container=range.startContainer,offset=range.startOffset,text;return!!(isWhiteSpace(range.toString())&&isNotPre(container.parentNode)&&isText$1(container)&&(text=container.data,isWhiteSpace(text[offset-1])||isWhiteSpace(text[offset+1])))},getBrClientRect=function(brNode){var doc=brNode.ownerDocument,rng=createRange(doc),nbsp$1=doc.createTextNode(" "),parentNode=brNode.parentNode;parentNode.insertBefore(nbsp$1,brNode),rng.setStart(nbsp$1,0),rng.setEnd(nbsp$1,1);var clientRect=clone$2(rng.getBoundingClientRect());return parentNode.removeChild(nbsp$1),clientRect},getBoundingClientRectWebKitText=function(rng){var sc=rng.startContainer,ec=rng.endContainer,so=rng.startOffset,eo=rng.endOffset;if(sc===ec&&isText$1(ec)&&0===so&&1===eo){var newRng=rng.cloneRange();return newRng.setEndAfter(ec),getBoundingClientRect(newRng)}return null},isZeroRect=function(r){return 0===r.left&&0===r.right&&0===r.top&&0===r.bottom},getBoundingClientRect=function(item){var clientRect,clientRects=item.getClientRects();return clientRect=clientRects.length>0?clone$2(clientRects[0]):clone$2(item.getBoundingClientRect()),!isRange(item)&&isBr$3(item)&&isZeroRect(clientRect)?getBrClientRect(item):isZeroRect(clientRect)&&isRange(item)?getBoundingClientRectWebKitText(item):clientRect},collapseAndInflateWidth=function(clientRect,toStart){var newClientRect=collapse(clientRect,toStart);return newClientRect.width=1,newClientRect.right=newClientRect.left+1,newClientRect},getCaretPositionClientRects=function(caretPosition){var clientRects=[],beforeNode,node,addUniqueAndValidRect=function(clientRect){0!==clientRect.height&&(clientRects.length>0&&isEqual(clientRect,clientRects[clientRects.length-1])||clientRects.push(clientRect))},addCharacterOffset=function(container,offset){var range=createRange(container.ownerDocument);if(offset<container.data.length){if(isExtendingChar(container.data[offset]))return clientRects;if(isExtendingChar(container.data[offset-1])&&(range.setStart(container,offset),range.setEnd(container,offset+1),!isHiddenWhiteSpaceRange(range)))return addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range),!1)),clientRects}offset>0&&(range.setStart(container,offset-1),range.setEnd(container,offset),isHiddenWhiteSpaceRange(range)||addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range),!1))),offset<container.data.length&&(range.setStart(container,offset),range.setEnd(container,offset+1),isHiddenWhiteSpaceRange(range)||addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range),!0)))};if(isText$4(caretPosition.container()))return addCharacterOffset(caretPosition.container(),caretPosition.offset()),clientRects;if(isElement$3(caretPosition.container()))if(caretPosition.isAtEnd())node=resolveIndex(caretPosition.container(),caretPosition.offset()),isText$4(node)&&addCharacterOffset(node,node.data.length),isValidElementCaretCandidate(node)&&!isBr$3(node)&&addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node),!1));else{if(node=resolveIndex(caretPosition.container(),caretPosition.offset()),isText$4(node)&&addCharacterOffset(node,0),isValidElementCaretCandidate(node)&&caretPosition.isAtEnd())return addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node),!1)),clientRects;beforeNode=resolveIndex(caretPosition.container(),caretPosition.offset()-1),isValidElementCaretCandidate(beforeNode)&&!isBr$3(beforeNode)&&(isBlock$1(beforeNode)||isBlock$1(node)||!isValidElementCaretCandidate(node))&&addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(beforeNode),!1)),isValidElementCaretCandidate(node)&&addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node),!0))}return clientRects},CaretPosition=function(container,offset,clientRects){var isAtStart=function(){return isText$4(container),0===offset},isAtEnd=function(){return isText$4(container)?offset>=container.data.length:offset>=container.childNodes.length},toRange=function(){var range=createRange(container.ownerDocument);return range.setStart(container,offset),range.setEnd(container,offset),range},getClientRects=function(){return clientRects||(clientRects=getCaretPositionClientRects(CaretPosition(container,offset))),clientRects},isVisible=function(){return getClientRects().length>0},isEqual=function(caretPosition){return caretPosition&&container===caretPosition.container()&&offset===caretPosition.offset()},getNode=function(before){return resolveIndex(container,before?offset-1:offset)};return{container:constant(container),offset:constant(offset),toRange:toRange,getClientRects:getClientRects,isVisible:isVisible,isAtStart:isAtStart,isAtEnd:isAtEnd,isEqual:isEqual,getNode:getNode}};CaretPosition.fromRangeStart=function(range){return CaretPosition(range.startContainer,range.startOffset)},CaretPosition.fromRangeEnd=function(range){return CaretPosition(range.endContainer,range.endOffset)},CaretPosition.after=function(node){return CaretPosition(node.parentNode,nodeIndex(node)+1)},CaretPosition.before=function(node){return CaretPosition(node.parentNode,nodeIndex(node))},CaretPosition.isAbove=function(pos1,pos2){return lift2(head(pos2.getClientRects()),last(pos1.getClientRects()),isAbove).getOr(!1)},CaretPosition.isBelow=function(pos1,pos2){return lift2(last(pos2.getClientRects()),head(pos1.getClientRects()),isBelow).getOr(!1)},CaretPosition.isAtStart=function(pos){return!!pos&&pos.isAtStart()},CaretPosition.isAtEnd=function(pos){return!!pos&&pos.isAtEnd()},CaretPosition.isTextPosition=function(pos){return!!pos&&isText$1(pos.container())},CaretPosition.isElementPosition=function(pos){return!1===CaretPosition.isTextPosition(pos)};var trimEmptyTextNode=function(dom,node){isText$1(node)&&0===node.data.length&&dom.remove(node)},insertNode=function(dom,rng,node){rng.insertNode(node),trimEmptyTextNode(dom,node.previousSibling),trimEmptyTextNode(dom,node.nextSibling)},insertFragment=function(dom,rng,frag){var firstChild=Optional.from(frag.firstChild),lastChild=Optional.from(frag.lastChild);rng.insertNode(frag),firstChild.each((function(child){return trimEmptyTextNode(dom,child.previousSibling)})),lastChild.each((function(child){return trimEmptyTextNode(dom,child.nextSibling)}))},rangeInsertNode=function(dom,rng,node){isDocumentFragment$1(node)?insertFragment(dom,rng,node):insertNode(dom,rng,node)},isText$5=isText$1,isBogus$2=isBogus,nodeIndex$1=DOMUtils.nodeIndex,normalizedParent=function(node){var parentNode=node.parentNode;return isBogus$2(parentNode)?normalizedParent(parentNode):parentNode},getChildNodes=function(node){return node?reduce(node.childNodes,(function(result,node){return isBogus$2(node)&&"BR"!==node.nodeName?result=result.concat(getChildNodes(node)):result.push(node),result}),[]):[]},normalizedTextOffset=function(node,offset){for(;(node=node.previousSibling)&&isText$5(node);)offset+=node.data.length;return offset},equal$1=function(a){return function(b){return a===b}},normalizedNodeIndex=function(node){var nodes,index;nodes=getChildNodes(normalizedParent(node)),index=findIndex$1(nodes,equal$1(node),node),nodes=nodes.slice(0,index+1);var numTextFragments=reduce(nodes,(function(result,node,i){return isText$5(node)&&isText$5(nodes[i-1])&&result++,result}),0);return nodes=filter$2(nodes,matchNodeNames([node.nodeName])),(index=findIndex$1(nodes,equal$1(node),node))-numTextFragments},createPathItem=function(node){var name;return(name=isText$5(node)?"text()":node.nodeName.toLowerCase())+"["+normalizedNodeIndex(node)+"]"},parentsUntil=function(root,node,predicate){var parents=[];for(node=node.parentNode;node!==root&&(!predicate||!predicate(node));node=node.parentNode)parents.push(node);return parents},create$3=function(root,caretPosition){var container,offset,path=[],outputOffset,childNodes,parents;return container=caretPosition.container(),offset=caretPosition.offset(),isText$5(container)?outputOffset=normalizedTextOffset(container,offset):(offset>=(childNodes=container.childNodes).length?(outputOffset="after",offset=childNodes.length-1):outputOffset="before",container=childNodes[offset]),path.push(createPathItem(container)),parents=parentsUntil(root,container),parents=filter$2(parents,not(isBogus)),(path=path.concat(map$2(parents,(function(node){return createPathItem(node)})))).reverse().join("/")+","+outputOffset},resolvePathItem=function(node,name,index){var nodes=getChildNodes(node);return nodes=filter$2(nodes,(function(node,index){return!isText$5(node)||!isText$5(nodes[index-1])})),(nodes=filter$2(nodes,matchNodeNames([name])))[index]},findTextPosition=function(container,offset){for(var node=container,targetOffset=0,dataLen;isText$5(node);){if(dataLen=node.data.length,offset>=targetOffset&&offset<=targetOffset+dataLen){container=node,offset-=targetOffset;break}if(!isText$5(node.nextSibling)){container=node,offset=dataLen;break}targetOffset+=dataLen,node=node.nextSibling}return isText$5(container)&&offset>container.data.length&&(offset=container.data.length),CaretPosition(container,offset)},resolve$1=function(root,path){var offset;if(!path)return null;var parts=path.split(","),paths=parts[0].split("/");offset=parts.length>1?parts[1]:"before";var container=reduce(paths,(function(result,value){var match=/([\w\-\(\)]+)\[([0-9]+)\]/.exec(value);return match?("text()"===match[1]&&(match[1]="#text"),resolvePathItem(result,match[1],parseInt(match[2],10))):null}),root);return container?isText$5(container)?findTextPosition(container,parseInt(offset,10)):(offset="after"===offset?nodeIndex$1(container)+1:nodeIndex$1(container),CaretPosition(container.parentNode,offset)):null},isContentEditableFalse$2=isContentEditableFalse,getNormalizedTextOffset=function(trim,container,offset){var node,trimmedOffset;for(trimmedOffset=trim(container.data.slice(0,offset)).length,node=container.previousSibling;node&&isText$1(node);node=node.previousSibling)trimmedOffset+=trim(node.data).length;return trimmedOffset},getPoint=function(dom,trim,normalized,rng,start){var container=rng[start?"startContainer":"endContainer"],offset=rng[start?"startOffset":"endOffset"],point=[],childNodes,after=0,root=dom.getRoot();for(isText$1(container)?point.push(normalized?getNormalizedTextOffset(trim,container,offset):offset):(offset>=(childNodes=container.childNodes).length&&childNodes.length&&(after=1,offset=Math.max(0,childNodes.length-1)),point.push(dom.nodeIndex(childNodes[offset],normalized)+after));container&&container!==root;container=container.parentNode)point.push(dom.nodeIndex(container,normalized));return point},getLocation=function(trim,selection,normalized,rng){var dom=selection.dom,bookmark={};return bookmark.start=getPoint(dom,trim,normalized,rng,!0),selection.isCollapsed()||(bookmark.end=getPoint(dom,trim,normalized,rng,!1)),bookmark},findIndex$2=function(dom,name,element){var count=0;return Tools.each(dom.select(name),(function(node){if("all"!==node.getAttribute("data-mce-bogus"))return node!==element&&void count++})),count},moveEndPoint=function(rng,start){var container,offset,childNodes,prefix=start?"start":"end";container=rng[prefix+"Container"],offset=rng[prefix+"Offset"],isElement$1(container)&&"TR"===container.nodeName&&(container=(childNodes=container.childNodes)[Math.min(start?offset:offset-1,childNodes.length-1)])&&(offset=start?0:container.childNodes.length,rng["set"+(start?"Start":"End")](container,offset))},normalizeTableCellSelection=function(rng){return moveEndPoint(rng,!0),moveEndPoint(rng,!1),rng},findSibling=function(node,offset){var sibling;if(isElement$1(node)&&(node=getNode(node,offset),isContentEditableFalse$2(node)))return node;if(isCaretContainer(node)){if(isText$1(node)&&isCaretContainerBlock(node)&&(node=node.parentNode),sibling=node.previousSibling,isContentEditableFalse$2(sibling))return sibling;if(sibling=node.nextSibling,isContentEditableFalse$2(sibling))return sibling}},findAdjacentContentEditableFalseElm=function(rng){return findSibling(rng.startContainer,rng.startOffset)||findSibling(rng.endContainer,rng.endOffset)},getOffsetBookmark=function(trim,normalized,selection){var element=selection.getNode(),name=element?element.nodeName:null,rng=selection.getRng();if(isContentEditableFalse$2(element)||"IMG"===name)return{name:name,index:findIndex$2(selection.dom,name,element)};var sibling=findAdjacentContentEditableFalseElm(rng);return sibling?{name:name=sibling.tagName,index:findIndex$2(selection.dom,name,sibling)}:getLocation(trim,selection,normalized,rng)},getCaretBookmark=function(selection){var rng=selection.getRng();return{start:create$3(selection.dom.getRoot(),CaretPosition.fromRangeStart(rng)),end:create$3(selection.dom.getRoot(),CaretPosition.fromRangeEnd(rng))}},getRangeBookmark=function(selection){return{rng:selection.getRng()}},createBookmarkSpan=function(dom,id,filled){var args={"data-mce-type":"bookmark",id:id,style:"overflow:hidden;line-height:0px"};return filled?dom.create("span",args,"&#xFEFF;"):dom.create("span",args)},getPersistentBookmark=function(selection,filled){var dom=selection.dom,rng=selection.getRng(),id=dom.uniqueId(),collapsed=selection.isCollapsed(),element=selection.getNode(),name=element.nodeName;if("IMG"===name)return{name:name,index:findIndex$2(dom,name,element)};var rng2=normalizeTableCellSelection(rng.cloneRange());if(!collapsed){rng2.collapse(!1);var endBookmarkNode=createBookmarkSpan(dom,id+"_end",filled);rangeInsertNode(dom,rng2,endBookmarkNode)}(rng=normalizeTableCellSelection(rng)).collapse(!0);var startBookmarkNode=createBookmarkSpan(dom,id+"_start",filled);return rangeInsertNode(dom,rng,startBookmarkNode),selection.moveToBookmark({id:id,keep:!0}),{id:id}},getBookmark=function(selection,type,normalized){return 2===type?getOffsetBookmark(trim$2,normalized,selection):3===type?getCaretBookmark(selection):type?getRangeBookmark(selection):getPersistentBookmark(selection,!1)},getUndoBookmark=curry(getOffsetBookmark,identity,!0),DOM$1=DOMUtils.DOM,defaultPreviewStyles="font-family font-size font-weight font-style text-decoration text-transform color background-color border border-radius outline text-shadow",getBodySetting=function(editor,name,defaultValue){var value=editor.getParam(name,defaultValue);if(-1!==value.indexOf("=")){var bodyObj=editor.getParam(name,"","hash");return bodyObj.hasOwnProperty(editor.id)?bodyObj[editor.id]:defaultValue}return value},getIframeAttrs=function(editor){return editor.getParam("iframe_attrs",{})},getDocType=function(editor){return editor.getParam("doctype","<!DOCTYPE html>")},getDocumentBaseUrl=function(editor){return editor.getParam("document_base_url","")},getBodyId=function(editor){return getBodySetting(editor,"body_id","tinymce")},getBodyClass=function(editor){return getBodySetting(editor,"body_class","")},getContentSecurityPolicy=function(editor){return editor.getParam("content_security_policy","")},shouldPutBrInPre=function(editor){return editor.getParam("br_in_pre",!0)},getForcedRootBlock=function(editor){if(editor.getParam("force_p_newlines",!1))return"p";var block=editor.getParam("forced_root_block","p");return!1===block?"":!0===block?"p":block},getForcedRootBlockAttrs=function(editor){return editor.getParam("forced_root_block_attrs",{})},getBrNewLineSelector=function(editor){return editor.getParam("br_newline_selector",".mce-toc h2,figcaption,caption")},getNoNewLineSelector=function(editor){return editor.getParam("no_newline_selector","")},shouldKeepStyles=function(editor){return editor.getParam("keep_styles",!0)},shouldEndContainerOnEmptyBlock=function(editor){return editor.getParam("end_container_on_empty_block",!1)},getFontStyleValues=function(editor){return Tools.explode(editor.getParam("font_size_style_values","xx-small,x-small,small,medium,large,x-large,xx-large"))},getFontSizeClasses=function(editor){return Tools.explode(editor.getParam("font_size_classes",""))},getImagesDataImgFilter=function(editor){return editor.getParam("images_dataimg_filter",always,"function")},isAutomaticUploadsEnabled=function(editor){return editor.getParam("automatic_uploads",!0,"boolean")},shouldReuseFileName=function(editor){return editor.getParam("images_reuse_filename",!1,"boolean")},shouldReplaceBlobUris=function(editor){return editor.getParam("images_replace_blob_uris",!0,"boolean")},getIconPackName=function(editor){return editor.getParam("icons","","string")},getIconsUrl=function(editor){return editor.getParam("icons_url","","string")},getImageUploadUrl=function(editor){return editor.getParam("images_upload_url","","string")},getImageUploadBasePath=function(editor){return editor.getParam("images_upload_base_path","","string")},getImagesUploadCredentials=function(editor){return editor.getParam("images_upload_credentials",!1,"boolean")},getImagesUploadHandler=function(editor){return editor.getParam("images_upload_handler",null,"function")},shouldUseContentCssCors=function(editor){return editor.getParam("content_css_cors",!1,"boolean")},getReferrerPolicy=function(editor){return editor.getParam("referrer_policy","","string")},getLanguageCode=function(editor){return editor.getParam("language","en","string")},getLanguageUrl=function(editor){return editor.getParam("language_url","","string")},shouldIndentUseMargin=function(editor){return editor.getParam("indent_use_margin",!1)},getIndentation=function(editor){return editor.getParam("indentation","40px","string")},getContentCss=function(editor){var contentCss=editor.getParam("content_css");return isString(contentCss)?map(contentCss.split(","),trim):isArray(contentCss)?contentCss:!1===contentCss||editor.inline?[]:["default"]},getFontCss=function(editor){var fontCss=editor.getParam("font_css",[]);return isArray(fontCss)?fontCss:map(fontCss.split(","),trim)},getDirectionality=function(editor){return editor.getParam("directionality",I18n.isRtl()?"rtl":void 0)},getInlineBoundarySelector=function(editor){return editor.getParam("inline_boundaries_selector","a[href],code,.mce-annotation","string")},getObjectResizing=function(editor){var selector=editor.getParam("object_resizing");return!1!==selector&&!Env.iOS&&(isString(selector)?selector:"table,img,figure.image,div,video,iframe")},getResizeImgProportional=function(editor){return editor.getParam("resize_img_proportional",!0,"boolean")},getPlaceholder=function(editor){return editor.getParam("placeholder",DOM$1.getAttrib(editor.getElement(),"placeholder"),"string")},getEventRoot=function(editor){return editor.getParam("event_root")},getServiceMessage=function(editor){return editor.getParam("service_message")},getTheme=function(editor){return editor.getParam("theme")},shouldValidate=function(editor){return editor.getParam("validate")},isInlineBoundariesEnabled=function(editor){return!1!==editor.getParam("inline_boundaries")},getFormats=function(editor){return editor.getParam("formats")},getPreviewStyles=function(editor){var style=editor.getParam("preview_styles",defaultPreviewStyles);return isString(style)?style:""},canFormatEmptyLines=function(editor){return editor.getParam("format_empty_lines",!1,"boolean")},getCustomUiSelector=function(editor){return editor.getParam("custom_ui_selector","","string")},getThemeUrl=function(editor){return editor.getParam("theme_url")},isInline$1=function(editor){return editor.getParam("inline")},hasHiddenInput=function(editor){return editor.getParam("hidden_input")},shouldPatchSubmit=function(editor){return editor.getParam("submit_patch")},isEncodingXml=function(editor){return"xml"===editor.getParam("encoding")},shouldAddFormSubmitTrigger=function(editor){return editor.getParam("add_form_submit_trigger")},shouldAddUnloadTrigger=function(editor){return editor.getParam("add_unload_trigger")},hasForcedRootBlock=function(editor){return""!==getForcedRootBlock(editor)},getCustomUndoRedoLevels=function(editor){return editor.getParam("custom_undo_redo_levels",0,"number")},shouldDisableNodeChange=function(editor){return editor.getParam("disable_nodechange")},isReadOnly=function(editor){return editor.getParam("readonly")},hasContentCssCors=function(editor){return editor.getParam("content_css_cors")},getPlugins=function(editor){return editor.getParam("plugins","","string")},getExternalPlugins=function(editor){return editor.getParam("external_plugins")},shouldBlockUnsupportedDrop=function(editor){return editor.getParam("block_unsupported_drop",!0,"boolean")},isVisualAidsEnabled=function(editor){return editor.getParam("visual",!0,"boolean")},getVisualAidsTableClass=function(editor){return editor.getParam("visual_table_class","mce-item-table","string")},getVisualAidsAnchorClass=function(editor){return editor.getParam("visual_anchor_class","mce-item-anchor","string")},isElement$4=isElement$1,isText$6=isText$1,removeNode=function(node){var parentNode=node.parentNode;parentNode&&parentNode.removeChild(node)},trimCount=function(text){var trimmedText=trim$2(text);return{count:text.length-trimmedText.length,text:trimmedText}},deleteZwspChars=function(caretContainer){for(var idx;-1!==(idx=caretContainer.data.lastIndexOf(ZWSP));)caretContainer.deleteData(idx,1)},removeUnchanged=function(caretContainer,pos){return remove$5(caretContainer),pos},removeTextAndReposition=function(caretContainer,pos){var before=trimCount(caretContainer.data.substr(0,pos.offset())),after=trimCount(caretContainer.data.substr(pos.offset())),text;return(before.text+after.text).length>0?(deleteZwspChars(caretContainer),CaretPosition(caretContainer,pos.offset()-before.count)):pos},removeElementAndReposition=function(caretContainer,pos){var parentNode=pos.container(),newPosition=indexOf(from$1(parentNode.childNodes),caretContainer).map((function(index){return index<pos.offset()?CaretPosition(parentNode,pos.offset()-1):pos})).getOr(pos);return remove$5(caretContainer),newPosition},removeTextCaretContainer=function(caretContainer,pos){return isText$6(caretContainer)&&pos.container()===caretContainer?removeTextAndReposition(caretContainer,pos):removeUnchanged(caretContainer,pos)},removeElementCaretContainer=function(caretContainer,pos){return pos.container()===caretContainer.parentNode?removeElementAndReposition(caretContainer,pos):removeUnchanged(caretContainer,pos)},removeAndReposition=function(container,pos){return CaretPosition.isTextPosition(pos)?removeTextCaretContainer(container,pos):removeElementCaretContainer(container,pos)},remove$5=function(caretContainerNode){isElement$4(caretContainerNode)&&isCaretContainer(caretContainerNode)&&(hasContent(caretContainerNode)?caretContainerNode.removeAttribute("data-mce-caret"):removeNode(caretContainerNode)),isText$6(caretContainerNode)&&(deleteZwspChars(caretContainerNode),0===caretContainerNode.data.length&&removeNode(caretContainerNode))},browser$2=detect$3().browser,isContentEditableFalse$3=isContentEditableFalse,isMedia$1=isMedia,isTableCell$2=isTableCell,inlineFakeCaretSelector="*[contentEditable=false],video,audio,embed,object",getAbsoluteClientRect=function(root,element,before){var clientRect=collapse(element.getBoundingClientRect(),before),docElm,scrollX,scrollY,margin,rootRect;return"BODY"===root.tagName?(docElm=root.ownerDocument.documentElement,scrollX=root.scrollLeft||docElm.scrollLeft,scrollY=root.scrollTop||docElm.scrollTop):(rootRect=root.getBoundingClientRect(),scrollX=root.scrollLeft-rootRect.left,scrollY=root.scrollTop-rootRect.top),clientRect.left+=scrollX,clientRect.right+=scrollX,clientRect.top+=scrollY,clientRect.bottom+=scrollY,clientRect.width=1,(margin=element.offsetWidth-element.clientWidth)>0&&(before&&(margin*=-1),clientRect.left+=margin,clientRect.right+=margin),clientRect},trimInlineCaretContainers=function(root){for(var fakeCaretTargetNodes=descendants$1(SugarElement.fromDom(root),inlineFakeCaretSelector),i=0;i<fakeCaretTargetNodes.length;i++){var node=fakeCaretTargetNodes[i].dom,sibling=node.previousSibling,data,data;if(endsWithCaretContainer(sibling))1===(data=sibling.data).length?sibling.parentNode.removeChild(sibling):sibling.deleteData(data.length-1,1);if(sibling=node.nextSibling,startsWithCaretContainer(sibling))1===(data=sibling.data).length?sibling.parentNode.removeChild(sibling):sibling.deleteData(0,1)}},FakeCaret=function(editor,root,isBlock,hasFocus){var lastVisualCaret=Cell(Optional.none()),cursorInterval,caretContainerNode,rootBlock=getForcedRootBlock(editor),caretBlock=rootBlock.length>0?rootBlock:"p",show=function(before,element){var clientRect,rng;if(hide(),isTableCell$2(element))return null;if(!isBlock(element))return caretContainerNode=insertInline(element,before),rng=element.ownerDocument.createRange(),isInlineFakeCaretTarget(caretContainerNode.nextSibling)?(rng.setStart(caretContainerNode,0),rng.setEnd(caretContainerNode,0)):(rng.setStart(caretContainerNode,1),rng.setEnd(caretContainerNode,1)),rng;caretContainerNode=insertBlock(caretBlock,element,before),clientRect=getAbsoluteClientRect(root,element,before),DomQuery(caretContainerNode).css("top",clientRect.top);var caret=DomQuery('<div class="mce-visual-caret" data-mce-bogus="all"></div>').css(clientRect).appendTo(root)[0];return lastVisualCaret.set(Optional.some({caret:caret,element:element,before:before})),lastVisualCaret.get().each((function(caretState){before&&DomQuery(caretState.caret).addClass("mce-visual-caret-before")})),startBlink(),(rng=element.ownerDocument.createRange()).setStart(caretContainerNode,0),rng.setEnd(caretContainerNode,0),rng},hide=function(){trimInlineCaretContainers(root),caretContainerNode&&(remove$5(caretContainerNode),caretContainerNode=null),lastVisualCaret.get().each((function(caretState){DomQuery(caretState.caret).remove(),lastVisualCaret.set(Optional.none())})),cursorInterval&&(Delay.clearInterval(cursorInterval),cursorInterval=null)},startBlink=function(){cursorInterval=Delay.setInterval((function(){hasFocus()?DomQuery("div.mce-visual-caret",root).toggleClass("mce-visual-caret-hidden"):DomQuery("div.mce-visual-caret",root).addClass("mce-visual-caret-hidden")}),500)},reposition,destroy,getCss;return{show:show,hide:hide,getCss:function(){return".mce-visual-caret {position: absolute;background-color: black;background-color: currentcolor;}.mce-visual-caret-hidden {display: none;}*[data-mce-caret] {position: absolute;left: -1000px;right: auto;top: 0;margin: 0;padding: 0;}"},reposition:function(){lastVisualCaret.get().each((function(caretState){var clientRect=getAbsoluteClientRect(root,caretState.element,caretState.before);DomQuery(caretState.caret).css(__assign({},clientRect))}))},destroy:function(){return Delay.clearInterval(cursorInterval)}}},isFakeCaretTableBrowser=function(){return browser$2.isIE()||browser$2.isEdge()||browser$2.isFirefox()},isInlineFakeCaretTarget=function(node){return isContentEditableFalse$3(node)||isMedia$1(node)},isFakeCaretTarget=function(node){return isInlineFakeCaretTarget(node)||isTable(node)&&isFakeCaretTableBrowser()},isContentEditableFalse$4=isContentEditableFalse,isMedia$2=isMedia,isBlockLike=matchStyleValues("display","block table table-cell table-caption list-item"),isCaretContainer$2=isCaretContainer,isCaretContainerBlock$1=isCaretContainerBlock,isElement$5=isElement$1,isCaretCandidate$2=isCaretCandidate,isForwards=function(direction){return direction>0},isBackwards=function(direction){return direction<0},skipCaretContainers=function(walk,shallow){for(var node;node=walk(shallow);)if(!isCaretContainerBlock$1(node))return node;return null},findNode=function(node,direction,predicateFn,rootNode,shallow){var walker=new DomTreeWalker(node,rootNode),isCefOrCaretContainer=isContentEditableFalse$4(node)||isCaretContainerBlock$1(node);if(isBackwards(direction)){if(isCefOrCaretContainer&&predicateFn(node=skipCaretContainers(walker.prev.bind(walker),!0)))return node;for(;node=skipCaretContainers(walker.prev.bind(walker),shallow);)if(predicateFn(node))return node}if(isForwards(direction)){if(isCefOrCaretContainer&&predicateFn(node=skipCaretContainers(walker.next.bind(walker),!0)))return node;for(;node=skipCaretContainers(walker.next.bind(walker),shallow);)if(predicateFn(node))return node}return null},getParentBlock=function(node,rootNode){for(;node&&node!==rootNode;){if(isBlockLike(node))return node;node=node.parentNode}return null},isInSameBlock=function(caretPosition1,caretPosition2,rootNode){return getParentBlock(caretPosition1.container(),rootNode)===getParentBlock(caretPosition2.container(),rootNode)},getChildNodeAtRelativeOffset=function(relativeOffset,caretPosition){if(!caretPosition)return null;var container=caretPosition.container(),offset=caretPosition.offset();return isElement$5(container)?container.childNodes[offset+relativeOffset]:null},beforeAfter=function(before,node){var range=node.ownerDocument.createRange();return before?(range.setStartBefore(node),range.setEndBefore(node)):(range.setStartAfter(node),range.setEndAfter(node)),range},isNodesInSameBlock=function(root,node1,node2){return getParentBlock(node1,root)===getParentBlock(node2,root)},lean=function(left,root,node){var sibling,siblingName;for(siblingName=left?"previousSibling":"nextSibling";node&&node!==root;){if(sibling=node[siblingName],isCaretContainer$2(sibling)&&(sibling=sibling[siblingName]),isContentEditableFalse$4(sibling)||isMedia$2(sibling)){if(isNodesInSameBlock(root,sibling,node))return sibling;break}if(isCaretCandidate$2(sibling))break;node=node.parentNode}return null},before$2=curry(beforeAfter,!0),after$1=curry(beforeAfter,!1),normalizeRange=function(direction,root,range){var node,container,location,leanLeft=curry(lean,!0,root),leanRight=curry(lean,!1,root);container=range.startContainer;var offset=range.startOffset;if(isCaretContainerBlock(container)){if(isElement$5(container)||(container=container.parentNode),"before"===(location=container.getAttribute("data-mce-caret"))&&(node=container.nextSibling,isFakeCaretTarget(node)))return before$2(node);if("after"===location&&(node=container.previousSibling,isFakeCaretTarget(node)))return after$1(node)}if(!range.collapsed)return range;if(isText$1(container)){if(isCaretContainer$2(container)){if(1===direction){if(node=leanRight(container))return before$2(node);if(node=leanLeft(container))return after$1(node)}if(-1===direction){if(node=leanLeft(container))return after$1(node);if(node=leanRight(container))return before$2(node)}return range}if(endsWithCaretContainer(container)&&offset>=container.data.length-1)return 1===direction&&(node=leanRight(container))?before$2(node):range;if(startsWithCaretContainer(container)&&offset<=1)return-1===direction&&(node=leanLeft(container))?after$1(node):range;if(offset===container.data.length)return(node=leanRight(container))?before$2(node):range;if(0===offset)return(node=leanLeft(container))?after$1(node):range}return range},getRelativeCefElm=function(forward,caretPosition){return Optional.from(getChildNodeAtRelativeOffset(forward?0:-1,caretPosition)).filter(isContentEditableFalse$4)},getNormalizedRangeEndPoint=function(direction,root,range){var normalizedRange=normalizeRange(direction,root,range);return-1===direction?CaretPosition.fromRangeStart(normalizedRange):CaretPosition.fromRangeEnd(normalizedRange)},getElementFromPosition=function(pos){return Optional.from(pos.getNode()).map(SugarElement.fromDom)},getElementFromPrevPosition=function(pos){return Optional.from(pos.getNode(!0)).map(SugarElement.fromDom)},getVisualCaretPosition=function(walkFn,caretPosition){for(;caretPosition=walkFn(caretPosition);)if(caretPosition.isVisible())return caretPosition;return caretPosition},isMoveInsideSameBlock=function(from,to){var inSameBlock=isInSameBlock(from,to);return!(inSameBlock||!isBr(from.getNode()))||inSameBlock},HDirection;!function(HDirection){HDirection[HDirection.Backwards=-1]="Backwards",HDirection[HDirection.Forwards=1]="Forwards"}(HDirection||(HDirection={}));var isContentEditableFalse$5=isContentEditableFalse,isText$7=isText$1,isElement$6=isElement$1,isBr$4=isBr,isCaretCandidate$3=isCaretCandidate,isAtomic$1=isAtomic,isEditableCaretCandidate$1=isEditableCaretCandidate,getParents=function(node,root){for(var parents=[];node&&node!==root;)parents.push(node),node=node.parentNode;return parents},nodeAtIndex=function(container,offset){return container.hasChildNodes()&&offset<container.childNodes.length?container.childNodes[offset]:null},getCaretCandidatePosition=function(direction,node){if(isForwards(direction)){if(isCaretCandidate$3(node.previousSibling)&&!isText$7(node.previousSibling))return CaretPosition.before(node);if(isText$7(node))return CaretPosition(node,0)}if(isBackwards(direction)){if(isCaretCandidate$3(node.nextSibling)&&!isText$7(node.nextSibling))return CaretPosition.after(node);if(isText$7(node))return CaretPosition(node,node.data.length)}return isBackwards(direction)?isBr$4(node)?CaretPosition.before(node):CaretPosition.after(node):CaretPosition.before(node)},moveForwardFromBr=function(root,nextNode){var nextSibling=nextNode.nextSibling;return nextSibling&&isCaretCandidate$3(nextSibling)?isText$7(nextSibling)?CaretPosition(nextSibling,0):CaretPosition.before(nextSibling):findCaretPosition(HDirection.Forwards,CaretPosition.after(nextNode),root)},findCaretPosition=function(direction,startPos,root){var node,nextNode,innerNode,caretPosition;if(!isElement$6(root)||!startPos)return null;if(startPos.isEqual(CaretPosition.after(root))&&root.lastChild){if(caretPosition=CaretPosition.after(root.lastChild),isBackwards(direction)&&isCaretCandidate$3(root.lastChild)&&isElement$6(root.lastChild))return isBr$4(root.lastChild)?CaretPosition.before(root.lastChild):caretPosition}else caretPosition=startPos;var container=caretPosition.container(),offset=caretPosition.offset();if(isText$7(container)){if(isBackwards(direction)&&offset>0)return CaretPosition(container,--offset);if(isForwards(direction)&&offset<container.length)return CaretPosition(container,++offset);node=container}else{if(isBackwards(direction)&&offset>0&&(nextNode=nodeAtIndex(container,offset-1),isCaretCandidate$3(nextNode)))return!isAtomic$1(nextNode)&&(innerNode=findNode(nextNode,direction,isEditableCaretCandidate$1,nextNode))?isText$7(innerNode)?CaretPosition(innerNode,innerNode.data.length):CaretPosition.after(innerNode):isText$7(nextNode)?CaretPosition(nextNode,nextNode.data.length):CaretPosition.before(nextNode);if(isForwards(direction)&&offset<container.childNodes.length&&(nextNode=nodeAtIndex(container,offset),isCaretCandidate$3(nextNode)))return isBr$4(nextNode)?moveForwardFromBr(root,nextNode):!isAtomic$1(nextNode)&&(innerNode=findNode(nextNode,direction,isEditableCaretCandidate$1,nextNode))?isText$7(innerNode)?CaretPosition(innerNode,0):CaretPosition.before(innerNode):isText$7(nextNode)?CaretPosition(nextNode,0):CaretPosition.after(nextNode);node=nextNode||caretPosition.getNode()}if((isForwards(direction)&&caretPosition.isAtEnd()||isBackwards(direction)&&caretPosition.isAtStart())&&(node=findNode(node,direction,always,root,!0),isEditableCaretCandidate$1(node,root)))return getCaretCandidatePosition(direction,node);nextNode=findNode(node,direction,isEditableCaretCandidate$1,root);var rootContentEditableFalseElm=last$1(filter(getParents(container,root),isContentEditableFalse$5));return!rootContentEditableFalseElm||nextNode&&rootContentEditableFalseElm.contains(nextNode)?nextNode?getCaretCandidatePosition(direction,nextNode):null:caretPosition=isForwards(direction)?CaretPosition.after(rootContentEditableFalseElm):CaretPosition.before(rootContentEditableFalseElm)},CaretWalker=function(root){return{next:function(caretPosition){return findCaretPosition(HDirection.Forwards,caretPosition,root)},prev:function(caretPosition){return findCaretPosition(HDirection.Backwards,caretPosition,root)}}},walkToPositionIn=function(forward,root,start){var position=forward?CaretPosition.before(start):CaretPosition.after(start);return fromPosition(forward,root,position)},afterElement=function(node){return isBr(node)?CaretPosition.before(node):CaretPosition.after(node)},isBeforeOrStart=function(position){return CaretPosition.isTextPosition(position)?0===position.offset():isCaretCandidate(position.getNode())},isAfterOrEnd=function(position){if(CaretPosition.isTextPosition(position)){var container=position.container();return position.offset()===container.data.length}return isCaretCandidate(position.getNode(!0))},isBeforeAfterSameElement=function(from,to){return!CaretPosition.isTextPosition(from)&&!CaretPosition.isTextPosition(to)&&from.getNode()===to.getNode(!0)},isAtBr=function(position){return!CaretPosition.isTextPosition(position)&&isBr(position.getNode())},shouldSkipPosition=function(forward,from,to){return forward?!isBeforeAfterSameElement(from,to)&&!isAtBr(from)&&isAfterOrEnd(from)&&isBeforeOrStart(to):!isBeforeAfterSameElement(to,from)&&isBeforeOrStart(from)&&isAfterOrEnd(to)},fromPosition=function(forward,root,pos){var walker=CaretWalker(root);return Optional.from(forward?walker.next(pos):walker.prev(pos))},navigate=function(forward,root,from){return fromPosition(forward,root,from).bind((function(to){return isInSameBlock(from,to,root)&&shouldSkipPosition(forward,from,to)?fromPosition(forward,root,to):Optional.some(to)}))},navigateIgnore=function(forward,root,from,ignoreFilter){return navigate(forward,root,from).bind((function(pos){return ignoreFilter(pos)?navigateIgnore(forward,root,pos,ignoreFilter):Optional.some(pos)}))},positionIn=function(forward,element){var startNode=forward?element.firstChild:element.lastChild;return isText$1(startNode)?Optional.some(CaretPosition(startNode,forward?0:startNode.data.length)):startNode?isCaretCandidate(startNode)?Optional.some(forward?CaretPosition.before(startNode):afterElement(startNode)):walkToPositionIn(forward,element,startNode):Optional.none()},nextPosition=curry(fromPosition,!0),prevPosition=curry(fromPosition,!1),firstPositionIn=curry(positionIn,!0),lastPositionIn=curry(positionIn,!1),CARET_ID="_mce_caret",isCaretNode=function(node){return isElement$1(node)&&node.id===CARET_ID},getParentCaretContainer=function(body,node){for(;node&&node!==body;){if(node.id===CARET_ID)return node;node=node.parentNode}return null},isStringPathBookmark=function(bookmark){return isString(bookmark.start)},isRangeBookmark=function(bookmark){return bookmark.hasOwnProperty("rng")},isIdBookmark=function(bookmark){return bookmark.hasOwnProperty("id")},isIndexBookmark=function(bookmark){return bookmark.hasOwnProperty("name")},isPathBookmark=function(bookmark){return Tools.isArray(bookmark.start)},addBogus=function(dom,node){return isElement$1(node)&&dom.isBlock(node)&&!node.innerHTML&&!Env.ie&&(node.innerHTML='<br data-mce-bogus="1" />'),node},resolveCaretPositionBookmark=function(dom,bookmark){var pos,rng=dom.createRng();return pos=resolve$1(dom.getRoot(),bookmark.start),rng.setStart(pos.container(),pos.offset()),pos=resolve$1(dom.getRoot(),bookmark.end),rng.setEnd(pos.container(),pos.offset()),rng},insertZwsp=function(node,rng){var textNode=node.ownerDocument.createTextNode(ZWSP);node.appendChild(textNode),rng.setStart(textNode,0),rng.setEnd(textNode,0)},isEmpty$1=function(node){return!1===node.hasChildNodes()},tryFindRangePosition=function(node,rng){return lastPositionIn(node).fold(never,(function(pos){return rng.setStart(pos.container(),pos.offset()),rng.setEnd(pos.container(),pos.offset()),!0}))},padEmptyCaretContainer=function(root,node,rng){return!(!isEmpty$1(node)||!getParentCaretContainer(root,node))&&(insertZwsp(node,rng),!0)},setEndPoint=function(dom,start,bookmark,rng){var point=bookmark[start?"start":"end"],i,node,offset,children,root=dom.getRoot();if(point){for(offset=point[0],node=root,i=point.length-1;i>=1;i--){if(children=node.childNodes,padEmptyCaretContainer(root,node,rng))return!0;if(point[i]>children.length-1)return!!padEmptyCaretContainer(root,node,rng)||tryFindRangePosition(node,rng);node=children[point[i]]}3===node.nodeType&&(offset=Math.min(point[0],node.nodeValue.length)),1===node.nodeType&&(offset=Math.min(point[0],node.childNodes.length)),start?rng.setStart(node,offset):rng.setEnd(node,offset)}return!0},isValidTextNode=function(node){return isText$1(node)&&node.data.length>0},restoreEndPoint=function(dom,suffix,bookmark){var marker=dom.get(bookmark.id+"_"+suffix),node,idx,next,prev,keep=bookmark.keep,container,offset;if(marker){if(node=marker.parentNode,"start"===suffix?(keep?marker.hasChildNodes()?(node=marker.firstChild,idx=1):isValidTextNode(marker.nextSibling)?(node=marker.nextSibling,idx=0):isValidTextNode(marker.previousSibling)?(node=marker.previousSibling,idx=marker.previousSibling.data.length):(node=marker.parentNode,idx=dom.nodeIndex(marker)+1):idx=dom.nodeIndex(marker),container=node,offset=idx):(keep?marker.hasChildNodes()?(node=marker.firstChild,idx=1):isValidTextNode(marker.previousSibling)?(node=marker.previousSibling,idx=marker.previousSibling.data.length):(node=marker.parentNode,idx=dom.nodeIndex(marker)):idx=dom.nodeIndex(marker),container=node,offset=idx),!keep){for(prev=marker.previousSibling,next=marker.nextSibling,Tools.each(Tools.grep(marker.childNodes),(function(node){isText$1(node)&&(node.nodeValue=node.nodeValue.replace(/\uFEFF/g,""))}));marker=dom.get(bookmark.id+"_"+suffix);)dom.remove(marker,!0);prev&&next&&prev.nodeType===next.nodeType&&isText$1(prev)&&!Env.opera&&(idx=prev.nodeValue.length,prev.appendData(next.nodeValue),dom.remove(next),container=prev,offset=idx)}return Optional.some(CaretPosition(container,offset))}return Optional.none()},resolvePaths=function(dom,bookmark){var rng=dom.createRng();return setEndPoint(dom,!0,bookmark,rng)&&setEndPoint(dom,!1,bookmark,rng)?Optional.some(rng):Optional.none()},resolveId=function(dom,bookmark){var startPos=restoreEndPoint(dom,"start",bookmark),endPos=restoreEndPoint(dom,"end",bookmark);return lift2(startPos,endPos.or(startPos),(function(spos,epos){var rng=dom.createRng();return rng.setStart(addBogus(dom,spos.container()),spos.offset()),rng.setEnd(addBogus(dom,epos.container()),epos.offset()),rng}))},resolveIndex$1=function(dom,bookmark){return Optional.from(dom.select(bookmark.name)[bookmark.index]).map((function(elm){var rng=dom.createRng();return rng.selectNode(elm),rng}))},resolve$2=function(selection,bookmark){var dom=selection.dom;if(bookmark){if(isPathBookmark(bookmark))return resolvePaths(dom,bookmark);if(isStringPathBookmark(bookmark))return Optional.some(resolveCaretPositionBookmark(dom,bookmark));if(isIdBookmark(bookmark))return resolveId(dom,bookmark);if(isIndexBookmark(bookmark))return resolveIndex$1(dom,bookmark);if(isRangeBookmark(bookmark))return Optional.some(bookmark.rng)}return Optional.none()},getBookmark$1=function(selection,type,normalized){return getBookmark(selection,type,normalized)},moveToBookmark=function(selection,bookmark){resolve$2(selection,bookmark).each((function(rng){selection.setRng(rng)}))},isBookmarkNode$1=function(node){return isElement$1(node)&&"SPAN"===node.tagName&&"bookmark"===node.getAttribute("data-mce-type")},is$2,isNbsp=function(expected){return function(actual){return expected===actual}}(" "),isWhiteSpace$1=function(chr){return""!==chr&&-1!==" \f\n\r\t\v".indexOf(chr)},isContent$1=function(chr){return!isWhiteSpace$1(chr)&&!isNbsp(chr)},isNode=function(node){return!!node.nodeType},isInlineBlock=function(node){return node&&/^(IMG)$/.test(node.nodeName)},moveStart=function(dom,selection,rng){var offset=rng.startOffset,container=rng.startContainer,walker,node,nodes;if((rng.startContainer!==rng.endContainer||!isInlineBlock(rng.startContainer.childNodes[rng.startOffset]))&&1===container.nodeType)for(offset<(nodes=container.childNodes).length?(container=nodes[offset],walker=new DomTreeWalker(container,dom.getParent(container,dom.isBlock))):(container=nodes[nodes.length-1],(walker=new DomTreeWalker(container,dom.getParent(container,dom.isBlock))).next(!0)),node=walker.current();node;node=walker.next())if(3===node.nodeType&&!isWhiteSpaceNode(node))return rng.setStart(node,0),void selection.setRng(rng)},getNonWhiteSpaceSibling=function(node,next,inc){if(node){var nextName=next?"nextSibling":"previousSibling";for(node=inc?node:node[nextName];node;node=node[nextName])if(1===node.nodeType||!isWhiteSpaceNode(node))return node}},isTextBlock$1=function(editor,name){return isNode(name)&&(name=name.nodeName),!!editor.schema.getTextBlockElements()[name.toLowerCase()]},isValid=function(ed,parent,child){return ed.schema.isValidChild(parent,child)},isWhiteSpaceNode=function(node,allowSpaces){if(void 0===allowSpaces&&(allowSpaces=!1),isNonNullable(node)&&isText$1(node)){var data=allowSpaces?node.data.replace(/ /g," "):node.data;return isWhitespaceText(data)}return!1},isEmptyTextNode=function(node){return isNonNullable(node)&&isText$1(node)&&0===node.length},replaceVars=function(value,vars){return"string"!=typeof value?value=value(vars):vars&&(value=value.replace(/%(\w+)/g,(function(str,name){return vars[name]||str}))),value},isEq=function(str1,str2){return str2=str2||"",str1=""+((str1=str1||"").nodeName||str1),str2=""+(str2.nodeName||str2),str1.toLowerCase()===str2.toLowerCase()},normalizeStyleValue=function(dom,value,name){return"color"!==name&&"backgroundColor"!==name||(value=dom.toHex(value)),"fontWeight"===name&&700===value&&(value="bold"),"fontFamily"===name&&(value=value.replace(/[\'\"]/g,"").replace(/,\s+/g,",")),""+value},getStyle=function(dom,node,name){return normalizeStyleValue(dom,dom.getStyle(node,name),name)},getTextDecoration=function(dom,node){var decoration;return dom.getParent(node,(function(n){return(decoration=dom.getStyle(n,"text-decoration"))&&"none"!==decoration})),decoration},getParents$1=function(dom,node,selector){return dom.getParents(node,selector,dom.getRoot())},isVariableFormatName=function(editor,formatName){var hasVariableValues=function(format){var isVariableValue=function(val){return val.length>1&&"%"===val.charAt(0)};return exists(["styles","attributes"],(function(key){return get$1(format,key).exists((function(field){var fieldValues=isArray(field)?field:values(field);return exists(fieldValues,isVariableValue)}))}))};return exists(editor.formatter.get(formatName),hasVariableValues)},areSimilarFormats=function(editor,formatName,otherFormatName){var validKeys=["inline","block","selector","attributes","styles","classes"],filterObj=function(format){return filter$1(format,(function(_,key){return exists(validKeys,(function(validKey){return validKey===key}))}))};return exists(editor.formatter.get(formatName),(function(fmt1){var filteredFmt1=filterObj(fmt1);return exists(editor.formatter.get(otherFormatName),(function(fmt2){var filteredFmt2=filterObj(fmt2);return equal(filteredFmt1,filteredFmt2)}))}))},isBlockFormat=function(format){return hasNonNullableKey(format,"block")},isSelectorFormat=function(format){return hasNonNullableKey(format,"selector")},isInlineFormat=function(format){return hasNonNullableKey(format,"inline")},isBookmarkNode$2=isBookmarkNode$1,getParents$2=getParents$1,isWhiteSpaceNode$1=isWhiteSpaceNode,isTextBlock$2=isTextBlock$1,isBogusBr=function(node){return isBr(node)&&node.getAttribute("data-mce-bogus")&&!node.nextSibling},findParentContentEditable=function(dom,node){for(var parent=node;parent;){if(isElement$1(parent)&&dom.getContentEditable(parent))return"false"===dom.getContentEditable(parent)?parent:node;parent=parent.parentNode}return node},walkText=function(start,node,offset,predicate){for(var str=node.data,i=offset;start?i>=0:i<str.length;start?i--:i++)if(predicate(str.charAt(i)))return start?i+1:i;return-1},findSpace=function(start,node,offset){return walkText(start,node,offset,(function(c){return isNbsp(c)||isWhiteSpace$1(c)}))},findContent=function(start,node,offset){return walkText(start,node,offset,isContent$1)},findWordEndPoint=function(dom,body,container,offset,start,includeTrailingSpaces){var lastTextNode,rootNode=dom.getParent(container,dom.isBlock)||body,walk=function(container,offset,pred){var textSeeker=TextSeeker(dom),walker=start?textSeeker.backwards:textSeeker.forwards;return Optional.from(walker(container,offset,(function(text,textOffset){return isBookmarkNode$2(text.parentNode)?-1:(lastTextNode=text,pred(start,text,textOffset))}),rootNode))},spaceResult;return walk(container,offset,findSpace).bind((function(result){return includeTrailingSpaces?walk(result.container,result.offset+(start?-1:0),findContent):Optional.some(result)})).orThunk((function(){return lastTextNode?Optional.some({container:lastTextNode,offset:start?0:lastTextNode.length}):Optional.none()}))},findSelectorEndPoint=function(dom,format,rng,container,siblingName){isText$1(container)&&0===container.nodeValue.length&&container[siblingName]&&(container=container[siblingName]);for(var parents=getParents$2(dom,container),i=0;i<parents.length;i++)for(var y=0;y<format.length;y++){var curFormat=format[y];if(!("collapsed"in curFormat&&curFormat.collapsed!==rng.collapsed)&&dom.is(parents[i],curFormat.selector))return parents[i]}return container},findBlockEndPoint=function(editor,format,container,siblingName){var node,dom=editor.dom,root=dom.getRoot();if(format[0].wrapper||(node=dom.getParent(container,format[0].block,root)),!node){var scopeRoot=dom.getParent(container,"LI,TD,TH");node=dom.getParent(isText$1(container)?container.parentNode:container,(function(node){return node!==root&&isTextBlock$2(editor,node)}),scopeRoot)}if(node&&format[0].wrapper&&(node=getParents$2(dom,node,"ul,ol").reverse()[0]||node),!node)for(node=container;node[siblingName]&&!dom.isBlock(node[siblingName])&&(node=node[siblingName],!isEq(node,"br")););return node||container},isAtBlockBoundary=function(dom,root,container,siblingName){var parent=container.parentNode;return!isNonNullable(container[siblingName])&&(!(parent!==root&&!isNullable(parent)&&!dom.isBlock(parent))||isAtBlockBoundary(dom,root,parent,siblingName))},findParentContainer=function(dom,format,container,offset,start){var parent=container,sibling,siblingName=start?"previousSibling":"nextSibling",root=dom.getRoot();if(isText$1(container)&&!isWhiteSpaceNode$1(container)&&(start?offset>0:offset<container.data.length))return container;for(;;){if(!format[0].block_expand&&dom.isBlock(parent))return parent;for(sibling=parent[siblingName];sibling;sibling=sibling[siblingName]){var allowSpaces=isText$1(sibling)&&!isAtBlockBoundary(dom,root,sibling,siblingName);if(!isBookmarkNode$2(sibling)&&!isBogusBr(sibling)&&!isWhiteSpaceNode$1(sibling,allowSpaces))return parent}if(parent===root||parent.parentNode===root){container=parent;break}parent=parent.parentNode}return container},isSelfOrParentBookmark=function(container){return isBookmarkNode$2(container.parentNode)||isBookmarkNode$2(container)},expandRng=function(editor,rng,format,includeTrailingSpace){void 0===includeTrailingSpace&&(includeTrailingSpace=!1);var startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset,dom=editor.dom,startPoint,endPoint;(isElement$1(startContainer)&&startContainer.hasChildNodes()&&(startContainer=getNode(startContainer,startOffset),isText$1(startContainer)&&(startOffset=0)),isElement$1(endContainer)&&endContainer.hasChildNodes()&&(endContainer=getNode(endContainer,rng.collapsed?endOffset:endOffset-1),isText$1(endContainer)&&(endOffset=endContainer.nodeValue.length)),startContainer=findParentContentEditable(dom,startContainer),endContainer=findParentContentEditable(dom,endContainer),isSelfOrParentBookmark(startContainer)&&(startContainer=isBookmarkNode$2(startContainer)?startContainer:startContainer.parentNode,startContainer=rng.collapsed?startContainer.previousSibling||startContainer:startContainer.nextSibling||startContainer,isText$1(startContainer)&&(startOffset=rng.collapsed?startContainer.length:0)),isSelfOrParentBookmark(endContainer)&&(endContainer=isBookmarkNode$2(endContainer)?endContainer:endContainer.parentNode,endContainer=rng.collapsed?endContainer.nextSibling||endContainer:endContainer.previousSibling||endContainer,isText$1(endContainer)&&(endOffset=rng.collapsed?0:endContainer.length)),rng.collapsed)&&(findWordEndPoint(dom,editor.getBody(),startContainer,startOffset,!0,includeTrailingSpace).each((function(_a){var container=_a.container,offset=_a.offset;startContainer=container,startOffset=offset})),findWordEndPoint(dom,editor.getBody(),endContainer,endOffset,!1,includeTrailingSpace).each((function(_a){var container=_a.container,offset=_a.offset;endContainer=container,endOffset=offset})));return(format[0].inline||format[0].block_expand)&&(format[0].inline&&isText$1(startContainer)&&0!==startOffset||(startContainer=findParentContainer(dom,format,startContainer,startOffset,!0)),format[0].inline&&isText$1(endContainer)&&endOffset!==endContainer.nodeValue.length||(endContainer=findParentContainer(dom,format,endContainer,endOffset,!1))),format[0].selector&&!1!==format[0].expand&&!format[0].inline&&(startContainer=findSelectorEndPoint(dom,format,rng,startContainer,"previousSibling"),endContainer=findSelectorEndPoint(dom,format,rng,endContainer,"nextSibling")),(format[0].block||format[0].selector)&&(startContainer=findBlockEndPoint(editor,format,startContainer,"previousSibling"),endContainer=findBlockEndPoint(editor,format,endContainer,"nextSibling"),format[0].block&&(dom.isBlock(startContainer)||(startContainer=findParentContainer(dom,format,startContainer,startOffset,!0)),dom.isBlock(endContainer)||(endContainer=findParentContainer(dom,format,endContainer,endOffset,!1)))),isElement$1(startContainer)&&(startOffset=dom.nodeIndex(startContainer),startContainer=startContainer.parentNode),isElement$1(endContainer)&&(endOffset=dom.nodeIndex(endContainer)+1,endContainer=endContainer.parentNode),{startContainer:startContainer,startOffset:startOffset,endContainer:endContainer,endOffset:endOffset}},clampToExistingChildren=function(container,index){var childNodes=container.childNodes;return index>=childNodes.length?index=childNodes.length-1:index<0&&(index=0),childNodes[index]||container},getEndChild=function(container,index){return clampToExistingChildren(container,index-1)},walk$1=function(dom,rng,callback){var startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset,exclude=function(nodes){var node;return 3===(node=nodes[0]).nodeType&&node===startContainer&&startOffset>=node.nodeValue.length&&nodes.splice(0,1),node=nodes[nodes.length-1],0===endOffset&&nodes.length>0&&node===endContainer&&3===node.nodeType&&nodes.splice(nodes.length-1,1),nodes},collectSiblings=function(node,name,endNode){for(var siblings=[];node&&node!==endNode;node=node[name])siblings.push(node);return siblings},findEndPoint=function(node,root){do{if(node.parentNode===root)return node;node=node.parentNode}while(node)},walkBoundary=function(startNode,endNode,next){for(var siblingName=next?"nextSibling":"previousSibling",node=startNode,parent_1=node.parentNode;node&&node!==endNode;node=parent_1){parent_1=node.parentNode;var siblings_1=collectSiblings(node===startNode?node:node[siblingName],siblingName);siblings_1.length&&(next||siblings_1.reverse(),callback(exclude(siblings_1)))}};if(1===startContainer.nodeType&&startContainer.hasChildNodes()&&(startContainer=clampToExistingChildren(startContainer,startOffset)),1===endContainer.nodeType&&endContainer.hasChildNodes()&&(endContainer=getEndChild(endContainer,endOffset)),startContainer===endContainer)return callback(exclude([startContainer]));for(var ancestor=dom.findCommonAncestor(startContainer,endContainer),node=startContainer;node;node=node.parentNode){if(node===endContainer)return walkBoundary(startContainer,ancestor,!0);if(node===ancestor)break}for(var node=endContainer;node;node=node.parentNode){if(node===startContainer)return walkBoundary(endContainer,ancestor);if(node===ancestor)break}var startPoint=findEndPoint(startContainer,ancestor)||startContainer,endPoint=findEndPoint(endContainer,ancestor)||endContainer;walkBoundary(startContainer,startPoint,!0);var siblings=collectSiblings(startPoint===startContainer?startPoint:startPoint.nextSibling,"nextSibling",endPoint===endContainer?endPoint.nextSibling:endPoint);siblings.length&&callback(exclude(siblings)),walkBoundary(endContainer,endPoint)},getRanges=function(selection){var ranges=[];if(selection)for(var i=0;i<selection.rangeCount;i++)ranges.push(selection.getRangeAt(i));return ranges},getSelectedNodes=function(ranges){return bind(ranges,(function(range){var node=getSelectedNode(range);return node?[SugarElement.fromDom(node)]:[]}))},hasMultipleRanges=function(selection){return getRanges(selection).length>1},getCellsFromRanges=function(ranges){return filter(getSelectedNodes(ranges),isTableCell$1)},getCellsFromElement=function(elm){return descendants$1(elm,"td[data-mce-selected],th[data-mce-selected]")},getCellsFromElementOrRanges=function(ranges,element){var selectedCells=getCellsFromElement(element);return selectedCells.length>0?selectedCells:getCellsFromRanges(ranges)},getCellsFromEditor=function(editor){return getCellsFromElementOrRanges(getRanges(editor.selection.getSel()),SugarElement.fromDom(editor.getBody()))},getStartNode=function(rng){var sc=rng.startContainer,so=rng.startOffset;return isText$1(sc)?0===so?Optional.some(SugarElement.fromDom(sc)):Optional.none():Optional.from(sc.childNodes[so]).map(SugarElement.fromDom)},getEndNode=function(rng){var ec=rng.endContainer,eo=rng.endOffset;return isText$1(ec)?eo===ec.data.length?Optional.some(SugarElement.fromDom(ec)):Optional.none():Optional.from(ec.childNodes[eo-1]).map(SugarElement.fromDom)},getFirstChildren=function(node){return firstChild(node).fold(constant([node]),(function(child){return[node].concat(getFirstChildren(child))}))},getLastChildren=function(node){return lastChild(node).fold(constant([node]),(function(child){return"br"===name(child)?prevSibling(child).map((function(sibling){return[node].concat(getLastChildren(sibling))})).getOr([]):[node].concat(getLastChildren(child))}))},hasAllContentsSelected=function(elm,rng){return lift2(getStartNode(rng),getEndNode(rng),(function(startNode,endNode){var start=find(getFirstChildren(elm),curry(eq$2,startNode)),end=find(getLastChildren(elm),curry(eq$2,endNode));return start.isSome()&&end.isSome()})).getOr(!1)},moveEndPoint$1=function(dom,rng,node,start){var root=node,walker=new DomTreeWalker(node,root),moveCaretBeforeOnEnterElementsMap=filter$1(dom.schema.getMoveCaretBeforeOnEnterElements(),(function(_,name){return!contains(["td","th","table"],name.toLowerCase())}));do{if(isText$1(node)&&0!==Tools.trim(node.nodeValue).length)return void(start?rng.setStart(node,0):rng.setEnd(node,node.nodeValue.length));if(moveCaretBeforeOnEnterElementsMap[node.nodeName])return void(start?rng.setStartBefore(node):"BR"===node.nodeName?rng.setEndBefore(node):rng.setEndAfter(node))}while(node=start?walker.next():walker.prev());"BODY"===root.nodeName&&(start?rng.setStart(root,0):rng.setEnd(root,root.childNodes.length))},hasAnyRanges=function(editor){var sel=editor.selection.getSel();return sel&&sel.rangeCount>0},runOnRanges=function(editor,executor){var fakeSelectionNodes=getCellsFromEditor(editor);fakeSelectionNodes.length>0?each(fakeSelectionNodes,(function(elem){var node=elem.dom,fakeNodeRng=editor.dom.createRng();fakeNodeRng.setStartBefore(node),fakeNodeRng.setEndAfter(node),executor(fakeNodeRng,!0)})):executor(editor.selection.getRng(),!1)},preserve=function(selection,fillBookmark,executor){var bookmark=getPersistentBookmark(selection,fillBookmark);executor(bookmark),selection.moveToBookmark(bookmark)},NodeValue,api=function(is,name){var get=function(element){if(!is(element))throw new Error("Can only get "+name+" value of a "+name+" node");return getOption(element).getOr("")},getOption=function(element){return is(element)?Optional.from(element.dom.nodeValue):Optional.none()},set;return{get:get,getOption:getOption,set:function(element,value){if(!is(element))throw new Error("Can only set raw "+name+" value of a "+name+" node");element.dom.nodeValue=value}}}(isText,"text"),get$8=function(element){return api.get(element)},isZeroWidth=function(elem){return isText(elem)&&get$8(elem)===ZWSP},context=function(editor,elem,wrapName,nodeName){return parent(elem).fold((function(){return"skipping"}),(function(parent){return"br"===nodeName||isZeroWidth(elem)?"valid":isAnnotation(elem)?"existing":isCaretNode(elem.dom)?"caret":isValid(editor,wrapName,nodeName)&&isValid(editor,name(parent),wrapName)?"valid":"invalid-child"}))},applyWordGrab=function(editor,rng){var r=expandRng(editor,rng,[{inline:!0}]);rng.setStart(r.startContainer,r.startOffset),rng.setEnd(r.endContainer,r.endOffset),editor.selection.setRng(rng)},makeAnnotation=function(eDoc,_a,annotationName,decorate){var _b=_a.uid,uid=void 0===_b?generate$1("mce-annotation"):_b,data=__rest(_a,["uid"]),master=SugarElement.fromTag("span",eDoc);add$3(master,annotation()),set(master,""+dataAnnotationId(),uid),set(master,""+dataAnnotation(),annotationName);var _c=decorate(uid,data),_d=_c.attributes,attributes=void 0===_d?{}:_d,_e=_c.classes,classes=void 0===_e?[]:_e;return setAll(master,attributes),add$4(master,classes),master},annotate=function(editor,rng,annotationName,decorate,data){var newWrappers=[],master=makeAnnotation(editor.getDoc(),data,annotationName,decorate),wrapper=Cell(Optional.none()),finishWrapper=function(){wrapper.set(Optional.none())},getOrOpenWrapper=function(){return wrapper.get().getOrThunk((function(){var nu=shallow(master);return newWrappers.push(nu),wrapper.set(Optional.some(nu)),nu}))},processElements=function(elems){each(elems,processElement)},processElement=function(elem){var ctx;switch(context(editor,elem,"span",name(elem))){case"invalid-child":finishWrapper();var children$1=children(elem);processElements(children$1),finishWrapper();break;case"valid":var w=getOrOpenWrapper();wrap(elem,w)}},processNodes=function(nodes){var elems=map(nodes,SugarElement.fromDom);processElements(elems)};return walk$1(editor.dom,rng,(function(nodes){finishWrapper(),processNodes(nodes)})),newWrappers},annotateWithBookmark=function(editor,name,settings,data){editor.undoManager.transact((function(){var selection=editor.selection,initialRng=selection.getRng(),hasFakeSelection=getCellsFromEditor(editor).length>0;if(initialRng.collapsed&&!hasFakeSelection&&applyWordGrab(editor,initialRng),selection.getRng().collapsed&&!hasFakeSelection){var wrapper=makeAnnotation(editor.getDoc(),data,name,settings.decorate);set$1(wrapper," "),selection.getRng().insertNode(wrapper.dom),selection.select(wrapper.dom)}else preserve(selection,!1,(function(){runOnRanges(editor,(function(selectionRng){annotate(editor,selectionRng,name,settings.decorate,data)}))}))}))},Annotator=function(editor){var registry=create$2();setup$1(editor,registry);var changes=setup(editor);return{register:function(name,settings){registry.register(name,settings)},annotate:function(name,data){registry.lookup(name).each((function(settings){annotateWithBookmark(editor,name,settings,data)}))},annotationChanged:function(name,callback){changes.addListener(name,callback)},remove:function(name){identify(editor,Optional.some(name)).each((function(_a){var elements=_a.elements;each(elements,unwrap)}))},getAll:function(name){var directory=findAll(editor,name);return map$1(directory,(function(elems){return map(elems,(function(elem){return elem.dom}))}))}}},BookmarkManager=function(selection){return{getBookmark:curry(getBookmark$1,selection),moveToBookmark:curry(moveToBookmark,selection)}};BookmarkManager.isBookmarkNode=isBookmarkNode$1;var getContentEditableRoot=function(root,node){for(;node&&node!==root;){if(isContentEditableTrue(node)||isContentEditableFalse(node))return node;node=node.parentNode}return null},isXYWithinRange=function(clientX,clientY,range){if(range.collapsed)return!1;if(Env.browser.isIE()&&range.startOffset===range.endOffset-1&&range.startContainer===range.endContainer){var elm=range.startContainer.childNodes[range.startOffset];if(isElement$1(elm))return exists(elm.getClientRects(),(function(rect){return containsXY(rect,clientX,clientY)}))}return exists(range.getClientRects(),(function(rect){return containsXY(rect,clientX,clientY)}))},firePreProcess=function(editor,args){return editor.fire("PreProcess",args)},firePostProcess=function(editor,args){return editor.fire("PostProcess",args)},fireRemove=function(editor){return editor.fire("remove")},fireDetach=function(editor){return editor.fire("detach")},fireSwitchMode=function(editor,mode){return editor.fire("SwitchMode",{mode:mode})},fireObjectResizeStart=function(editor,target,width,height,origin){editor.fire("ObjectResizeStart",{target:target,width:width,height:height,origin:origin})},fireObjectResized=function(editor,target,width,height,origin){editor.fire("ObjectResized",{target:target,width:width,height:height,origin:origin})},firePreInit=function(editor){return editor.fire("PreInit")},firePostRender=function(editor){return editor.fire("PostRender")},fireInit=function(editor){return editor.fire("Init")},firePlaceholderToggle=function(editor,state){return editor.fire("PlaceholderToggle",{state:state})},fireError=function(editor,errorType,error){return editor.fire(errorType,error)},VK={BACKSPACE:8,DELETE:46,DOWN:40,ENTER:13,LEFT:37,RIGHT:39,SPACEBAR:32,TAB:9,UP:38,END:35,HOME:36,modifierPressed:function(e){return e.shiftKey||e.ctrlKey||e.altKey||VK.metaKeyPressed(e)},metaKeyPressed:function(e){return Env.mac?e.metaKey:e.ctrlKey&&!e.altKey}},isContentEditableFalse$6=isContentEditableFalse,ControlSelection=function(selection,editor){var elementSelectionAttr="data-mce-selected",dom=editor.dom,each=Tools.each,selectedElm,selectedElmGhost,resizeHelper,selectedHandle,resizeBackdrop,startX,startY,selectedElmX,selectedElmY,startW,startH,ratio,resizeStarted,width,height,editableDoc=editor.getDoc(),rootDocument=document,abs=Math.abs,round=Math.round,rootElement=editor.getBody(),startScrollWidth,startScrollHeight,resizeHandles={nw:[0,0,-1,-1],ne:[1,0,1,-1],se:[1,1,1,1],sw:[0,1,-1,1]},isImage=function(elm){return elm&&("IMG"===elm.nodeName||editor.dom.is(elm,"figure.image"))},isMedia$1=function(elm){return isMedia(elm)||dom.hasClass(elm,"mce-preview-object")},isEventOnImageOutsideRange=function(evt,range){if("longpress"===evt.type||0===evt.type.indexOf("touch")){var touch=evt.touches[0];return isImage(evt.target)&&!isXYWithinRange(touch.clientX,touch.clientY,range)}return isImage(evt.target)&&!isXYWithinRange(evt.clientX,evt.clientY,range)},contextMenuSelectImage=function(evt){var target=evt.target;isEventOnImageOutsideRange(evt,editor.selection.getRng())&&!evt.isDefaultPrevented()&&editor.selection.select(target)},getResizeTarget=function(elm){return dom.is(elm,"figure.image")?elm.querySelector("img"):dom.hasClass(elm,"mce-preview-object")&&isNonNullable(elm.firstElementChild)?elm.firstElementChild:elm},isResizable=function(elm){var selector=getObjectResizing(editor);return!!selector&&("false"!==elm.getAttribute("data-mce-resize")&&(elm!==editor.getBody()&&(dom.hasClass(elm,"mce-preview-object")?is$1(SugarElement.fromDom(elm.firstElementChild),selector):is$1(SugarElement.fromDom(elm),selector))))},createGhostElement=function(elm){return isMedia$1(elm)?dom.create("img",{src:Env.transparentSrc}):elm.cloneNode(!0)},setGhostElmSize=function(ghostElm,width,height){dom.setStyles(getResizeTarget(ghostElm),{width:width,height:height})},resizeGhostElement=function(e){var deltaX,deltaY,proportional,resizeHelperX,resizeHelperY;deltaX=e.screenX-startX,deltaY=e.screenY-startY,width=deltaX*selectedHandle[2]+startW,height=deltaY*selectedHandle[3]+startH,width=width<5?5:width,height=height<5?5:height,(proportional=(isImage(selectedElm)||isMedia$1(selectedElm))&&!1!==getResizeImgProportional(editor)?!VK.modifierPressed(e):VK.modifierPressed(e))&&(abs(deltaX)>abs(deltaY)?(height=round(width*ratio),width=round(height/ratio)):(width=round(height/ratio),height=round(width*ratio))),setGhostElmSize(selectedElmGhost,width,height),resizeHelperX=(resizeHelperX=selectedHandle.startPos.x+deltaX)>0?resizeHelperX:0,resizeHelperY=(resizeHelperY=selectedHandle.startPos.y+deltaY)>0?resizeHelperY:0,dom.setStyles(resizeHelper,{left:resizeHelperX,top:resizeHelperY,display:"block"}),resizeHelper.innerHTML=width+" &times; "+height,selectedHandle[2]<0&&selectedElmGhost.clientWidth<=width&&dom.setStyle(selectedElmGhost,"left",void 0+(startW-width)),selectedHandle[3]<0&&selectedElmGhost.clientHeight<=height&&dom.setStyle(selectedElmGhost,"top",void 0+(startH-height)),(deltaX=rootElement.scrollWidth-startScrollWidth)+(deltaY=rootElement.scrollHeight-startScrollHeight)!==0&&dom.setStyles(resizeHelper,{left:resizeHelperX-deltaX,top:resizeHelperY-deltaY}),resizeStarted||(fireObjectResizeStart(editor,selectedElm,startW,startH,"corner-"+selectedHandle.name),resizeStarted=!0)},endGhostResize=function(){var wasResizeStarted=resizeStarted;resizeStarted=!1;var setSizeProp=function(name,value){if(value){var target=getResizeTarget(selectedElm);target.style[name]||!editor.schema.isValid(target.nodeName.toLowerCase(),name)?dom.setStyle(target,name,value):dom.setAttrib(target,name,""+value)}};wasResizeStarted&&(setSizeProp("width",width),setSizeProp("height",height)),dom.unbind(editableDoc,"mousemove",resizeGhostElement),dom.unbind(editableDoc,"mouseup",endGhostResize),rootDocument!==editableDoc&&(dom.unbind(rootDocument,"mousemove",resizeGhostElement),dom.unbind(rootDocument,"mouseup",endGhostResize)),dom.remove(selectedElmGhost),dom.remove(resizeHelper),dom.remove(resizeBackdrop),showResizeRect(selectedElm),wasResizeStarted&&(fireObjectResized(editor,selectedElm,width,height,"corner-"+selectedHandle.name),dom.setAttrib(selectedElm,"style",dom.getAttrib(selectedElm,"style"))),editor.nodeChanged()},showResizeRect=function(targetElm){unbindResizeHandleEvents();var position=dom.getPos(targetElm,rootElement),selectedElmX=position.x,selectedElmY=position.y,rect=targetElm.getBoundingClientRect(),targetWidth=rect.width||rect.right-rect.left,targetHeight=rect.height||rect.bottom-rect.top;selectedElm!==targetElm&&(hideResizeRect(),selectedElm=targetElm,width=height=0);var e=editor.fire("ObjectSelected",{target:targetElm}),selectedValue=dom.getAttrib(selectedElm,"data-mce-selected","1");isResizable(targetElm)&&!e.isDefaultPrevented()?each(resizeHandles,(function(handle,name){var handleElm,startDrag=function(e){startX=e.screenX,startY=e.screenY,startW=getResizeTarget(selectedElm).clientWidth,startH=getResizeTarget(selectedElm).clientHeight,ratio=startH/startW,(selectedHandle=handle).name=name,selectedHandle.startPos={x:targetWidth*handle[0]+selectedElmX,y:targetHeight*handle[1]+selectedElmY},startScrollWidth=rootElement.scrollWidth,startScrollHeight=rootElement.scrollHeight,resizeBackdrop=dom.add(rootElement,"div",{class:"mce-resize-backdrop"}),dom.setStyles(resizeBackdrop,{position:"fixed",left:"0",top:"0",width:"100%",height:"100%"}),selectedElmGhost=createGhostElement(selectedElm),dom.addClass(selectedElmGhost,"mce-clonedresizable"),dom.setAttrib(selectedElmGhost,"data-mce-bogus","all"),selectedElmGhost.contentEditable="false",dom.setStyles(selectedElmGhost,{left:selectedElmX,top:selectedElmY,margin:0}),setGhostElmSize(selectedElmGhost,targetWidth,targetHeight),selectedElmGhost.removeAttribute("data-mce-selected"),rootElement.appendChild(selectedElmGhost),dom.bind(editableDoc,"mousemove",resizeGhostElement),dom.bind(editableDoc,"mouseup",endGhostResize),rootDocument!==editableDoc&&(dom.bind(rootDocument,"mousemove",resizeGhostElement),dom.bind(rootDocument,"mouseup",endGhostResize)),resizeHelper=dom.add(rootElement,"div",{class:"mce-resize-helper","data-mce-bogus":"all"},startW+" &times; "+startH)};(handleElm=dom.get("mceResizeHandle"+name))&&dom.remove(handleElm),handleElm=dom.add(rootElement,"div",{id:"mceResizeHandle"+name,"data-mce-bogus":"all",class:"mce-resizehandle",unselectable:!0,style:"cursor:"+name+"-resize; margin:0; padding:0"}),11===Env.ie&&(handleElm.contentEditable=!1),dom.bind(handleElm,"mousedown",(function(e){e.stopImmediatePropagation(),e.preventDefault(),startDrag(e)})),handle.elm=handleElm,dom.setStyles(handleElm,{left:targetWidth*handle[0]+selectedElmX-handleElm.offsetWidth/2,top:targetHeight*handle[1]+selectedElmY-handleElm.offsetHeight/2})})):hideResizeRect(),dom.getAttrib(selectedElm,"data-mce-selected")||selectedElm.setAttribute("data-mce-selected",selectedValue)},hideResizeRect=function(){unbindResizeHandleEvents(),selectedElm&&selectedElm.removeAttribute("data-mce-selected"),each$1(resizeHandles,(function(value,name){var handleElm=dom.get("mceResizeHandle"+name);handleElm&&(dom.unbind(handleElm),dom.remove(handleElm))}))},updateResizeRect=function(e){var startElm,controlElm,isChildOrEqual=function(node,parent){if(node)do{if(node===parent)return!0}while(node=node.parentNode)};resizeStarted||editor.removed||(each(dom.select("img[data-mce-selected],hr[data-mce-selected]"),(function(img){img.removeAttribute("data-mce-selected")})),controlElm="mousedown"===e.type?e.target:selection.getNode(),isChildOrEqual(controlElm=dom.$(controlElm).closest("table,img,figure.image,hr,video,span.mce-preview-object")[0],rootElement)&&(disableGeckoResize(),isChildOrEqual(startElm=selection.getStart(!0),controlElm)&&isChildOrEqual(selection.getEnd(!0),controlElm))?showResizeRect(controlElm):hideResizeRect())},isWithinContentEditableFalse=function(elm){return isContentEditableFalse$6(getContentEditableRoot(editor.getBody(),elm))},unbindResizeHandleEvents=function(){each$1(resizeHandles,(function(handle){handle.elm&&(dom.unbind(handle.elm),delete handle.elm)}))},disableGeckoResize=function(){try{editor.getDoc().execCommand("enableObjectResizing",!1,"false")}catch(ex){}},destroy;return editor.on("init",(function(){if(disableGeckoResize(),Env.browser.isIE()||Env.browser.isEdge()){editor.on("mousedown click",(function(e){var target=e.target,nodeName=target.nodeName;resizeStarted||!/^(TABLE|IMG|HR)$/.test(nodeName)||isWithinContentEditableFalse(target)||(2!==e.button&&editor.selection.select(target,"TABLE"===nodeName),"mousedown"===e.type&&editor.nodeChanged())}));var handleMSControlSelect_1=function(e){var delayedSelect=function(node){Delay.setEditorTimeout(editor,(function(){return editor.selection.select(node)}))};if(isWithinContentEditableFalse(e.target)||isMedia(e.target))return e.preventDefault(),void delayedSelect(e.target);/^(TABLE|IMG|HR)$/.test(e.target.nodeName)&&(e.preventDefault(),"IMG"===e.target.tagName&&delayedSelect(e.target))};dom.bind(rootElement,"mscontrolselect",handleMSControlSelect_1),editor.on("remove",(function(){return dom.unbind(rootElement,"mscontrolselect",handleMSControlSelect_1)}))}var throttledUpdateResizeRect=Delay.throttle((function(e){editor.composing||updateResizeRect(e)}));editor.on("nodechange ResizeEditor ResizeWindow ResizeContent drop FullscreenStateChanged",throttledUpdateResizeRect),editor.on("keyup compositionend",(function(e){selectedElm&&"TABLE"===selectedElm.nodeName&&throttledUpdateResizeRect(e)})),editor.on("hide blur",hideResizeRect),editor.on("contextmenu longpress",contextMenuSelectImage,!0)})),editor.on("remove",unbindResizeHandleEvents),{isResizable:isResizable,showResizeRect:showResizeRect,hideResizeRect:hideResizeRect,updateResizeRect:updateResizeRect,destroy:function(){selectedElm=selectedElmGhost=resizeBackdrop=null}}},hasCeProperty=function(node){return isContentEditableTrue(node)||isContentEditableFalse(node)},findParent=function(node,rootNode,predicate){for(;node&&node!==rootNode;){if(predicate(node))return node;node=node.parentNode}return null},findClosestIeRange=function(clientX,clientY,doc){var rects,element=doc.elementFromPoint(clientX,clientY),rng=doc.body.createTextRange();if(element&&"HTML"!==element.tagName||(element=doc.body),rng.moveToElementText(element),(rects=(rects=Tools.toArray(rng.getClientRects())).sort((function(a,b){return(a=Math.abs(Math.max(a.top-clientY,a.bottom-clientY)))-(b=Math.abs(Math.max(b.top-clientY,b.bottom-clientY)))}))).length>0){clientY=(rects[0].bottom+rects[0].top)/2;try{return rng.moveToPoint(clientX,clientY),rng.collapse(!0),rng}catch(ex){}}return null},moveOutOfContentEditableFalse=function(rng,rootNode){var parentElement=rng&&rng.parentElement?rng.parentElement():null;return isContentEditableFalse(findParent(parentElement,rootNode,hasCeProperty))?null:rng},fromPoint$1=function(clientX,clientY,doc){var rng,point,pointDoc=doc;if(pointDoc.caretPositionFromPoint)(point=pointDoc.caretPositionFromPoint(clientX,clientY))&&((rng=doc.createRange()).setStart(point.offsetNode,point.offset),rng.collapse(!0));else if(doc.caretRangeFromPoint)rng=doc.caretRangeFromPoint(clientX,clientY);else if(pointDoc.body.createTextRange){rng=pointDoc.body.createTextRange();try{rng.moveToPoint(clientX,clientY),rng.collapse(!0)}catch(ex){rng=findClosestIeRange(clientX,clientY,doc)}return moveOutOfContentEditableFalse(rng,doc.body)}return rng},isEq$1=function(rng1,rng2){return rng1&&rng2&&rng1.startContainer===rng2.startContainer&&rng1.startOffset===rng2.startOffset&&rng1.endContainer===rng2.endContainer&&rng1.endOffset===rng2.endOffset},findParent$1=function(node,rootNode,predicate){for(;node&&node!==rootNode;){if(predicate(node))return node;node=node.parentNode}return null},hasParent=function(node,rootNode,predicate){return null!==findParent$1(node,rootNode,predicate)},hasParentWithName=function(node,rootNode,name){return hasParent(node,rootNode,(function(node){return node.nodeName===name}))},isTable$3=function(node){return node&&"TABLE"===node.nodeName},isTableCell$3=function(node){return node&&/^(TD|TH|CAPTION)$/.test(node.nodeName)},isCeFalseCaretContainer=function(node,rootNode){return isCaretContainer(node)&&!1===hasParent(node,rootNode,isCaretNode)},hasBrBeforeAfter=function(dom,node,left){for(var walker=new DomTreeWalker(node,dom.getParent(node.parentNode,dom.isBlock)||dom.getRoot());node=walker[left?"prev":"next"]();)if(isBr(node))return!0},isPrevNode=function(node,name){return node.previousSibling&&node.previousSibling.nodeName===name},hasContentEditableFalseParent=function(body,node){for(;node&&node!==body;){if(isContentEditableFalse(node))return!0;node=node.parentNode}return!1},findTextNodeRelative=function(dom,isAfterNode,collapsed,left,startNode){var lastInlineElement,body=dom.getRoot(),node,nonEmptyElementsMap=dom.schema.getNonEmptyElements(),parentBlockContainer=dom.getParent(startNode.parentNode,dom.isBlock)||body;if(left&&isBr(startNode)&&isAfterNode&&dom.isEmpty(parentBlockContainer))return Optional.some(CaretPosition(startNode.parentNode,dom.nodeIndex(startNode)));for(var walker=new DomTreeWalker(startNode,parentBlockContainer);node=walker[left?"prev":"next"]();){if("false"===dom.getContentEditableParent(node)||isCeFalseCaretContainer(node,body))return Optional.none();if(isText$1(node)&&node.nodeValue.length>0)return!1===hasParentWithName(node,body,"A")?Optional.some(CaretPosition(node,left?node.nodeValue.length:0)):Optional.none();if(dom.isBlock(node)||nonEmptyElementsMap[node.nodeName.toLowerCase()])return Optional.none();lastInlineElement=node}return collapsed&&lastInlineElement?Optional.some(CaretPosition(lastInlineElement,0)):Optional.none()},normalizeEndPoint=function(dom,collapsed,start,rng){var container,offset,body=dom.getRoot(),node,directionLeft,normalized=!1;container=rng[(start?"start":"end")+"Container"],offset=rng[(start?"start":"end")+"Offset"];var isAfterNode=isElement$1(container)&&offset===container.childNodes.length,nonEmptyElementsMap=dom.schema.getNonEmptyElements();if(directionLeft=start,isCaretContainer(container))return Optional.none();if(isElement$1(container)&&offset>container.childNodes.length-1&&(directionLeft=!1),isDocument$1(container)&&(container=body,offset=0),container===body){if(directionLeft&&(node=container.childNodes[offset>0?offset-1:0])){if(isCaretContainer(node))return Optional.none();if(nonEmptyElementsMap[node.nodeName]||isTable$3(node))return Optional.none()}if(container.hasChildNodes()){if(offset=Math.min(!directionLeft&&offset>0?offset-1:offset,container.childNodes.length-1),container=container.childNodes[offset],offset=isText$1(container)&&isAfterNode?container.data.length:0,!collapsed&&container===body.lastChild&&isTable$3(container))return Optional.none();if(hasContentEditableFalseParent(body,container)||isCaretContainer(container))return Optional.none();if(container.hasChildNodes()&&!1===isTable$3(container)){node=container;var walker=new DomTreeWalker(container,body);do{if(isContentEditableFalse(node)||isCaretContainer(node)){normalized=!1;break}if(isText$1(node)&&node.nodeValue.length>0){offset=directionLeft?0:node.nodeValue.length,container=node,normalized=!0;break}if(nonEmptyElementsMap[node.nodeName.toLowerCase()]&&!isTableCell$3(node)){offset=dom.nodeIndex(node),container=node.parentNode,directionLeft||offset++,normalized=!0;break}}while(node=directionLeft?walker.next():walker.prev())}}}return collapsed&&(isText$1(container)&&0===offset&&findTextNodeRelative(dom,isAfterNode,collapsed,!0,container).each((function(pos){container=pos.container(),offset=pos.offset(),normalized=!0})),isElement$1(container)&&((node=container.childNodes[offset])||(node=container.childNodes[offset-1]),!node||!isBr(node)||isPrevNode(node,"A")||hasBrBeforeAfter(dom,node,!1)||hasBrBeforeAfter(dom,node,!0)||findTextNodeRelative(dom,isAfterNode,collapsed,!0,node).each((function(pos){container=pos.container(),offset=pos.offset(),normalized=!0})))),directionLeft&&!collapsed&&isText$1(container)&&offset===container.nodeValue.length&&findTextNodeRelative(dom,isAfterNode,collapsed,!1,container).each((function(pos){container=pos.container(),offset=pos.offset(),normalized=!0})),normalized?Optional.some(CaretPosition(container,offset)):Optional.none()},normalize=function(dom,rng){var collapsed=rng.collapsed,normRng=rng.cloneRange(),startPos=CaretPosition.fromRangeStart(rng);return normalizeEndPoint(dom,collapsed,!0,normRng).each((function(pos){collapsed&&CaretPosition.isAbove(startPos,pos)||normRng.setStart(pos.container(),pos.offset())})),collapsed||normalizeEndPoint(dom,collapsed,!1,normRng).each((function(pos){normRng.setEnd(pos.container(),pos.offset())})),collapsed&&normRng.collapse(!0),isEq$1(rng,normRng)?Optional.none():Optional.some(normRng)},splitText=function(node,offset){return node.splitText(offset)},split$1=function(rng){var startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset;return startContainer===endContainer&&isText$1(startContainer)?startOffset>0&&startOffset<startContainer.nodeValue.length&&(startContainer=(endContainer=splitText(startContainer,startOffset)).previousSibling,endOffset>startOffset?(startContainer=endContainer=splitText(endContainer,endOffset-=startOffset).previousSibling,endOffset=endContainer.nodeValue.length,startOffset=0):endOffset=0):(isText$1(startContainer)&&startOffset>0&&startOffset<startContainer.nodeValue.length&&(startContainer=splitText(startContainer,startOffset),startOffset=0),isText$1(endContainer)&&endOffset>0&&endOffset<endContainer.nodeValue.length&&(endOffset=(endContainer=splitText(endContainer,endOffset).previousSibling).nodeValue.length)),{startContainer:startContainer,startOffset:startOffset,endContainer:endContainer,endOffset:endOffset}},RangeUtils=function(dom){var walk,split,normalize$1;return{walk:function(rng,callback){return walk$1(dom,rng,callback)},split:split$1,normalize:function(rng){return normalize(dom,rng).fold(never,(function(normalizedRng){return rng.setStart(normalizedRng.startContainer,normalizedRng.startOffset),rng.setEnd(normalizedRng.endContainer,normalizedRng.endOffset),!0}))}}};RangeUtils.compareRanges=isEq$1,RangeUtils.getCaretRangeFromPoint=fromPoint$1,RangeUtils.getSelectedNode=getSelectedNode,RangeUtils.getNode=getNode;var Dimension,api$1=function(name,getOffset){var set,get=function(element){var r=getOffset(element);if(r<=0||null===r){var css=get$5(element,name);return parseFloat(css)||0}return r},getOuter,aggregate=function(element,properties){return foldl(properties,(function(acc,property){var val=get$5(element,property),value=void 0===val?0:parseInt(val,10);return isNaN(value)?acc:acc+value}),0)},max=function(element,value,properties){var cumulativeInclusions=aggregate(element,properties),absoluteMax;return value>cumulativeInclusions?value-cumulativeInclusions:0};return{set:function(element,h){if(!isNumber(h)&&!h.match(/^[0-9]+$/))throw new Error(name+".set accepts only positive integer values. Value was "+h);var dom=element.dom;isSupported$1(dom)&&(dom.style[name]=h+"px")},get:get,getOuter:get,aggregate:aggregate,max:max}}("height",(function(element){var dom=element.dom;return inBody(element)?dom.getBoundingClientRect().height:dom.offsetHeight})),get$9=function(element){return api$1.get(element)},walkUp=function(navigation,doc){var frame;return navigation.view(doc).fold(constant([]),(function(f){var parent=navigation.owner(f),rest=walkUp(navigation,parent);return[f].concat(rest)}))},pathTo=function(element,navigation){var d=navigation.owner(element);return walkUp(navigation,d)},view=function(doc){var _a,element;return(doc.dom===document?Optional.none():Optional.from(null===(_a=doc.dom.defaultView)||void 0===_a?void 0:_a.frameElement)).map(SugarElement.fromDom)},owner$1=function(element){return documentOrOwner(element)},Navigation=Object.freeze({__proto__:null,view:view,owner:owner$1}),find$2=function(element){var doc=SugarElement.fromDom(document),scroll=get$2(doc),frames=pathTo(element,Navigation),offset=viewport(element),r=foldr(frames,(function(b,a){var loc=viewport(a);return{left:b.left+loc.left,top:b.top+loc.top}}),{left:0,top:0});return SugarPosition(r.left+offset.left+scroll.left,r.top+offset.top+scroll.top)},excludeFromDescend=function(element){return"textarea"===name(element)},fireScrollIntoViewEvent=function(editor,data){var scrollEvent;return editor.fire("ScrollIntoView",data).isDefaultPrevented()},fireAfterScrollIntoViewEvent=function(editor,data){editor.fire("AfterScrollIntoView",data)},descend=function(element,offset){var children$1=children(element);if(0===children$1.length||excludeFromDescend(element))return{element:element,offset:offset};if(offset<children$1.length&&!excludeFromDescend(children$1[offset]))return{element:children$1[offset],offset:0};var last=children$1[children$1.length-1];return excludeFromDescend(last)?{element:element,offset:offset}:"img"===name(last)?{element:last,offset:1}:isText(last)?{element:last,offset:get$8(last).length}:{element:last,offset:children(last).length}},markerInfo=function(element,cleanupFun){var pos=absolute(element),height=get$9(element);return{element:element,bottom:pos.top+height,height:height,pos:pos,cleanup:cleanupFun}},createMarker=function(element,offset){var startPoint=descend(element,offset),span=SugarElement.fromHtml('<span data-mce-bogus="all">\ufeff</span>');return before(startPoint.element,span),markerInfo(span,(function(){return remove(span)}))},elementMarker=function(element){return markerInfo(SugarElement.fromDom(element),noop)},withMarker=function(editor,f,rng,alignToTop){preserveWith(editor,(function(_s,_e){return applyWithMarker(editor,f,rng,alignToTop)}),rng)},withScrollEvents=function(editor,doc,f,marker,alignToTop){var data={elm:marker.element.dom,alignToTop:alignToTop},scrollTop;fireScrollIntoViewEvent(editor,data)||(f(doc,get$2(doc).top,marker,alignToTop),fireAfterScrollIntoViewEvent(editor,data))},applyWithMarker=function(editor,f,rng,alignToTop){var body=SugarElement.fromDom(editor.getBody()),doc=SugarElement.fromDom(editor.getDoc());reflow(body);var marker=createMarker(SugarElement.fromDom(rng.startContainer),rng.startOffset);withScrollEvents(editor,doc,f,marker,alignToTop),marker.cleanup()},withElement=function(editor,element,f,alignToTop){var doc=SugarElement.fromDom(editor.getDoc());withScrollEvents(editor,doc,f,elementMarker(element),alignToTop)},preserveWith=function(editor,f,rng){var startElement=rng.startContainer,startOffset=rng.startOffset,endElement=rng.endContainer,endOffset=rng.endOffset;f(SugarElement.fromDom(startElement),SugarElement.fromDom(endElement));var newRng=editor.dom.createRng();newRng.setStart(startElement,startOffset),newRng.setEnd(endElement,endOffset),editor.selection.setRng(rng)},scrollToMarker=function(marker,viewHeight,alignToTop,doc){var pos=marker.pos;if(alignToTop)to(pos.left,pos.top,doc);else{var y=pos.top-viewHeight+marker.height;to(pos.left,y,doc)}},intoWindowIfNeeded=function(doc,scrollTop,viewHeight,marker,alignToTop){var viewportBottom=viewHeight+scrollTop,markerTop=marker.pos.top,markerBottom=marker.bottom,largerThanViewport=markerBottom-markerTop>=viewHeight;if(markerTop<scrollTop)scrollToMarker(marker,viewHeight,!1!==alignToTop,doc);else if(markerTop>viewportBottom){var align;scrollToMarker(marker,viewHeight,largerThanViewport?!1!==alignToTop:!0===alignToTop,doc)}else markerBottom>viewportBottom&&!largerThanViewport&&scrollToMarker(marker,viewHeight,!0===alignToTop,doc)},intoWindow=function(doc,scrollTop,marker,alignToTop){var viewHeight=doc.dom.defaultView.innerHeight;intoWindowIfNeeded(doc,scrollTop,viewHeight,marker,alignToTop)},intoFrame=function(doc,scrollTop,marker,alignToTop){var frameViewHeight=doc.dom.defaultView.innerHeight;intoWindowIfNeeded(doc,scrollTop,frameViewHeight,marker,alignToTop);var op=find$2(marker.element),viewportBounds=getBounds(window);op.top<viewportBounds.y?intoView(marker.element,!1!==alignToTop):op.top>viewportBounds.bottom&&intoView(marker.element,!0===alignToTop)},rangeIntoWindow=function(editor,rng,alignToTop){return withMarker(editor,intoWindow,rng,alignToTop)},elementIntoWindow=function(editor,element,alignToTop){return withElement(editor,element,intoWindow,alignToTop)},rangeIntoFrame=function(editor,rng,alignToTop){return withMarker(editor,intoFrame,rng,alignToTop)},elementIntoFrame=function(editor,element,alignToTop){return withElement(editor,element,intoFrame,alignToTop)},scrollElementIntoView=function(editor,element,alignToTop){var scroller;(editor.inline?elementIntoWindow:elementIntoFrame)(editor,element,alignToTop)},scrollRangeIntoView=function(editor,rng,alignToTop){var scroller;(editor.inline?rangeIntoWindow:rangeIntoFrame)(editor,rng,alignToTop)},getDocument=function(){return SugarElement.fromDom(document)},focus=function(element){return element.dom.focus()},hasFocus=function(element){var root=getRootNode(element).dom;return element.dom===root.activeElement},active=function(root){return void 0===root&&(root=getDocument()),Optional.from(root.dom.activeElement).map(SugarElement.fromDom)},search=function(element){return active(getRootNode(element)).filter((function(e){return element.dom.contains(e.dom)}))},create$4,SimRange_create=function(start,soffset,finish,foffset){return{start:start,soffset:soffset,finish:finish,foffset:foffset}},adt=Adt_generate([{before:["element"]},{on:["element","offset"]},{after:["element"]}]),cata=function(subject,onBefore,onOn,onAfter){return subject.fold(onBefore,onOn,onAfter)},getStart=function(situ){return situ.fold(identity,identity,identity)},before$3,on,after$2,Situ_before=adt.before,Situ_on=adt.on,Situ_after=adt.after,Situ_cata=cata,Situ_getStart=getStart,adt$1=Adt_generate([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),exactFromRange=function(simRange){return adt$1.exact(simRange.start,simRange.soffset,simRange.finish,simRange.foffset)},getStart$1=function(selection){return selection.match({domRange:function(rng){return SugarElement.fromDom(rng.startContainer)},relative:function(startSitu,_finishSitu){return Situ_getStart(startSitu)},exact:function(start,_soffset,_finish,_foffset){return start}})},domRange,relative,exact,getWin,range,SimSelection={domRange:adt$1.domRange,relative:adt$1.relative,exact:adt$1.exact,exactFromRange:exactFromRange,getWin:function(selection){var start=getStart$1(selection);return defaultView(start)},range:SimRange_create},browser$3=detect$3().browser,clamp=function(offset,element){var max=isText(element)?get$8(element).length:children(element).length+1;return offset>max?max:offset<0?0:offset},normalizeRng=function(rng){return SimSelection.range(rng.start,clamp(rng.soffset,rng.start),rng.finish,clamp(rng.foffset,rng.finish))},isOrContains=function(root,elm){return!isRestrictedNode(elm.dom)&&(contains$2(root,elm)||eq$2(root,elm))},isRngInRoot=function(root){return function(rng){return isOrContains(root,rng.start)&&isOrContains(root,rng.finish)}},shouldStore=function(editor){return!0===editor.inline||browser$3.isIE()},nativeRangeToSelectionRange=function(r){return SimSelection.range(SugarElement.fromDom(r.startContainer),r.startOffset,SugarElement.fromDom(r.endContainer),r.endOffset)},readRange=function(win){var selection=win.getSelection(),rng;return(selection&&0!==selection.rangeCount?Optional.from(selection.getRangeAt(0)):Optional.none()).map(nativeRangeToSelectionRange)},getBookmark$2=function(root){var win=defaultView(root);return readRange(win.dom).filter(isRngInRoot(root))},validate=function(root,bookmark){return Optional.from(bookmark).filter(isRngInRoot(root)).map(normalizeRng)},bookmarkToNativeRng=function(bookmark){var rng=document.createRange();try{return rng.setStart(bookmark.start.dom,bookmark.soffset),rng.setEnd(bookmark.finish.dom,bookmark.foffset),Optional.some(rng)}catch(_){return Optional.none()}},store=function(editor){var newBookmark=shouldStore(editor)?getBookmark$2(SugarElement.fromDom(editor.getBody())):Optional.none();editor.bookmark=newBookmark.isSome()?newBookmark:editor.bookmark},storeNative=function(editor,rng){var root=SugarElement.fromDom(editor.getBody()),range,newBookmark=(shouldStore(editor)?Optional.from(rng):Optional.none()).map(nativeRangeToSelectionRange).filter(isRngInRoot(root));editor.bookmark=newBookmark.isSome()?newBookmark:editor.bookmark},getRng=function(editor){var bookmark;return(editor.bookmark?editor.bookmark:Optional.none()).bind((function(x){return validate(SugarElement.fromDom(editor.getBody()),x)})).bind(bookmarkToNativeRng)},restore=function(editor){getRng(editor).each((function(rng){return editor.selection.setRng(rng)}))},isEditorUIElement,FocusManager={isEditorUIElement:function(elm){var className=elm.className.toString();return-1!==className.indexOf("tox-")||-1!==className.indexOf("mce-")}},isManualNodeChange=function(e){return"nodechange"===e.type&&e.selectionChange},registerPageMouseUp=function(editor,throttledStore){var mouseUpPage=function(){throttledStore.throttle()};DOMUtils.DOM.bind(document,"mouseup",mouseUpPage),editor.on("remove",(function(){DOMUtils.DOM.unbind(document,"mouseup",mouseUpPage)}))},registerFocusOut=function(editor){editor.on("focusout",(function(){store(editor)}))},registerMouseUp=function(editor,throttledStore){editor.on("mouseup touchend",(function(_e){throttledStore.throttle()}))},registerEditorEvents=function(editor,throttledStore){var browser;detect$3().browser.isIE()?registerFocusOut(editor):registerMouseUp(editor,throttledStore),editor.on("keyup NodeChange",(function(e){isManualNodeChange(e)||store(editor)}))},register=function(editor){var throttledStore=first((function(){store(editor)}),0);editor.on("init",(function(){editor.inline&&registerPageMouseUp(editor,throttledStore),registerEditorEvents(editor,throttledStore)})),editor.on("remove",(function(){throttledStore.cancel()}))},documentFocusInHandler,DOM$2=DOMUtils.DOM,isEditorUIElement$1=function(elm){return FocusManager.isEditorUIElement(elm)},isEditorContentAreaElement=function(elm){var classList=elm.classList;return void 0!==classList&&(classList.contains("tox-edit-area")||classList.contains("tox-edit-area__iframe")||classList.contains("mce-content-body"))},isUIElement=function(editor,elm){var customSelector=getCustomUiSelector(editor),parent;return null!==DOM$2.getParent(elm,(function(elm){return isEditorUIElement$1(elm)||!!customSelector&&editor.dom.is(elm,customSelector)}))},getActiveElement=function(editor){try{var root=getRootNode(SugarElement.fromDom(editor.getElement()));return active(root).fold((function(){return document.body}),(function(x){return x.dom}))}catch(ex){return document.body}},registerEvents=function(editorManager,e){var editor=e.editor;register(editor),editor.on("focusin",(function(){var focusedEditor=editorManager.focusedEditor;focusedEditor!==editor&&(focusedEditor&&focusedEditor.fire("blur",{focusedEditor:editor}),editorManager.setActive(editor),editorManager.focusedEditor=editor,editor.fire("focus",{blurredEditor:focusedEditor}),editor.focus(!0))})),editor.on("focusout",(function(){Delay.setEditorTimeout(editor,(function(){var focusedEditor=editorManager.focusedEditor;isUIElement(editor,getActiveElement(editor))||focusedEditor!==editor||(editor.fire("blur",{focusedEditor:null}),editorManager.focusedEditor=null)}))})),documentFocusInHandler||(documentFocusInHandler=function(e){var activeEditor=editorManager.activeEditor;activeEditor&&getOriginalEventTarget(e).each((function(target){target.ownerDocument===document&&(target===document.body||isUIElement(activeEditor,target)||editorManager.focusedEditor!==activeEditor||(activeEditor.fire("blur",{focusedEditor:null}),editorManager.focusedEditor=null))}))},DOM$2.bind(document,"focusin",documentFocusInHandler))},unregisterDocumentEvents=function(editorManager,e){editorManager.focusedEditor===e.editor&&(editorManager.focusedEditor=null),editorManager.activeEditor||(DOM$2.unbind(document,"focusin",documentFocusInHandler),documentFocusInHandler=null)},setup$2=function(editorManager){editorManager.on("AddEditor",curry(registerEvents,editorManager)),editorManager.on("RemoveEditor",curry(unregisterDocumentEvents,editorManager))},getContentEditableHost=function(editor,node){return editor.dom.getParent(node,(function(node){return"true"===editor.dom.getContentEditable(node)}))},getCollapsedNode=function(rng){return rng.collapsed?Optional.from(getNode(rng.startContainer,rng.startOffset)).map(SugarElement.fromDom):Optional.none()},getFocusInElement=function(root,rng){return getCollapsedNode(rng).bind((function(node){return isTableSection(node)?Optional.some(node):!1===contains$2(root,node)?Optional.some(root):Optional.none()}))},normalizeSelection=function(editor,rng){getFocusInElement(SugarElement.fromDom(editor.getBody()),rng).bind((function(elm){return firstPositionIn(elm.dom)})).fold((function(){editor.selection.normalize()}),(function(caretPos){return editor.selection.setRng(caretPos.toRange())}))},focusBody=function(body){if(body.setActive)try{body.setActive()}catch(ex){body.focus()}else body.focus()},hasElementFocus=function(elm){return hasFocus(elm)||search(elm).isSome()},hasIframeFocus=function(editor){return editor.iframeElement&&hasFocus(SugarElement.fromDom(editor.iframeElement))},hasInlineFocus=function(editor){var rawBody=editor.getBody();return rawBody&&hasElementFocus(SugarElement.fromDom(rawBody))},hasUiFocus=function(editor){var dos=getRootNode(SugarElement.fromDom(editor.getElement()));return active(dos).filter((function(elem){return!isEditorContentAreaElement(elem.dom)&&isUIElement(editor,elem.dom)})).isSome()},hasFocus$1=function(editor){return editor.inline?hasInlineFocus(editor):hasIframeFocus(editor)},hasEditorOrUiFocus=function(editor){return hasFocus$1(editor)||hasUiFocus(editor)},focusEditor=function(editor){var selection=editor.selection,body=editor.getBody(),rng=selection.getRng();editor.quirks.refreshContentEditable(),void 0!==editor.bookmark&&!1===hasFocus$1(editor)&&getRng(editor).each((function(bookmarkRng){editor.selection.setRng(bookmarkRng),rng=bookmarkRng}));var contentEditableHost=getContentEditableHost(editor,selection.getNode());if(editor.$.contains(body,contentEditableHost))return focusBody(contentEditableHost),normalizeSelection(editor,rng),void activateEditor(editor);editor.inline||(Env.opera||focusBody(body),editor.getWin().focus()),(Env.gecko||editor.inline)&&(focusBody(body),normalizeSelection(editor,rng)),activateEditor(editor)},activateEditor=function(editor){return editor.editorManager.setActive(editor)},focus$1=function(editor,skipFocus){editor.removed||(skipFocus?activateEditor(editor):focusEditor(editor))},getEndpointElement=function(root,rng,start,real,resolve){var container=start?rng.startContainer:rng.endContainer,offset=start?rng.startOffset:rng.endOffset;return Optional.from(container).map(SugarElement.fromDom).map((function(elm){return real&&rng.collapsed?elm:child(elm,resolve(elm,offset)).getOr(elm)})).bind((function(elm){return isElement(elm)?Optional.some(elm):parent(elm).filter(isElement)})).map((function(elm){return elm.dom})).getOr(root)},getStart$2=function(root,rng,real){return getEndpointElement(root,rng,!0,real,(function(elm,offset){return Math.min(childNodesCount(elm),offset)}))},getEnd=function(root,rng,real){return getEndpointElement(root,rng,!1,real,(function(elm,offset){return offset>0?offset-1:offset}))},skipEmptyTextNodes=function(node,forwards){for(var orig=node;node&&isText$1(node)&&0===node.length;)node=forwards?node.nextSibling:node.previousSibling;return node||orig},getNode$1=function(root,rng){var elm,startContainer,endContainer;if(!rng)return root;startContainer=rng.startContainer,endContainer=rng.endContainer;var startOffset=rng.startOffset,endOffset=rng.endOffset;return elm=rng.commonAncestorContainer,!rng.collapsed&&(startContainer===endContainer&&endOffset-startOffset<2&&startContainer.hasChildNodes()&&(elm=startContainer.childNodes[startOffset]),3===startContainer.nodeType&&3===endContainer.nodeType&&(startContainer=startContainer.length===startOffset?skipEmptyTextNodes(startContainer.nextSibling,!0):startContainer.parentNode,endContainer=0===endOffset?skipEmptyTextNodes(endContainer.previousSibling,!1):endContainer.parentNode,startContainer&&startContainer===endContainer))?startContainer:elm&&3===elm.nodeType?elm.parentNode:elm},getSelectedBlocks=function(dom,rng,startElm,endElm){var node,selectedBlocks=[],root=dom.getRoot();if(startElm=dom.getParent(startElm||getStart$2(root,rng,rng.collapsed),dom.isBlock),endElm=dom.getParent(endElm||getEnd(root,rng,rng.collapsed),dom.isBlock),startElm&&startElm!==root&&selectedBlocks.push(startElm),startElm&&endElm&&startElm!==endElm){node=startElm;for(var walker=new DomTreeWalker(startElm,root);(node=walker.next())&&node!==endElm;)dom.isBlock(node)&&selectedBlocks.push(node)}return endElm&&startElm!==endElm&&endElm!==root&&selectedBlocks.push(endElm),selectedBlocks},select$1=function(dom,node,content){return Optional.from(node).map((function(node){var idx=dom.nodeIndex(node),rng=dom.createRng();return rng.setStart(node.parentNode,idx),rng.setEnd(node.parentNode,idx+1),content&&(moveEndPoint$1(dom,rng,node,!0),moveEndPoint$1(dom,rng,node,!1)),rng}))},processRanges=function(editor,ranges){return map(ranges,(function(range){var evt=editor.fire("GetSelectionRange",{range:range});return evt.range!==range?evt.range:range}))},typeLookup={"#text":3,"#comment":8,"#cdata":4,"#pi":7,"#doctype":10,"#document-fragment":11},walk$2=function(node,root,prev){var startName=prev?"lastChild":"firstChild",siblingName=prev?"prev":"next";if(node[startName])return node[startName];if(node!==root){var sibling=node[siblingName];if(sibling)return sibling;for(var parent_1=node.parent;parent_1&&parent_1!==root;parent_1=parent_1.parent)if(sibling=parent_1[siblingName])return sibling}},isEmptyTextNode$1=function(node){if(!isWhitespaceText(node.value))return!1;var parentNode=node.parent;return!parentNode||"span"===parentNode.name&&!parentNode.attr("style")||!/^[ ]+$/.test(node.value)},isNonEmptyElement=function(node){var isNamedAnchor="a"===node.name&&!node.attr("href")&&node.attr("id");return node.attr("name")||node.attr("id")&&!node.firstChild||node.attr("data-mce-bookmark")||isNamedAnchor},AstNode=function(){function AstNode(name,type){this.name=name,this.type=type,1===type&&(this.attributes=[],this.attributes.map={})}return AstNode.create=function(name,attrs){var node=new AstNode(name,typeLookup[name]||1);return attrs&&each$1(attrs,(function(value,attrName){node.attr(attrName,value)})),node},AstNode.prototype.replace=function(node){var self=this;return node.parent&&node.remove(),this.insert(node,this),this.remove(),this},AstNode.prototype.attr=function(name,value){var self=this,attrs;if("string"!=typeof name)return null!=name&&each$1(name,(function(value,key){self.attr(key,value)})),self;if(attrs=self.attributes){if(void 0!==value){if(null===value){if(name in attrs.map){delete attrs.map[name];for(var i=attrs.length;i--;)if(attrs[i].name===name)return attrs.splice(i,1),self}return self}if(name in attrs.map){for(var i=attrs.length;i--;)if(attrs[i].name===name){attrs[i].value=value;break}}else attrs.push({name:name,value:value});return attrs.map[name]=value,self}return attrs.map[name]}},AstNode.prototype.clone=function(){var self=this,clone=new AstNode(this.name,this.type),selfAttrs;if(selfAttrs=this.attributes){var cloneAttrs=[];cloneAttrs.map={};for(var i=0,l=selfAttrs.length;i<l;i++){var selfAttr=selfAttrs[i];"id"!==selfAttr.name&&(cloneAttrs[cloneAttrs.length]={name:selfAttr.name,value:selfAttr.value},cloneAttrs.map[selfAttr.name]=selfAttr.value)}clone.attributes=cloneAttrs}return clone.value=this.value,clone.shortEnded=this.shortEnded,clone},AstNode.prototype.wrap=function(wrapper){var self=this;return this.parent.insert(wrapper,this),wrapper.append(this),this},AstNode.prototype.unwrap=function(){for(var self=this,node=this.firstChild;node;){var next=node.next;this.insert(node,this,!0),node=next}this.remove()},AstNode.prototype.remove=function(){var self=this,parent=this.parent,next=this.next,prev=this.prev;return parent&&(parent.firstChild===this?(parent.firstChild=next,next&&(next.prev=null)):prev.next=next,parent.lastChild===this?(parent.lastChild=prev,prev&&(prev.next=null)):next.prev=prev,this.parent=this.next=this.prev=null),this},AstNode.prototype.append=function(node){var self=this;node.parent&&node.remove();var last=this.lastChild;return last?(last.next=node,node.prev=last,this.lastChild=node):this.lastChild=this.firstChild=node,node.parent=this,node},AstNode.prototype.insert=function(node,refNode,before){node.parent&&node.remove();var parent=refNode.parent||this;return before?(refNode===parent.firstChild?parent.firstChild=node:refNode.prev.next=node,node.prev=refNode.prev,node.next=refNode,refNode.prev=node):(refNode===parent.lastChild?parent.lastChild=node:refNode.next.prev=node,node.next=refNode.next,node.prev=refNode,refNode.next=node),node.parent=parent,node},AstNode.prototype.getAll=function(name){for(var self=this,collection=[],node=this.firstChild;node;node=walk$2(node,this))node.name===name&&collection.push(node);return collection},AstNode.prototype.empty=function(){var self=this;if(this.firstChild){for(var nodes=[],node=this.firstChild;node;node=walk$2(node,this))nodes.push(node);for(var i=nodes.length;i--;){var node;(node=nodes[i]).parent=node.firstChild=node.lastChild=node.next=node.prev=null}}return this.firstChild=this.lastChild=null,this},AstNode.prototype.isEmpty=function(elements,whitespace,predicate){void 0===whitespace&&(whitespace={});var self=this,node=this.firstChild;if(isNonEmptyElement(this))return!1;if(node)do{if(1===node.type){if(node.attr("data-mce-bogus"))continue;if(elements[node.name])return!1;if(isNonEmptyElement(node))return!1}if(8===node.type)return!1;if(3===node.type&&!isEmptyTextNode$1(node))return!1;if(3===node.type&&node.parent&&whitespace[node.parent.name]&&isWhitespaceText(node.value))return!1;if(predicate&&predicate(node))return!1}while(node=walk$2(node,this));return!0},AstNode.prototype.walk=function(prev){return walk$2(this,null,prev)},AstNode}(),extractBase64DataUris=function(html){for(var dataImageUri=/data:[^;]+;base64,([a-z0-9\+\/=]+)/gi,chunks=[],uris={},prefix=generate$1("img"),matches,index=0,count=0;matches=dataImageUri.exec(html);){var uri=matches[0],imageId=prefix+"_"+count++;uris[imageId]=uri,index<matches.index&&chunks.push(html.substr(index,matches.index-index)),chunks.push(imageId),index=matches.index+uri.length}var re=new RegExp(prefix+"_[0-9]+","g");return 0===index?{prefix:prefix,uris:uris,html:html,re:re}:(index<html.length&&chunks.push(html.substr(index)),{prefix:prefix,uris:uris,html:chunks.join(""),re:re})},restoreDataUris=function(html,result){return html.replace(result.re,(function(imageId){return get$1(result.uris,imageId).getOr(imageId)}))},parseDataUri=function(uri){var matches=/data:([^;]+);base64,([a-z0-9\+\/=]+)/i.exec(uri);return matches?Optional.some({type:matches[1],data:decodeURIComponent(matches[2])}):Optional.none()},safeSvgDataUrlElements=["img","video"],isValidPrefixAttrName=function(name){return 0===name.indexOf("data-")||0===name.indexOf("aria-")},blockSvgDataUris=function(allowSvgDataUrls,tagName){var allowed;return!(isNullable(allowSvgDataUrls)?contains(safeSvgDataUrlElements,tagName):allowSvgDataUrls)},isInvalidUri=function(settings,uri,tagName){return!settings.allow_html_data_urls&&(/^data:image\//i.test(uri)?blockSvgDataUris(settings.allow_svg_data_urls,tagName)&&/^data:image\/svg\+xml/i.test(uri):/^data:/i.test(uri))},findEndTagIndex=function(schema,html,startIndex){var count=1,index,matches,shortEndedElements=schema.getShortEndedElements(),tokenRegExp=/<([!?\/])?([A-Za-z0-9\-_:.]+)(\s(?:[^'">]+(?:"[^"]*"|'[^']*'))*[^"'>]*(?:"[^">]*|'[^'>]*)?|\s*|\/)>/g;for(tokenRegExp.lastIndex=index=startIndex;matches=tokenRegExp.exec(html);){if(index=tokenRegExp.lastIndex,"/"===matches[1])count--;else if(!matches[1]){if(matches[2]in shortEndedElements)continue;count++}if(0===count)break}return index},isConditionalComment=function(html,startIndex){return/^\s*\[if [\w\W]+\]>.*<!\[endif\](--!?)?>/.test(html.substr(startIndex))},findCommentEndIndex=function(html,isBogus,startIndex){void 0===startIndex&&(startIndex=0);var lcHtml=html.toLowerCase();if(-1!==lcHtml.indexOf("[if ",startIndex)&&isConditionalComment(lcHtml,startIndex)){var endIfIndex=lcHtml.indexOf("[endif]",startIndex);return lcHtml.indexOf(">",endIfIndex)}if(isBogus){var endIndex=lcHtml.indexOf(">",startIndex);return-1!==endIndex?endIndex:lcHtml.length}var endCommentRegexp=/--!?>/g;endCommentRegexp.lastIndex=startIndex;var match=endCommentRegexp.exec(html);return match?match.index+match[0].length:lcHtml.length},checkBogusAttribute=function(regExp,attrString){var matches=regExp.exec(attrString);if(matches){var name_1=matches[1],value=matches[2];return"string"==typeof name_1&&"data-mce-bogus"===name_1.toLowerCase()?value:null}return null},SaxParser=function(settings,schema){void 0===schema&&(schema=Schema()),!1!==(settings=settings||{}).fix_self_closing&&(settings.fix_self_closing=!0);var comment=settings.comment?settings.comment:noop,cdata=settings.cdata?settings.cdata:noop,text=settings.text?settings.text:noop,start=settings.start?settings.start:noop,end=settings.end?settings.end:noop,pi=settings.pi?settings.pi:noop,doctype=settings.doctype?settings.doctype:noop,parseInternal=function(base64Extract,format){void 0===format&&(format="html");for(var html=base64Extract.html,matches,index=0,value,endRegExp,stack=[],attrList,i,textData,name,isInternalElement,isShortEnded,elementRule,isValidElement,attr,attribsValue,validAttributesMap,validAttributePatterns,attributesRequired,attributesDefault,attributesForced,anyAttributesRequired,attrValue,idCount=0,decode=Entities.decode,filteredUrlAttrs=Tools.makeMap("src,href,data,background,formaction,poster,xlink:href"),scriptUriRegExp=/((java|vb)script|mhtml):/i,parsingMode="html"===format?0:1,processEndTag=function(name){var pos,i;for(pos=stack.length;pos--&&stack[pos].name!==name;);if(pos>=0){for(i=stack.length-1;i>=pos;i--)(name=stack[i]).valid&&end(name.name);stack.length=pos}},processText=function(value,raw){return text(restoreDataUris(value,base64Extract),raw)},processComment=function(value){""!==value&&(">"===value.charAt(0)&&(value=" "+value),settings.allow_conditional_comments||"[if"!==value.substr(0,3).toLowerCase()||(value=" "+value),comment(restoreDataUris(value,base64Extract)))},processAttr=function(value){return restoreDataUris(value,base64Extract)},processMalformedComment=function(value,startIndex){var startTag=value||"",isBogus=!startsWith(startTag,"--"),endIndex=findCommentEndIndex(html,isBogus,startIndex);return value=html.substr(startIndex,endIndex-startIndex),processComment(isBogus?startTag+value:value),endIndex+1},parseAttribute=function(tagName,name,value,val2,val3){var attrRule,i,trimRegExp=/[\s\u0000-\u001F]+/g;if(name=name.toLowerCase(),value=processAttr(name in fillAttrsMap?name:decode(value||val2||val3||"")),validate&&!isInternalElement&&!1===isValidPrefixAttrName(name)&&!["svg","path","defs","linearGradient","stop","rect"].includes(tagName)){if(!(attrRule=validAttributesMap[name])&&validAttributePatterns){for(i=validAttributePatterns.length;i--&&!(attrRule=validAttributePatterns[i]).pattern.test(name););-1===i&&(attrRule=null)}if(!attrRule)return;if(attrRule.validValues&&!(value in attrRule.validValues))return}if(filteredUrlAttrs[name]&&!settings.allow_script_urls){var uri=value.replace(trimRegExp,"");try{uri=decodeURIComponent(uri)}catch(ex){uri=unescape(uri)}if(scriptUriRegExp.test(uri))return;if(isInvalidUri(settings,uri,tagName))return}isInternalElement&&(name in filteredUrlAttrs||0===name.indexOf("on"))||(attrList.map[name]=value,attrList.push({name:name,value:value}))},tokenRegExp=new RegExp("<(?:(?:!--([\\w\\W]*?)--!?>)|(?:!\\[CDATA\\[([\\w\\W]*?)\\]\\]>)|(?:![Dd][Oo][Cc][Tt][Yy][Pp][Ee]([\\w\\W]*?)>)|(?:!(--)?)|(?:\\?([^\\s\\/<>]+) ?([\\w\\W]*?)[?/]>)|(?:\\/([A-Za-z][A-Za-z0-9\\-_\\:\\.]*)>)|(?:([A-Za-z][A-Za-z0-9\\-_:.]*)(\\s(?:[^'\">]+(?:\"[^\"]*\"|'[^']*'))*[^\"'>]*(?:\"[^\">]*|'[^'>]*)?|\\s*|\\/)>))","g"),attrRegExp=/([\w:\-]+)(?:\s*=\s*(?:(?:\"((?:[^\"])*)\")|(?:\'((?:[^\'])*)\')|([^>\s]+)))?/g,shortEndedElements=schema.getShortEndedElements(),selfClosing=settings.self_closing_elements||schema.getSelfClosingElements(),fillAttrsMap=schema.getBoolAttrs(),validate=settings.validate,removeInternalElements=settings.remove_internals,fixSelfClosing=settings.fix_self_closing,specialElements=schema.getSpecialElements(),processHtml=html+">";matches=tokenRegExp.exec(processHtml);){var matchText=matches[0];if(index<matches.index&&processText(decode(html.substr(index,matches.index-index))),value=matches[7])":"===(value=value.toLowerCase()).charAt(0)&&(value=value.substr(1)),processEndTag(value);else if(value=matches[8]){if(matches.index+matchText.length>html.length){processText(decode(html.substr(matches.index))),index=matches.index+matchText.length;continue}":"===(value=value.toLowerCase()).charAt(0)&&(value=value.substr(1)),isShortEnded=value in shortEndedElements,fixSelfClosing&&selfClosing[value]&&stack.length>0&&stack[stack.length-1].name===value&&processEndTag(value);var bogusValue=checkBogusAttribute(attrRegExp,matches[9]);if(null!==bogusValue){if("all"===bogusValue){index=findEndTagIndex(schema,html,tokenRegExp.lastIndex),tokenRegExp.lastIndex=index;continue}isValidElement=!1}if("lineargradient"===value&&(value="linearGradient"),!validate||(elementRule=schema.getElementRule(value))){if(isValidElement=!0,validate&&(validAttributesMap=elementRule.attributes,validAttributePatterns=elementRule.attributePatterns),(attribsValue=matches[9])?((isInternalElement=-1!==attribsValue.indexOf("data-mce-type"))&&removeInternalElements&&(isValidElement=!1),(attrList=[]).map={},attribsValue.replace(attrRegExp,(function(match,name,val,val2,val3){return parseAttribute(value,name,val,val2,val3),""}))):(attrList=[]).map={},validate&&!isInternalElement){if(attributesRequired=elementRule.attributesRequired,attributesDefault=elementRule.attributesDefault,attributesForced=elementRule.attributesForced,(anyAttributesRequired=elementRule.removeEmptyAttrs)&&!attrList.length&&(isValidElement=!1),attributesForced)for(i=attributesForced.length;i--;)name=(attr=attributesForced[i]).name,"{$uid}"===(attrValue=attr.value)&&(attrValue="mce_"+idCount++),attrList.map[name]=attrValue,attrList.push({name:name,value:attrValue});if(attributesDefault)for(i=attributesDefault.length;i--;)(name=(attr=attributesDefault[i]).name)in attrList.map||("{$uid}"===(attrValue=attr.value)&&(attrValue="mce_"+idCount++),attrList.map[name]=attrValue,attrList.push({name:name,value:attrValue}));if(attributesRequired){for(i=attributesRequired.length;i--&&!(attributesRequired[i]in attrList.map););-1===i&&(isValidElement=!1)}if(attr=attrList.map["data-mce-bogus"]){if("all"===attr){index=findEndTagIndex(schema,html,tokenRegExp.lastIndex),tokenRegExp.lastIndex=index;continue}isValidElement=!1}}isValidElement&&start(value,attrList,isShortEnded)}else isValidElement=!1;if(endRegExp=specialElements[value]){endRegExp.lastIndex=index=matches.index+matchText.length,(matches=endRegExp.exec(html))?(isValidElement&&(textData=html.substr(index,matches.index-index)),index=matches.index+matches[0].length):(textData=html.substr(index),index=html.length),isValidElement&&(textData.length>0&&processText(textData,!0),end(value)),tokenRegExp.lastIndex=index;continue}isShortEnded||(attribsValue&&attribsValue.indexOf("/")===attribsValue.length-1?isValidElement&&end(value):stack.push({name:value,valid:isValidElement}))}else if(value=matches[1])processComment(value);else if(value=matches[2]){var isValidCdataSection;if(!(1===parsingMode||settings.preserve_cdata||stack.length>0&&schema.isValidChild(stack[stack.length-1].name,"#cdata"))){index=processMalformedComment("",matches.index+2),tokenRegExp.lastIndex=index;continue}cdata(value)}else if(value=matches[3])doctype(value);else{if((value=matches[4])||"<!"===matchText){index=processMalformedComment(value,matches.index+matchText.length),tokenRegExp.lastIndex=index;continue}if(value=matches[5]){if(1!==parsingMode){index=processMalformedComment("?",matches.index+2),tokenRegExp.lastIndex=index;continue}pi(value,matches[6])}}index=matches.index+matchText.length}for(index<html.length&&processText(decode(html.substr(index))),i=stack.length-1;i>=0;i--)(value=stack[i]).valid&&end(value.name)},parse;return{parse:function(html,format){void 0===format&&(format="html"),parseInternal(extractBase64DataUris(html),format)}}};SaxParser.findEndTag=findEndTagIndex;var trimHtml=function(tempAttrs,html){var trimContentRegExp=new RegExp(["\\s?("+tempAttrs.join("|")+')="[^"]+"'].join("|"),"gi");return html.replace(trimContentRegExp,"")},trimInternal=function(serializer,html){var content=html,bogusAllRegExp=/<(\w+) [^>]*data-mce-bogus="all"[^>]*>/g,endTagIndex,index,matchLength,matches,schema=serializer.schema;content=trimHtml(serializer.getTempAttrs(),content);for(var shortEndedElements=schema.getShortEndedElements();matches=bogusAllRegExp.exec(content);)index=bogusAllRegExp.lastIndex,matchLength=matches[0].length,endTagIndex=shortEndedElements[matches[1]]?index:SaxParser.findEndTag(schema,content,index),content=content.substring(0,index-matchLength)+content.substring(endTagIndex),bogusAllRegExp.lastIndex=index-matchLength;return trim$2(content)},trimExternal=trimInternal,trimEmptyContents=function(editor,html){var blockName=getForcedRootBlock(editor),emptyRegExp=new RegExp("^(<"+blockName+"[^>]*>(&nbsp;|&#160;|\\s| |<br \\/>|)<\\/"+blockName+">[\r\n]*|<br \\/>[\r\n]*)$");return html.replace(emptyRegExp,"")},getContentFromBody=function(editor,args,format,body){var content;return args.format=format,args.get=!0,args.getInner=!0,args.no_events||editor.fire("BeforeGetContent",args),content="raw"===args.format?Tools.trim(trimExternal(editor.serializer,body.innerHTML)):"text"===args.format?editor.dom.isEmpty(body)?"":trim$2(body.innerText||body.textContent):"tree"===args.format?editor.serializer.serialize(body,args):Tools.trim(trimExternal(editor.serializer,body.innerHTML)),contains(["text","tree"],args.format)||isWsPreserveElement(SugarElement.fromDom(body))?args.content=content:args.content=Tools.trim(content),args.no_events||editor.fire("GetContent",args),args.content},getContentInternal=function(editor,args,format){return Optional.from(editor.getBody()).fold(constant("tree"===args.format?new AstNode("body",11):""),(function(body){return getContentFromBody(editor,args,format,body)}))},each$7=Tools.each,ElementUtils=function(dom){var compare;return{compare:function(node1,node2){if(node1.nodeName!==node2.nodeName)return!1;var getAttribs=function(node){var attribs={};return each$7(dom.getAttribs(node),(function(attr){var name=attr.nodeName.toLowerCase();0!==name.indexOf("_")&&"style"!==name&&0!==name.indexOf("data-")&&(attribs[name]=dom.getAttrib(node,name))})),attribs},compareObjects=function(obj1,obj2){var value,name;for(name in obj1)if(obj1.hasOwnProperty(name)){if(void 0===(value=obj2[name]))return!1;if(obj1[name]!==value)return!1;delete obj2[name]}for(name in obj2)if(obj2.hasOwnProperty(name))return!1;return!0};return!!compareObjects(getAttribs(node1),getAttribs(node2))&&(!!compareObjects(dom.parseStyle(dom.getAttrib(node1,"style")),dom.parseStyle(dom.getAttrib(node2,"style")))&&(!isBookmarkNode$1(node1)&&!isBookmarkNode$1(node2)))}}},makeMap$3=Tools.makeMap,Writer=function(settings){var html=[],indent=(settings=settings||{}).indent,indentBefore=makeMap$3(settings.indent_before||""),indentAfter=makeMap$3(settings.indent_after||""),encode=Entities.getEncodeFunc(settings.entity_encoding||"raw",settings.entities),htmlOutput="html"===settings.element_format;return{start:function(name,attrs,empty){var i,l,attr,value;if(indent&&indentBefore[name]&&html.length>0&&(value=html[html.length-1]).length>0&&"\n"!==value&&html.push("\n"),html.push("<",name),attrs)for(i=0,l=attrs.length;i<l;i++)attr=attrs[i],html.push(" ",attr.name,'="',encode(attr.value,!0),'"');html[html.length]=!empty||htmlOutput?">":" />",empty&&indent&&indentAfter[name]&&html.length>0&&(value=html[html.length-1]).length>0&&"\n"!==value&&html.push("\n")},end:function(name){var value;html.push("</",name,">"),indent&&indentAfter[name]&&html.length>0&&(value=html[html.length-1]).length>0&&"\n"!==value&&html.push("\n")},text:function(text,raw){text.length>0&&(html[html.length]=raw?text:encode(text))},cdata:function(text){html.push("<![CDATA[",text,"]]>")},comment:function(text){html.push("\x3c!--",text,"--\x3e")},pi:function(name,text){text?html.push("<?",name," ",encode(text),"?>"):html.push("<?",name,"?>"),indent&&html.push("\n")},doctype:function(text){html.push("<!DOCTYPE",text,">",indent?"\n":"")},reset:function(){html.length=0},getContent:function(){return html.join("").replace(/\n$/,"")}}},HtmlSerializer=function(settings,schema){void 0===schema&&(schema=Schema());var writer=Writer(settings),serialize;return(settings=settings||{}).validate=!("validate"in settings)||settings.validate,{serialize:function(node){var validate=settings.validate,handlers={3:function(node){writer.text(node.value,node.raw)},8:function(node){writer.comment(node.value)},7:function(node){writer.pi(node.name,node.value)},10:function(node){writer.doctype(node.value)},4:function(node){writer.cdata(node.value)},11:function(node){if(node=node.firstChild)do{walk(node)}while(node=node.next)}};writer.reset();var walk=function(node){var handler=handlers[node.type],name,isEmpty,attrs,attrName,attrValue,sortedAttrs,i,l,elementRule;if(handler)handler(node);else{if(name=node.name,isEmpty=node.shortEnded,attrs=node.attributes,validate&&attrs&&attrs.length>1&&((sortedAttrs=[]).map={},elementRule=schema.getElementRule(node.name))){for(i=0,l=elementRule.attributesOrder.length;i<l;i++)(attrName=elementRule.attributesOrder[i])in attrs.map&&(attrValue=attrs.map[attrName],sortedAttrs.map[attrName]=attrValue,sortedAttrs.push({name:attrName,value:attrValue}));for(i=0,l=attrs.length;i<l;i++)(attrName=attrs[i].name)in sortedAttrs.map||(attrValue=attrs.map[attrName],sortedAttrs.map[attrName]=attrValue,sortedAttrs.push({name:attrName,value:attrValue}));attrs=sortedAttrs}if(writer.start(node.name,attrs,isEmpty),!isEmpty){if(node=node.firstChild)do{walk(node)}while(node=node.next);writer.end(name)}}};return 1!==node.type||settings.inner?handlers[11](node):walk(node),writer.getContent()}}},isChar=function(forward,predicate,pos){return Optional.from(pos.container()).filter(isText$1).exists((function(text){var delta=forward?0:-1;return predicate(text.data.charAt(pos.offset()+delta))}))},isBeforeSpace=curry(isChar,!0,isWhiteSpace$1),isAfterSpace=curry(isChar,!1,isWhiteSpace$1),isEmptyText=function(pos){var container=pos.container();return isText$1(container)&&(0===container.data.length||isZwsp$1(container.data)&&BookmarkManager.isBookmarkNode(container.parentNode))},matchesElementPosition=function(before,predicate){return function(pos){return Optional.from(getChildNodeAtRelativeOffset(before?0:-1,pos)).filter(predicate).isSome()}},isImageBlock=function(node){return isImg(node)&&"block"===get$5(SugarElement.fromDom(node),"display")},isCefNode=function(node){return isContentEditableFalse(node)&&!isBogusAll(node)},isBeforeImageBlock=matchesElementPosition(!0,isImageBlock),isAfterImageBlock=matchesElementPosition(!1,isImageBlock),isBeforeMedia=matchesElementPosition(!0,isMedia),isAfterMedia=matchesElementPosition(!1,isMedia),isBeforeTable=matchesElementPosition(!0,isTable),isAfterTable=matchesElementPosition(!1,isTable),isBeforeContentEditableFalse=matchesElementPosition(!0,isCefNode),isAfterContentEditableFalse=matchesElementPosition(!1,isCefNode),getLastChildren$1=function(elm){for(var children=[],rawNode=elm.dom;rawNode;)children.push(SugarElement.fromDom(rawNode)),rawNode=rawNode.lastChild;return children},removeTrailingBr=function(elm){var allBrs=descendants$1(elm,"br"),brs=filter(getLastChildren$1(elm).slice(-1),isBr$1);allBrs.length===brs.length&&each(brs,remove)},fillWithPaddingBr=function(elm){empty(elm),append(elm,SugarElement.fromHtml('<br data-mce-bogus="1">'))},trimBlockTrailingBr=function(elm){lastChild(elm).each((function(lastChild){prevSibling(lastChild).each((function(lastChildPrevSibling){isBlock(elm)&&isBr$1(lastChild)&&isBlock(lastChildPrevSibling)&&remove(lastChild)}))}))},dropLast=function(xs){return xs.slice(0,-1)},parentsUntil$1=function(start,root,predicate){return contains$2(root,start)?dropLast(parents(start,(function(elm){return predicate(elm)||eq$2(elm,root)}))):[]},parents$1=function(start,root){return parentsUntil$1(start,root,never)},parentsAndSelf=function(start,root){return[start].concat(parents$1(start,root))},navigateIgnoreEmptyTextNodes=function(forward,root,from){return navigateIgnore(forward,root,from,isEmptyText)},getClosestBlock=function(root,pos){return find(parentsAndSelf(SugarElement.fromDom(pos.container()),root),isBlock)},isAtBeforeAfterBlockBoundary=function(forward,root,pos){return navigateIgnoreEmptyTextNodes(forward,root.dom,pos).forall((function(newPos){return getClosestBlock(root,pos).fold((function(){return!1===isInSameBlock(newPos,pos,root.dom)}),(function(fromBlock){return!1===isInSameBlock(newPos,pos,root.dom)&&contains$2(fromBlock,SugarElement.fromDom(newPos.container()))}))}))},isAtBlockBoundary$1=function(forward,root,pos){return getClosestBlock(root,pos).fold((function(){return navigateIgnoreEmptyTextNodes(forward,root.dom,pos).forall((function(newPos){return!1===isInSameBlock(newPos,pos,root.dom)}))}),(function(parent){return navigateIgnoreEmptyTextNodes(forward,parent.dom,pos).isNone()}))},isAtStartOfBlock=curry(isAtBlockBoundary$1,!1),isAtEndOfBlock=curry(isAtBlockBoundary$1,!0),isBeforeBlock=curry(isAtBeforeAfterBlockBoundary,!1),isAfterBlock=curry(isAtBeforeAfterBlockBoundary,!0),isBr$5=function(pos){return getElementFromPosition(pos).exists(isBr$1)},findBr=function(forward,root,pos){var parentBlocks=filter(parentsAndSelf(SugarElement.fromDom(pos.container()),root),isBlock),scope=head(parentBlocks).getOr(root);return fromPosition(forward,scope.dom,pos).filter(isBr$5)},isBeforeBr=function(root,pos){return getElementFromPosition(pos).exists(isBr$1)||findBr(!0,root,pos).isSome()},isAfterBr=function(root,pos){return getElementFromPrevPosition(pos).exists(isBr$1)||findBr(!1,root,pos).isSome()},findPreviousBr=curry(findBr,!1),findNextBr=curry(findBr,!0),isInMiddleOfText=function(pos){return CaretPosition.isTextPosition(pos)&&!pos.isAtStart()&&!pos.isAtEnd()},getClosestBlock$1=function(root,pos){var parentBlocks=filter(parentsAndSelf(SugarElement.fromDom(pos.container()),root),isBlock);return head(parentBlocks).getOr(root)},hasSpaceBefore=function(root,pos){return isInMiddleOfText(pos)?isAfterSpace(pos):isAfterSpace(pos)||prevPosition(getClosestBlock$1(root,pos).dom,pos).exists(isAfterSpace)},hasSpaceAfter=function(root,pos){return isInMiddleOfText(pos)?isBeforeSpace(pos):isBeforeSpace(pos)||nextPosition(getClosestBlock$1(root,pos).dom,pos).exists(isBeforeSpace)},isPreValue=function(value){return contains(["pre","pre-wrap"],value)},isInPre=function(pos){return getElementFromPosition(pos).bind((function(elm){return closest(elm,isElement)})).exists((function(elm){return isPreValue(get$5(elm,"white-space"))}))},isAtBeginningOfBody=function(root,pos){return prevPosition(root.dom,pos).isNone()},isAtEndOfBody=function(root,pos){return nextPosition(root.dom,pos).isNone()},isAtLineBoundary=function(root,pos){return isAtBeginningOfBody(root,pos)||isAtEndOfBody(root,pos)||isAtStartOfBlock(root,pos)||isAtEndOfBlock(root,pos)||isAfterBr(root,pos)||isBeforeBr(root,pos)},needsToHaveNbsp=function(root,pos){return!isInPre(pos)&&(isAtLineBoundary(root,pos)||hasSpaceBefore(root,pos)||hasSpaceAfter(root,pos))},needsToBeNbspLeft=function(root,pos){return!isInPre(pos)&&(isAtStartOfBlock(root,pos)||isBeforeBlock(root,pos)||isAfterBr(root,pos)||hasSpaceBefore(root,pos))},leanRight=function(pos){var container=pos.container(),offset=pos.offset();return isText$1(container)&&offset<container.data.length?CaretPosition(container,offset+1):pos},needsToBeNbspRight=function(root,pos){return!isInPre(pos)&&(isAtEndOfBlock(root,pos)||isAfterBlock(root,pos)||isBeforeBr(root,pos)||hasSpaceAfter(root,pos))},needsToBeNbsp=function(root,pos){return needsToBeNbspLeft(root,pos)||needsToBeNbspRight(root,leanRight(pos))},isNbspAt=function(text,offset){return isNbsp(text.charAt(offset))},hasNbsp=function(pos){var container=pos.container();return isText$1(container)&&contains$1(container.data," ")},normalizeNbspMiddle=function(text){var chars=text.split("");return map(chars,(function(chr,i){return isNbsp(chr)&&i>0&&i<chars.length-1&&isContent$1(chars[i-1])&&isContent$1(chars[i+1])?" ":chr})).join("")},normalizeNbspAtStart=function(root,node){var text=node.data,firstPos=CaretPosition(node,0);return!(!isNbspAt(text,0)||needsToBeNbsp(root,firstPos))&&(node.data=" "+text.slice(1),!0)},normalizeNbspInMiddleOfTextNode=function(node){var text=node.data,newText=normalizeNbspMiddle(text);return newText!==text&&(node.data=newText,!0)},normalizeNbspAtEnd=function(root,node){var text=node.data,lastPos=CaretPosition(node,text.length-1);return!(!isNbspAt(text,text.length-1)||needsToBeNbsp(root,lastPos))&&(node.data=text.slice(0,-1)+" ",!0)},normalizeNbsps=function(root,pos){return Optional.some(pos).filter(hasNbsp).bind((function(pos){var container=pos.container(),normalized;return normalizeNbspAtStart(root,container)||normalizeNbspInMiddleOfTextNode(container)||normalizeNbspAtEnd(root,container)?Optional.some(pos):Optional.none()}))},normalizeNbspsInEditor=function(editor){var root=SugarElement.fromDom(editor.getBody());editor.selection.isCollapsed()&&normalizeNbsps(root,CaretPosition.fromRangeStart(editor.selection.getRng())).each((function(pos){editor.selection.setRng(pos.toRange())}))},normalizeContent=function(content,isStartOfContent,isEndOfContent){var result;return foldl(content,(function(acc,c){return isWhiteSpace$1(c)||isNbsp(c)?acc.previousCharIsSpace||""===acc.str&&isStartOfContent||acc.str.length===content.length-1&&isEndOfContent?{previousCharIsSpace:!1,str:acc.str+" "}:{previousCharIsSpace:!0,str:acc.str+" "}:{previousCharIsSpace:!1,str:acc.str+c}}),{previousCharIsSpace:!1,str:""}).str},normalize$1=function(node,offset,count){if(0!==count){var elm=SugarElement.fromDom(node),root=ancestor(elm,isBlock).getOr(elm),whitespace=node.data.slice(offset,offset+count),isEndOfContent=offset+count>=node.data.length&&needsToBeNbspRight(root,CaretPosition(node,node.data.length)),isStartOfContent=0===offset&&needsToBeNbspLeft(root,CaretPosition(node,0));node.replaceData(offset,count,normalizeContent(whitespace,isStartOfContent,isEndOfContent))}},normalizeWhitespaceAfter=function(node,offset){var content=node.data.slice(offset),whitespaceCount=content.length-lTrim(content).length;return normalize$1(node,offset,whitespaceCount)},normalizeWhitespaceBefore=function(node,offset){var content=node.data.slice(0,offset),whitespaceCount=content.length-rTrim(content).length;return normalize$1(node,offset-whitespaceCount,whitespaceCount)},mergeTextNodes=function(prevNode,nextNode,normalizeWhitespace,mergeToPrev){void 0===mergeToPrev&&(mergeToPrev=!0);var whitespaceOffset=rTrim(prevNode.data).length,newNode=mergeToPrev?prevNode:nextNode,removeNode=mergeToPrev?nextNode:prevNode;return mergeToPrev?newNode.appendData(removeNode.data):newNode.insertData(0,removeNode.data),remove(SugarElement.fromDom(removeNode)),normalizeWhitespace&&normalizeWhitespaceAfter(newNode,whitespaceOffset),newNode},needsReposition=function(pos,elm){var container=pos.container(),offset=pos.offset();return!1===CaretPosition.isTextPosition(pos)&&container===elm.parentNode&&offset>CaretPosition.before(elm).offset()},reposition=function(elm,pos){return needsReposition(pos,elm)?CaretPosition(pos.container(),pos.offset()-1):pos},beforeOrStartOf=function(node){return isText$1(node)?CaretPosition(node,0):CaretPosition.before(node)},afterOrEndOf=function(node){return isText$1(node)?CaretPosition(node,node.data.length):CaretPosition.after(node)},getPreviousSiblingCaretPosition=function(elm){return isCaretCandidate(elm.previousSibling)?Optional.some(afterOrEndOf(elm.previousSibling)):elm.previousSibling?lastPositionIn(elm.previousSibling):Optional.none()},getNextSiblingCaretPosition=function(elm){return isCaretCandidate(elm.nextSibling)?Optional.some(beforeOrStartOf(elm.nextSibling)):elm.nextSibling?firstPositionIn(elm.nextSibling):Optional.none()},findCaretPositionBackwardsFromElm=function(rootElement,elm){var startPosition=CaretPosition.before(elm.previousSibling?elm.previousSibling:elm.parentNode);return prevPosition(rootElement,startPosition).fold((function(){return nextPosition(rootElement,CaretPosition.after(elm))}),Optional.some)},findCaretPositionForwardsFromElm=function(rootElement,elm){return nextPosition(rootElement,CaretPosition.after(elm)).fold((function(){return prevPosition(rootElement,CaretPosition.before(elm))}),Optional.some)},findCaretPositionBackwards=function(rootElement,elm){return getPreviousSiblingCaretPosition(elm).orThunk((function(){return getNextSiblingCaretPosition(elm)})).orThunk((function(){return findCaretPositionBackwardsFromElm(rootElement,elm)}))},findCaretPositionForward=function(rootElement,elm){return getNextSiblingCaretPosition(elm).orThunk((function(){return getPreviousSiblingCaretPosition(elm)})).orThunk((function(){return findCaretPositionForwardsFromElm(rootElement,elm)}))},findCaretPosition$1=function(forward,rootElement,elm){return forward?findCaretPositionForward(rootElement,elm):findCaretPositionBackwards(rootElement,elm)},findCaretPosOutsideElmAfterDelete=function(forward,rootElement,elm){return findCaretPosition$1(forward,rootElement,elm).map(curry(reposition,elm))},setSelection=function(editor,forward,pos){pos.fold((function(){editor.focus()}),(function(pos){editor.selection.setRng(pos.toRange(),forward)}))},eqRawNode=function(rawNode){return function(elm){return elm.dom===rawNode}},isBlock$2=function(editor,elm){return elm&&has(editor.schema.getBlockElements(),name(elm))},paddEmptyBlock=function(elm){if(isEmpty(elm)){var br=SugarElement.fromHtml('<br data-mce-bogus="1">');return empty(elm),append(elm,br),Optional.some(CaretPosition.before(br.dom))}return Optional.none()},deleteNormalized=function(elm,afterDeletePosOpt,normalizeWhitespace){var prevTextOpt=prevSibling(elm).filter(isText),nextTextOpt=nextSibling(elm).filter(isText);return remove(elm),lift3(prevTextOpt,nextTextOpt,afterDeletePosOpt,(function(prev,next,pos){var prevNode=prev.dom,nextNode=next.dom,offset=prevNode.data.length;return mergeTextNodes(prevNode,nextNode,normalizeWhitespace),pos.container()===nextNode?CaretPosition(prevNode,offset):pos})).orThunk((function(){return normalizeWhitespace&&(prevTextOpt.each((function(elm){return normalizeWhitespaceBefore(elm.dom,elm.dom.length)})),nextTextOpt.each((function(elm){return normalizeWhitespaceAfter(elm.dom,0)}))),afterDeletePosOpt}))},isInlineElement=function(editor,element){return has(editor.schema.getTextInlineElements(),name(element))},deleteElement=function(editor,forward,elm,moveCaret){void 0===moveCaret&&(moveCaret=!0);var afterDeletePos=findCaretPosOutsideElmAfterDelete(forward,editor.getBody(),elm.dom),parentBlock=ancestor(elm,curry(isBlock$2,editor),eqRawNode(editor.getBody())),normalizedAfterDeletePos=deleteNormalized(elm,afterDeletePos,isInlineElement(editor,elm));editor.dom.isEmpty(editor.getBody())?(editor.setContent(""),editor.selection.setCursorLocation()):parentBlock.bind(paddEmptyBlock).fold((function(){moveCaret&&setSelection(editor,forward,normalizedAfterDeletePos)}),(function(paddPos){moveCaret&&setSelection(editor,forward,Optional.some(paddPos))}))},tableCellRng=function(start,end){return{start:start,end:end}},tableSelection=function(rng,table,cells){return{rng:rng,table:table,cells:cells}},deleteAction=Adt_generate([{removeTable:["element"]},{emptyCells:["cells"]},{deleteCellSelection:["rng","cell"]}]),isRootFromElement=function(root){return function(cur){return eq$2(root,cur)}},getClosestCell=function(container,isRoot){return closest$1(SugarElement.fromDom(container),"td,th",isRoot)},getClosestTable=function(cell,isRoot){return ancestor$1(cell,"table",isRoot)},isExpandedCellRng=function(cellRng){return!eq$2(cellRng.start,cellRng.end)},getTableFromCellRng=function(cellRng,isRoot){return getClosestTable(cellRng.start,isRoot).bind((function(startParentTable){return getClosestTable(cellRng.end,isRoot).bind((function(endParentTable){return someIf(eq$2(startParentTable,endParentTable),startParentTable)}))}))},isSingleCellTable=function(cellRng,isRoot){return!isExpandedCellRng(cellRng)&&getTableFromCellRng(cellRng,isRoot).exists((function(table){var rows=table.dom.rows;return 1===rows.length&&1===rows[0].cells.length}))},getTableCells=function(table){return descendants$1(table,"td,th")},getCellRng=function(rng,isRoot){var startCell=getClosestCell(rng.startContainer,isRoot),endCell=getClosestCell(rng.endContainer,isRoot);return lift2(startCell,endCell,tableCellRng)},getCellRangeFromStartTable=function(cellRng,isRoot){return getClosestTable(cellRng.start,isRoot).bind((function(table){return last(getTableCells(table)).map((function(endCell){return tableCellRng(cellRng.start,endCell)}))}))},partialSelection=function(isRoot,rng){var startCell=getClosestCell(rng.startContainer,isRoot),endCell=getClosestCell(rng.endContainer,isRoot);return rng.collapsed?Optional.none():lift2(startCell,endCell,tableCellRng).fold((function(){return startCell.fold((function(){return endCell.bind((function(endCell){return getClosestTable(endCell,isRoot).bind((function(table){return head(getTableCells(table)).map((function(startCell){return tableCellRng(startCell,endCell)}))}))}))}),(function(startCell){return getClosestTable(startCell,isRoot).bind((function(table){return last(getTableCells(table)).map((function(endCell){return tableCellRng(startCell,endCell)}))}))}))}),(function(cellRng){return isWithinSameTable(isRoot,cellRng)?Optional.none():getCellRangeFromStartTable(cellRng,isRoot)}))},isWithinSameTable=function(isRoot,cellRng){return getTableFromCellRng(cellRng,isRoot).isSome()},getTableSelectionFromCellRng=function(cellRng,isRoot){return getTableFromCellRng(cellRng,isRoot).map((function(table){return tableSelection(cellRng,table,getTableCells(table))}))},getTableSelection=function(optCellRng,rng,isRoot){return optCellRng.filter((function(cellRng){return isExpandedCellRng(cellRng)&&isWithinSameTable(isRoot,cellRng)})).orThunk((function(){return partialSelection(isRoot,rng)})).bind((function(cRng){return getTableSelectionFromCellRng(cRng,isRoot)}))},getCellIndex=function(cells,cell){return findIndex(cells,(function(x){return eq$2(x,cell)}))},getSelectedCells=function(tableSelection){return lift2(getCellIndex(tableSelection.cells,tableSelection.rng.start),getCellIndex(tableSelection.cells,tableSelection.rng.end),(function(startIndex,endIndex){return tableSelection.cells.slice(startIndex,endIndex+1)}))},isSingleCellTableContentSelected=function(optCellRng,rng,isRoot){return optCellRng.filter((function(cellRng){return isSingleCellTable(cellRng,isRoot)&&hasAllContentsSelected(cellRng.start,rng)})).map((function(cellRng){return cellRng.start}))},getAction=function(tableSelection){return getSelectedCells(tableSelection).map((function(selected){var cells=tableSelection.cells;return selected.length===cells.length?deleteAction.removeTable(tableSelection.table):deleteAction.emptyCells(selected)}))},getActionFromRange=function(root,rng){var isRoot=isRootFromElement(root),optCellRng=getCellRng(rng,isRoot);return isSingleCellTableContentSelected(optCellRng,rng,isRoot).map((function(cell){return deleteAction.deleteCellSelection(rng,cell)})).orThunk((function(){return getTableSelection(optCellRng,rng,isRoot).bind(getAction)}))},freefallRtl=function(root){var child;return(isComment(root)?prevSibling(root):lastChild(root)).bind(freefallRtl).orThunk((function(){return Optional.some(root)}))},emptyCells=function(editor,cells){return each(cells,fillWithPaddingBr),editor.selection.setCursorLocation(cells[0].dom,0),!0},deleteCellContents=function(editor,rng,cell){rng.deleteContents();var lastNode=freefallRtl(cell).getOr(cell),lastBlock=SugarElement.fromDom(editor.dom.getParent(lastNode.dom,editor.dom.isBlock));if(isEmpty(lastBlock)&&(fillWithPaddingBr(lastBlock),editor.selection.setCursorLocation(lastBlock.dom,0)),!eq$2(cell,lastBlock)){var additionalCleanupNodes=parent(lastBlock).is(cell)?[]:siblings(lastBlock);each(additionalCleanupNodes.concat(children(cell)),(function(node){eq$2(node,lastBlock)||contains$2(node,lastBlock)||remove(node)}))}return!0},deleteTableElement=function(editor,table){return deleteElement(editor,!1,table),!0},deleteCellRange=function(editor,rootElm,rng){return getActionFromRange(rootElm,rng).map((function(action){return action.fold(curry(deleteTableElement,editor),curry(emptyCells,editor),curry(deleteCellContents,editor))}))},deleteCaptionRange=function(editor,caption){return emptyElement(editor,caption)},deleteTableRange=function(editor,rootElm,rng,startElm){return getParentCaption(rootElm,startElm).fold((function(){return deleteCellRange(editor,rootElm,rng)}),(function(caption){return deleteCaptionRange(editor,caption)})).getOr(!1)},deleteRange=function(editor,startElm){var rootNode=SugarElement.fromDom(editor.getBody()),rng=editor.selection.getRng(),selectedCells=getCellsFromEditor(editor);return getParentTable(rootNode,startElm).bind((function(tableEle){var tdCount;descendants$1(tableEle,"td").length===selectedCells.length&&deleteElement(editor,!1,tableEle)})),0!==selectedCells.length?emptyCells(editor,selectedCells):deleteTableRange(editor,rootNode,rng,startElm)},getParentCell=function(rootElm,elm){return find(parentsAndSelf(elm,rootElm),isTableCell$1)},getParentCaption=function(rootElm,elm){return find(parentsAndSelf(elm,rootElm),(function(elm){return"caption"===name(elm)}))},deleteBetweenCells=function(editor,rootElm,forward,fromCell,from){return navigate(forward,editor.getBody(),from).bind((function(to){return getParentCell(rootElm,SugarElement.fromDom(to.getNode())).map((function(toCell){return!1===eq$2(toCell,fromCell)}))}))},emptyElement=function(editor,elm){return fillWithPaddingBr(elm),editor.selection.setCursorLocation(elm.dom,0),Optional.some(!0)},isDeleteOfLastCharPos=function(fromCaption,forward,from,to){return firstPositionIn(fromCaption.dom).bind((function(first){return lastPositionIn(fromCaption.dom).map((function(last){return forward?from.isEqual(first)&&to.isEqual(last):from.isEqual(last)&&to.isEqual(first)}))})).getOr(!0)},emptyCaretCaption=function(editor,elm){return emptyElement(editor,elm)},validateCaretCaption=function(rootElm,fromCaption,to){return getParentCaption(rootElm,SugarElement.fromDom(to.getNode())).map((function(toCaption){return!1===eq$2(toCaption,fromCaption)}))},deleteCaretInsideCaption=function(editor,rootElm,forward,fromCaption,from){return navigate(forward,editor.getBody(),from).bind((function(to){return isDeleteOfLastCharPos(fromCaption,forward,from,to)?emptyCaretCaption(editor,fromCaption):validateCaretCaption(rootElm,fromCaption,to)})).or(Optional.some(!0))},deleteCaretCells=function(editor,forward,rootElm,startElm){var from=CaretPosition.fromRangeStart(editor.selection.getRng());return getParentCell(rootElm,startElm).bind((function(fromCell){return isEmpty(fromCell)?emptyElement(editor,fromCell):deleteBetweenCells(editor,rootElm,forward,fromCell,from)})).getOr(!1)},deleteCaretCaption=function(editor,forward,rootElm,fromCaption){var from=CaretPosition.fromRangeStart(editor.selection.getRng());return isEmpty(fromCaption)?emptyElement(editor,fromCaption):deleteCaretInsideCaption(editor,rootElm,forward,fromCaption,from)},isNearTable=function(forward,pos){return forward?isBeforeTable(pos):isAfterTable(pos)},isBeforeOrAfterTable=function(editor,forward){var fromPos=CaretPosition.fromRangeStart(editor.selection.getRng());return isNearTable(forward,fromPos)||fromPosition(forward,editor.getBody(),fromPos).exists((function(pos){return isNearTable(forward,pos)}))},afterTableSpaceBack=function(editor,forward){var fromPos=CaretPosition.fromRangeStart(editor.selection.getRng());fromPosition(forward,editor.getBody(),fromPos).filter((function(pos){return isNearTable(forward,pos)})).bind((function(pos){return Optional.from(getChildNodeAtRelativeOffset(forward?0:-1,pos))})).exists((function(elm){return editor.selection.select(elm),!0})),Optional.from(fromPos).filter((function(pos){return isNearTable(forward,pos)})).bind((function(pos){return Optional.from(getChildNodeAtRelativeOffset(forward?0:-1,pos))})).exists((function(elm){return editor.selection.select(elm),!0}))},deleteCaret=function(editor,forward,startElm){var rootElm=SugarElement.fromDom(editor.getBody()),isBeforeOrAfterTableRes=isBeforeOrAfterTable(editor,forward);return isBeforeOrAfterTableRes&&!forward&&afterTableSpaceBack(editor,forward),getParentCaption(rootElm,startElm).fold((function(){return deleteCaretCells(editor,forward,rootElm,startElm)||isBeforeOrAfterTableRes}),(function(fromCaption){return deleteCaretCaption(editor,forward,rootElm,fromCaption).getOr(!1)}))},backspaceDelete=function(editor,forward){var startElm=SugarElement.fromDom(editor.selection.getStart(!0)),cells=getCellsFromEditor(editor);return editor.selection.isCollapsed()&&0===cells.length?deleteCaret(editor,forward,startElm):deleteRange(editor,startElm)},createRange$1=function(sc,so,ec,eo){var rng=document.createRange();return rng.setStart(sc,so),rng.setEnd(ec,eo),rng},normalizeBlockSelectionRange=function(rng){var startPos=CaretPosition.fromRangeStart(rng),endPos=CaretPosition.fromRangeEnd(rng),rootNode=rng.commonAncestorContainer;return fromPosition(!1,rootNode,endPos).map((function(newEndPos){return!isInSameBlock(startPos,endPos,rootNode)&&isInSameBlock(startPos,newEndPos,rootNode)?createRange$1(startPos.container(),startPos.offset(),newEndPos.container(),newEndPos.offset()):rng})).getOr(rng)},normalize$2=function(rng){return rng.collapsed?rng:normalizeBlockSelectionRange(rng)},hasOnlyOneChild=function(node){return node.firstChild&&node.firstChild===node.lastChild},isPaddingNode=function(node){return"br"===node.name||" "===node.value},isPaddedEmptyBlock=function(schema,node){var blockElements;return schema.getBlockElements()[node.name]&&hasOnlyOneChild(node)&&isPaddingNode(node.firstChild)},isEmptyFragmentElement=function(schema,node){var nonEmptyElements=schema.getNonEmptyElements();return node&&(node.isEmpty(nonEmptyElements)||isPaddedEmptyBlock(schema,node))},isListFragment=function(schema,fragment){var firstChild=fragment.firstChild,lastChild=fragment.lastChild;return firstChild&&"meta"===firstChild.name&&(firstChild=firstChild.next),lastChild&&"mce_marker"===lastChild.attr("id")&&(lastChild=lastChild.prev),isEmptyFragmentElement(schema,lastChild)&&(lastChild=lastChild.prev),!(!firstChild||firstChild!==lastChild)&&("ul"===firstChild.name||"ol"===firstChild.name)},cleanupDomFragment=function(domFragment){var firstChild=domFragment.firstChild,lastChild=domFragment.lastChild;return firstChild&&"META"===firstChild.nodeName&&firstChild.parentNode.removeChild(firstChild),lastChild&&"mce_marker"===lastChild.id&&lastChild.parentNode.removeChild(lastChild),domFragment},toDomFragment=function(dom,serializer,fragment){var html=serializer.serialize(fragment),domFragment=dom.createFragment(html);return cleanupDomFragment(domFragment)},listItems$1=function(elm){return Tools.grep(elm.childNodes,(function(child){return"LI"===child.nodeName}))},isPadding=function(node){return" "===node.data||isBr(node)},isListItemPadded=function(node){return node&&node.firstChild&&node.firstChild===node.lastChild&&isPadding(node.firstChild)},isEmptyOrPadded=function(elm){return!elm.firstChild||isListItemPadded(elm)},trimListItems=function(elms){return elms.length>0&&isEmptyOrPadded(elms[elms.length-1])?elms.slice(0,-1):elms},getParentLi=function(dom,node){var parentBlock=dom.getParent(node,dom.isBlock);return parentBlock&&"LI"===parentBlock.nodeName?parentBlock:null},isParentBlockLi=function(dom,node){return!!getParentLi(dom,node)},getSplit=function(parentNode,rng){var beforeRng=rng.cloneRange(),afterRng=rng.cloneRange();return beforeRng.setStartBefore(parentNode),afterRng.setEndAfter(parentNode),[beforeRng.cloneContents(),afterRng.cloneContents()]},findFirstIn=function(node,rootNode){var caretPos=CaretPosition.before(node),caretWalker,newCaretPos=CaretWalker(rootNode).next(caretPos);return newCaretPos?newCaretPos.toRange():null},findLastOf=function(node,rootNode){var caretPos=CaretPosition.after(node),caretWalker,newCaretPos=CaretWalker(rootNode).prev(caretPos);return newCaretPos?newCaretPos.toRange():null},insertMiddle=function(target,elms,rootNode,rng){var parts=getSplit(target,rng),parentElm=target.parentNode;return parentElm.insertBefore(parts[0],target),Tools.each(elms,(function(li){parentElm.insertBefore(li,target)})),parentElm.insertBefore(parts[1],target),parentElm.removeChild(target),findLastOf(elms[elms.length-1],rootNode)},insertBefore=function(target,elms,rootNode){var parentElm=target.parentNode;return Tools.each(elms,(function(elm){parentElm.insertBefore(elm,target)})),findFirstIn(target,rootNode)},insertAfter=function(target,elms,rootNode,dom){return dom.insertAfter(elms.reverse(),target),findLastOf(elms[0],rootNode)},insertAtCaret=function(serializer,dom,rng,fragment){var domFragment=toDomFragment(dom,serializer,fragment),liTarget=getParentLi(dom,rng.startContainer),liElms=trimListItems(listItems$1(domFragment.firstChild)),BEGINNING=1,END=2,rootNode=dom.getRoot(),isAt=function(location){var caretPos=CaretPosition.fromRangeStart(rng),caretWalker=CaretWalker(dom.getRoot()),newPos=1===location?caretWalker.prev(caretPos):caretWalker.next(caretPos);return!newPos||getParentLi(dom,newPos.getNode())!==liTarget};return isAt(1)?insertBefore(liTarget,liElms,rootNode):isAt(2)?insertAfter(liTarget,liElms,rootNode,dom):insertMiddle(liTarget,liElms,rootNode,rng)},trimOrPadLeftRight=function(dom,rng,html){var root=SugarElement.fromDom(dom.getRoot());return html=needsToBeNbspLeft(root,CaretPosition.fromRangeStart(rng))?html.replace(/^ /,"&nbsp;"):html.replace(/^&nbsp;/," "),html=needsToBeNbspRight(root,CaretPosition.fromRangeEnd(rng))?html.replace(/(&nbsp;| )(<br( \/)>)?$/,"&nbsp;"):html.replace(/&nbsp;(<br( \/)?>)?$/," ")},isTableCell$4=isTableCell,isTableCellContentSelected=function(dom,rng,cell){var endCell;return null!==cell&&(cell===dom.getParent(rng.endContainer,isTableCell$4)&&hasAllContentsSelected(SugarElement.fromDom(cell),rng))},validInsertion=function(editor,value,parentNode){if("all"===parentNode.getAttribute("data-mce-bogus"))parentNode.parentNode.insertBefore(editor.dom.createFragment(value),parentNode);else{var node=parentNode.firstChild,node2=parentNode.lastChild;!node||node===node2&&"BR"===node.nodeName?editor.dom.setHTML(parentNode,value):editor.selection.setContent(value)}},trimBrsFromTableCell=function(dom,elm){Optional.from(dom.getParent(elm,"td,th")).map(SugarElement.fromDom).each(trimBlockTrailingBr)},reduceInlineTextElements=function(editor,merge){var textInlineElements=editor.schema.getTextInlineElements(),dom=editor.dom;if(merge){var root_1=editor.getBody(),elementUtils_1=ElementUtils(dom);Tools.each(dom.select("*[data-mce-fragment]"),(function(node){for(var testNode=node.parentNode;testNode&&testNode!==root_1;testNode=testNode.parentNode)textInlineElements[node.nodeName.toLowerCase()]&&elementUtils_1.compare(testNode,node)&&dom.remove(node,!0)}))}},markFragmentElements=function(fragment){for(var node=fragment;node=node.walk();)1===node.type&&node.attr("data-mce-fragment","1")},unmarkFragmentElements=function(elm){Tools.each(elm.getElementsByTagName("*"),(function(elm){elm.removeAttribute("data-mce-fragment")}))},isPartOfFragment=function(node){return!!node.getAttribute("data-mce-fragment")},canHaveChildren=function(editor,node){return node&&!editor.schema.getShortEndedElements()[node.nodeName]},moveSelectionToMarker=function(editor,marker){var nextRng,dom=editor.dom,selection=editor.selection,node2,getContentEditableFalseParent=function(node){for(var root=editor.getBody();node&&node!==root;node=node.parentNode)if("false"===dom.getContentEditable(node))return node;return null};if(marker){selection.scrollIntoView(marker);var parentEditableFalseElm=getContentEditableFalseParent(marker);if(parentEditableFalseElm)return dom.remove(marker),void selection.select(parentEditableFalseElm);var rng=dom.createRng(),node=marker.previousSibling;node&&3===node.nodeType?(rng.setStart(node,node.nodeValue.length),Env.ie||(node2=marker.nextSibling)&&3===node2.nodeType&&(node.appendData(node2.data),node2.parentNode.removeChild(node2))):(rng.setStartBefore(marker),rng.setEndBefore(marker));var findNextCaretRng=function(rng){var caretPos=CaretPosition.fromRangeStart(rng),caretWalker;if(caretPos=CaretWalker(editor.getBody()).next(caretPos))return caretPos.toRange()},parentBlock=dom.getParent(marker,dom.isBlock);dom.remove(marker),parentBlock&&dom.isEmpty(parentBlock)&&(editor.$(parentBlock).empty(),rng.setStart(parentBlock,0),rng.setEnd(parentBlock,0),isTableCell$4(parentBlock)||isPartOfFragment(parentBlock)||!(nextRng=findNextCaretRng(rng))?dom.add(parentBlock,dom.create("br",{"data-mce-bogus":"1"})):(rng=nextRng,dom.remove(parentBlock))),selection.setRng(rng)}},deleteSelectedContent=function(editor){var dom=editor.dom,rng=normalize$2(editor.selection.getRng());editor.selection.setRng(rng);var startCell=dom.getParent(rng.startContainer,isTableCell$4);isTableCellContentSelected(dom,rng,startCell)?deleteCellContents(editor,rng,SugarElement.fromDom(startCell)):editor.getDoc().execCommand("Delete",!1,null)},insertHtmlAtCaret=function(editor,value,details){var parentNode,rootNode,args,marker,rng,node,selection=editor.selection,dom=editor.dom;/^ | $/.test(value)&&(value=trimOrPadLeftRight(dom,selection.getRng(),value));var parser=editor.parser,merge=details.merge,serializer=HtmlSerializer({validate:shouldValidate(editor)},editor.schema),bookmarkHtml='<span id="mce_marker" data-mce-type="bookmark">&#xFEFF;</span>';if(args={content:value,format:"html",selection:!0,paste:details.paste},(args=editor.fire("BeforeSetContent",args)).isDefaultPrevented())editor.fire("SetContent",{content:args.content,format:"html",selection:!0,paste:details.paste});else{-1===(value=args.content).indexOf("{$caret}")&&(value+="{$caret}"),value=value.replace(/\{\$caret\}/,bookmarkHtml);var caretElement=(rng=selection.getRng()).startContainer||(rng.parentElement?rng.parentElement():null),body=editor.getBody();caretElement===body&&selection.isCollapsed()&&dom.isBlock(body.firstChild)&&canHaveChildren(editor,body.firstChild)&&dom.isEmpty(body.firstChild)&&((rng=dom.createRng()).setStart(body.firstChild,0),rng.setEnd(body.firstChild,0),selection.setRng(rng)),selection.isCollapsed()||deleteSelectedContent(editor);var parserArgs={context:(parentNode=selection.getNode()).nodeName.toLowerCase(),data:details.data,insert:!0},fragment=parser.parse(value,parserArgs);if(!0===details.paste&&isListFragment(editor.schema,fragment)&&isParentBlockLi(dom,parentNode))return rng=insertAtCaret(serializer,dom,selection.getRng(),fragment),selection.setRng(rng),void editor.fire("SetContent",args);if(markFragmentElements(fragment),"mce_marker"===(node=fragment.lastChild).attr("id"))for(marker=node,node=node.prev;node;node=node.walk(!0))if(3===node.type||!dom.isBlock(node.name)){editor.schema.isValidChild(node.parent.name,"span")&&node.parent.insert(marker,node,"br"===node.name);break}if(editor._selectionOverrides.showBlockCaretContainer(parentNode),parserArgs.invalid){for(editor.selection.setContent(bookmarkHtml),parentNode=selection.getNode(),rootNode=editor.getBody(),9===parentNode.nodeType?parentNode=node=rootNode:node=parentNode;node!==rootNode;)parentNode=node,node=node.parentNode;value=parentNode===rootNode?rootNode.innerHTML:dom.getOuterHTML(parentNode),value=serializer.serialize(parser.parse(value.replace(/<span (id="mce_marker"|id=mce_marker).+?<\/span>/i,(function(){return serializer.serialize(fragment)})))),parentNode===rootNode?dom.setHTML(rootNode,value):dom.setOuterHTML(parentNode,value)}else value=serializer.serialize(fragment),validInsertion(editor,value,parentNode);reduceInlineTextElements(editor,merge),moveSelectionToMarker(editor,dom.get("mce_marker")),unmarkFragmentElements(editor.getBody()),trimBrsFromTableCell(dom,selection.getStart()),editor.fire("SetContent",args),editor.addVisual()}},traverse=function(node,fn){fn(node),node.firstChild&&traverse(node.firstChild,fn),node.next&&traverse(node.next,fn)},findMatchingNodes=function(nodeFilters,attributeFilters,node){var nodeMatches={},attrMatches={},matches=[];for(var name_1 in node.firstChild&&traverse(node.firstChild,(function(node){each(nodeFilters,(function(filter){filter.name===node.name&&(nodeMatches[filter.name]?nodeMatches[filter.name].nodes.push(node):nodeMatches[filter.name]={filter:filter,nodes:[node]})})),each(attributeFilters,(function(filter){"string"==typeof node.attr(filter.name)&&(attrMatches[filter.name]?attrMatches[filter.name].nodes.push(node):attrMatches[filter.name]={filter:filter,nodes:[node]})}))})),nodeMatches)nodeMatches.hasOwnProperty(name_1)&&matches.push(nodeMatches[name_1]);for(var name_2 in attrMatches)attrMatches.hasOwnProperty(name_2)&&matches.push(attrMatches[name_2]);return matches},filter$3=function(nodeFilters,attributeFilters,node){var matches=findMatchingNodes(nodeFilters,attributeFilters,node);each(matches,(function(match){each(match.filter.callbacks,(function(callback){callback(match.nodes,match.filter.name,{})}))}))},defaultFormat="html",isTreeNode=function(content){return content instanceof AstNode},moveSelection=function(editor){hasFocus$1(editor)&&firstPositionIn(editor.getBody()).each((function(pos){var node=pos.getNode(),caretPos=isTable(node)?firstPositionIn(node).getOr(pos):pos;editor.selection.setRng(caretPos.toRange())}))},setEditorHtml=function(editor,html){editor.dom.setHTML(editor.getBody(),html),moveSelection(editor)},setContentString=function(editor,body,content,args){var forcedRootBlockName,padd;return 0===content.length||/^\s+$/.test(content)?(padd='<br data-mce-bogus="1">',"TABLE"===body.nodeName?content="<tr><td>"+padd+"</td></tr>":/^(UL|OL)$/.test(body.nodeName)&&(content="<li>"+padd+"</li>"),(forcedRootBlockName=getForcedRootBlock(editor))&&editor.schema.isValidChild(body.nodeName.toLowerCase(),forcedRootBlockName.toLowerCase())?(content=padd,content=editor.dom.createHTML(forcedRootBlockName,getForcedRootBlockAttrs(editor),content)):content||(content='<br data-mce-bogus="1">'),setEditorHtml(editor,content),editor.fire("SetContent",args)):("raw"!==args.format&&(content=HtmlSerializer({validate:editor.validate},editor.schema).serialize(editor.parser.parse(content,{isRootContent:!0,insert:!0}))),args.content=isWsPreserveElement(SugarElement.fromDom(body))?content:Tools.trim(content),setEditorHtml(editor,args.content),args.no_events||editor.fire("SetContent",args)),args.content},setContentTree=function(editor,body,content,args){filter$3(editor.parser.getNodeFilters(),editor.parser.getAttributeFilters(),content);var html=HtmlSerializer({validate:editor.validate},editor.schema).serialize(content);return args.content=isWsPreserveElement(SugarElement.fromDom(body))?html:Tools.trim(html),setEditorHtml(editor,args.content),args.no_events||editor.fire("SetContent",args),content},setContentInternal=function(editor,content,args){return args.format=args.format?args.format:"html",editor.settings.nonFormat&&(args.format="raw"),args.set=!0,content=content.replace("100vh","100%"),content=formatContent(editor,content),args.content=isTreeNode(content)?"":content,args.no_events||editor.fire("BeforeSetContent",args),isTreeNode(content)||(content=args.content),Optional.from(editor.getBody()).fold(constant(content),(function(body){return isTreeNode(content)?setContentTree(editor,body,content,args):setContentString(editor,body,content,args)}))},sibling$2=function(scope,predicate){return sibling(scope,predicate).isSome()},ensureIsRoot=function(isRoot){return isFunction(isRoot)?isRoot:never},ancestor$3=function(scope,transform,isRoot){for(var element=scope.dom,stop=ensureIsRoot(isRoot);element.parentNode;){element=element.parentNode;var el=SugarElement.fromDom(element),transformed=transform(el);if(transformed.isSome())return transformed;if(stop(el))break}return Optional.none()},closest$2=function(scope,transform,isRoot){var current=transform(scope),stop=ensureIsRoot(isRoot);return current.orThunk((function(){return stop(scope)?Optional.none():ancestor$3(scope,transform,stop)}))},isEq$2=isEq,matchesUnInheritedFormatSelector=function(ed,node,name){var formatList=ed.formatter.get(name);if(formatList)for(var i=0;i<formatList.length;i++)if(!1===formatList[i].inherit&&ed.dom.is(node,formatList[i].selector))return!0;return!1},matchParents=function(editor,node,name,vars){var root=editor.dom.getRoot();return node!==root&&(node=editor.dom.getParent(node,(function(node){return!!matchesUnInheritedFormatSelector(editor,node,name)||(node.parentNode===root||!!matchNode(editor,node,name,vars,!0))})),matchNode(editor,node,name,vars))},matchName=function(dom,node,format){return!!isEq$2(node,format.inline)||(!!isEq$2(node,format.block)||(format.selector?1===node.nodeType&&dom.is(node,format.selector):void 0))},matchItems=function(dom,node,format,itemName,similar,vars){var key,value,items=format[itemName],i;if(format.onmatch)return format.onmatch(node,format,itemName);if(items)if(void 0===items.length){for(key in items)if(items.hasOwnProperty(key)){if(value="attributes"===itemName?dom.getAttrib(node,key):getStyle(dom,node,key),similar&&!value&&!format.exact)return;if((!similar||format.exact)&&!isEq$2(value,normalizeStyleValue(dom,replaceVars(items[key],vars),key)))return}}else for(i=0;i<items.length;i++)if("attributes"===itemName?dom.getAttrib(node,items[i]):getStyle(dom,node,items[i]))return format;return format},matchNode=function(ed,node,name,vars,similar){var formatList=ed.formatter.get(name),format,i,x,classes,dom=ed.dom;if(formatList&&node)for(i=0;i<formatList.length;i++)if(format=formatList[i],matchName(ed.dom,node,format)&&matchItems(dom,node,format,"attributes",similar,vars)&&matchItems(dom,node,format,"styles",similar,vars)){if(classes=format.classes)for(x=0;x<classes.length;x++)if(!ed.dom.hasClass(node,classes[x]))return;return format}},match=function(editor,name,vars,node){if(node)return matchParents(editor,node,name,vars);if(node=editor.selection.getNode(),matchParents(editor,node,name,vars))return!0;var startNode=editor.selection.getStart();return!(startNode===node||!matchParents(editor,startNode,name,vars))},matchAll=function(editor,names,vars){var matchedFormatNames=[],checkedMap={},startElement=editor.selection.getStart();return editor.dom.getParent(startElement,(function(node){for(var i=0;i<names.length;i++){var name_1=names[i];!checkedMap[name_1]&&matchNode(editor,node,name_1,vars)&&(checkedMap[name_1]=!0,matchedFormatNames.push(name_1))}}),editor.dom.getRoot()),matchedFormatNames},closest$3=function(editor,names){var isRoot=function(elm){return eq$2(elm,SugarElement.fromDom(editor.getBody()))},match=function(elm,name){return matchNode(editor,elm.dom,name)?Optional.some(name):Optional.none()};return Optional.from(editor.selection.getStart(!0)).bind((function(rawElm){return closest$2(SugarElement.fromDom(rawElm),(function(elm){return findMap(names,(function(name){return match(elm,name)}))}),isRoot)})).getOrNull()},canApply=function(editor,name){var formatList=editor.formatter.get(name),startNode,parents,i,x,selector,dom=editor.dom;if(formatList)for(startNode=editor.selection.getStart(),parents=getParents$1(dom,startNode),x=formatList.length-1;x>=0;x--){if(!(selector=formatList[x].selector)||formatList[x].defaultBlock)return!0;for(i=parents.length-1;i>=0;i--)if(dom.is(parents[i],selector))return!0}return!1},matchAllOnNode=function(editor,node,formatNames){return foldl(formatNames,(function(acc,name){var matchSimilar=isVariableFormatName(editor,name);return editor.formatter.matchNode(node,name,{},matchSimilar)?acc.concat([name]):acc}),[])},ZWSP$1=ZWSP,CARET_ID$1="_mce_caret",importNode=function(ownerDocument,node){return ownerDocument.importNode(node,!0)},getEmptyCaretContainers=function(node){for(var nodes=[];node;){if(3===node.nodeType&&node.nodeValue!==ZWSP$1||node.childNodes.length>1)return[];1===node.nodeType&&nodes.push(node),node=node.firstChild}return nodes},isCaretContainerEmpty=function(node){return getEmptyCaretContainers(node).length>0},findFirstTextNode=function(node){if(node){var walker=new DomTreeWalker(node,node);for(node=walker.current();node;node=walker.next())if(isText$1(node))return node}return null},createCaretContainer=function(fill){var caretContainer=SugarElement.fromTag("span");return setAll(caretContainer,{id:CARET_ID$1,"data-mce-bogus":"1","data-mce-type":"format-caret"}),fill&&append(caretContainer,SugarElement.fromText(ZWSP$1)),caretContainer},trimZwspFromCaretContainer=function(caretContainerNode){var textNode=findFirstTextNode(caretContainerNode);return textNode&&textNode.nodeValue.charAt(0)===ZWSP$1&&textNode.deleteData(0,1),textNode},removeCaretContainerNode=function(editor,node,moveCaret){void 0===moveCaret&&(moveCaret=!0);var dom=editor.dom,selection=editor.selection;if(isCaretContainerEmpty(node))deleteElement(editor,!1,SugarElement.fromDom(node),moveCaret);else{var rng=selection.getRng(),block=dom.getParent(node,dom.isBlock),startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset,textNode=trimZwspFromCaretContainer(node);dom.remove(node,!0),startContainer===textNode&&startOffset>0&&rng.setStart(textNode,startOffset-1),endContainer===textNode&&endOffset>0&&rng.setEnd(textNode,endOffset-1),block&&dom.isEmpty(block)&&fillWithPaddingBr(SugarElement.fromDom(block)),selection.setRng(rng)}},removeCaretContainer=function(editor,node,moveCaret){void 0===moveCaret&&(moveCaret=!0);var dom=editor.dom,selection=editor.selection;if(node)removeCaretContainerNode(editor,node,moveCaret);else if(!(node=getParentCaretContainer(editor.getBody(),selection.getStart())))for(;node=dom.get(CARET_ID$1);)removeCaretContainerNode(editor,node,!1)},insertCaretContainerNode=function(editor,caretContainer,formatNode){var dom=editor.dom,block=dom.getParent(formatNode,curry(isTextBlock$1,editor));block&&dom.isEmpty(block)?formatNode.parentNode.replaceChild(caretContainer,formatNode):(removeTrailingBr(SugarElement.fromDom(formatNode)),dom.isEmpty(formatNode)?formatNode.parentNode.replaceChild(caretContainer,formatNode):dom.insertAfter(caretContainer,formatNode))},appendNode=function(parentNode,node){return parentNode.appendChild(node),node},insertFormatNodesIntoCaretContainer=function(formatNodes,caretContainer){var innerMostFormatNode=foldr(formatNodes,(function(parentNode,formatNode){return appendNode(parentNode,formatNode.cloneNode(!1))}),caretContainer);return appendNode(innerMostFormatNode,innerMostFormatNode.ownerDocument.createTextNode(ZWSP$1))},cleanFormatNode=function(editor,caretContainer,formatNode,name,vars,similar){var formatter=editor.formatter,dom=editor.dom,validFormats=filter(keys(formatter.get()),(function(formatName){return formatName!==name&&!contains$1(formatName,"removeformat")})),matchedFormats=matchAllOnNode(editor,formatNode,validFormats),uniqueFormats;if(filter(matchedFormats,(function(fmtName){return!areSimilarFormats(editor,fmtName,name)})).length>0){var clonedFormatNode=formatNode.cloneNode(!1);return dom.add(caretContainer,clonedFormatNode),formatter.remove(name,vars,clonedFormatNode,similar),dom.remove(clonedFormatNode),Optional.some(clonedFormatNode)}return Optional.none()},applyCaretFormat=function(editor,name,vars){var caretContainer,textNode,selection=editor.selection,selectionRng=selection.getRng(),offset=selectionRng.startOffset,container,text=selectionRng.startContainer.nodeValue;(caretContainer=getParentCaretContainer(editor.getBody(),selection.getStart()))&&(textNode=findFirstTextNode(caretContainer));var wordcharRegex=/[^\s\u00a0\u00ad\u200b\ufeff]/;if(text&&offset>0&&offset<text.length&&wordcharRegex.test(text.charAt(offset))&&wordcharRegex.test(text.charAt(offset-1))){var bookmark=selection.getBookmark();selectionRng.collapse(!0);var rng=expandRng(editor,selectionRng,editor.formatter.get(name));rng=split$1(rng),editor.formatter.apply(name,vars,rng),selection.moveToBookmark(bookmark)}else caretContainer&&textNode.nodeValue===ZWSP$1?editor.formatter.apply(name,vars,caretContainer):(textNode=(caretContainer=importNode(editor.getDoc(),createCaretContainer(!0).dom)).firstChild,selectionRng.insertNode(caretContainer),offset=1,editor.formatter.apply(name,vars,caretContainer)),selection.setCursorLocation(textNode,offset)},removeCaretFormat=function(editor,name,vars,similar){var dom=editor.dom,selection=editor.selection,hasContentAfter,node,formatNode,parents=[],rng=selection.getRng(),container=rng.startContainer,offset=rng.startOffset;for(node=container,3===container.nodeType&&(offset!==container.nodeValue.length&&(hasContentAfter=!0),node=node.parentNode);node;){if(matchNode(editor,node,name,vars,similar)){formatNode=node;break}node.nextSibling&&(hasContentAfter=!0),parents.push(node),node=node.parentNode}if(formatNode)if(hasContentAfter){var bookmark=selection.getBookmark();rng.collapse(!0);var expandedRng=expandRng(editor,rng,editor.formatter.get(name),!0);expandedRng=split$1(expandedRng),editor.formatter.remove(name,vars,expandedRng,similar),selection.moveToBookmark(bookmark)}else{var caretContainer=getParentCaretContainer(editor.getBody(),formatNode),newCaretContainer=createCaretContainer(!1).dom;insertCaretContainerNode(editor,newCaretContainer,null!==caretContainer?caretContainer:formatNode);var cleanedFormatNode=cleanFormatNode(editor,newCaretContainer,formatNode,name,vars,similar),caretTextNode=insertFormatNodesIntoCaretContainer(parents.concat(cleanedFormatNode.toArray()),newCaretContainer);removeCaretContainerNode(editor,caretContainer,!1),selection.setCursorLocation(caretTextNode,1),dom.isEmpty(formatNode)&&dom.remove(formatNode)}},disableCaretContainer=function(editor,keyCode){var selection=editor.selection,body=editor.getBody();removeCaretContainer(editor,null,!1),8!==keyCode&&46!==keyCode||!selection.isCollapsed()||selection.getStart().innerHTML!==ZWSP$1||removeCaretContainer(editor,getParentCaretContainer(body,selection.getStart())),37!==keyCode&&39!==keyCode||removeCaretContainer(editor,getParentCaretContainer(body,selection.getStart()))},setup$3=function(editor){editor.on("mouseup keydown",(function(e){disableCaretContainer(editor,e.keyCode)}))},replaceWithCaretFormat=function(targetNode,formatNodes){var caretContainer=createCaretContainer(!1),innerMost=insertFormatNodesIntoCaretContainer(formatNodes,caretContainer.dom);return before(SugarElement.fromDom(targetNode),caretContainer),remove(SugarElement.fromDom(targetNode)),CaretPosition(innerMost,0)},isFormatElement=function(editor,element){var inlineElements;return editor.schema.getTextInlineElements().hasOwnProperty(name(element))&&!isCaretNode(element.dom)&&!isBogus(element.dom)},isEmptyCaretFormatElement=function(element){return isCaretNode(element.dom)&&isCaretContainerEmpty(element.dom)},postProcessHooks={},filter$4=filter$2,each$8=each$2,addPostProcessHook,postProcess=function(name,editor){each$8(postProcessHooks[name],(function(hook){hook(editor)}))};(function(name,hook){var hooks;postProcessHooks[name]||(postProcessHooks[name]=[]),postProcessHooks[name].push(hook)})("pre",(function(editor){var rng=editor.selection.getRng(),blocks,hasPreSibling=function(pre){return isPre(pre.previousSibling)&&-1!==indexOf$1(blocks,pre.previousSibling)},joinPre=function(pre1,pre2){DomQuery(pre2).remove(),DomQuery(pre1).append("<br><br>").append(pre2.childNodes)},isPre=matchNodeNames(["pre"]);rng.collapsed||(blocks=editor.selection.getSelectedBlocks(),each$8(filter$4(filter$4(blocks,isPre),hasPreSibling),(function(pre){joinPre(pre.previousSibling,pre)})))}));var each$9=Tools.each,isElementNode=function(node){return isElement$1(node)&&!isBookmarkNode$1(node)&&!isCaretNode(node)&&!isBogus(node)},findElementSibling=function(node,siblingName){var sibling;for(sibling=node;sibling;sibling=sibling[siblingName]){if(isText$1(sibling)&&0!==sibling.nodeValue.length)return node;if(isElement$1(sibling)&&!isBookmarkNode$1(sibling))return sibling}return node},mergeSiblingsNodes=function(dom,prev,next){var sibling,tmpSibling,elementUtils=ElementUtils(dom);if(prev&&next&&(prev=findElementSibling(prev,"previousSibling"),next=findElementSibling(next,"nextSibling"),elementUtils.compare(prev,next))){for(sibling=prev.nextSibling;sibling&&sibling!==next;)tmpSibling=sibling,sibling=sibling.nextSibling,prev.appendChild(tmpSibling);return dom.remove(next),Tools.each(Tools.grep(next.childNodes),(function(node){prev.appendChild(node)})),prev}return next},mergeSiblings=function(dom,format,vars,node){if(node&&!1!==format.merge_siblings){var newNode=mergeSiblingsNodes(dom,getNonWhiteSpaceSibling(node),node);mergeSiblingsNodes(dom,newNode,getNonWhiteSpaceSibling(newNode,!0))}},clearChildStyles=function(dom,format,node){if(format.clear_child_styles){var selector=format.links?"*:not(a)":"*";each$9(dom.select(selector,node),(function(node){isElementNode(node)&&each$9(format.styles,(function(value,name){dom.setStyle(node,name,"")}))}))}},processChildElements=function(node,filter,process){each$9(node.childNodes,(function(node){isElementNode(node)&&(filter(node)&&process(node),node.hasChildNodes()&&processChildElements(node,filter,process))}))},unwrapEmptySpan=function(dom,node){"SPAN"===node.nodeName&&0===dom.getAttribs(node).length&&dom.remove(node,!0)},hasStyle=function(dom,name){return function(node){return!(!node||!getStyle(dom,node,name))}},applyStyle=function(dom,name,value){return function(node){dom.setStyle(node,name,value),""===node.getAttribute("style")&&node.removeAttribute("style"),unwrapEmptySpan(dom,node)}},removeResult=Adt_generate([{keep:[]},{rename:["name"]},{removed:[]}]),MCE_ATTR_RE=/^(src|href|style)$/,each$a=Tools.each,isEq$3=isEq,isTableCellOrRow=function(node){return/^(TR|TH|TD)$/.test(node.nodeName)},isChildOfInlineParent=function(dom,node,parent){return dom.isChildOf(node,parent)&&node!==parent&&!dom.isBlock(parent)},getContainer=function(ed,rng,start){var container,offset;if(container=rng[start?"startContainer":"endContainer"],offset=rng[start?"startOffset":"endOffset"],isElement$1(container)){var lastIdx=container.childNodes.length-1;!start&&offset&&offset--,container=container.childNodes[offset>lastIdx?lastIdx:offset]}return isText$1(container)&&start&&offset>=container.nodeValue.length&&(container=new DomTreeWalker(container,ed.getBody()).next()||container),isText$1(container)&&!start&&0===offset&&(container=new DomTreeWalker(container,ed.getBody()).prev()||container),container},normalizeTableSelection=function(node,start){var prop=start?"firstChild":"lastChild";if(isTableCellOrRow(node)&&node[prop]){var childNode=node[prop];return"TR"===node.nodeName&&childNode[prop]||childNode}return node},wrap$2=function(dom,node,name,attrs){var wrapper=dom.create(name,attrs);return node.parentNode.insertBefore(wrapper,node),wrapper.appendChild(node),wrapper},wrapWithSiblings=function(dom,node,next,name,attrs){var start=SugarElement.fromDom(node),wrapper=SugarElement.fromDom(dom.create(name,attrs)),siblings=next?nextSiblings(start):prevSiblings(start);return append$1(wrapper,siblings),next?(before(start,wrapper),prepend(wrapper,start)):(after(start,wrapper),append(wrapper,start)),wrapper.dom},matchName$1=function(dom,node,format){return!!isEq$3(node,format.inline)||(!!isEq$3(node,format.block)||(format.selector?isElement$1(node)&&dom.is(node,format.selector):void 0))},isColorFormatAndAnchor=function(node,format){return format.links&&"A"===node.nodeName},find$3=function(dom,node,next,inc){return!(node=getNonWhiteSpaceSibling(node,next,inc))||"BR"===node.nodeName||dom.isBlock(node)},removeNode$1=function(ed,node,format){var parentNode=node.parentNode,rootBlockElm,dom=ed.dom,forcedRootBlock=getForcedRootBlock(ed);format.block&&(forcedRootBlock?parentNode===dom.getRoot()&&(format.list_block&&isEq$3(node,format.list_block)||each(from$1(node.childNodes),(function(node){isValid(ed,forcedRootBlock,node.nodeName.toLowerCase())?rootBlockElm?rootBlockElm.appendChild(node):(rootBlockElm=wrap$2(dom,node,forcedRootBlock),dom.setAttribs(rootBlockElm,ed.settings.forced_root_block_attrs)):rootBlockElm=0}))):dom.isBlock(node)&&!dom.isBlock(parentNode)&&(find$3(dom,node,!1)||find$3(dom,node.firstChild,!0,!0)||node.insertBefore(dom.create("br"),node.firstChild),find$3(dom,node,!0)||find$3(dom,node.lastChild,!1,!0)||node.appendChild(dom.create("br")))),format.selector&&format.inline&&!isEq$3(format.inline,node)||dom.remove(node,!0)},removeFormatInternal=function(ed,format,vars,node,compareNode){var stylesModified,dom=ed.dom;if(!matchName$1(dom,node,format)&&!isColorFormatAndAnchor(node,format))return removeResult.keep();var elm=node;if(format.inline&&"all"===format.remove&&isArray(format.preserve_attributes)){var attrsToPreserve=filter(dom.getAttribs(elm),(function(attr){return contains(format.preserve_attributes,attr.name.toLowerCase())}));if(dom.removeAllAttribs(elm),each(attrsToPreserve,(function(attr){return dom.setAttrib(elm,attr.name,attr.value)})),attrsToPreserve.length>0)return removeResult.rename("span")}if("all"!==format.remove){each$a(format.styles,(function(value,name){value=normalizeStyleValue(dom,replaceVars(value,vars),name+""),isNumber(name)&&(name=value,compareNode=null),(format.remove_similar||!compareNode||isEq$3(getStyle(dom,compareNode,name),value))&&dom.setStyle(elm,name,""),stylesModified=!0})),stylesModified&&""===dom.getAttrib(elm,"style")&&(elm.removeAttribute("style"),elm.removeAttribute("data-mce-style")),each$a(format.attributes,(function(value,name){var valueOut;if(value=replaceVars(value,vars),isNumber(name)&&(name=value,compareNode=null),format.remove_similar||!compareNode||isEq$3(dom.getAttrib(compareNode,name),value)){if("class"===name&&(value=dom.getAttrib(elm,name))&&(valueOut="",each(value.split(/\s+/),(function(cls){/mce\-\w+/.test(cls)&&(valueOut+=(valueOut?" ":"")+cls)})),valueOut))return void dom.setAttrib(elm,name,valueOut);"class"===name&&elm.removeAttribute("className"),MCE_ATTR_RE.test(name)&&elm.removeAttribute("data-mce-"+name),elm.removeAttribute(name)}})),each$a(format.classes,(function(value){value=replaceVars(value,vars),compareNode&&!dom.hasClass(compareNode,value)||dom.removeClass(elm,value)}));for(var attrs=dom.getAttribs(elm),i=0;i<attrs.length;i++){var attrName=attrs[i].nodeName;if(0!==attrName.indexOf("_")&&0!==attrName.indexOf("data-"))return removeResult.keep()}}return"none"!==format.remove?(removeNode$1(ed,elm,format),removeResult.removed()):removeResult.keep()},removeFormat=function(ed,format,vars,node,compareNode){return removeFormatInternal(ed,format,vars,node,compareNode).fold(never,(function(newName){return ed.dom.rename(node,newName),!0}),always)},findFormatRoot=function(editor,container,name,vars,similar){var formatRoot;return each(getParents$1(editor.dom,container.parentNode).reverse(),(function(parent){if(!formatRoot&&"_start"!==parent.id&&"_end"!==parent.id){var format=matchNode(editor,parent,name,vars,similar);format&&!1!==format.split&&(formatRoot=parent)}})),formatRoot},removeFormatFromClone=function(editor,format,vars,clone){return removeFormatInternal(editor,format,vars,clone,clone).fold(constant(clone),(function(newName){var fragment;return editor.dom.createFragment().appendChild(clone),editor.dom.rename(clone,newName)}),constant(null))},wrapAndSplit=function(editor,formatList,formatRoot,container,target,split,format,vars){var clone,lastClone,firstClone,dom=editor.dom;if(formatRoot){for(var formatRootParent=formatRoot.parentNode,parent_1=container.parentNode;parent_1&&parent_1!==formatRootParent;parent_1=parent_1.parentNode){clone=dom.clone(parent_1,!1);for(var i=0;i<formatList.length&&null!==(clone=removeFormatFromClone(editor,formatList[i],vars,clone));i++);clone&&(lastClone&&clone.appendChild(lastClone),firstClone||(firstClone=clone),lastClone=clone)}!split||format.mixed&&dom.isBlock(formatRoot)||(container=dom.split(formatRoot,container)),lastClone&&(target.parentNode.insertBefore(lastClone,target),firstClone.appendChild(target),format.inline&&mergeSiblings(dom,format,vars,lastClone))}return container},remove$6=function(ed,name,vars,node,similar){var formatList=ed.formatter.get(name),format=formatList[0],contentEditable=!0,dom=ed.dom,selection=ed.selection,splitToFormatRoot=function(container){var formatRoot=findFormatRoot(ed,container,name,vars,similar);return wrapAndSplit(ed,formatList,formatRoot,container,container,!0,format,vars)},isRemoveBookmarkNode=function(node){return isBookmarkNode$1(node)&&isElement$1(node)&&("_start"===node.id||"_end"===node.id)},process=function(node){var lastContentEditable,hasContentEditableState;isElement$1(node)&&dom.getContentEditable(node)&&(lastContentEditable=contentEditable,contentEditable="true"===dom.getContentEditable(node),hasContentEditableState=!0);var children=from$1(node.childNodes);if(contentEditable&&!hasContentEditableState)for(var i=0;i<formatList.length&&!removeFormat(ed,formatList[i],vars,node,node);i++);if(format.deep&&children.length){for(var i=0;i<children.length;i++)process(children[i]);hasContentEditableState&&(contentEditable=lastContentEditable)}},unwrap=function(start){var node=dom.get(start?"_start":"_end"),out=node[start?"firstChild":"lastChild"];return isRemoveBookmarkNode(out)&&(out=out[start?"firstChild":"lastChild"]),isText$1(out)&&0===out.data.length&&(out=start?node.previousSibling||node.nextSibling:node.nextSibling||node.previousSibling),dom.remove(node,!0),out},removeRngStyle=function(rng){var startContainer,endContainer,expandedRng=expandRng(ed,rng,formatList,rng.collapsed);if(format.split){if(expandedRng=split$1(expandedRng),(startContainer=getContainer(ed,expandedRng,!0))!==(endContainer=getContainer(ed,expandedRng))){if(startContainer=normalizeTableSelection(startContainer,!0),endContainer=normalizeTableSelection(endContainer,!1),isChildOfInlineParent(dom,startContainer,endContainer)){var marker=Optional.from(startContainer.firstChild).getOr(startContainer);return splitToFormatRoot(wrapWithSiblings(dom,marker,!0,"span",{id:"_start","data-mce-type":"bookmark"})),void unwrap(!0)}if(isChildOfInlineParent(dom,endContainer,startContainer)){var marker=Optional.from(endContainer.lastChild).getOr(endContainer);return splitToFormatRoot(wrapWithSiblings(dom,marker,!1,"span",{id:"_end","data-mce-type":"bookmark"})),void unwrap(!1)}startContainer=wrap$2(dom,startContainer,"span",{id:"_start","data-mce-type":"bookmark"}),endContainer=wrap$2(dom,endContainer,"span",{id:"_end","data-mce-type":"bookmark"});var newRng=dom.createRng();newRng.setStartAfter(startContainer),newRng.setEndBefore(endContainer),walk$1(dom,newRng,(function(nodes){each(nodes,(function(n){isBookmarkNode$1(n)||isBookmarkNode$1(n.parentNode)||splitToFormatRoot(n)}))})),splitToFormatRoot(startContainer),splitToFormatRoot(endContainer),startContainer=unwrap(!0),endContainer=unwrap()}else startContainer=endContainer=splitToFormatRoot(startContainer);expandedRng.startContainer=startContainer.parentNode?startContainer.parentNode:startContainer,expandedRng.startOffset=dom.nodeIndex(startContainer),expandedRng.endContainer=endContainer.parentNode?endContainer.parentNode:endContainer,expandedRng.endOffset=dom.nodeIndex(endContainer)+1}walk$1(dom,expandedRng,(function(nodes){each(nodes,(function(node){var textDecorations;process(node),each(["underline","line-through","overline"],(function(decoration){isElement$1(node)&&ed.dom.getStyle(node,"text-decoration")===decoration&&node.parentNode&&getTextDecoration(dom,node.parentNode)===decoration&&removeFormat(ed,{deep:!1,exact:!0,inline:"span",styles:{textDecoration:decoration}},null,node)}))}))}))};if(node)if(isNode(node)){var rng=dom.createRng();rng.setStartBefore(node),rng.setEndAfter(node),removeRngStyle(rng)}else removeRngStyle(node);else if("false"!==dom.getContentEditable(selection.getNode()))selection.isCollapsed()&&format.inline&&!getCellsFromEditor(ed).length?removeCaretFormat(ed,name,vars,similar):(preserve(selection,!0,(function(){runOnRanges(ed,removeRngStyle)})),format.inline&&match(ed,name,vars,selection.getStart())&&moveStart(dom,selection,selection.getRng()),ed.nodeChanged());else{node=selection.getNode();for(var i=0;i<formatList.length&&(!formatList[i].ceFalseOverride||!removeFormat(ed,formatList[i],vars,node,node));i++);}},each$b=Tools.each,mergeTextDecorationsAndColor=function(dom,format,vars,node){var processTextDecorationsAndColor=function(n){if(1===n.nodeType&&n.parentNode&&1===n.parentNode.nodeType){var textDecoration=getTextDecoration(dom,n.parentNode);dom.getStyle(n,"color")&&textDecoration?dom.setStyle(n,"text-decoration",textDecoration):dom.getStyle(n,"text-decoration")===textDecoration&&dom.setStyle(n,"text-decoration",null)}};format.styles&&(format.styles.color||format.styles.textDecoration)&&(Tools.walk(node,processTextDecorationsAndColor,"childNodes"),processTextDecorationsAndColor(node))},mergeBackgroundColorAndFontSize=function(dom,format,vars,node){format.styles&&format.styles.backgroundColor&&processChildElements(node,hasStyle(dom,"fontSize"),applyStyle(dom,"backgroundColor",replaceVars(format.styles.backgroundColor,vars)))},mergeSubSup=function(dom,format,vars,node){"sub"!==format.inline&&"sup"!==format.inline||(processChildElements(node,hasStyle(dom,"fontSize"),applyStyle(dom,"fontSize","")),dom.remove(dom.select("sup"===format.inline?"sub":"sup",node),!0))},mergeWithChildren=function(editor,formatList,vars,node){each$b(formatList,(function(format){each$b(editor.dom.select(format.inline,node),(function(child){isElementNode(child)&&removeFormat(editor,format,vars,child,format.exact?child:null)})),clearChildStyles(editor.dom,format,node)}))},mergeWithParents=function(editor,format,name,vars,node){matchNode(editor,node.parentNode,name,vars)&&removeFormat(editor,format,vars,node)||format.merge_with_parents&&editor.dom.getParent(node.parentNode,(function(parent){if(matchNode(editor,parent,name,vars))return removeFormat(editor,format,vars,node),!0}))},each$c=Tools.each,hasFormatProperty=function(format,prop){return hasNonNullableKey(format,prop)},isElementNode$1=function(node){return node&&1===node.nodeType&&!isBookmarkNode$1(node)&&!isCaretNode(node)&&!isBogus(node)},canFormatBR=function(editor,format,node,parentName){if(canFormatEmptyLines(editor)&&isInlineFormat(format)){var validBRParentElements=__assign(__assign({},editor.schema.getTextBlockElements()),{td:{},th:{},li:{},dt:{},dd:{},figcaption:{},caption:{},details:{},summary:{}}),hasCaretNodeSibling=sibling$2(SugarElement.fromDom(node),(function(sibling){return isCaretNode(sibling.dom)}));return hasNonNullableKey(validBRParentElements,parentName)&&isEmpty(SugarElement.fromDom(node.parentNode),!1)&&!hasCaretNodeSibling}return!1},applyFormat=function(ed,name,vars,node){var formatList=ed.formatter.get(name),format=formatList[0],isCollapsed=!node&&ed.selection.isCollapsed(),dom=ed.dom,selection=ed.selection,setElementFormat=function(elm,fmt){if(fmt=fmt||format,elm){if(fmt.onformat&&fmt.onformat(elm,fmt,vars,node),each$c(fmt.styles,(function(value,name){dom.setStyle(elm,name,replaceVars(value,vars))})),fmt.styles){var styleVal=dom.getAttrib(elm,"style");styleVal&&dom.setAttrib(elm,"data-mce-style",styleVal)}each$c(fmt.attributes,(function(value,name){dom.setAttrib(elm,name,replaceVars(value,vars))})),each$c(fmt.classes,(function(value){value=replaceVars(value,vars),dom.hasClass(elm,value)||dom.addClass(elm,value)}))}},applyNodeStyle=function(formatList,node){var found=!1;return!!isSelectorFormat(format)&&(each$c(formatList,(function(format){if(!("collapsed"in format&&format.collapsed!==isCollapsed))return dom.is(node,format.selector)&&!isCaretNode(node)?(setElementFormat(node,format),found=!0,!1):void 0})),found)},applyRngStyle=function(dom,rng,bookmark,nodeSpecific){var newWrappers=[],contentEditable=!0,wrapName=format.inline||format.block,wrapElm=dom.create(wrapName);setElementFormat(wrapElm),walk$1(dom,rng,(function(nodes){var currentWrapElm,process=function(node){var hasContentEditableState=!1,lastContentEditable=contentEditable,nodeName=node.nodeName.toLowerCase(),parentName=node.parentNode.nodeName.toLowerCase();if(isElement$1(node)&&dom.getContentEditable(node)&&(lastContentEditable=contentEditable,contentEditable="true"===dom.getContentEditable(node),hasContentEditableState=!0),isBr(node)&&!canFormatBR(ed,format,node,parentName))return currentWrapElm=null,void(isBlockFormat(format)&&dom.remove(node));if(format.wrapper&&matchNode(ed,node,name,vars))currentWrapElm=null;else{if(contentEditable&&!hasContentEditableState&&isBlockFormat(format)&&!format.wrapper&&isTextBlock$1(ed,nodeName)&&isValid(ed,parentName,wrapName)){var elm=dom.rename(node,wrapName);return setElementFormat(elm),newWrappers.push(elm),void(currentWrapElm=null)}if(isSelectorFormat(format)){var found=applyNodeStyle(formatList,node);if(!hasFormatProperty(format,"inline")||found)return void(currentWrapElm=null)}!contentEditable||hasContentEditableState||!isValid(ed,wrapName,nodeName)||!isValid(ed,parentName,wrapName)||!nodeSpecific&&3===node.nodeType&&1===node.nodeValue.length&&65279===node.nodeValue.charCodeAt(0)||isCaretNode(node)||hasFormatProperty(format,"inline")&&dom.isBlock(node)?(currentWrapElm=null,each$c(Tools.grep(node.childNodes),process),hasContentEditableState&&(contentEditable=lastContentEditable),currentWrapElm=null):(currentWrapElm||(currentWrapElm=dom.clone(wrapElm,!1),node.parentNode.insertBefore(currentWrapElm,node),newWrappers.push(currentWrapElm)),currentWrapElm.appendChild(node))}};each$c(nodes,process)})),!0===format.links&&each$c(newWrappers,(function(node){var process=function(node){"A"===node.nodeName&&setElementFormat(node,format),each$c(Tools.grep(node.childNodes),process)};process(node)})),each$c(newWrappers,(function(node){var getChildCount,getChildElementNode=function(root){var child=!1;return each$c(root.childNodes,(function(node){if(isElementNode$1(node))return child=node,!1})),child},mergeStyles=function(node){var clone,child=getChildElementNode(node);return child&&!isBookmarkNode$1(child)&&matchName(dom,child,format)&&(clone=dom.clone(child,!1),setElementFormat(clone),dom.replace(clone,node,!0),dom.remove(child,!0)),clone||node},childCount=function(node){var count=0;return each$c(node.childNodes,(function(node){isEmptyTextNode(node)||isBookmarkNode$1(node)||count++})),count}(node);!(newWrappers.length>1)&&dom.isBlock(node)||0!==childCount?(isInlineFormat(format)||format.wrapper)&&(format.exact||1!==childCount||(node=mergeStyles(node)),mergeWithChildren(ed,formatList,vars,node),mergeWithParents(ed,format,name,vars,node),mergeBackgroundColorAndFontSize(dom,format,vars,node),mergeTextDecorationsAndColor(dom,format,vars,node),mergeSubSup(dom,format,vars,node),mergeSiblings(dom,format,vars,node)):dom.remove(node,!0)}))};if("false"!==dom.getContentEditable(selection.getNode())){if(format){if(node)if(isNode(node)){if(!applyNodeStyle(formatList,node)){var rng=dom.createRng();rng.setStartBefore(node),rng.setEndAfter(node),applyRngStyle(dom,expandRng(ed,rng,formatList),null,!0)}}else applyRngStyle(dom,node,null,!0);else if(isCollapsed&&isInlineFormat(format)&&!getCellsFromEditor(ed).length)applyCaretFormat(ed,name,vars);else{var curSelNode=selection.getNode(),firstFormat=formatList[0];ed.settings.forced_root_block||!firstFormat.defaultBlock||dom.getParent(curSelNode,dom.isBlock)||applyFormat(ed,firstFormat.defaultBlock),selection.setRng(normalize$2(selection.getRng())),preserve(selection,!0,(function(bookmark){runOnRanges(ed,(function(selectionRng,fake){var expandedRng=fake?selectionRng:expandRng(ed,selectionRng,formatList);applyRngStyle(dom,expandedRng)}))})),moveStart(dom,selection,selection.getRng()),ed.nodeChanged()}postProcess(name,ed)}}else{node=selection.getNode();for(var i=0,l=formatList.length;i<l;i++){var formatItem=formatList[i];if(formatItem.ceFalseOverride&&isSelectorFormat(formatItem)&&dom.is(node,formatItem.selector))return void setElementFormat(node,formatItem)}}},setup$4=function(registeredFormatListeners,editor){var currentFormats=Cell({});registeredFormatListeners.set({}),editor.on("NodeChange",(function(e){updateAndFireChangeCallbacks(editor,e.element,currentFormats,registeredFormatListeners.get())}))},updateAndFireChangeCallbacks=function(editor,elm,currentFormats,formatChangeData){var formatsList=keys(currentFormats.get()),newFormats={},matchedFormats={},parents=filter(getParents$1(editor.dom,elm),(function(node){return 1===node.nodeType&&!node.getAttribute("data-mce-bogus")}));each$1(formatChangeData,(function(data,format){Tools.each(parents,(function(node){return editor.formatter.matchNode(node,format,{},data.similar)?(-1===formatsList.indexOf(format)&&(each(data.callbacks,(function(callback){callback(!0,{node:node,format:format,parents:parents})})),newFormats[format]=data.callbacks),matchedFormats[format]=data.callbacks,!1):!matchesUnInheritedFormatSelector(editor,node,format)&&void 0}))}));var remainingFormats=filterRemainingFormats(currentFormats.get(),matchedFormats,elm,parents);currentFormats.set(__assign(__assign({},newFormats),remainingFormats))},filterRemainingFormats=function(currentFormats,matchedFormats,elm,parents){return bifilter(currentFormats,(function(callbacks,format){return!!has(matchedFormats,format)||(each(callbacks,(function(callback){callback(!1,{node:elm,format:format,parents:parents})})),!1)})).t},addListeners=function(registeredFormatListeners,formats,callback,similar){var formatChangeItems=registeredFormatListeners.get();each(formats.split(","),(function(format){formatChangeItems[format]||(formatChangeItems[format]={similar:similar,callbacks:[]}),formatChangeItems[format].callbacks.push(callback)})),registeredFormatListeners.set(formatChangeItems)},removeListeners=function(registeredFormatListeners,formats,callback){var formatChangeItems=registeredFormatListeners.get();each(formats.split(","),(function(format){formatChangeItems[format].callbacks=filter(formatChangeItems[format].callbacks,(function(c){return c!==callback})),0===formatChangeItems[format].callbacks.length&&delete formatChangeItems[format]})),registeredFormatListeners.set(formatChangeItems)},formatChangedInternal=function(editor,registeredFormatListeners,formats,callback,similar){return null===registeredFormatListeners.get()&&setup$4(registeredFormatListeners,editor),addListeners(registeredFormatListeners,formats,callback,similar),{unbind:function(){return removeListeners(registeredFormatListeners,formats,callback)}}},toggle=function(editor,name,vars,node){var fmt=editor.formatter.get(name);!match(editor,name,vars,node)||"toggle"in fmt[0]&&!fmt[0].toggle?applyFormat(editor,name,vars,node):remove$6(editor,name,vars,node)},fromElements=function(elements,scope){var doc,fragment=(scope||document).createDocumentFragment();return each(elements,(function(element){fragment.appendChild(element.dom)})),SugarElement.fromDom(fragment)},tableModel=function(element,width,rows){return{element:element,width:width,rows:rows}},tableRow=function(element,cells){return{element:element,cells:cells}},cellPosition=function(x,y){return{x:x,y:y}},getSpan=function(td,key){var value=parseInt(get$4(td,key),10);return isNaN(value)?1:value},fillout=function(table,x,y,tr,td){for(var rowspan=getSpan(td,"rowspan"),colspan=getSpan(td,"colspan"),rows=table.rows,y2=y;y2<y+rowspan;y2++){rows[y2]||(rows[y2]=tableRow(deep(tr),[]));for(var x2=x;x2<x+colspan;x2++){var cells;rows[y2].cells[x2]=y2===y&&x2===x?td:shallow(td)}}},cellExists=function(table,x,y){var rows=table.rows,cells;return!!(rows[y]?rows[y].cells:[])[x]},skipCellsX=function(table,x,y){for(;cellExists(table,x,y);)x++;return x},getWidth=function(rows){return foldl(rows,(function(acc,row){return row.cells.length>acc?row.cells.length:acc}),0)},findElementPos=function(table,element){for(var rows=table.rows,y=0;y<rows.length;y++)for(var cells=rows[y].cells,x=0;x<cells.length;x++)if(eq$2(cells[x],element))return Optional.some(cellPosition(x,y));return Optional.none()},extractRows=function(table,sx,sy,ex,ey){for(var newRows=[],rows=table.rows,y=sy;y<=ey;y++){var cells=rows[y].cells,slice=sx<ex?cells.slice(sx,ex+1):cells.slice(ex,sx+1);newRows.push(tableRow(rows[y].element,slice))}return newRows},subTable=function(table,startPos,endPos){var sx=startPos.x,sy=startPos.y,ex=endPos.x,ey=endPos.y,newRows=sy<ey?extractRows(table,sx,sy,ex,ey):extractRows(table,sx,ey,ex,sy);return tableModel(table.element,getWidth(newRows),newRows)},createDomTable=function(table,rows){var tableElement=shallow(table.element),tableBody=SugarElement.fromTag("tbody");return append$1(tableBody,rows),append(tableElement,tableBody),tableElement},modelRowsToDomRows=function(table){return map(table.rows,(function(row){var cells=map(row.cells,(function(cell){var td=deep(cell);return remove$1(td,"colspan"),remove$1(td,"rowspan"),td})),tr=shallow(row.element);return append$1(tr,cells),tr}))},fromDom$1=function(tableElm){var table=tableModel(shallow(tableElm),0,[]);return each(descendants$1(tableElm,"tr"),(function(tr,y){each(descendants$1(tr,"td,th"),(function(td,x){fillout(table,skipCellsX(table,x,y),y,tr,td)}))})),tableModel(table.element,getWidth(table.rows),table.rows)},toDom=function(table){return createDomTable(table,modelRowsToDomRows(table))},subsection=function(table,startElement,endElement){return findElementPos(table,startElement).bind((function(startPos){return findElementPos(table,endElement).map((function(endPos){return subTable(table,startPos,endPos)}))}))},findParentListContainer=function(parents){return find(parents,(function(elm){return"ul"===name(elm)||"ol"===name(elm)}))},getFullySelectedListWrappers=function(parents,rng){return find(parents,(function(elm){return"li"===name(elm)&&hasAllContentsSelected(elm,rng)})).fold(constant([]),(function(_li){return findParentListContainer(parents).map((function(listCont){var listElm=SugarElement.fromTag(name(listCont)),listStyles=filter$1(getAllRaw(listCont),(function(_style,name){return startsWith(name,"list-style")}));return setAll$1(listElm,listStyles),[SugarElement.fromTag("li"),listElm]})).getOr([])}))},wrap$3=function(innerElm,elms){var wrapped=foldl(elms,(function(acc,elm){return append(elm,acc),elm}),innerElm);return elms.length>0?fromElements([wrapped]):wrapped},directListWrappers=function(commonAnchorContainer){return isListItem(commonAnchorContainer)?parent(commonAnchorContainer).filter(isList).fold(constant([]),(function(listElm){return[commonAnchorContainer,listElm]})):isList(commonAnchorContainer)?[commonAnchorContainer]:[]},getWrapElements=function(rootNode,rng){var commonAnchorContainer=SugarElement.fromDom(rng.commonAncestorContainer),parents=parentsAndSelf(commonAnchorContainer,rootNode),wrapElements=filter(parents,(function(elm){return isInline(elm)||isHeading(elm)})),listWrappers=getFullySelectedListWrappers(parents,rng),allWrappers=wrapElements.concat(listWrappers.length?listWrappers:directListWrappers(commonAnchorContainer));return map(allWrappers,shallow)},emptyFragment=function(){return fromElements([])},getFragmentFromRange=function(rootNode,rng){return wrap$3(SugarElement.fromDom(rng.cloneContents()),getWrapElements(rootNode,rng))},getParentTable=function(rootElm,cell){return ancestor$1(cell,"table",curry(eq$2,rootElm))},getTableFragment=function(rootNode,selectedTableCells){return getParentTable(rootNode,selectedTableCells[0]).bind((function(tableElm){var firstCell=selectedTableCells[0],lastCell=selectedTableCells[selectedTableCells.length-1],fullTableModel=fromDom$1(tableElm);return subsection(fullTableModel,firstCell,lastCell).map((function(sectionedTableModel){return fromElements([toDom(sectionedTableModel)])}))})).getOrThunk(emptyFragment)},getSelectionFragment=function(rootNode,ranges){return ranges.length>0&&ranges[0].collapsed?emptyFragment():getFragmentFromRange(rootNode,ranges[0])},read$1=function(rootNode,ranges){var selectedCells=getCellsFromElementOrRanges(ranges,rootNode);return selectedCells.length>0?getTableFragment(rootNode,selectedCells):getSelectionFragment(rootNode,ranges)},trimLeadingCollapsibleText=function(text){return text.replace(/^[ \f\n\r\t\v]+/,"")},isCollapsibleWhitespace=function(text,index){return index>=0&&index<text.length&&isWhiteSpace$1(text.charAt(index))},getInnerText=function(bin,shouldTrim){var text=trim$2(bin.innerText);return shouldTrim?trimLeadingCollapsibleText(text):text},getContextNodeName=function(parentBlockOpt){return parentBlockOpt.map((function(block){return block.nodeName})).getOr("div").toLowerCase()},getTextContent=function(editor){return Optional.from(editor.selection.getRng()).map((function(rng){var parentBlockOpt=Optional.from(editor.dom.getParent(rng.commonAncestorContainer,editor.dom.isBlock)),body=editor.getBody(),contextNodeName=getContextNodeName(parentBlockOpt),shouldTrimSpaces=Env.browser.isIE()&&"pre"!==contextNodeName,bin=editor.dom.add(body,contextNodeName,{"data-mce-bogus":"all",style:"overflow: hidden; opacity: 0;"},rng.cloneContents()),text=getInnerText(bin,shouldTrimSpaces),nonRenderedText=trim$2(bin.textContent);if(editor.dom.remove(bin),isCollapsibleWhitespace(nonRenderedText,0)||isCollapsibleWhitespace(nonRenderedText,nonRenderedText.length-1)){var parentBlock=parentBlockOpt.getOr(body),parentBlockText=getInnerText(parentBlock,shouldTrimSpaces),textIndex=parentBlockText.indexOf(text),hasProceedingSpace,hasTrailingSpace;return-1===textIndex?text:(isCollapsibleWhitespace(parentBlockText,textIndex-1)?" ":"")+text+(isCollapsibleWhitespace(parentBlockText,textIndex+text.length)?" ":"")}return text})).getOr("")},getSerializedContent=function(editor,args){var rng=editor.selection.getRng(),tmpElm=editor.dom.create("body"),sel=editor.selection.getSel(),ranges=processRanges(editor,getRanges(sel)),fragment=args.contextual?read$1(SugarElement.fromDom(editor.getBody()),ranges).dom:rng.cloneContents();return fragment&&tmpElm.appendChild(fragment),editor.selection.serializer.serialize(tmpElm,args)},getSelectedContentInternal=function(editor,format,args){if(void 0===args&&(args={}),args.get=!0,args.format=format,args.selection=!0,(args=editor.fire("BeforeGetContent",args)).isDefaultPrevented())return editor.fire("GetContent",args),args.content;if("text"===args.format)return getTextContent(editor);args.getInner=!0;var content=getSerializedContent(editor,args);return"tree"===args.format?content:(args.content=editor.selection.isCollapsed()?"":content,editor.fire("GetContent",args),args.content)},KEEP=0,INSERT=1,DELETE=2,diff=function(left,right){var size=left.length+right.length+2,vDown=new Array(size),vUp=new Array(size),snake=function(start,end,diag){return{start:start,end:end,diag:diag}},buildScript=function(start1,end1,start2,end2,script){var middle=getMiddleSnake(start1,end1,start2,end2);if(null===middle||middle.start===end1&&middle.diag===end1-end2||middle.end===start1&&middle.diag===start1-start2)for(var i=start1,j=start2;i<end1||j<end2;)i<end1&&j<end2&&left[i]===right[j]?(script.push([0,left[i]]),++i,++j):end1-start1>end2-start2?(script.push([2,left[i]]),++i):(script.push([1,right[j]]),++j);else{buildScript(start1,middle.start,start2,middle.start-middle.diag,script);for(var i2=middle.start;i2<middle.end;++i2)script.push([0,left[i2]]);buildScript(middle.end,end1,middle.end-middle.diag,end2,script)}},buildSnake=function(start,diag,end1,end2){for(var end=start;end-diag<end2&&end<end1&&left[end]===right[end-diag];)++end;return snake(start,end,diag)},getMiddleSnake=function(start1,end1,start2,end2){var m=end1-start1,n=end2-start2;if(0===m||0===n)return null;var delta=m-n,sum=n+m,offset=(sum%2==0?sum:sum+1)/2,d,k,i,x,y;for(vDown[1+offset]=start1,vUp[1+offset]=end1+1,d=0;d<=offset;++d){for(k=-d;k<=d;k+=2){for(i=k+offset,k===-d||k!==d&&vDown[i-1]<vDown[i+1]?vDown[i]=vDown[i+1]:vDown[i]=vDown[i-1]+1,y=(x=vDown[i])-start1+start2-k;x<end1&&y<end2&&left[x]===right[y];)vDown[i]=++x,++y;if(delta%2!=0&&delta-d<=k&&k<=delta+d&&vUp[i-delta]<=vDown[i])return buildSnake(vUp[i-delta],k+start1-start2,end1,end2)}for(k=delta-d;k<=delta+d;k+=2){for(i=k+offset-delta,k===delta-d||k!==delta+d&&vUp[i+1]<=vUp[i-1]?vUp[i]=vUp[i+1]-1:vUp[i]=vUp[i-1],y=(x=vUp[i]-1)-start1+start2-k;x>=start1&&y>=start2&&left[x]===right[y];)vUp[i]=x--,y--;if(delta%2==0&&-d<=k&&k<=d&&vUp[i]<=vDown[i+delta])return buildSnake(vUp[i],k+start1-start2,end1,end2)}}},script=[];return buildScript(0,left.length,0,right.length,script),script},getOuterHtml=function(elm){return isElement$1(elm)?elm.outerHTML:isText$1(elm)?Entities.encodeRaw(elm.data,!1):isComment$1(elm)?"\x3c!--"+elm.data+"--\x3e":""},createFragment$1=function(html){var node,container=document.createElement("div"),frag=document.createDocumentFragment();for(html&&(container.innerHTML=html);node=container.firstChild;)frag.appendChild(node);return frag},insertAt=function(elm,html,index){var fragment=createFragment$1(html);if(elm.hasChildNodes()&&index<elm.childNodes.length){var target=elm.childNodes[index];target.parentNode.insertBefore(fragment,target)}else elm.appendChild(fragment)},removeAt=function(elm,index){if(elm.hasChildNodes()&&index<elm.childNodes.length){var target=elm.childNodes[index];target.parentNode.removeChild(target)}},applyDiff=function(diff,elm){var index=0;each(diff,(function(action){0===action[0]?index++:1===action[0]?(insertAt(elm,action[1],index),index++):2===action[0]&&removeAt(elm,index)}))},read$2=function(elm){return filter(map(from$1(elm&&elm.childNodes?elm.childNodes:[]),getOuterHtml),(function(item){return item.length>0}))},write=function(fragments,elm){var currentFragments=map(from$1(elm&&elm.childNodes?elm.childNodes:[]),getOuterHtml);return applyDiff(diff(currentFragments,fragments),elm),elm},undoLevelDocument=Cell(Optional.none()),lazyTempDocument=function(){return undoLevelDocument.get().getOrThunk((function(){var doc=document.implementation.createHTMLDocument("undo");return undoLevelDocument.set(Optional.some(doc)),doc}))},hasIframes=function(html){return-1!==html.indexOf("</iframe>")},createFragmentedLevel=function(fragments){return{type:"fragmented",fragments:fragments,content:"",bookmark:null,beforeBookmark:null}},createCompleteLevel=function(content){return{type:"complete",fragments:null,content:content,bookmark:null,beforeBookmark:null}},createFromEditor=function(editor){var fragments=read$2(editor.getBody()),trimmedFragments=bind(fragments,(function(html){var trimmed=trimInternal(editor.serializer,html);return trimmed.length>0?[trimmed]:[]})),content=trimmedFragments.join("");return hasIframes(content)?createFragmentedLevel(trimmedFragments):createCompleteLevel(content)},applyToEditor=function(editor,level,before){"fragmented"===level.type?write(level.fragments,editor.getBody()):editor.setContent(level.content,{format:"raw"}),editor.selection.moveToBookmark(before?level.beforeBookmark:level.bookmark)},getLevelContent=function(level){return"fragmented"===level.type?level.fragments.join(""):level.content},getCleanLevelContent=function(level){var elm=SugarElement.fromTag("body",lazyTempDocument());return set$1(elm,getLevelContent(level)),each(descendants$1(elm,"*[data-mce-bogus]"),unwrap),get$7(elm)},hasEqualContent=function(level1,level2){return getLevelContent(level1)===getLevelContent(level2)},hasEqualCleanedContent=function(level1,level2){return getCleanLevelContent(level1)===getCleanLevelContent(level2)},isEq$4=function(level1,level2){return!(!level1||!level2)&&(!!hasEqualContent(level1,level2)||hasEqualCleanedContent(level1,level2))},isUnlocked=function(locks){return 0===locks.get()},setTyping=function(undoManager,typing,locks){isUnlocked(locks)&&(undoManager.typing=typing)},endTyping=function(undoManager,locks){undoManager.typing&&(setTyping(undoManager,!1,locks),undoManager.add())},endTypingLevelIgnoreLocks=function(undoManager){undoManager.typing&&(undoManager.typing=!1,undoManager.add())},beforeChange=function(editor,locks,beforeBookmark){isUnlocked(locks)&&beforeBookmark.set(Optional.some(getUndoBookmark(editor.selection)))},addUndoLevel=function(editor,undoManager,index,locks,beforeBookmark,level,event){var currentLevel=createFromEditor(editor);if(level=level||{},level=Tools.extend(level,currentLevel),!1===isUnlocked(locks)||editor.removed)return null;var lastLevel=undoManager.data[index.get()];if(editor.fire("BeforeAddUndo",{level:level,lastLevel:lastLevel,originalEvent:event}).isDefaultPrevented())return null;if(lastLevel&&isEq$4(lastLevel,level))return null;undoManager.data[index.get()]&&beforeBookmark.get().each((function(bm){undoManager.data[index.get()].beforeBookmark=bm}));var customUndoRedoLevels=getCustomUndoRedoLevels(editor);if(customUndoRedoLevels&&undoManager.data.length>customUndoRedoLevels){for(var i=0;i<undoManager.data.length-1;i++)undoManager.data[i]=undoManager.data[i+1];undoManager.data.length--,index.set(undoManager.data.length)}level.bookmark=getUndoBookmark(editor.selection),index.get()<undoManager.data.length-1&&(undoManager.data.length=index.get()+1),undoManager.data.push(level),index.set(undoManager.data.length-1);var args={level:level,lastLevel:lastLevel,originalEvent:event};return index.get()>0?(editor.setDirty(!0),editor.fire("AddUndo",args),editor.fire("change",args)):editor.fire("AddUndo",args),level},clear=function(editor,undoManager,index){undoManager.data=[],index.set(0),undoManager.typing=!1,editor.fire("ClearUndos")},extra=function(editor,undoManager,index,callback1,callback2){if(undoManager.transact(callback1)){var bookmark=undoManager.data[index.get()].bookmark,lastLevel=undoManager.data[index.get()-1];applyToEditor(editor,lastLevel,!0),undoManager.transact(callback2)&&(undoManager.data[index.get()-1].beforeBookmark=bookmark)}},redo=function(editor,index,data){var level;return index.get()<data.length-1&&(index.set(index.get()+1),level=data[index.get()],applyToEditor(editor,level,!1),editor.setDirty(!0),editor.fire("Redo",{level:level})),level},undo=function(editor,undoManager,locks,index){var level;return undoManager.typing&&(undoManager.add(),undoManager.typing=!1,setTyping(undoManager,!1,locks)),index.get()>0&&(index.set(index.get()-1),level=undoManager.data[index.get()],applyToEditor(editor,level,!0),editor.setDirty(!0),editor.fire("Undo",{level:level})),level},reset=function(undoManager){undoManager.clear(),undoManager.add()},hasUndo=function(editor,undoManager,index){return index.get()>0||undoManager.typing&&undoManager.data[0]&&!isEq$4(createFromEditor(editor),undoManager.data[0])},hasRedo=function(undoManager,index){return index.get()<undoManager.data.length-1&&!undoManager.typing},transact=function(undoManager,locks,callback){return endTyping(undoManager,locks),undoManager.beforeChange(),undoManager.ignore(callback),undoManager.add()},ignore=function(locks,callback){try{locks.set(locks.get()+1),callback()}finally{locks.set(locks.get()-1)}},addVisualInternal=function(editor,elm){var dom=editor.dom,scope=isNonNullable(elm)?elm:editor.getBody();isUndefined(editor.hasVisual)&&(editor.hasVisual=isVisualAidsEnabled(editor)),each(dom.select("table,a",scope),(function(matchedElm){switch(matchedElm.nodeName){case"TABLE":var cls=getVisualAidsTableClass(editor),value=dom.getAttrib(matchedElm,"border");value&&"0"!==value||!editor.hasVisual?dom.removeClass(matchedElm,cls):dom.addClass(matchedElm,cls)}})),editor.fire("VisualAid",{element:elm,hasVisual:editor.hasVisual})},makePlainAdaptor=function(editor){return{undoManager:{beforeChange:function(locks,beforeBookmark){return beforeChange(editor,locks,beforeBookmark)},addUndoLevel:function(undoManager,index,locks,beforeBookmark,level,event){return addUndoLevel(editor,undoManager,index,locks,beforeBookmark,level,event)},undo:function(undoManager,locks,index){return undo(editor,undoManager,locks,index)},redo:function(index,data){return redo(editor,index,data)},clear:function(undoManager,index){return clear(editor,undoManager,index)},reset:function(undoManager){return reset(undoManager)},hasUndo:function(undoManager,index){return hasUndo(editor,undoManager,index)},hasRedo:function(undoManager,index){return hasRedo(undoManager,index)},transact:function(undoManager,locks,callback){return transact(undoManager,locks,callback)},ignore:function(locks,callback){return ignore(locks,callback)},extra:function(undoManager,index,callback1,callback2){return extra(editor,undoManager,index,callback1,callback2)}},formatter:{match:function(name,vars,node){return match(editor,name,vars,node)},matchAll:function(names,vars){return matchAll(editor,names,vars)},matchNode:function(node,name,vars,similar){return matchNode(editor,node,name,vars,similar)},canApply:function(name){return canApply(editor,name)},closest:function(names){return closest$3(editor,names)},apply:function(name,vars,node){return applyFormat(editor,name,vars,node)},remove:function(name,vars,node,similar){return remove$6(editor,name,vars,node,similar)},toggle:function(name,vars,node){return toggle(editor,name,vars,node)},formatChanged:function(registeredFormatListeners,formats,callback,similar){return formatChangedInternal(editor,registeredFormatListeners,formats,callback,similar)}},editor:{getContent:function(args,format){return getContentInternal(editor,args,format)},setContent:function(content,args){return setContentInternal(editor,content,args)},insertContent:function(value,details){return insertHtmlAtCaret(editor,value,details)},addVisual:function(elm){return addVisualInternal(editor,elm)}},selection:{getContent:function(format,args){return getSelectedContentInternal(editor,format,args)}},raw:{getModel:function(){return Optional.none()}}}},makeRtcAdaptor=function(rtcEditor){var defaultVars=function(vars){return isObject(vars)?vars:{}},unsupported=die("Unimplemented feature for rtc"),undoManager=rtcEditor.undoManager,formatter=rtcEditor.formatter,editor=rtcEditor.editor,selection=rtcEditor.selection,raw=rtcEditor.raw,ignore=noop;return{undoManager:{beforeChange:noop,addUndoLevel:unsupported,undo:function(){return undoManager.undo()},redo:function(){return undoManager.redo()},clear:function(){return undoManager.clear()},reset:function(){return undoManager.reset()},hasUndo:function(){return undoManager.hasUndo()},hasRedo:function(){return undoManager.hasRedo()},transact:function(_undoManager,_locks,fn){return undoManager.transact(fn)},ignore:function(_locks,callback){return undoManager.ignore(callback)},extra:function(_undoManager,_index,callback1,callback2){return undoManager.extra(callback1,callback2)}},formatter:{match:function(name,vars,_node){return formatter.match(name,defaultVars(vars))},matchAll:unsupported,matchNode:unsupported,canApply:function(name){return formatter.canApply(name)},closest:function(names){return formatter.closest(names)},apply:function(name,vars,_node){return formatter.apply(name,defaultVars(vars))},remove:function(name,vars,_node,_similar){return formatter.remove(name,defaultVars(vars))},toggle:function(name,vars,_node){return formatter.toggle(name,defaultVars(vars))},formatChanged:function(_rfl,formats,callback,similar){return formatter.formatChanged(formats,callback,similar)}},editor:{getContent:function(args,_format){return editor.getContent(args)},setContent:function(content,args){return editor.setContent(content,args)},insertContent:function(content,_details){return editor.insertContent(content)},addVisual:noop},selection:{getContent:function(_format,args){return selection.getContent(args)}},raw:{getModel:function(){return Optional.some(raw.getRawModel())}}}},makeNoopAdaptor=function(){var nul=constant(null),empty=constant("");return{undoManager:{beforeChange:noop,addUndoLevel:nul,undo:nul,redo:nul,clear:noop,reset:noop,hasUndo:never,hasRedo:never,transact:nul,ignore:noop,extra:noop},formatter:{match:never,matchAll:constant([]),matchNode:never,canApply:never,closest:empty,apply:noop,remove:noop,toggle:noop,formatChanged:constant({unbind:noop})},editor:{getContent:empty,setContent:empty,insertContent:noop,addVisual:noop},selection:{getContent:empty},raw:{getModel:constant(Optional.none())}}},isRtc=function(editor){return has(editor.plugins,"rtc")},setup$5=function(editor){var editorCast=editor;return get$1(editor.plugins,"rtc").fold((function(){return editorCast.rtcInstance=makePlainAdaptor(editor),Optional.none()}),(function(rtc){return Optional.some(rtc.setup().then((function(rtcEditor){return editorCast.rtcInstance=makeRtcAdaptor(rtcEditor),rtcEditor.rtc.isRemote}),(function(err){return editorCast.rtcInstance=makeNoopAdaptor(),promiseObj.reject(err)})))}))},getRtcInstanceWithFallback=function(editor){return editor.rtcInstance?editor.rtcInstance:makePlainAdaptor(editor)},getRtcInstanceWithError=function(editor){var rtcInstance=editor.rtcInstance;if(rtcInstance)return rtcInstance;throw new Error("Failed to get RTC instance not yet initialized.")},beforeChange$1=function(editor,locks,beforeBookmark){getRtcInstanceWithError(editor).undoManager.beforeChange(locks,beforeBookmark)},addUndoLevel$1=function(editor,undoManager,index,locks,beforeBookmark,level,event){return getRtcInstanceWithError(editor).undoManager.addUndoLevel(undoManager,index,locks,beforeBookmark,level,event)},undo$1=function(editor,undoManager,locks,index){return getRtcInstanceWithError(editor).undoManager.undo(undoManager,locks,index)},redo$1=function(editor,index,data){return getRtcInstanceWithError(editor).undoManager.redo(index,data)},clear$1=function(editor,undoManager,index){getRtcInstanceWithError(editor).undoManager.clear(undoManager,index)},reset$1=function(editor,undoManager){getRtcInstanceWithError(editor).undoManager.reset(undoManager)},hasUndo$1=function(editor,undoManager,index){return getRtcInstanceWithError(editor).undoManager.hasUndo(undoManager,index)},hasRedo$1=function(editor,undoManager,index){return getRtcInstanceWithError(editor).undoManager.hasRedo(undoManager,index)},transact$1=function(editor,undoManager,locks,callback){return getRtcInstanceWithError(editor).undoManager.transact(undoManager,locks,callback)},ignore$1=function(editor,locks,callback){getRtcInstanceWithError(editor).undoManager.ignore(locks,callback)},extra$1=function(editor,undoManager,index,callback1,callback2){getRtcInstanceWithError(editor).undoManager.extra(undoManager,index,callback1,callback2)},matchFormat=function(editor,name,vars,node){return getRtcInstanceWithError(editor).formatter.match(name,vars,node)},matchAllFormats=function(editor,names,vars){return getRtcInstanceWithError(editor).formatter.matchAll(names,vars)},matchNodeFormat=function(editor,node,name,vars,similar){return getRtcInstanceWithError(editor).formatter.matchNode(node,name,vars,similar)},canApplyFormat=function(editor,name){return getRtcInstanceWithError(editor).formatter.canApply(name)},closestFormat=function(editor,names){return getRtcInstanceWithError(editor).formatter.closest(names)},applyFormat$1=function(editor,name,vars,node){getRtcInstanceWithError(editor).formatter.apply(name,vars,node)},removeFormat$1=function(editor,name,vars,node,similar){getRtcInstanceWithError(editor).formatter.remove(name,vars,node,similar)},toggleFormat=function(editor,name,vars,node){getRtcInstanceWithError(editor).formatter.toggle(name,vars,node)},formatChanged=function(editor,registeredFormatListeners,formats,callback,similar){return void 0===similar&&(similar=!1),getRtcInstanceWithError(editor).formatter.formatChanged(registeredFormatListeners,formats,callback,similar)},getContent=function(editor,args,format){return getRtcInstanceWithFallback(editor).editor.getContent(args,format)},setContent=function(editor,content,args){var temp;return getRtcInstanceWithFallback(editor).editor.setContent(content,args)},insertContent=function(editor,value,details){return getRtcInstanceWithFallback(editor).editor.insertContent(value,details)},getSelectedContent=function(editor,format,args){return getRtcInstanceWithError(editor).selection.getContent(format,args)},addVisual=function(editor,elm){return getRtcInstanceWithError(editor).editor.addVisual(elm)},getContent$1=function(editor,args){void 0===args&&(args={});var format=args.format?args.format:"html";return getSelectedContent(editor,format,args)},removeEmpty=function(text){return 0===text.dom.length?(remove(text),Optional.none()):Optional.some(text)},walkPastBookmark=function(node,start){return node.filter((function(elm){return BookmarkManager.isBookmarkNode(elm.dom)})).bind(start?nextSibling:prevSibling)},merge=function(outer,inner,rng,start){var outerElm=outer.dom,innerElm=inner.dom,oldLength=start?outerElm.length:innerElm.length;start?(mergeTextNodes(outerElm,innerElm,!1,!start),rng.setStart(innerElm,oldLength)):(mergeTextNodes(innerElm,outerElm,!1,!start),rng.setEnd(innerElm,oldLength))},normalizeTextIfRequired=function(inner,start){parent(inner).each((function(root){var text=inner.dom;start&&needsToBeNbspLeft(root,CaretPosition(text,0))?normalizeWhitespaceAfter(text,0):!start&&needsToBeNbspRight(root,CaretPosition(text,text.length))&&normalizeWhitespaceBefore(text,text.length)}))},mergeAndNormalizeText=function(outerNode,innerNode,rng,start){outerNode.bind((function(outer){var normalizer;return(start?normalizeWhitespaceBefore:normalizeWhitespaceAfter)(outer.dom,start?outer.dom.length:0),innerNode.filter(isText).map((function(inner){return merge(outer,inner,rng,start)}))})).orThunk((function(){var innerTextNode;return walkPastBookmark(innerNode,start).or(innerNode).filter(isText).map((function(inner){return normalizeTextIfRequired(inner,start)}))}))},rngSetContent=function(rng,fragment){var firstChild=Optional.from(fragment.firstChild).map(SugarElement.fromDom),lastChild=Optional.from(fragment.lastChild).map(SugarElement.fromDom);rng.deleteContents(),rng.insertNode(fragment);var prevText=firstChild.bind(prevSibling).filter(isText).bind(removeEmpty),nextText=lastChild.bind(nextSibling).filter(isText).bind(removeEmpty);mergeAndNormalizeText(prevText,firstChild,rng,!0),mergeAndNormalizeText(nextText,lastChild,rng,!1),rng.collapse(!1)},setupArgs=function(args,content){return __assign(__assign({format:"html"},args),{set:!0,selection:!0,content:content})},cleanContent=function(editor,args){if("raw"!==args.format){var rng=editor.selection.getRng(),contextBlock=editor.dom.getParent(rng.commonAncestorContainer,editor.dom.isBlock),contextArgs=contextBlock?{context:contextBlock.nodeName.toLowerCase()}:{},node=editor.parser.parse(args.content,__assign(__assign({isRootContent:!0,forced_root_block:!1},contextArgs),args));return HtmlSerializer({validate:editor.validate},editor.schema).serialize(node)}return args.content},setContent$1=function(editor,content,args){void 0===args&&(args={});var contentArgs=setupArgs(args,content);if(contentArgs.no_events||!(contentArgs=editor.fire("BeforeSetContent",contentArgs)).isDefaultPrevented()){args.content=cleanContent(editor,contentArgs);var rng=editor.selection.getRng();rngSetContent(rng,rng.createContextualFragment(args.content)),editor.selection.setRng(rng),scrollRangeIntoView(editor,rng),contentArgs.no_events||editor.fire("SetContent",contentArgs)}else editor.fire("SetContent",contentArgs)},deleteFromCallbackMap=function(callbackMap,selector,callback){if(callbackMap&&callbackMap.hasOwnProperty(selector)){var newCallbacks=filter(callbackMap[selector],(function(cb){return cb!==callback}));0===newCallbacks.length?delete callbackMap[selector]:callbackMap[selector]=newCallbacks}};function SelectorChanged(dom,editor){var selectorChangedData,currentSelectors;return{selectorChangedWithUnbind:function(selector,callback){return selectorChangedData||(selectorChangedData={},currentSelectors={},editor.on("NodeChange",(function(e){var node=e.element,parents=dom.getParents(node,null,dom.getRoot()),matchedSelectors={};Tools.each(selectorChangedData,(function(callbacks,selector){Tools.each(parents,(function(node){if(dom.is(node,selector))return currentSelectors[selector]||(Tools.each(callbacks,(function(callback){callback(!0,{node:node,selector:selector,parents:parents})})),currentSelectors[selector]=callbacks),matchedSelectors[selector]=callbacks,!1}))})),Tools.each(currentSelectors,(function(callbacks,selector){matchedSelectors[selector]||(delete currentSelectors[selector],Tools.each(callbacks,(function(callback){callback(!1,{node:node,selector:selector,parents:parents})})))}))}))),selectorChangedData[selector]||(selectorChangedData[selector]=[]),selectorChangedData[selector].push(callback),{unbind:function(){deleteFromCallbackMap(selectorChangedData,selector,callback),deleteFromCallbackMap(currentSelectors,selector,callback)}}}}}var isNativeIeSelection=function(rng){return!!rng.select},isAttachedToDom=function(node){return!(!node||!node.ownerDocument)&&contains$2(SugarElement.fromDom(node.ownerDocument),SugarElement.fromDom(node))},isValidRange=function(rng){return!!rng&&(!!isNativeIeSelection(rng)||isAttachedToDom(rng.startContainer)&&isAttachedToDom(rng.endContainer))},EditorSelection=function(dom,win,serializer,editor){var selectedRange,explicitRange,selectorChangedWithUnbind=SelectorChanged(dom,editor).selectorChangedWithUnbind,setCursorLocation=function(node,offset){var rng=dom.createRng();isNonNullable(node)&&isNonNullable(offset)?(rng.setStart(node,offset),rng.setEnd(node,offset),setRng(rng),collapse(!1)):(moveEndPoint$1(dom,rng,editor.getBody(),!0),setRng(rng))},getContent,setContent=function(content,args){return setContent$1(editor,content,args)},getStart=function(real){return getStart$2(editor.getBody(),getRng$1(),real)},getEnd$1=function(real){return getEnd(editor.getBody(),getRng$1(),real)},getBookmark,moveToBookmark,select=function(node,content){return select$1(dom,node,content).each(setRng),node},isCollapsed=function(){var rng=getRng$1(),sel=getSel();return!(!rng||rng.item)&&(rng.compareEndPoints?0===rng.compareEndPoints("StartToEnd",rng):!sel||rng.collapsed)},collapse=function(toStart){var rng=getRng$1();rng.collapse(!!toStart),setRng(rng)},getSel=function(){return win.getSelection?win.getSelection():win.document.selection},getRng$1=function(){var selection,rng,elm,tryCompareBoundaryPoints=function(how,sourceRange,destinationRange){try{return sourceRange.compareBoundaryPoints(how,destinationRange)}catch(ex){return-1}},doc=win.document;if(void 0!==editor.bookmark&&!1===hasFocus$1(editor)){var bookmark=getRng(editor);if(bookmark.isSome())return bookmark.map((function(r){return processRanges(editor,[r])[0]})).getOr(doc.createRange())}try{(selection=getSel())&&!isRestrictedNode(selection.anchorNode)&&(rng=selection.rangeCount>0?selection.getRangeAt(0):selection.createRange?selection.createRange():doc.createRange(),rng=processRanges(editor,[rng])[0])}catch(ex){}return rng||(rng=doc.createRange?doc.createRange():doc.body.createTextRange()),rng.setStart&&9===rng.startContainer.nodeType&&rng.collapsed&&(elm=dom.getRoot(),rng.setStart(elm,0),rng.setEnd(elm,0)),selectedRange&&explicitRange&&(0===tryCompareBoundaryPoints(rng.START_TO_START,rng,selectedRange)&&0===tryCompareBoundaryPoints(rng.END_TO_END,rng,selectedRange)?rng=explicitRange:(selectedRange=null,explicitRange=null)),rng},setRng=function(rng,forward){var node;if(isValidRange(rng)){var ieRange=isNativeIeSelection(rng)?rng:null;if(ieRange){explicitRange=null;try{ieRange.select()}catch(ex){}}else{var sel=getSel(),evt;if(rng=editor.fire("SetSelectionRange",{range:rng,forward:forward}).range,sel){explicitRange=rng;try{sel.removeAllRanges(),sel.addRange(rng)}catch(ex){}!1===forward&&sel.extend&&(sel.collapse(rng.endContainer,rng.endOffset),sel.extend(rng.startContainer,rng.startOffset)),selectedRange=sel.rangeCount>0?sel.getRangeAt(0):null}rng.collapsed||rng.startContainer!==rng.endContainer||!sel.setBaseAndExtent||Env.ie||rng.endOffset-rng.startOffset<2&&rng.startContainer.hasChildNodes()&&(node=rng.startContainer.childNodes[rng.startOffset])&&"IMG"===node.tagName&&(sel.setBaseAndExtent(rng.startContainer,rng.startOffset,rng.endContainer,rng.endOffset),sel.anchorNode===rng.startContainer&&sel.focusNode===rng.endContainer||sel.setBaseAndExtent(node,0,node,1)),editor.fire("AfterSetSelectionRange",{range:rng,forward:forward})}}},setNode=function(elm){return setContent(dom.getOuterHTML(elm)),elm},getNode=function(){return getNode$1(editor.getBody(),getRng$1())},getSelectedBlocks$1=function(startElm,endElm){return getSelectedBlocks(dom,getRng$1(),startElm,endElm)},isForward=function(){var sel=getSel(),anchorNode=null==sel?void 0:sel.anchorNode,focusNode=null==sel?void 0:sel.focusNode;if(!sel||!anchorNode||!focusNode||isRestrictedNode(anchorNode)||isRestrictedNode(focusNode))return!0;var anchorRange=dom.createRng();anchorRange.setStart(anchorNode,sel.anchorOffset),anchorRange.collapse(!0);var focusRange=dom.createRng();return focusRange.setStart(focusNode,sel.focusOffset),focusRange.collapse(!0),anchorRange.compareBoundaryPoints(anchorRange.START_TO_START,focusRange)<=0},normalize$1=function(){var rng=getRng$1(),sel=getSel();if(!hasMultipleRanges(sel)&&hasAnyRanges(editor)){var normRng=normalize(dom,rng);return normRng.each((function(normRng){setRng(normRng,isForward())})),normRng.getOr(rng)}return rng},selectorChanged,getScrollContainer=function(){for(var scrollContainer,node=dom.getRoot();node&&"BODY"!==node.nodeName;){if(node.scrollHeight>node.clientHeight){scrollContainer=node;break}node=node.parentNode}return scrollContainer},scrollIntoView,placeCaretAt=function(clientX,clientY){return setRng(fromPoint$1(clientX,clientY,editor.getDoc()))},getBoundingClientRect=function(){var rng=getRng$1();return rng.collapsed?CaretPosition.fromRangeStart(rng).getClientRects()[0]:rng.getBoundingClientRect()},destroy=function(){win=selectedRange=explicitRange=null,controlSelection.destroy()},exports={bookmarkManager:null,controlSelection:null,dom:dom,win:win,serializer:serializer,editor:editor,collapse:collapse,setCursorLocation:setCursorLocation,getContent:function(args){return getContent$1(editor,args)},setContent:setContent,getBookmark:function(type,normalized){return bookmarkManager.getBookmark(type,normalized)},moveToBookmark:function(bookmark){return bookmarkManager.moveToBookmark(bookmark)},select:select,isCollapsed:isCollapsed,isForward:isForward,setNode:setNode,getNode:getNode,getSel:getSel,setRng:setRng,getRng:getRng$1,getStart:getStart,getEnd:getEnd$1,getSelectedBlocks:getSelectedBlocks$1,normalize:normalize$1,selectorChanged:function(selector,callback){return selectorChangedWithUnbind(selector,callback),exports},selectorChangedWithUnbind:selectorChangedWithUnbind,getScrollContainer:getScrollContainer,scrollIntoView:function(elm,alignToTop){return scrollElementIntoView(editor,elm,alignToTop)},placeCaretAt:placeCaretAt,getBoundingClientRect:getBoundingClientRect,destroy:destroy},bookmarkManager=BookmarkManager(exports),controlSelection=ControlSelection(exports,editor);return exports.bookmarkManager=bookmarkManager,exports.controlSelection=controlSelection,exports},removeAttrs=function(node,names){each(names,(function(name){node.attr(name,null)}))},addFontToSpansFilter=function(domParser,styles,fontSizes){domParser.addNodeFilter("font",(function(nodes){each(nodes,(function(node){var props=styles.parse(node.attr("style")),color=node.attr("color"),face=node.attr("face"),size=node.attr("size");color&&(props.color=color),face&&(props["font-family"]=face),size&&(props["font-size"]=fontSizes[parseInt(node.attr("size"),10)-1]),node.name="span",node.attr("style",styles.serialize(props)),removeAttrs(node,["color","face","size"])}))}))},addStrikeToSpanFilter=function(domParser,styles){domParser.addNodeFilter("strike",(function(nodes){each(nodes,(function(node){var props=styles.parse(node.attr("style"));props["text-decoration"]="line-through",node.name="span",node.attr("style",styles.serialize(props))}))}))},addFilters=function(domParser,settings){var styles=Styles();settings.convert_fonts_to_spans&&addFontToSpansFilter(domParser,styles,Tools.explode(settings.font_size_legacy_values)),addStrikeToSpanFilter(domParser,styles)},register$1=function(domParser,settings){settings.inline_styles&&addFilters(domParser,settings)},blobUriToBlob=function(url){return new promiseObj((function(resolve,reject){var rejectWithError=function(){reject("Cannot convert "+url+" to Blob. Resource might not exist or is inaccessible.")};try{var xhr_1=new XMLHttpRequest;xhr_1.open("GET",url,!0),xhr_1.responseType="blob",xhr_1.onload=function(){200===xhr_1.status?resolve(xhr_1.response):rejectWithError()},xhr_1.onerror=rejectWithError,xhr_1.send()}catch(ex){rejectWithError()}}))},parseDataUri$1=function(uri){var type,uriParts=decodeURIComponent(uri).split(","),matches=/data:([^;]+)/.exec(uriParts[0]);return matches&&(type=matches[1]),{type:type,data:uriParts[1]}},buildBlob=function(type,data){var str;try{str=atob(data)}catch(e){return Optional.none()}for(var arr=new Uint8Array(str.length),i=0;i<arr.length;i++)arr[i]=str.charCodeAt(i);return Optional.some(new Blob([arr],{type:type}))},dataUriToBlob=function(uri){return new promiseObj((function(resolve){var _a=parseDataUri$1(uri),type=_a.type,data=_a.data;buildBlob(type,data).fold((function(){return resolve(new Blob([]))}),resolve)}))},uriToBlob=function(url){return 0===url.indexOf("blob:")?blobUriToBlob(url):0===url.indexOf("data:")?dataUriToBlob(url):null},blobToDataUri=function(blob){return new promiseObj((function(resolve){var reader=new FileReader;reader.onloadend=function(){resolve(reader.result)},reader.readAsDataURL(blob)}))},count=0,uniqueId=function(prefix){return(prefix||"blobid")+count++},imageToBlobInfo=function(blobCache,img,resolve,reject){var base64,blobInfo;if(0!==img.src.indexOf("blob:")){var _a=parseDataUri$1(img.src),data=_a.data,type=_a.type;base64=data,(blobInfo=blobCache.getByData(base64,type))?resolve({image:img,blobInfo:blobInfo}):uriToBlob(img.src).then((function(blob){blobInfo=blobCache.create(uniqueId(),blob,base64),blobCache.add(blobInfo),resolve({image:img,blobInfo:blobInfo})}),(function(err){reject(err)}))}else(blobInfo=blobCache.getByUri(img.src))?resolve({image:img,blobInfo:blobInfo}):uriToBlob(img.src).then((function(blob){blobToDataUri(blob).then((function(dataUri){base64=parseDataUri$1(dataUri).data,blobInfo=blobCache.create(uniqueId(),blob,base64),blobCache.add(blobInfo),resolve({image:img,blobInfo:blobInfo})}))}),(function(err){reject(err)}))},getAllImages=function(elm){return elm?from$1(elm.getElementsByTagName("img")):[]},ImageScanner=function(uploadStatus,blobCache){var cachedPromises={},findAll;return{findAll:function(elm,predicate){predicate||(predicate=always);var images=filter(getAllImages(elm),(function(img){var src=img.src;return!!Env.fileApi&&(!img.hasAttribute("data-mce-bogus")&&(!img.hasAttribute("data-mce-placeholder")&&(!(!src||src===Env.transparentSrc)&&(0===src.indexOf("blob:")?!uploadStatus.isUploaded(src)&&predicate(img):0===src.indexOf("data:")&&predicate(img)))))})),promises=map(images,(function(img){if(void 0!==cachedPromises[img.src])return new promiseObj((function(resolve){cachedPromises[img.src].then((function(imageInfo){if("string"==typeof imageInfo)return imageInfo;resolve({image:img,blobInfo:imageInfo.blobInfo})}))}));var newPromise=new promiseObj((function(resolve,reject){imageToBlobInfo(blobCache,img,resolve,reject)})).then((function(result){return delete cachedPromises[result.image.src],result})).catch((function(error){return delete cachedPromises[img.src],error}));return cachedPromises[img.src]=newPromise,newPromise}));return promiseObj.all(promises)}}},paddEmptyNode=function(settings,args,blockElements,node){var brPreferred;(settings.padd_empty_with_br||args.insert)&&blockElements[node.name]?node.empty().append(new AstNode("br",1)).shortEnded=!0:node.empty().append(new AstNode("#text",3)).value=" "},isPaddedWithNbsp=function(node){return hasOnlyChild(node,"#text")&&" "===node.firstChild.value},hasOnlyChild=function(node,name){return node&&node.firstChild&&node.firstChild===node.lastChild&&node.firstChild.name===name},isPadded=function(schema,node){var rule=schema.getElementRule(node.name);return rule&&rule.paddEmpty},isEmpty$2=function(schema,nonEmptyElements,whitespaceElements,node){return node.isEmpty(nonEmptyElements,whitespaceElements,(function(node){return isPadded(schema,node)}))},isLineBreakNode=function(node,blockElements){return node&&(blockElements[node.name]||"br"===node.name)},isBogusImage=function(img){return img.attr("data-mce-bogus")},isInternalImageSource=function(img){return img.attr("src")===Env.transparentSrc||img.attr("data-mce-placeholder")},isValidDataImg=function(img,settings){if(settings.images_dataimg_filter){var imgElem_1=new Image;return imgElem_1.src=img.attr("src"),each$1(img.attributes.map,(function(value,key){imgElem_1.setAttribute(key,value)})),settings.images_dataimg_filter(imgElem_1)}return!0},registerBase64ImageFilter=function(parser,settings){var blobCache=settings.blob_cache,processImage=function(img){var inputSrc=img.attr("src");isInternalImageSource(img)||isBogusImage(img)||parseDataUri(inputSrc).filter((function(){return isValidDataImg(img,settings)})).bind((function(_a){var type=_a.type,data=_a.data;return Optional.from(blobCache.getByData(data,type)).orThunk((function(){return buildBlob(type,data).map((function(blob){var blobInfo=blobCache.create(uniqueId(),blob,data);return blobCache.add(blobInfo),blobInfo}))}))})).each((function(blobInfo){img.attr("src",blobInfo.blobUri())}))};blobCache&&parser.addAttributeFilter("src",(function(nodes){return each(nodes,processImage)}))},register$2=function(parser,settings){var schema=parser.schema;settings.remove_trailing_brs&&parser.addNodeFilter("br",(function(nodes,_,args){var i,l=nodes.length,node,blockElements=Tools.extend({},schema.getBlockElements()),nonEmptyElements=schema.getNonEmptyElements(),parent,lastParent,prev,prevName,whiteSpaceElements=schema.getWhiteSpaceElements(),elementRule,textNode;for(blockElements.body=1,i=0;i<l;i++)if(parent=(node=nodes[i]).parent,blockElements[node.parent.name]&&node===parent.lastChild){for(prev=node.prev;prev;){if("span"!==(prevName=prev.name)||"bookmark"!==prev.attr("data-mce-type")){"br"===prevName&&(node=null);break}prev=prev.prev}node&&(node.remove(),isEmpty$2(schema,nonEmptyElements,whiteSpaceElements,parent)&&(elementRule=schema.getElementRule(parent.name))&&(elementRule.removeEmpty?parent.remove():elementRule.paddEmpty&&paddEmptyNode(settings,args,blockElements,parent)))}else{for(lastParent=node;parent&&parent.firstChild===lastParent&&parent.lastChild===lastParent&&(lastParent=parent,!blockElements[parent.name]);)parent=parent.parent;lastParent===parent&&!0!==settings.padd_empty_with_br&&((textNode=new AstNode("#text",3)).value=" ",node.replace(textNode))}})),parser.addAttributeFilter("href",(function(nodes){var i=nodes.length,appendRel=function(rel){var parts;return rel.split(" ").filter((function(p){return p.length>0})).concat(["noopener"]).sort().join(" ")},addNoOpener=function(rel){var newRel=rel?Tools.trim(rel):"";return/\b(noopener)\b/g.test(newRel)?newRel:appendRel(newRel)};if(!settings.allow_unsafe_link_target)for(;i--;){var node=nodes[i];"a"===node.name&&"_blank"===node.attr("target")&&node.attr("rel",addNoOpener(node.attr("rel")))}})),settings.allow_html_in_named_anchor||parser.addAttributeFilter("id,name",(function(nodes){for(var i=nodes.length,sibling,prevSibling,parent,node;i--;)if("a"===(node=nodes[i]).name&&node.firstChild&&!node.attr("href")){parent=node.parent,sibling=node.lastChild;do{prevSibling=sibling.prev,parent.insert(sibling,node),sibling=prevSibling}while(sibling)}})),settings.fix_list_elements&&parser.addNodeFilter("ul,ol",(function(nodes){for(var i=nodes.length,node,parentNode;i--;)if("ul"===(parentNode=(node=nodes[i]).parent).name||"ol"===parentNode.name)if(node.prev&&"li"===node.prev.name)node.prev.append(node);else{var li=new AstNode("li",1);li.attr("style","list-style-type: none"),node.wrap(li)}})),settings.validate&&schema.getValidClasses()&&parser.addAttributeFilter("class",(function(nodes){for(var i=nodes.length,node,classList,ci,className,classValue,validClasses=schema.getValidClasses(),validClassesMap,valid;i--;){for(classList=(node=nodes[i]).attr("class").split(" "),classValue="",ci=0;ci<classList.length;ci++)className=classList[ci],valid=!1,(validClassesMap=validClasses["*"])&&validClassesMap[className]&&(valid=!0),validClassesMap=validClasses[node.name],!valid&&validClassesMap&&validClassesMap[className]&&(valid=!0),valid&&(classValue&&(classValue+=" "),classValue+=className);classValue.length||(classValue=null),node.attr("class",classValue)}})),registerBase64ImageFilter(parser,settings)},makeMap$4=Tools.makeMap,each$d=Tools.each,explode$2=Tools.explode,extend$2=Tools.extend,DomParser=function(settings,schema){void 0===schema&&(schema=Schema());var nodeFilters={},attributeFilters=[],matchedNodes={},matchedAttributes={};(settings=settings||{}).validate=!("validate"in settings)||settings.validate,settings.root_name=settings.root_name||"body";var fixInvalidChildren=function(nodes){var ni,node,parent,parents,newParent,currentNode,tempNode,childNode,i,sibling,nextNode,nonSplitableElements=makeMap$4("tr,td,th,tbody,thead,tfoot,table"),nonEmptyElements=schema.getNonEmptyElements(),whitespaceElements=schema.getWhiteSpaceElements(),textBlockElements=schema.getTextBlockElements(),specialElements=schema.getSpecialElements();for(ni=0;ni<nodes.length;ni++)if((node=nodes[ni]).parent&&!node.fixed)if(textBlockElements[node.name]&&"li"===node.parent.name){for(sibling=node.next;sibling&&textBlockElements[sibling.name];)sibling.name="li",sibling.fixed=!0,node.parent.insert(sibling,node.parent),sibling=sibling.next;node.unwrap(node)}else{for(parents=[node],parent=node.parent;parent&&!schema.isValidChild(parent.name,node.name)&&!nonSplitableElements[parent.name];parent=parent.parent)parents.push(parent);if(parent&&parents.length>1){for(parents.reverse(),newParent=currentNode=filterNode(parents[0].clone()),i=0;i<parents.length-1;i++){for(schema.isValidChild(currentNode.name,parents[i].name)?(tempNode=filterNode(parents[i].clone()),currentNode.append(tempNode)):tempNode=currentNode,childNode=parents[i].firstChild;childNode&&childNode!==parents[i+1];)nextNode=childNode.next,tempNode.append(childNode),childNode=nextNode;currentNode=tempNode}isEmpty$2(schema,nonEmptyElements,whitespaceElements,newParent)?parent.insert(node,parents[0],!0):(parent.insert(newParent,parents[0],!0),parent.insert(node,newParent)),parent=parents[0],(isEmpty$2(schema,nonEmptyElements,whitespaceElements,parent)||hasOnlyChild(parent,"br"))&&parent.empty().remove()}else if(node.parent){if("li"===node.name){if((sibling=node.prev)&&("ul"===sibling.name||"ol"===sibling.name)){sibling.append(node);continue}if((sibling=node.next)&&("ul"===sibling.name||"ol"===sibling.name)){sibling.insert(node,sibling.firstChild,!0);continue}node.wrap(filterNode(new AstNode("ul",1)));continue}schema.isValidChild(node.parent.name,"div")&&schema.isValidChild("div",node.name)?node.wrap(filterNode(new AstNode("div",1))):specialElements[node.name]?node.empty().remove():node.unwrap()}}},filterNode=function(node){var i,name,list;(name=node.name)in nodeFilters&&((list=matchedNodes[name])?list.push(node):matchedNodes[name]=[node]),i=attributeFilters.length;for(;i--;)(name=attributeFilters[i].name)in node.attributes.map&&((list=matchedAttributes[name])?list.push(node):matchedAttributes[name]=[node]);return node},addNodeFilter,getNodeFilters,addAttributeFilter,getAttributeFilters,parse=function(html,args){var nodes,i,l,fi,fl,list,name,invalidChildren=[],isInWhiteSpacePreservedElement,node,getRootBlockName=function(name){return!1===name?"":!0===name?"p":name};args=args||{},matchedNodes={},matchedAttributes={};var blockElements=extend$2(makeMap$4("script,style,head,html,body,title,meta,param"),schema.getBlockElements()),nonEmptyElements=schema.getNonEmptyElements(),children=schema.children,validate=settings.validate,forcedRootBlockName,rootBlockName=getRootBlockName("forced_root_block"in args?args.forced_root_block:settings.forced_root_block),whiteSpaceElements=schema.getWhiteSpaceElements(),lineBreakRegExp=/[\r\n]+/,startWhiteSpaceRegExp=/^[ \t\r\n]+/,endWhiteSpaceRegExp=/[ \t\r\n]+$/,allWhiteSpaceRegExp=/[ \t\r\n]+/g,isAllWhiteSpaceRegExp=/^[ \t\r\n]+$/;isInWhiteSpacePreservedElement=whiteSpaceElements.hasOwnProperty(args.context)||whiteSpaceElements.hasOwnProperty(settings.root_name);var addRootBlocks=function(){var node=rootNode.firstChild,next,rootBlockNode,trim=function(rootBlockNode){rootBlockNode&&((node=rootBlockNode.firstChild)&&3===node.type&&(node.value=node.value.replace(startWhiteSpaceRegExp,"")),(node=rootBlockNode.lastChild)&&3===node.type&&(node.value=node.value.replace(endWhiteSpaceRegExp,"")))};if(schema.isValidChild(rootNode.name,rootBlockName.toLowerCase())){for(;node;)next=node.next,3===node.type||1===node.type&&"p"!==node.name&&!blockElements[node.name]&&!node.attr("data-mce-type")?rootBlockNode?rootBlockNode.append(node):((rootBlockNode=createNode(rootBlockName,1)).attr(settings.forced_root_block_attrs),rootNode.insert(rootBlockNode,node),rootBlockNode.append(node)):(trim(rootBlockNode),rootBlockNode=null),node=next;trim(rootBlockNode)}},createNode=function(name,type){var node=new AstNode(name,type),list;return name in nodeFilters&&((list=matchedNodes[name])?list.push(node):matchedNodes[name]=[node]),node},removeWhitespaceBefore=function(node){var textNode,textNodeNext,textVal,sibling,blockElements=schema.getBlockElements();for(textNode=node.prev;textNode&&3===textNode.type;){if((textVal=textNode.value.replace(endWhiteSpaceRegExp,"")).length>0)return void(textNode.value=textVal);if(textNodeNext=textNode.next){if(3===textNodeNext.type&&textNodeNext.value.length){textNode=textNode.prev;continue}if(!blockElements[textNodeNext.name]&&"script"!==textNodeNext.name&&"style"!==textNodeNext.name){textNode=textNode.prev;continue}}sibling=textNode.prev,textNode.remove(),textNode=sibling}},cloneAndExcludeBlocks=function(input){var name,output={};for(name in input)"li"!==name&&"p"!==name&&(output[name]=input[name]);return output},parser=SaxParser({validate:validate,allow_html_data_urls:settings.allow_html_data_urls,allow_svg_data_urls:settings.allow_svg_data_urls,allow_script_urls:settings.allow_script_urls,allow_conditional_comments:settings.allow_conditional_comments,preserve_cdata:settings.preserve_cdata,self_closing_elements:cloneAndExcludeBlocks(schema.getSelfClosingElements()),cdata:function(text){node.append(createNode("#cdata",4)).value=text},text:function(text,raw){var textNode;0!==text.length&&((textNode=createNode("#text",3)).raw=!!raw,node.append(textNode).value=text)},comment:function(text){node.append(createNode("#comment",8)).value=text},pi:function(name,text){node.append(createNode(name,7)).value=text,removeWhitespaceBefore(node)},doctype:function(text){var newNode;node.append(createNode("#doctype",10)).value=text,removeWhitespaceBefore(node)},start:function(name,attrs,empty){var newNode,attrFiltersLen,attrName,parent,elementRule=validate?schema.getElementRule(name):{};if(elementRule){for((newNode=createNode(elementRule.outputName||name,1)).attributes=attrs,newNode.shortEnded=empty,node.append(newNode),(parent=children[node.name])&&children[newNode.name]&&!parent[newNode.name]&&invalidChildren.push(newNode),attrFiltersLen=attributeFilters.length;attrFiltersLen--;)(attrName=attributeFilters[attrFiltersLen].name)in attrs.map&&((list=matchedAttributes[attrName])?list.push(newNode):matchedAttributes[attrName]=[newNode]);blockElements[name]&&removeWhitespaceBefore(newNode),empty||(node=newNode),!isInWhiteSpacePreservedElement&&whiteSpaceElements[name]&&(isInWhiteSpacePreservedElement=!0)}},end:function(name){var textNode,text,sibling,tempNode,elementRule=validate?schema.getElementRule(name):{};if(elementRule){if(blockElements[name]&&!isInWhiteSpacePreservedElement){if((textNode=node.firstChild)&&3===textNode.type)if((text=textNode.value.replace(startWhiteSpaceRegExp,"")).length>0)textNode.value=text,textNode=textNode.next;else for(sibling=textNode.next,textNode.remove(),textNode=sibling;textNode&&3===textNode.type;)text=textNode.value,sibling=textNode.next,(0===text.length||isAllWhiteSpaceRegExp.test(text))&&(textNode.remove(),textNode=sibling),textNode=sibling;if((textNode=node.lastChild)&&3===textNode.type)if((text=textNode.value.replace(endWhiteSpaceRegExp,"")).length>0)textNode.value=text,textNode=textNode.prev;else for(sibling=textNode.prev,textNode.remove(),textNode=sibling;textNode&&3===textNode.type;)text=textNode.value,sibling=textNode.prev,(0===text.length||isAllWhiteSpaceRegExp.test(text))&&(textNode.remove(),textNode=sibling),textNode=sibling}if(isInWhiteSpacePreservedElement&&whiteSpaceElements[name]&&(isInWhiteSpacePreservedElement=!1),elementRule.removeEmpty&&isEmpty$2(schema,nonEmptyElements,whiteSpaceElements,node))return tempNode=node.parent,blockElements[node.name]?node.empty().remove():node.unwrap(),void(node=tempNode);elementRule.paddEmpty&&(isPaddedWithNbsp(node)||isEmpty$2(schema,nonEmptyElements,whiteSpaceElements,node))&&paddEmptyNode(settings,args,blockElements,node),node=node.parent}}},schema),rootNode=node=new AstNode(args.context||settings.root_name,11);if(parser.parse(html,args.format),validate&&invalidChildren.length&&(args.context?args.invalid=!0:fixInvalidChildren(invalidChildren)),rootBlockName&&("body"===rootNode.name||args.isRootContent)&&addRootBlocks(),!args.invalid){for(name in matchedNodes)if(matchedNodes.hasOwnProperty(name)){for(list=nodeFilters[name],fi=(nodes=matchedNodes[name]).length;fi--;)nodes[fi].parent||nodes.splice(fi,1);for(i=0,l=list.length;i<l;i++)list[i](nodes,name,args)}for(i=0,l=attributeFilters.length;i<l;i++)if((list=attributeFilters[i]).name in matchedAttributes){for(fi=(nodes=matchedAttributes[list.name]).length;fi--;)nodes[fi].parent||nodes.splice(fi,1);for(fi=0,fl=list.callbacks.length;fi<fl;fi++)list.callbacks[fi](nodes,list.name,args)}}return rootNode},exports={schema:schema,addAttributeFilter:function(name,callback){each$d(explode$2(name),(function(name){var i;for(i=0;i<attributeFilters.length;i++)if(attributeFilters[i].name===name)return void attributeFilters[i].callbacks.push(callback);attributeFilters.push({name:name,callbacks:[callback]})}))},getAttributeFilters:function(){return[].concat(attributeFilters)},addNodeFilter:function(name,callback){each$d(explode$2(name),(function(name){var list=nodeFilters[name];list||(nodeFilters[name]=list=[]),list.push(callback)}))},getNodeFilters:function(){var out=[];for(var name_1 in nodeFilters)nodeFilters.hasOwnProperty(name_1)&&out.push({name:name_1,callbacks:nodeFilters[name_1]});return out},filterNode:filterNode,parse:parse};return register$2(exports,settings),register$1(exports,settings),exports},register$3=function(htmlParser,settings,dom){htmlParser.addAttributeFilter("data-mce-tabindex",(function(nodes,name){for(var i=nodes.length,node;i--;)(node=nodes[i]).attr("tabindex",node.attr("data-mce-tabindex")),node.attr(name,null)})),htmlParser.addAttributeFilter("src,href,style",(function(nodes,name){for(var i=nodes.length,node,value,internalName="data-mce-"+name,urlConverter=settings.url_converter,urlConverterScope=settings.url_converter_scope;i--;)void 0!==(value=(node=nodes[i]).attr(internalName))?(node.attr(name,value.length>0?value:null),node.attr(internalName,null)):(value=node.attr(name),"style"===name?value=dom.serializeStyle(dom.parseStyle(value),node.name):urlConverter&&(value=urlConverter.call(urlConverterScope,value,name,node.name)),node.attr(name,value.length>0?value:null))})),htmlParser.addAttributeFilter("class",(function(nodes){for(var i=nodes.length,node,value;i--;)(value=(node=nodes[i]).attr("class"))&&(value=node.attr("class").replace(/(?:^|\s)mce-item-\w+(?!\S)/g,""),node.attr("class",value.length>0?value:null))})),htmlParser.addAttributeFilter("data-mce-type",(function(nodes,name,args){for(var i=nodes.length,node;i--;){var hasChildren;if("bookmark"===(node=nodes[i]).attr("data-mce-type")&&!args.cleanup)Optional.from(node.firstChild).exists((function(firstChild){return!isZwsp$1(firstChild.value)}))?node.unwrap():node.remove()}})),htmlParser.addNodeFilter("noscript",(function(nodes){for(var i=nodes.length,node;i--;)(node=nodes[i].firstChild)&&(node.value=Entities.decode(node.value))})),htmlParser.addNodeFilter("script,style",(function(nodes,name){for(var i=nodes.length,node,value,type,trim=function(value){return value.replace(/(<!--\[CDATA\[|\]\]-->)/g,"\n").replace(/^[\r\n]*|[\r\n]*$/g,"").replace(/^\s*((<!--)?(\s*\/\/)?\s*<!\[CDATA\[|(<!--\s*)?\/\*\s*<!\[CDATA\[\s*\*\/|(\/\/)?\s*<!--|\/\*\s*<!--\s*\*\/)\s*[\r\n]*/gi,"").replace(/\s*(\/\*\s*\]\]>\s*\*\/(-->)?|\s*\/\/\s*\]\]>(-->)?|\/\/\s*(-->)?|\]\]>|\/\*\s*-->\s*\*\/|\s*-->\s*)\s*$/g,"")};i--;)value=(node=nodes[i]).firstChild?node.firstChild.value:"","script"===name?((type=node.attr("type"))&&node.attr("type","mce-no/type"===type?null:type.replace(/^mce\-/,"")),"xhtml"===settings.element_format&&value.length>0&&(node.firstChild.value="// <![CDATA[\n"+trim(value)+"\n// ]]>")):"xhtml"===settings.element_format&&value.length>0&&(node.firstChild.value="\x3c!--\n"+trim(value)+"\n--\x3e")})),htmlParser.addNodeFilter("#comment",(function(nodes){for(var i=nodes.length,node;i--;)node=nodes[i],settings.preserve_cdata&&0===node.value.indexOf("[CDATA[")?(node.name="#cdata",node.type=4,node.value=dom.decode(node.value.replace(/^\[CDATA\[|\]\]$/g,""))):0===node.value.indexOf("mce:protected ")&&(node.name="#text",node.type=3,node.raw=!0,node.value=unescape(node.value).substr(14))})),htmlParser.addNodeFilter("xml:namespace,input",(function(nodes,name){for(var i=nodes.length,node;i--;)7===(node=nodes[i]).type?node.remove():1===node.type&&("input"!==name||node.attr("type")||node.attr("type","text"))})),htmlParser.addAttributeFilter("data-mce-type",(function(nodes){each(nodes,(function(node){"format-caret"===node.attr("data-mce-type")&&(node.isEmpty(htmlParser.schema.getNonEmptyElements())?node.remove():node.unwrap())}))})),htmlParser.addAttributeFilter("data-mce-src,data-mce-href,data-mce-style,data-mce-selected,data-mce-expando,data-mce-type,data-mce-resize,data-mce-placeholder",(function(nodes,name){for(var i=nodes.length;i--;)nodes[i].attr(name,null)}))},trimTrailingBr=function(rootNode){var isBr=function(node){return node&&"br"===node.name},brNode1=rootNode.lastChild;if(isBr(brNode1)){var brNode2=brNode1.prev;isBr(brNode2)&&(brNode1.remove(),brNode2.remove())}},preProcess=function(editor,node,args){var doc,oldDoc,dom=editor.dom;node=node.cloneNode(!0);var impl=document.implementation;return impl.createHTMLDocument&&(doc=impl.createHTMLDocument(""),Tools.each("BODY"===node.nodeName?node.childNodes:[node],(function(node){doc.body.appendChild(doc.importNode(node,!0))})),node="BODY"!==node.nodeName?doc.body.firstChild:doc.body,oldDoc=dom.doc,dom.doc=doc),firePreProcess(editor,__assign(__assign({},args),{node:node})),oldDoc&&(dom.doc=oldDoc),node},shouldFireEvent=function(editor,args){return editor&&editor.hasEventListeners("PreProcess")&&!args.no_events},process=function(editor,node,args){return shouldFireEvent(editor,args)?preProcess(editor,node,args):node},addTempAttr=function(htmlParser,tempAttrs,name){-1===Tools.inArray(tempAttrs,name)&&(htmlParser.addAttributeFilter(name,(function(nodes,name){for(var i=nodes.length;i--;)nodes[i].attr(name,null)})),tempAttrs.push(name))},postProcess$1=function(editor,args,content){var outArgs;return!args.no_events&&editor?firePostProcess(editor,__assign(__assign({},args),{content:content})).content:content},getHtmlFromNode=function(dom,node,args){var html=trim$2(args.getInner?node.innerHTML:dom.getOuterHTML(node));return args.selection||isWsPreserveElement(SugarElement.fromDom(node))?html:Tools.trim(html)},parseHtml=function(htmlParser,html,args){var parserArgs=args.selection?__assign({forced_root_block:!1},args):args,rootNode=htmlParser.parse(html,parserArgs);return trimTrailingBr(rootNode),rootNode},serializeNode=function(settings,schema,node){var htmlSerializer;return HtmlSerializer(settings,schema).serialize(node)},toHtml=function(editor,settings,schema,rootNode,args){var content=serializeNode(settings,schema,rootNode);return postProcess$1(editor,args,content)},DomSerializerImpl=function(settings,editor){var tempAttrs=["data-mce-selected"],dom=editor&&editor.dom?editor.dom:DOMUtils.DOM,schema=editor&&editor.schema?editor.schema:Schema(settings);settings.entity_encoding=settings.entity_encoding||"named",settings.remove_trailing_brs=!("remove_trailing_brs"in settings)||settings.remove_trailing_brs;var htmlParser=DomParser(settings,schema);register$3(htmlParser,settings,dom);var serialize=function(node,parserArgs){void 0===parserArgs&&(parserArgs={});var args=__assign({format:"html"},parserArgs),targetNode=process(editor,node,args),html=getHtmlFromNode(dom,targetNode,args),rootNode=parseHtml(htmlParser,html,args);return"tree"===args.format?rootNode:toHtml(editor,settings,schema,rootNode,args)};return{schema:schema,addNodeFilter:htmlParser.addNodeFilter,addAttributeFilter:htmlParser.addAttributeFilter,serialize:serialize,addRules:function(rules){schema.addValidElements(rules)},setRules:function(rules){schema.setValidElements(rules)},addTempAttr:curry(addTempAttr,htmlParser,tempAttrs),getTempAttrs:constant(tempAttrs),getNodeFilters:htmlParser.getNodeFilters,getAttributeFilters:htmlParser.getAttributeFilters}},DomSerializer=function(settings,editor){var domSerializer=DomSerializerImpl(settings,editor);return{schema:domSerializer.schema,addNodeFilter:domSerializer.addNodeFilter,addAttributeFilter:domSerializer.addAttributeFilter,serialize:domSerializer.serialize,addRules:domSerializer.addRules,setRules:domSerializer.setRules,addTempAttr:domSerializer.addTempAttr,getTempAttrs:domSerializer.getTempAttrs,getNodeFilters:domSerializer.getNodeFilters,getAttributeFilters:domSerializer.getAttributeFilters}},defaultFormat$1="html",getContent$2=function(editor,args){void 0===args&&(args={});var format=args.format?args.format:"html";return getContent(editor,args,format)},setContent$2=function(editor,content,args){return void 0===args&&(args={}),setContent(editor,content,args)},DOM$3=DOMUtils.DOM,restoreOriginalStyles=function(editor){DOM$3.setStyle(editor.id,"display",editor.orgDisplay)},safeDestroy=function(x){return Optional.from(x).each((function(x){return x.destroy()}))},clearDomReferences=function(editor){editor.contentAreaContainer=editor.formElement=editor.container=editor.editorContainer=null,editor.bodyElement=editor.contentDocument=editor.contentWindow=null,editor.iframeElement=editor.targetElm=null,editor.selection&&(editor.selection=editor.selection.win=editor.selection.dom=editor.selection.dom.doc=null)},restoreForm=function(editor){var form=editor.formElement;form&&(form._mceOldSubmit&&(form.submit=form._mceOldSubmit,form._mceOldSubmit=null),DOM$3.unbind(form,"submit reset",editor.formEventDelegate))},remove$7=function(editor){if(!editor.removed){var _selectionOverrides=editor._selectionOverrides,editorUpload=editor.editorUpload,body=editor.getBody(),element=editor.getElement();body&&editor.save({is_removing:!0}),editor.removed=!0,editor.unbindAllNativeEvents(),editor.hasHiddenInput&&element&&DOM$3.remove(element.nextSibling),fireRemove(editor),editor.editorManager.remove(editor),!editor.inline&&body&&restoreOriginalStyles(editor),fireDetach(editor),DOM$3.remove(editor.getContainer()),safeDestroy(_selectionOverrides),safeDestroy(editorUpload),editor.destroy()}},destroy=function(editor,automatic){var selection=editor.selection,dom=editor.dom;editor.destroyed||(automatic||editor.removed?(automatic||(editor.editorManager.off("beforeunload",editor._beforeUnload),editor.theme&&editor.theme.destroy&&editor.theme.destroy(),safeDestroy(selection),safeDestroy(dom)),restoreForm(editor),clearDomReferences(editor),editor.destroyed=!0):editor.remove())},hasOwnProperty$2=Object.prototype.hasOwnProperty,deep$1,baseMerge,deepMerge=function(merger){return function(){for(var objects=[],_i=0;_i<arguments.length;_i++)objects[_i]=arguments[_i];if(0===objects.length)throw new Error("Can't merge zero objects");for(var ret={},j=0;j<objects.length;j++){var curObject=objects[j];for(var key in curObject)hasOwnProperty$2.call(curObject,key)&&(ret[key]=merger(ret[key],curObject[key]))}return ret}}((function(old,nu){var bothObjects;return isObject(old)&&isObject(nu)?deepMerge(old,nu):nu})),sectionResult=function(sections,settings){return{sections:constant(sections),settings:constant(settings)}},deviceDetection=detect$3().deviceType,isTouch=deviceDetection.isTouch(),isPhone=deviceDetection.isPhone(),isTablet=deviceDetection.isTablet(),legacyMobilePlugins=["lists","autolink","autosave"],defaultTouchSettings={table_grid:!1,object_resizing:!1,resize:!1},normalizePlugins=function(plugins){var pluginNames=isArray(plugins)?plugins.join(" "):plugins,trimmedPlugins=map(isString(pluginNames)?pluginNames.split(" "):[],trim);return filter(trimmedPlugins,(function(item){return item.length>0}))},filterLegacyMobilePlugins=function(plugins){return filter(plugins,curry(contains,legacyMobilePlugins))},extractSections=function(keys,settings){var result=bifilter(settings,(function(value,key){return contains(keys,key)}));return sectionResult(result.t,result.f)},getSection=function(sectionResult,name,defaults){void 0===defaults&&(defaults={});var sections=sectionResult.sections(),sectionSettings=sections.hasOwnProperty(name)?sections[name]:{};return Tools.extend({},defaults,sectionSettings)},hasSection=function(sectionResult,name){return sectionResult.sections().hasOwnProperty(name)},isSectionTheme=function(sectionResult,name,theme){var section=sectionResult.sections();return hasSection(sectionResult,name)&&section[name].theme===theme},getSectionConfig=function(sectionResult,name){return hasSection(sectionResult,name)?sectionResult.sections()[name]:{}},getToolbarMode=function(settings,defaultVal){return get$1(settings,"toolbar_mode").orThunk((function(){return get$1(settings,"toolbar_drawer").map((function(val){return!1===val?"wrap":val}))})).getOr(defaultVal)},getDefaultSettings=function(settings,id,documentBaseUrl,isTouch,editor){var baseDefaults={id:id,theme:"silver",toolbar_mode:getToolbarMode(settings,"floating"),plugins:"",document_base_url:documentBaseUrl,add_form_submit_trigger:!0,submit_patch:!0,add_unload_trigger:!0,convert_urls:!0,relative_urls:!0,remove_script_host:!0,object_resizing:!0,doctype:"<!DOCTYPE html>",visual:!0,font_size_legacy_values:"xx-small,small,medium,large,x-large,xx-large,300%",forced_root_block:"p",hidden_input:!0,inline_styles:!0,convert_fonts_to_spans:!0,indent:!0,indent_before:"p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,tfoot,tbody,tr,section,summary,article,hgroup,aside,figure,figcaption,option,optgroup,datalist",indent_after:"p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,tfoot,tbody,tr,section,summary,article,hgroup,aside,figure,figcaption,option,optgroup,datalist",entity_encoding:"named",url_converter:editor.convertURL,url_converter_scope:editor};return __assign(__assign({},baseDefaults),isTouch?defaultTouchSettings:{})},getDefaultMobileSettings=function(mobileSettings,isPhone){var defaultMobileSettings={resize:!1,toolbar_mode:getToolbarMode(mobileSettings,"scrolling"),toolbar_sticky:!1},defaultPhoneSettings={menubar:!1};return __assign(__assign(__assign({},defaultTouchSettings),defaultMobileSettings),isPhone?defaultPhoneSettings:{})},getExternalPlugins$1=function(overrideSettings,settings){var userDefinedExternalPlugins=settings.external_plugins?settings.external_plugins:{};return overrideSettings&&overrideSettings.external_plugins?Tools.extend({},overrideSettings.external_plugins,userDefinedExternalPlugins):userDefinedExternalPlugins},combinePlugins=function(forcedPlugins,plugins){return[].concat(normalizePlugins(forcedPlugins)).concat(normalizePlugins(plugins))},getPlatformPlugins=function(isMobileDevice,sectionResult,desktopPlugins,mobilePlugins){return isMobileDevice&&isSectionTheme(sectionResult,"mobile","mobile")?filterLegacyMobilePlugins(mobilePlugins):isMobileDevice&&hasSection(sectionResult,"mobile")?mobilePlugins:desktopPlugins},processPlugins=function(isMobileDevice,sectionResult,defaultOverrideSettings,settings){var forcedPlugins=normalizePlugins(defaultOverrideSettings.forced_plugins),desktopPlugins=normalizePlugins(settings.plugins),mobileConfig=getSectionConfig(sectionResult,"mobile"),mobilePlugins=mobileConfig.plugins?normalizePlugins(mobileConfig.plugins):desktopPlugins,platformPlugins=getPlatformPlugins(isMobileDevice,sectionResult,desktopPlugins,mobilePlugins),combinedPlugins=combinePlugins(forcedPlugins,platformPlugins);if(Env.browser.isIE()&&contains(combinedPlugins,"rtc"))throw new Error("RTC plugin is not supported on IE 11.");return Tools.extend(settings,{plugins:combinedPlugins.join(" ")})},isOnMobile=function(isMobileDevice,sectionResult){return isMobileDevice&&hasSection(sectionResult,"mobile")},combineSettings=function(isMobileDevice,isPhone,defaultSettings,defaultOverrideSettings,settings){var defaultDeviceSettings=isMobileDevice?{mobile:getDefaultMobileSettings(settings.mobile||{},isPhone)}:{},sectionResult=extractSections(["mobile"],deepMerge(defaultDeviceSettings,settings)),extendedSettings=Tools.extend(defaultSettings,defaultOverrideSettings,sectionResult.settings(),isOnMobile(isMobileDevice,sectionResult)?getSection(sectionResult,"mobile"):{},{validate:!0,external_plugins:getExternalPlugins$1(defaultOverrideSettings,sectionResult.settings())});return processPlugins(isMobileDevice,sectionResult,defaultOverrideSettings,extendedSettings)},getEditorSettings=function(editor,id,documentBaseUrl,defaultOverrideSettings,settings){var defaultSettings=getDefaultSettings(settings,id,documentBaseUrl,isTouch,editor);return combineSettings(isPhone||isTablet,isPhone,defaultSettings,defaultOverrideSettings,settings)},getFiltered=function(predicate,editor,name){return Optional.from(editor.settings[name]).filter(predicate)},getParamObject=function(value){var output={};return"string"==typeof value?each(value.indexOf("=")>0?value.split(/[;,](?![^=;,]*(?:[;,]|$))/):value.split(","),(function(val){var arr=val.split("=");arr.length>1?output[Tools.trim(arr[0])]=Tools.trim(arr[1]):output[Tools.trim(arr[0])]=Tools.trim(arr[0])})):output=value,output},isArrayOf=function(p){return function(a){return isArray(a)&&forall(a,p)}},getParam=function(editor,name,defaultVal,type){var value=name in editor.settings?editor.settings[name]:defaultVal;return"hash"===type?getParamObject(value):"string"===type?getFiltered(isString,editor,name).getOr(defaultVal):"number"===type?getFiltered(isNumber,editor,name).getOr(defaultVal):"boolean"===type?getFiltered(isBoolean,editor,name).getOr(defaultVal):"object"===type?getFiltered(isObject,editor,name).getOr(defaultVal):"array"===type?getFiltered(isArray,editor,name).getOr(defaultVal):"string[]"===type?getFiltered(isArrayOf(isString),editor,name).getOr(defaultVal):"function"===type?getFiltered(isFunction,editor,name).getOr(defaultVal):value},CreateIconManager,IconManager=function(){var lookup={},add,get,has$1;return{add:function(id,iconPack){lookup[id]=iconPack},get:function(id){return lookup[id]?lookup[id]:{icons:{}}},has:function(id){return has(lookup,id)}}}(),getProp=function(propName,elm){var rawElm;return elm.dom[propName]},getComputedSizeProp=function(propName,elm){return parseInt(get$5(elm,propName),10)},getClientWidth=curry(getProp,"clientWidth"),getClientHeight=curry(getProp,"clientHeight"),getMarginTop=curry(getComputedSizeProp,"margin-top"),getMarginLeft=curry(getComputedSizeProp,"margin-left"),getBoundingClientRect$1=function(elm){return elm.dom.getBoundingClientRect()},isInsideElementContentArea=function(bodyElm,clientX,clientY){var clientWidth=getClientWidth(bodyElm),clientHeight=getClientHeight(bodyElm);return clientX>=0&&clientY>=0&&clientX<=clientWidth&&clientY<=clientHeight},transpose=function(inline,elm,clientX,clientY){var clientRect=getBoundingClientRect$1(elm),deltaX,deltaY,x,y;return{x:clientX-(inline?clientRect.left+elm.dom.clientLeft+getMarginLeft(elm):0),y:clientY-(inline?clientRect.top+elm.dom.clientTop+getMarginTop(elm):0)}},isXYInContentArea=function(editor,clientX,clientY){var bodyElm=SugarElement.fromDom(editor.getBody()),targetElm=editor.inline?bodyElm:documentElement(bodyElm),transposedPoint=transpose(editor.inline,targetElm,clientX,clientY);return isInsideElementContentArea(targetElm,transposedPoint.x,transposedPoint.y)},fromDomSafe=function(node){return Optional.from(node).map(SugarElement.fromDom)},isEditorAttachedToDom=function(editor){var rawContainer=editor.inline?editor.getBody():editor.getContentAreaContainer();return fromDomSafe(rawContainer).map(inBody).getOr(!1)},NotificationManagerImpl=function(){var unimplemented=function(){throw new Error("Theme did not provide a NotificationManager implementation.")};return{open:unimplemented,close:unimplemented,reposition:unimplemented,getArgs:unimplemented}},NotificationManager=function(editor){var notifications=[],getImplementation=function(){var theme=editor.theme;return theme&&theme.getNotificationManagerImpl?theme.getNotificationManagerImpl():NotificationManagerImpl()},getTopNotification=function(){return Optional.from(notifications[0])},isEqual=function(a,b){return!(a.type!==b.type||a.text!==b.text||a.progressBar||a.timeout||b.progressBar||b.timeout)},reposition=function(){notifications.length>0&&getImplementation().reposition(notifications)},addNotification=function(notification){notifications.push(notification)},closeNotification=function(notification){findIndex(notifications,(function(otherNotification){return otherNotification===notification})).each((function(index){notifications.splice(index,1)}))},open=function(spec,fireEvent){if(void 0===fireEvent&&(fireEvent=!0),!editor.removed&&isEditorAttachedToDom(editor))return fireEvent&&editor.fire("BeforeOpenNotification",{notification:spec}),find(notifications,(function(notification){return isEqual(getImplementation().getArgs(notification),spec)})).getOrThunk((function(){editor.editorManager.setActive(editor);var notification=getImplementation().open(spec,(function(){closeNotification(notification),reposition(),getTopNotification().fold((function(){return editor.focus()}),(function(top){return focus(SugarElement.fromDom(top.getEl()))}))}));return addNotification(notification),reposition(),editor.fire("OpenNotification",__assign({},notification)),notification}))},close=function(){getTopNotification().each((function(notification){getImplementation().close(notification),closeNotification(notification),reposition()}))},getNotifications=function(){return notifications},registerEvents;return function(editor){editor.on("SkinLoaded",(function(){var serviceMessage=getServiceMessage(editor);serviceMessage&&open({text:serviceMessage,type:"warning",timeout:0},!1)})),editor.on("ResizeEditor ResizeWindow NodeChange",(function(){Delay.requestAnimationFrame(reposition)})),editor.on("remove",(function(){each(notifications.slice(),(function(notification){getImplementation().close(notification)}))}))}(editor),{open:open,close:close,getNotifications:getNotifications}},PluginManager=AddOnManager.PluginManager,ThemeManager=AddOnManager.ThemeManager;function WindowManagerImpl(){var unimplemented=function(){throw new Error("Theme did not provide a WindowManager implementation.")};return{open:unimplemented,openUrl:unimplemented,alert:unimplemented,confirm:unimplemented,close:unimplemented,getParams:unimplemented,setParams:unimplemented}}var WindowManager=function(editor){var dialogs=[],getImplementation=function(){var theme=editor.theme;return theme&&theme.getWindowManagerImpl?theme.getWindowManagerImpl():WindowManagerImpl()},funcBind=function(scope,f){return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return f?f.apply(scope,args):void 0}},fireOpenEvent=function(dialog){editor.fire("OpenWindow",{dialog:dialog})},fireCloseEvent=function(dialog){editor.fire("CloseWindow",{dialog:dialog})},addDialog=function(dialog){dialogs.push(dialog),fireOpenEvent(dialog)},closeDialog=function(dialog){fireCloseEvent(dialog),0===(dialogs=filter(dialogs,(function(otherDialog){return otherDialog!==dialog}))).length&&editor.focus()},getTopDialog=function(){return Optional.from(dialogs[dialogs.length-1])},storeSelectionAndOpenDialog=function(openDialog){editor.editorManager.setActive(editor),store(editor);var dialog=openDialog();return addDialog(dialog),dialog},open=function(args,params){return storeSelectionAndOpenDialog((function(){return getImplementation().open(args,params,closeDialog)}))},openUrl=function(args){return storeSelectionAndOpenDialog((function(){return getImplementation().openUrl(args,closeDialog)}))},alert=function(message,callback,scope){var windowManagerImpl=getImplementation();windowManagerImpl.alert(message,funcBind(scope||windowManagerImpl,callback))},confirm=function(message,callback,scope){var windowManagerImpl=getImplementation();windowManagerImpl.confirm(message,funcBind(scope||windowManagerImpl,callback))},close=function(){getTopDialog().each((function(dialog){getImplementation().close(dialog),closeDialog(dialog)}))};return editor.on("remove",(function(){each(dialogs,(function(dialog){getImplementation().close(dialog)}))})),{open:open,openUrl:openUrl,alert:alert,confirm:confirm,close:close}},displayNotification=function(editor,message){editor.notificationManager.open({type:"error",text:message})},displayError=function(editor,message){},uploadError=function(editor,message){I18n.translate(["Failed to upload image: {0}",message])},logError=function(editor,errorType,msg){fireError(editor,errorType,{message:msg}),console.error(msg)},createLoadError=function(type,url,name){return name?"Failed to load "+type+": "+name+" from url "+url:"Failed to load "+type+" url: "+url},pluginLoadError=function(editor,url,name){logError(editor,"PluginLoadError",createLoadError("plugin",url,name))},iconsLoadError=function(editor,url,name){logError(editor,"IconsLoadError",createLoadError("icons",url,name))},languageLoadError=function(editor,url,name){logError(editor,"LanguageLoadError",createLoadError("language",url,name))},customJsLoadError=function(editor,url,name){logError(editor,"customJsLoadError",createLoadError("customJs",url,name))},pluginInitError=function(editor,name,err){var message=I18n.translate(["Failed to initialize plugin: {0}",name]);fireError(editor,"PluginLoadError",{message:message}),initError(message,err)},initError=function(message){for(var x=[],_i=1;_i<arguments.length;_i++)x[_i-1]=arguments[_i];var console=window.console;console&&(console.error?console.error.apply(console,__spreadArrays([message],x)):console.log.apply(console,__spreadArrays([message],x)))},isContentCssSkinName=function(url){return/^[a-z0-9\-]+$/i.test(url)},getContentCssUrls=function(editor){return transformToUrls(editor,getContentCss(editor))},getFontCssUrls=function(editor){return transformToUrls(editor,getFontCss(editor))},transformToUrls=function(editor,cssLinks){var skinUrl=editor.editorManager.baseURL+"/skins/content",suffix,contentCssFile="content"+editor.editorManager.suffix+".css",inline=!0===editor.inline;return map(cssLinks,(function(url){return isContentCssSkinName(url)&&!inline?skinUrl+"/"+url+"/"+contentCssFile:editor.documentBaseURI.toAbsolute(url)}))},appendContentCssFromSettings=function(editor){editor.contentCSS=editor.contentCSS.concat(getContentCssUrls(editor),getFontCssUrls(editor))},UploadStatus=function(){var PENDING=1,UPLOADED=2,blobUriStatuses={},createStatus=function(status,resultUri){return{status:status,resultUri:resultUri}},hasBlobUri=function(blobUri){return blobUri in blobUriStatuses},getResultUri,isPending=function(blobUri){return!!hasBlobUri(blobUri)&&1===blobUriStatuses[blobUri].status},isUploaded=function(blobUri){return!!hasBlobUri(blobUri)&&2===blobUriStatuses[blobUri].status},markPending,markUploaded,removeFailed,destroy;return{hasBlobUri:hasBlobUri,getResultUri:function(blobUri){var result=blobUriStatuses[blobUri];return result?result.resultUri:null},isPending:isPending,isUploaded:isUploaded,markPending:function(blobUri){blobUriStatuses[blobUri]=createStatus(1,null)},markUploaded:function(blobUri,resultUri){blobUriStatuses[blobUri]=createStatus(2,resultUri)},removeFailed:function(blobUri){delete blobUriStatuses[blobUri]},destroy:function(){blobUriStatuses={}}}},count$1=0,seed=function(){var rnd=function(){return Math.round(4294967295*Math.random()).toString(36)},now;return"s"+(new Date).getTime().toString(36)+rnd()+rnd()+rnd()},uuid=function(prefix){return prefix+count$1+++seed()},BlobCache=function(){var cache=[],mimeToExt=function(mime){var mimes;return{"image/jpeg":"jpg","image/jpg":"jpg","image/gif":"gif","image/png":"png","image/apng":"apng","image/avif":"avif","image/svg+xml":"svg","image/webp":"webp","image/bmp":"bmp","image/tiff":"tiff"}[mime.toLowerCase()]||"dat"},create=function(o,blob,base64,name,filename){var id;if(isString(o))return toBlobInfo({id:o,name:name,filename:filename,blob:blob,base64:base64});if(isObject(o))return toBlobInfo(o);throw new Error("Unknown input type")},toBlobInfo=function(o){if(!o.blob||!o.base64)throw new Error("blob and base64 representations of the image are required for BlobInfo to be created");var id=o.id||uuid("blobid"),name=o.name||id,blob=o.blob;return{id:constant(id),name:constant(name),filename:constant(o.filename||name+"."+mimeToExt(blob.type)),blob:constant(blob),base64:constant(o.base64),blobUri:constant(o.blobUri||URL.createObjectURL(blob)),uri:constant(o.uri)}},add=function(blobInfo){get(blobInfo.id())||cache.push(blobInfo)},findFirst=function(predicate){return find(cache,predicate).getOrUndefined()},get=function(id){return findFirst((function(cachedBlobInfo){return cachedBlobInfo.id()===id}))},getByUri,getByData,removeByUri,destroy;return{create:create,add:add,get:get,getByUri:function(blobUri){return findFirst((function(blobInfo){return blobInfo.blobUri()===blobUri}))},getByData:function(base64,type){return findFirst((function(blobInfo){return blobInfo.base64()===base64&&blobInfo.blob().type===type}))},findFirst:findFirst,removeByUri:function(blobUri){cache=filter(cache,(function(blobInfo){return blobInfo.blobUri()!==blobUri||(URL.revokeObjectURL(blobInfo.blobUri()),!1)}))},destroy:function(){each(cache,(function(cachedBlobInfo){URL.revokeObjectURL(cachedBlobInfo.blobUri())})),cache=[]}}},Uploader=function(uploadStatus,settings){var pendingPromises={},pathJoin=function(path1,path2){return path1?path1.replace(/\/$/,"")+"/"+path2.replace(/^\//,""):path2},defaultHandler=function(blobInfo,success,failure,progress){var xhr=new XMLHttpRequest;xhr.open("POST",settings.url),xhr.withCredentials=settings.credentials,xhr.upload.onprogress=function(e){progress(e.loaded/e.total*100)},xhr.onerror=function(){failure("Image upload failed due to a XHR Transport error. Code: "+xhr.status)},xhr.onload=function(){if(xhr.status<200||xhr.status>=300)failure("HTTP Error: "+xhr.status);else{var json=JSON.parse(xhr.responseText);json&&"string"==typeof json.location?success(pathJoin(settings.basePath,json.location)):failure("Invalid JSON: "+xhr.responseText)}};var formData=new FormData;formData.append("file",blobInfo.blob(),blobInfo.filename()),xhr.send(formData)},noUpload=function(){return new promiseObj((function(resolve){resolve([])}))},handlerSuccess=function(blobInfo,url){return{url:url,blobInfo:blobInfo,status:!0}},handlerFailure=function(blobInfo,message,options){return{url:"",blobInfo:blobInfo,status:!1,error:{message:message,options:options}}},resolvePending=function(blobUri,result){Tools.each(pendingPromises[blobUri],(function(resolve){resolve(result)})),delete pendingPromises[blobUri]},uploadBlobInfo=function(blobInfo,handler,openNotification){return uploadStatus.markPending(blobInfo.blobUri()),new promiseObj((function(resolve){var notification,progress;try{var closeNotification_1=function(){notification&&(notification.close(),progress=noop)},success=function(url){closeNotification_1(),uploadStatus.markUploaded(blobInfo.blobUri(),url),resolvePending(blobInfo.blobUri(),handlerSuccess(blobInfo,url)),resolve(handlerSuccess(blobInfo,url))},failure=function(error,options){var failureOptions=options||{};closeNotification_1(),uploadStatus.removeFailed(blobInfo.blobUri()),resolvePending(blobInfo.blobUri(),handlerFailure(blobInfo,error,failureOptions)),resolve(handlerFailure(blobInfo,error,failureOptions))};handler(blobInfo,success,failure,progress=function(percent){percent<0||percent>100||Optional.from(notification).orThunk((function(){return Optional.from(openNotification).map(apply)})).each((function(n){notification=n,n.progressBar.value(percent)}))})}catch(ex){resolve(handlerFailure(blobInfo,ex.message,{}))}}))},isDefaultHandler=function(handler){return handler===defaultHandler},pendingUploadBlobInfo=function(blobInfo){var blobUri=blobInfo.blobUri();return new promiseObj((function(resolve){pendingPromises[blobUri]=pendingPromises[blobUri]||[],pendingPromises[blobUri].push(resolve)}))},uploadBlobs=function(blobInfos,openNotification){return blobInfos=Tools.grep(blobInfos,(function(blobInfo){return!uploadStatus.isUploaded(blobInfo.blobUri())})),promiseObj.all(Tools.map(blobInfos,(function(blobInfo){return uploadStatus.isPending(blobInfo.blobUri())?pendingUploadBlobInfo(blobInfo):uploadBlobInfo(blobInfo,settings.handler,openNotification)})))},upload=function(blobInfos,openNotification){return!settings.url&&isDefaultHandler(settings.handler)?noUpload():uploadBlobs(blobInfos,openNotification)};return!1===isFunction(settings.handler)&&(settings.handler=defaultHandler),{upload:upload}},openNotification=function(editor){return function(){return editor.notificationManager.open({text:editor.translate("Image uploading..."),type:"info",timeout:-1,progressBar:!0})}},createUploader=function(editor,uploadStatus){return Uploader(uploadStatus,{url:getImageUploadUrl(editor),basePath:getImageUploadBasePath(editor),credentials:getImagesUploadCredentials(editor),handler:getImagesUploadHandler(editor)})},ImageUploader=function(editor){var uploadStatus=UploadStatus(),uploader=createUploader(editor,uploadStatus);return{upload:function(blobInfos,showNotification){return void 0===showNotification&&(showNotification=!0),uploader.upload(blobInfos,showNotification?openNotification(editor):void 0)}}},UploadChangeHandler=function(editor){var lastChangedLevel=Cell(null),fireIfChanged;return editor.on("change AddUndo",(function(e){lastChangedLevel.set(__assign({},e.level))})),{fireIfChanged:function(){var data=editor.undoManager.data;last(data).filter((function(level){return!isEq$4(lastChangedLevel.get(),level)})).each((function(level){editor.setDirty(!0),editor.fire("change",{level:level,lastLevel:get(data,data.length-2).getOrNull()})}))}}},EditorUpload=function(editor){var blobCache=BlobCache(),uploader,imageScanner,uploadStatus=UploadStatus(),urlFilters=[],changeHandler=UploadChangeHandler(editor),aliveGuard=function(callback){return function(result){return editor.selection?callback(result):[]}},cacheInvalidator=function(url){return url+(-1===url.indexOf("?")?"?":"&")+(new Date).getTime()},replaceString=function(content,search,replace){var index=0;do{-1!==(index=content.indexOf(search,index))&&(content=content.substring(0,index)+replace+content.substr(index+search.length),index+=replace.length-search.length+1)}while(-1!==index);return content},replaceImageUrl=function(content,targetUrl,replacementUrl){var replacementString='src="'+replacementUrl+'"'+(replacementUrl===Env.transparentSrc?' data-mce-placeholder="1"':"");return content=replaceString(content,'src="'+targetUrl+'"',replacementString),content=replaceString(content,'data-mce-src="'+targetUrl+'"','data-mce-src="'+replacementUrl+'"')},replaceUrlInUndoStack=function(targetUrl,replacementUrl){each(editor.undoManager.data,(function(level){"fragmented"===level.type?level.fragments=map(level.fragments,(function(fragment){return replaceImageUrl(fragment,targetUrl,replacementUrl)})):level.content=replaceImageUrl(level.content,targetUrl,replacementUrl)}))},replaceImageUriInView=function(image,resultUri){var src=editor.convertURL(resultUri,"src");replaceUrlInUndoStack(image.src,resultUri),editor.$(image).attr({src:shouldReuseFileName(editor)?cacheInvalidator(resultUri):resultUri,"data-mce-src":src})},uploadImages=function(callback){return uploader||(uploader=createUploader(editor,uploadStatus)),scanForImages().then(aliveGuard((function(imageInfos){var blobInfos=map(imageInfos,(function(imageInfo){return imageInfo.blobInfo}));return uploader.upload(blobInfos,openNotification(editor)).then(aliveGuard((function(result){var imagesToRemove=[],filteredResult=map(result,(function(uploadInfo,index){var blobInfo=imageInfos[index].blobInfo,image=imageInfos[index].image;return uploadInfo.status&&shouldReplaceBlobUris(editor)?(blobCache.removeByUri(image.src),replaceImageUriInView(image,uploadInfo.url)):uploadInfo.error&&(uploadInfo.error.options.remove&&(replaceUrlInUndoStack(image.getAttribute("src"),Env.transparentSrc),imagesToRemove.push(image)),uploadError(editor,uploadInfo.error.message)),{element:image,status:uploadInfo.status,uploadUri:uploadInfo.url,blobInfo:blobInfo}}));return filteredResult.length>0&&changeHandler.fireIfChanged(),imagesToRemove.length>0&&(isRtc(editor)?console.error("Removing images on failed uploads is currently unsupported for RTC"):editor.undoManager.transact((function(){each(imagesToRemove,(function(element){editor.dom.remove(element),blobCache.removeByUri(element.src)}))}))),callback&&callback(filteredResult),filteredResult})))})))},uploadImagesAuto=function(callback){if(isAutomaticUploadsEnabled(editor))return uploadImages(callback)},isValidDataUriImage=function(imgElm){return!1!==forall(urlFilters,(function(filter){return filter(imgElm)}))&&(0!==imgElm.getAttribute("src").indexOf("data:")||getImagesDataImgFilter(editor)(imgElm));var dataImgFilter},addFilter=function(filter){urlFilters.push(filter)},scanForImages=function(){return imageScanner||(imageScanner=ImageScanner(uploadStatus,blobCache)),imageScanner.findAll(editor.getBody(),isValidDataUriImage).then(aliveGuard((function(result){return result=filter(result,(function(resultItem){return"string"!=typeof resultItem})),each(result,(function(resultItem){replaceUrlInUndoStack(resultItem.image.src,resultItem.blobInfo.blobUri()),resultItem.image.src=resultItem.blobInfo.blobUri(),resultItem.image.removeAttribute("data-mce-src")})),result})))},destroy=function(){blobCache.destroy(),uploadStatus.destroy(),imageScanner=uploader=null},replaceBlobUris=function(content){return content.replace(/src="(blob:[^"]+)"/g,(function(match,blobUri){var resultUri=uploadStatus.getResultUri(blobUri);if(resultUri)return'src="'+resultUri+'"';var blobInfo=blobCache.getByUri(blobUri),blob;return blobInfo||(blobInfo=foldl(editor.editorManager.get(),(function(result,editor){return result||editor.editorUpload&&editor.editorUpload.blobCache.getByUri(blobUri)}),null)),blobInfo?'src="data:'+blobInfo.blob().type+";base64,"+blobInfo.base64()+'"':match}))};return editor.on("SetContent",(function(){isAutomaticUploadsEnabled(editor)?uploadImagesAuto():scanForImages()})),editor.on("RawSaveContent",(function(e){e.content=replaceBlobUris(e.content)})),editor.on("GetContent",(function(e){e.source_view||"raw"===e.format||"tree"===e.format||(e.content=replaceBlobUris(e.content))})),editor.on("PostRender",(function(){editor.parser.addNodeFilter("img",(function(images){each(images,(function(img){var src=img.attr("src");if(!blobCache.getByUri(src)){var resultUri=uploadStatus.getResultUri(src);resultUri&&img.attr("src",resultUri)}}))}))})),{blobCache:blobCache,addFilter:addFilter,uploadImages:uploadImages,uploadImagesAuto:uploadImagesAuto,scanForImages:scanForImages,destroy:destroy}},get$a=function(dom){var formats={valigntop:[{selector:"td,th",styles:{verticalAlign:"top"}}],valignmiddle:[{selector:"td,th",styles:{verticalAlign:"middle"}}],valignbottom:[{selector:"td,th",styles:{verticalAlign:"bottom"}}],alignleft:[{selector:"figure.image",collapsed:!1,classes:"align-left",ceFalseOverride:!0,preview:"font-family font-size"},{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"left"},inherit:!1,preview:!1,defaultBlock:"div"},{selector:"img,table",collapsed:!1,styles:{float:"left"},preview:"font-family font-size"}],aligncenter:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"center"},inherit:!1,preview:"font-family font-size",defaultBlock:"div"},{selector:"figure.image",collapsed:!1,classes:"align-center",ceFalseOverride:!0,preview:"font-family font-size"},{selector:"img",collapsed:!1,styles:{display:"block",marginLeft:"auto",marginRight:"auto"},preview:!1},{selector:"table",collapsed:!1,styles:{marginLeft:"auto",marginRight:"auto"},preview:"font-family font-size"}],alignright:[{selector:"figure.image",collapsed:!1,classes:"align-right",ceFalseOverride:!0,preview:"font-family font-size"},{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"right"},inherit:!1,preview:"font-family font-size",defaultBlock:"div"},{selector:"img,table",collapsed:!1,styles:{float:"right"},preview:"font-family font-size"}],alignjustify:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"justify"},inherit:!1,defaultBlock:"div",preview:"font-family font-size"}],bold:[{inline:"strong",remove:"all",preserve_attributes:["class","style"]},{inline:"span",styles:{fontWeight:"bold"}},{inline:"b",remove:"all",preserve_attributes:["class","style"]}],italic:[{inline:"em",remove:"all",preserve_attributes:["class","style"]},{inline:"span",styles:{fontStyle:"italic"}},{inline:"i",remove:"all",preserve_attributes:["class","style"]}],underline:[{inline:"span",styles:{textDecoration:"underline"},exact:!0},{inline:"u",remove:"all",preserve_attributes:["class","style"]}],strikethrough:[{inline:"span",styles:{textDecoration:"line-through"},exact:!0},{inline:"strike",remove:"all",preserve_attributes:["class","style"]},{inline:"s",remove:"all",preserve_attributes:["class","style"]}],forecolor:{inline:"span",styles:{color:"%value"},links:!0,remove_similar:!0,clear_child_styles:!0},hilitecolor:{inline:"span",styles:{backgroundColor:"%value"},links:!0,remove_similar:!0,clear_child_styles:!0},fontname:{inline:"span",toggle:!1,styles:{fontFamily:"%value"},clear_child_styles:!0},fontsize:{inline:"span",toggle:!1,styles:{fontSize:"%value"},clear_child_styles:!0},lineheight:{selector:"h1,h2,h3,h4,h5,h6,p,li,td,th,div",defaultBlock:"p",styles:{lineHeight:"%value"}},fontsize_class:{inline:"span",attributes:{class:"%value"}},blockquote:{block:"blockquote",wrapper:!0,remove:"all"},subscript:{inline:"sub"},superscript:{inline:"sup"},code:{inline:"code"},link:{inline:"a",selector:"a",remove:"all",split:!0,deep:!0,onmatch:function(node,_fmt,_itemName){return isElement$1(node)&&node.hasAttribute("href")},onformat:function(elm,_fmt,vars){Tools.each(vars,(function(value,key){dom.setAttrib(elm,key,value)}))}},removeformat:[{selector:"b,strong,em,i,font,u,strike,s,sub,sup,dfn,code,samp,kbd,var,cite,mark,q,del,ins",remove:"all",split:!0,expand:!1,block_expand:!0,deep:!0},{selector:"ul,ol",remove:"all",split:!0,expand:!1,deep:!0},{selector:"li",remove:"all",split:!0,expand:!1,block:!0,deep:!0},{selector:"span",attributes:["style","class"],remove:"empty",split:!0,expand:!1,deep:!0},{selector:"*",attributes:["style","class"],split:!1,expand:!1,deep:!0}]};return Tools.each("p h1 h2 h3 h4 h5 h6 div address pre div dt dd samp".split(/\s/),(function(name){formats[name]={block:name,remove:"all"}})),formats},FormatRegistry=function(editor){var formats={},get=function(name){return name?formats[name]:formats},has$1=function(name){return has(formats,name)},register=function(name,format){name&&("string"!=typeof name?Tools.each(name,(function(format,name){register(name,format)})):(isArray(format)||(format=[format]),Tools.each(format,(function(format){void 0===format.deep&&(format.deep=!format.selector),void 0===format.split&&(format.split=!format.selector||format.inline),void 0===format.remove&&format.selector&&!format.inline&&(format.remove="none"),format.selector&&format.inline&&(format.mixed=!0,format.block_expand=!0),"string"==typeof format.classes&&(format.classes=format.classes.split(/\s+/))})),formats[name]=format))},unregister=function(name){return name&&formats[name]&&delete formats[name],formats};return register(get$a(editor.dom)),register(getFormats(editor)),{get:get,has:has$1,register:register,unregister:unregister}},each$e=Tools.each,dom=DOMUtils.DOM,parsedSelectorToHtml=function(ancestry,editor){var elm,item,fragment,schema=editor&&editor.schema||Schema({}),decorate=function(elm,item){item.classes.length&&dom.addClass(elm,item.classes.join(" ")),dom.setAttribs(elm,item.attrs)},createElement=function(sItem){item="string"==typeof sItem?{name:sItem,classes:[],attrs:{}}:sItem;var elm=dom.create(item.name);return decorate(elm,item),elm},getRequiredParent=function(elm,candidate){var name="string"!=typeof elm?elm.nodeName.toLowerCase():elm,elmRule=schema.getElementRule(name),parentsRequired=elmRule&&elmRule.parentsRequired;return!(!parentsRequired||!parentsRequired.length)&&(candidate&&-1!==Tools.inArray(parentsRequired,candidate)?candidate:parentsRequired[0])},wrapInHtml=function(elm,ancestry,siblings){var parent,parentCandidate,ancestor=ancestry.length>0&&ancestry[0],ancestorName=ancestor&&ancestor.name,parentRequired=getRequiredParent(elm,ancestorName);if(parentRequired)ancestorName===parentRequired?(parentCandidate=ancestry[0],ancestry=ancestry.slice(1)):parentCandidate=parentRequired;else if(ancestor)parentCandidate=ancestry[0],ancestry=ancestry.slice(1);else if(!siblings)return elm;return parentCandidate&&(parent=createElement(parentCandidate)).appendChild(elm),siblings&&(parent||(parent=dom.create("div")).appendChild(elm),Tools.each(siblings,(function(sibling){var siblingElm=createElement(sibling);parent.insertBefore(siblingElm,elm)}))),wrapInHtml(parent,ancestry,parentCandidate&&parentCandidate.siblings)};return ancestry&&ancestry.length?(item=ancestry[0],elm=createElement(item),(fragment=dom.create("div")).appendChild(wrapInHtml(elm,ancestry.slice(1),item.siblings)),fragment):""},parseSelectorItem=function(item){var tagName,obj={classes:[],attrs:{}};return"*"!==(item=obj.selector=Tools.trim(item))&&(tagName=item.replace(/(?:([#\.]|::?)([\w\-]+)|(\[)([^\]]+)\]?)/g,(function($0,$1,$2,$3,$4){switch($1){case"#":obj.attrs.id=$2;break;case".":obj.classes.push($2);break;case":":-1!==Tools.inArray("checked disabled enabled read-only required".split(" "),$2)&&(obj.attrs[$2]=$2)}if("["===$3){var m=$4.match(/([\w\-]+)(?:\=\"([^\"]+))?/);m&&(obj.attrs[m[1]]=m[2])}return""}))),obj.name=tagName||"div",obj},parseSelector=function(selector){return selector&&"string"==typeof selector?(selector=(selector=selector.split(/\s*,\s*/)[0]).replace(/\s*(~\+|~|\+|>)\s*/g,"$1"),Tools.map(selector.split(/(?:>|\s+(?![^\[\]]+\]))/),(function(item){var siblings=Tools.map(item.split(/(?:~\+|~|\+)/),parseSelectorItem),obj=siblings.pop();return siblings.length&&(obj.siblings=siblings),obj})).reverse()):[]},getCssText=function(editor,format){var name,previewFrag,previewCss="",parentFontSize,previewStyles=getPreviewStyles(editor);if(""===previewStyles)return"";var removeVars=function(val){return val.replace(/%(\w+)/g,"")};if("string"==typeof format){if(!(format=editor.formatter.get(format)))return;format=format[0]}if("preview"in format){var previewOpt=get$1(format,"preview");if(previewOpt.is(!1))return"";previewStyles=previewOpt.getOr(previewStyles)}name=format.block||format.inline||"span";var items=parseSelector(format.selector);items.length?(items[0].name||(items[0].name=name),name=format.selector,previewFrag=parsedSelectorToHtml(items,editor)):previewFrag=parsedSelectorToHtml([name],editor);var previewElm=dom.select(name,previewFrag)[0]||previewFrag.firstChild;return each$e(format.styles,(function(value,name){var newValue=removeVars(value);newValue&&dom.setStyle(previewElm,name,newValue)})),each$e(format.attributes,(function(value,name){var newValue=removeVars(value);newValue&&dom.setAttrib(previewElm,name,newValue)})),each$e(format.classes,(function(value){var newValue=removeVars(value);dom.hasClass(previewElm,newValue)||dom.addClass(previewElm,newValue)})),editor.fire("PreviewFormats"),dom.setStyles(previewFrag,{position:"absolute",left:-65535}),editor.getBody().appendChild(previewFrag),parentFontSize=dom.getStyle(editor.getBody(),"fontSize",!0),parentFontSize=/px$/.test(parentFontSize)?parseInt(parentFontSize,10):0,each$e(previewStyles.split(" "),(function(name){var value=dom.getStyle(previewElm,name,!0);if(!("background-color"===name&&/transparent|rgba\s*\([^)]+,\s*0\)/.test(value)&&(value=dom.getStyle(editor.getBody(),name,!0),"#ffffff"===dom.toHex(value).toLowerCase())||"color"===name&&"#000000"===dom.toHex(value).toLowerCase())){if("font-size"===name&&/em|%$/.test(value)){if(0===parentFontSize)return;var numValue;value=parseFloat(value)/(/%$/.test(value)?100:1)*parentFontSize+"px"}"border"===name&&value&&(previewCss+="padding:0 2px;"),previewCss+=name+":"+value+";"}})),editor.fire("AfterPreviewFormats"),dom.remove(previewFrag),previewCss},setup$6=function(editor){editor.addShortcut("meta+b","","Bold"),editor.addShortcut("meta+i","","Italic"),editor.addShortcut("meta+u","","Underline");for(var i=1;i<=6;i++)editor.addShortcut("access+"+i,"",["FormatBlock",!1,"h"+i]);editor.addShortcut("access+7","",["FormatBlock",!1,"p"]),editor.addShortcut("access+8","",["FormatBlock",!1,"div"]),editor.addShortcut("access+9","",["FormatBlock",!1,"address"])},Formatter=function(editor){var formats=FormatRegistry(editor),formatChangeState=Cell(null);return setup$6(editor),setup$3(editor),{get:formats.get,has:formats.has,register:formats.register,unregister:formats.unregister,apply:function(name,vars,node){applyFormat$1(editor,name,vars,node)},remove:function(name,vars,node,similar){removeFormat$1(editor,name,vars,node,similar)},toggle:function(name,vars,node){toggleFormat(editor,name,vars,node)},match:function(name,vars,node){return matchFormat(editor,name,vars,node)},closest:function(names){return closestFormat(editor,names)},matchAll:function(names,vars){return matchAllFormats(editor,names,vars)},matchNode:function(node,names,vars,similar){return matchNodeFormat(editor,node,names,vars,similar)},canApply:function(name){return canApplyFormat(editor,name)},formatChanged:function(formats,callback,similar){return formatChanged(editor,formatChangeState,formats,callback,similar)},getCssText:curry(getCssText,editor)}},registerEvents$1=function(editor,undoManager,locks){var isFirstTypedCharacter=Cell(!1),addNonTypingUndoLevel=function(e){setTyping(undoManager,!1,locks),undoManager.add({},e)};editor.on("init",(function(){undoManager.add()})),editor.on("BeforeExecCommand",(function(e){var cmd=e.command.toLowerCase();"undo"!==cmd&&"redo"!==cmd&&"mcerepaint"!==cmd&&(endTyping(undoManager,locks),undoManager.beforeChange())})),editor.on("ExecCommand",(function(e){var cmd=e.command.toLowerCase();"undo"!==cmd&&"redo"!==cmd&&"mcerepaint"!==cmd&&addNonTypingUndoLevel(e)})),editor.on("ObjectResizeStart cut",(function(){undoManager.beforeChange()})),editor.on("SaveContent ObjectResized blur",addNonTypingUndoLevel),editor.on("dragend",addNonTypingUndoLevel),editor.on("keyup",(function(e){var keyCode=e.keyCode;e.isDefaultPrevented()||((keyCode>=33&&keyCode<=36||keyCode>=37&&keyCode<=40||45===keyCode||e.ctrlKey)&&(addNonTypingUndoLevel(),editor.nodeChanged()),46!==keyCode&&8!==keyCode||editor.nodeChanged(),isFirstTypedCharacter.get()&&undoManager.typing&&!1===isEq$4(createFromEditor(editor),undoManager.data[0])&&(!1===editor.isDirty()&&(editor.setDirty(!0),editor.fire("change",{level:undoManager.data[0],lastLevel:null})),editor.fire("TypingUndo"),isFirstTypedCharacter.set(!1),editor.nodeChanged()))})),editor.on("keydown",(function(e){var keyCode=e.keyCode;if(!e.isDefaultPrevented())if(keyCode>=33&&keyCode<=36||keyCode>=37&&keyCode<=40||45===keyCode)undoManager.typing&&addNonTypingUndoLevel(e);else{var modKey=e.ctrlKey&&!e.altKey||e.metaKey;!(keyCode<16||keyCode>20)||224===keyCode||91===keyCode||undoManager.typing||modKey||(undoManager.beforeChange(),setTyping(undoManager,!0,locks),undoManager.add({},e),isFirstTypedCharacter.set(!0))}})),editor.on("mousedown",(function(e){undoManager.typing&&addNonTypingUndoLevel(e)}));var isInsertReplacementText=function(event){return"insertReplacementText"===event.inputType},isInsertTextDataNull=function(event){return"insertText"===event.inputType&&null===event.data},isInsertFromPasteOrDrop=function(event){return"insertFromPaste"===event.inputType||"insertFromDrop"===event.inputType};editor.on("input",(function(e){e.inputType&&(isInsertReplacementText(e)||isInsertTextDataNull(e)||isInsertFromPasteOrDrop(e))&&addNonTypingUndoLevel(e)})),editor.on("AddUndo Undo Redo ClearUndos",(function(e){e.isDefaultPrevented()||editor.nodeChanged()}))},addKeyboardShortcuts=function(editor){editor.addShortcut("meta+z","","Undo"),editor.addShortcut("meta+y,meta+shift+z","","Redo")},UndoManager=function(editor){var beforeBookmark=Cell(Optional.none()),locks=Cell(0),index=Cell(0),undoManager={data:[],typing:!1,beforeChange:function(){beforeChange$1(editor,locks,beforeBookmark)},add:function(level,event){return addUndoLevel$1(editor,undoManager,index,locks,beforeBookmark,level,event)},undo:function(){return undo$1(editor,undoManager,locks,index)},redo:function(){return redo$1(editor,index,undoManager.data)},clear:function(){clear$1(editor,undoManager,index)},reset:function(){reset$1(editor,undoManager)},hasUndo:function(){return hasUndo$1(editor,undoManager,index)},hasRedo:function(){return hasRedo$1(editor,undoManager,index)},transact:function(callback){return transact$1(editor,undoManager,locks,callback)},ignore:function(callback){ignore$1(editor,locks,callback)},extra:function(callback1,callback2){extra$1(editor,undoManager,index,callback1,callback2)}};return isRtc(editor)||registerEvents$1(editor,undoManager,locks),addKeyboardShortcuts(editor),undoManager},nonTypingKeycodes=[9,27,VK.HOME,VK.END,19,20,44,144,145,33,34,45,16,17,18,91,92,93,VK.DOWN,VK.UP,VK.LEFT,VK.RIGHT].concat(Env.browser.isFirefox()?[224]:[]),placeholderAttr="data-mce-placeholder",isKeyboardEvent=function(e){return"keydown"===e.type||"keyup"===e.type},isDeleteEvent=function(e){var keyCode=e.keyCode;return keyCode===VK.BACKSPACE||keyCode===VK.DELETE},isNonTypingKeyboardEvent=function(e){if(isKeyboardEvent(e)){var keyCode=e.keyCode;return!isDeleteEvent(e)&&(VK.metaKeyPressed(e)||e.altKey||keyCode>=112&&keyCode<=123||contains(nonTypingKeycodes,keyCode))}return!1},isTypingKeyboardEvent=function(e){return isKeyboardEvent(e)&&!(isDeleteEvent(e)||"keyup"===e.type&&229===e.keyCode)},isVisuallyEmpty=function(dom,rootElm,forcedRootBlock){if(isEmpty(SugarElement.fromDom(rootElm),!1)){var isForcedRootBlockFalse=""===forcedRootBlock,firstElement=rootElm.firstElementChild;return!firstElement||!dom.getStyle(rootElm.firstElementChild,"padding-left")&&!dom.getStyle(rootElm.firstElementChild,"padding-right")&&(isForcedRootBlockFalse?!dom.isBlock(firstElement):forcedRootBlock===firstElement.nodeName.toLowerCase())}return!1},setup$7=function(editor){var dom=editor.dom,rootBlock=getForcedRootBlock(editor),placeholder=getPlaceholder(editor),mailtype="",updatePlaceholder=function(e,initial){if(!isNonTypingKeyboardEvent(e)){var body=editor.getBody(),showPlaceholder=!isTypingKeyboardEvent(e)&&isVisuallyEmpty(dom,body,rootBlock),isPlaceholderShown;initial&&(showPlaceholder=!0),(""!==dom.getAttrib(body,placeholderAttr)!==showPlaceholder||initial)&&(dom.setAttrib(body,placeholderAttr,showPlaceholder?placeholder:null),dom.setAttrib(body,"aria-placeholder",showPlaceholder?placeholder:null),firePlaceholderToggle(editor,showPlaceholder),editor.on(showPlaceholder?"keydown":"keyup",updatePlaceholder),editor.off(showPlaceholder?"keyup":"keydown",updatePlaceholder))}};placeholder&&editor.on("init",(function(e){updatePlaceholder(e,!0),editor.on("delete input",updatePlaceholder),editor.on("BeforeExecCommand",(function(e){var cmd=e.command.toLowerCase();["insertunorderedlist","insertorderedlist","mceinsertcontent","setcontent"].includes(cmd)&&updatePlaceholder(e)})),editor.on("paste",(function(e){return Delay.setEditorTimeout(editor,(function(){return updatePlaceholder(e)}))})),editor.on("updatePlaceholder",(function(e){var show=e.show,body=editor.getBody();dom.setAttrib(body,placeholderAttr,show?placeholder:null),dom.setAttrib(body,"aria-placeholder",show?placeholder:null)}))}))},strongRtl=/[\u0591-\u07FF\uFB1D-\uFDFF\uFE70-\uFEFC]/,hasStrongRtl=function(text){return strongRtl.test(text)},isInlineTarget=function(editor,elm){return is$1(SugarElement.fromDom(elm),getInlineBoundarySelector(editor))},isRtl$1=function(element){return"rtl"===DOMUtils.DOM.getStyle(element,"direction",!0)||hasStrongRtl(element.textContent)},findInlineParents=function(isInlineTarget,rootNode,pos){return filter(DOMUtils.DOM.getParents(pos.container(),"*",rootNode),isInlineTarget)},findRootInline=function(isInlineTarget,rootNode,pos){var parents=findInlineParents(isInlineTarget,rootNode,pos);return Optional.from(parents[parents.length-1])},hasSameParentBlock=function(rootNode,node1,node2){var block1=getParentBlock(node1,rootNode),block2=getParentBlock(node2,rootNode);return block1&&block1===block2},isAtZwsp=function(pos){return isBeforeInline(pos)||isAfterInline(pos)},normalizePosition=function(forward,pos){if(!pos)return pos;var container=pos.container(),offset=pos.offset();return forward?isCaretContainerInline(container)?isText$1(container.nextSibling)?CaretPosition(container.nextSibling,0):CaretPosition.after(container):isBeforeInline(pos)?CaretPosition(container,offset+1):pos:isCaretContainerInline(container)?isText$1(container.previousSibling)?CaretPosition(container.previousSibling,container.previousSibling.data.length):CaretPosition.before(container):isAfterInline(pos)?CaretPosition(container,offset-1):pos},normalizeForwards=curry(normalizePosition,!0),normalizeBackwards=curry(normalizePosition,!1),isBeforeRoot=function(rootNode){return function(elm){return eq$2(rootNode,SugarElement.fromDom(elm.dom.parentNode))}},getParentBlock$1=function(rootNode,elm){return contains$2(rootNode,elm)?closest(elm,(function(element){return isTextBlock(element)||isListItem(element)}),isBeforeRoot(rootNode)):Optional.none()},placeCaretInEmptyBody=function(editor){var body=editor.getBody(),node=body.firstChild&&editor.dom.isBlock(body.firstChild)?body.firstChild:body;editor.selection.setCursorLocation(node,0)},paddEmptyBody=function(editor){editor.dom.isEmpty(editor.getBody())&&(editor.setContent(""),placeCaretInEmptyBody(editor))},willDeleteLastPositionInElement=function(forward,fromPos,elm){return lift2(firstPositionIn(elm),lastPositionIn(elm),(function(firstPos,lastPos){var normalizedFirstPos=normalizePosition(!0,firstPos),normalizedLastPos=normalizePosition(!1,lastPos),normalizedFromPos=normalizePosition(!1,fromPos);return forward?nextPosition(elm,normalizedFromPos).exists((function(nextPos){return nextPos.isEqual(normalizedLastPos)&&fromPos.isEqual(normalizedFirstPos)})):prevPosition(elm,normalizedFromPos).exists((function(prevPos){return prevPos.isEqual(normalizedFirstPos)&&fromPos.isEqual(normalizedLastPos)}))})).getOr(!0)},blockPosition=function(block,position){return{block:block,position:position}},blockBoundary=function(from,to){return{from:from,to:to}},getBlockPosition=function(rootNode,pos){var rootElm=SugarElement.fromDom(rootNode),containerElm=SugarElement.fromDom(pos.container());return getParentBlock$1(rootElm,containerElm).map((function(block){return blockPosition(block,pos)}))},isDifferentBlocks=function(blockBoundary){return!1===eq$2(blockBoundary.from.block,blockBoundary.to.block)},hasSameParent=function(blockBoundary){return parent(blockBoundary.from.block).bind((function(parent1){return parent(blockBoundary.to.block).filter((function(parent2){return eq$2(parent1,parent2)}))})).isSome()},isEditable=function(blockBoundary){return!1===isContentEditableFalse(blockBoundary.from.block.dom)&&!1===isContentEditableFalse(blockBoundary.to.block.dom)},skipLastBr=function(rootNode,forward,blockPosition){return isBr(blockPosition.position.getNode())&&!1===isEmpty(blockPosition.block)?positionIn(!1,blockPosition.block.dom).bind((function(lastPositionInBlock){return lastPositionInBlock.isEqual(blockPosition.position)?fromPosition(forward,rootNode,lastPositionInBlock).bind((function(to){return getBlockPosition(rootNode,to)})):Optional.some(blockPosition)})).getOr(blockPosition):blockPosition},readFromRange=function(rootNode,forward,rng){var fromBlockPos=getBlockPosition(rootNode,CaretPosition.fromRangeStart(rng)),toBlockPos=fromBlockPos.bind((function(blockPos){return fromPosition(forward,rootNode,blockPos.position).bind((function(to){return getBlockPosition(rootNode,to).map((function(blockPos){return skipLastBr(rootNode,forward,blockPos)}))}))}));return lift2(fromBlockPos,toBlockPos,blockBoundary).filter((function(blockBoundary){return isDifferentBlocks(blockBoundary)&&hasSameParent(blockBoundary)&&isEditable(blockBoundary)}))},read$3=function(rootNode,forward,rng){return rng.collapsed?readFromRange(rootNode,forward,rng):Optional.none()},getChildrenUntilBlockBoundary=function(block){var children$1=children(block);return findIndex(children$1,isBlock).fold((function(){return children$1}),(function(index){return children$1.slice(0,index)}))},extractChildren=function(block){var children=getChildrenUntilBlockBoundary(block);return each(children,remove),children},removeEmptyRoot=function(rootNode,block){var parents=parentsAndSelf(block,rootNode);return find(parents.reverse(),(function(element){return isEmpty(element)})).each(remove)},isEmptyBefore=function(el){return 0===filter(prevSiblings(el),(function(el){return!isEmpty(el)})).length},nestedBlockMerge=function(rootNode,fromBlock,toBlock,insertionPoint){if(isEmpty(toBlock))return fillWithPaddingBr(toBlock),firstPositionIn(toBlock.dom);isEmptyBefore(insertionPoint)&&isEmpty(fromBlock)&&before(insertionPoint,SugarElement.fromTag("br"));var position=prevPosition(toBlock.dom,CaretPosition.before(insertionPoint.dom));return each(extractChildren(fromBlock),(function(child){before(insertionPoint,child)})),removeEmptyRoot(rootNode,fromBlock),position},sidelongBlockMerge=function(rootNode,fromBlock,toBlock){if(isEmpty(toBlock))return remove(toBlock),isEmpty(fromBlock)&&fillWithPaddingBr(fromBlock),firstPositionIn(fromBlock.dom);var position=lastPositionIn(toBlock.dom);return each(extractChildren(fromBlock),(function(child){append(toBlock,child)})),removeEmptyRoot(rootNode,fromBlock),position},findInsertionPoint=function(toBlock,block){var parentsAndSelf$1=parentsAndSelf(block,toBlock);return Optional.from(parentsAndSelf$1[parentsAndSelf$1.length-1])},getInsertionPoint=function(fromBlock,toBlock){return contains$2(toBlock,fromBlock)?findInsertionPoint(toBlock,fromBlock):Optional.none()},trimBr=function(first,block){positionIn(first,block.dom).map((function(position){return position.getNode()})).map(SugarElement.fromDom).filter(isBr$1).each(remove)},mergeBlockInto=function(rootNode,fromBlock,toBlock){return trimBr(!0,fromBlock),trimBr(!1,toBlock),getInsertionPoint(fromBlock,toBlock).fold(curry(sidelongBlockMerge,rootNode,fromBlock,toBlock),curry(nestedBlockMerge,rootNode,fromBlock,toBlock))},mergeBlocks=function(rootNode,forward,block1,block2){return forward?mergeBlockInto(rootNode,block2,block1):mergeBlockInto(rootNode,block1,block2)},backspaceDelete$1=function(editor,forward){var rootNode=SugarElement.fromDom(editor.getBody()),position=read$3(rootNode.dom,forward,editor.selection.getRng()).bind((function(blockBoundary){return mergeBlocks(rootNode,forward,blockBoundary.from.block,blockBoundary.to.block)}));return position.each((function(pos){editor.selection.setRng(pos.toRange())})),position.isSome()},deleteRangeMergeBlocks=function(rootNode,selection){var rng=selection.getRng();return lift2(getParentBlock$1(rootNode,SugarElement.fromDom(rng.startContainer)),getParentBlock$1(rootNode,SugarElement.fromDom(rng.endContainer)),(function(block1,block2){return!1===eq$2(block1,block2)&&(rng.deleteContents(),mergeBlocks(rootNode,!0,block1,block2).each((function(pos){selection.setRng(pos.toRange())})),!0)})).getOr(!1)},isRawNodeInTable=function(root,rawNode){var node=SugarElement.fromDom(rawNode),isRoot=curry(eq$2,root);return ancestor(node,isTableCell$1,isRoot).isSome()},isSelectionInTable=function(root,rng){return isRawNodeInTable(root,rng.startContainer)||isRawNodeInTable(root,rng.endContainer)},isEverythingSelected=function(root,rng){var noPrevious=prevPosition(root.dom,CaretPosition.fromRangeStart(rng)).isNone(),noNext=nextPosition(root.dom,CaretPosition.fromRangeEnd(rng)).isNone();return!isSelectionInTable(root,rng)&&noPrevious&&noNext},emptyEditor=function(editor){return editor.setContent(""),editor.selection.setCursorLocation(),!0},deleteRange$1=function(editor){var rootNode=SugarElement.fromDom(editor.getBody()),rng=editor.selection.getRng();return isEverythingSelected(rootNode,rng)?emptyEditor(editor):deleteRangeMergeBlocks(rootNode,editor.selection)},backspaceDelete$2=function(editor,_forward){return!editor.selection.isCollapsed()&&deleteRange$1(editor)},isContentEditableTrue$2=isContentEditableTrue,isContentEditableFalse$7=isContentEditableFalse,showCaret=function(direction,editor,node,before,scrollIntoView){return Optional.from(editor._selectionOverrides.showCaret(direction,node,before,scrollIntoView))},getNodeRange=function(node){var rng=node.ownerDocument.createRange();return rng.selectNode(node),rng},selectNode=function(editor,node){var e;return editor.fire("BeforeObjectSelected",{target:node}).isDefaultPrevented()?Optional.none():Optional.some(getNodeRange(node))},renderCaretAtRange=function(editor,range,scrollIntoView){var normalizedRange=normalizeRange(1,editor.getBody(),range),caretPosition=CaretPosition.fromRangeStart(normalizedRange),caretPositionNode=caretPosition.getNode();if(isInlineFakeCaretTarget(caretPositionNode))return showCaret(1,editor,caretPositionNode,!caretPosition.isAtEnd(),!1);var caretPositionBeforeNode=caretPosition.getNode(!0);if(isInlineFakeCaretTarget(caretPositionBeforeNode))return showCaret(1,editor,caretPositionBeforeNode,!1,!1);var ceRoot=editor.dom.getParent(caretPosition.getNode(),(function(node){return isContentEditableFalse$7(node)||isContentEditableTrue$2(node)}));return isInlineFakeCaretTarget(ceRoot)?showCaret(1,editor,ceRoot,!1,scrollIntoView):Optional.none()},renderRangeCaret=function(editor,range,scrollIntoView){return range.collapsed?renderCaretAtRange(editor,range,scrollIntoView).getOr(range):range},isBeforeBoundary=function(pos){return isBeforeContentEditableFalse(pos)||isBeforeMedia(pos)},isAfterBoundary=function(pos){return isAfterContentEditableFalse(pos)||isAfterMedia(pos)},trimEmptyTextNode$1=function(dom,node){isText$1(node)&&0===node.data.length&&dom.remove(node)},deleteContentAndShowCaret=function(editor,range,node,direction,forward,peekCaretPosition){return showCaret(direction,editor,peekCaretPosition.getNode(!forward),forward,!0).each((function(caretRange){if(range.collapsed){var deleteRange=range.cloneRange();forward?deleteRange.setEnd(caretRange.startContainer,caretRange.startOffset):deleteRange.setStart(caretRange.endContainer,caretRange.endOffset),deleteRange.deleteContents()}else range.deleteContents();editor.selection.setRng(caretRange)})),trimEmptyTextNode$1(editor.dom,node),!0},deleteBoundaryText=function(editor,forward){var range=editor.selection.getRng();if(!isText$1(range.commonAncestorContainer))return!1;var direction=forward?HDirection.Forwards:HDirection.Backwards,caretWalker=CaretWalker(editor.getBody()),getNextPosFn=curry(getVisualCaretPosition,forward?caretWalker.next:caretWalker.prev),isBeforeFn=forward?isBeforeBoundary:isAfterBoundary,caretPosition=getNormalizedRangeEndPoint(direction,editor.getBody(),range),nextCaretPosition=normalizePosition(forward,getNextPosFn(caretPosition));if(!nextCaretPosition||!isMoveInsideSameBlock(caretPosition,nextCaretPosition))return!1;if(isBeforeFn(nextCaretPosition))return deleteContentAndShowCaret(editor,range,caretPosition.getNode(),direction,forward,nextCaretPosition);var peekCaretPosition=getNextPosFn(nextCaretPosition);return!!(peekCaretPosition&&isBeforeFn(peekCaretPosition)&&isMoveInsideSameBlock(nextCaretPosition,peekCaretPosition))&&deleteContentAndShowCaret(editor,range,caretPosition.getNode(),direction,forward,peekCaretPosition)},backspaceDelete$3=function(editor,forward){return deleteBoundaryText(editor,forward)},isCompoundElement=function(node){return isTableCell$1(SugarElement.fromDom(node))||isListItem(SugarElement.fromDom(node))},DeleteAction=Adt_generate([{remove:["element"]},{moveToElement:["element"]},{moveToPosition:["position"]}]),isAtContentEditableBlockCaret=function(forward,from){var elm=from.getNode(!1===forward),caretLocation=forward?"after":"before";return isElement$1(elm)&&elm.getAttribute("data-mce-caret")===caretLocation},isDeleteFromCefDifferentBlocks=function(root,forward,from,to){var inSameBlock=function(elm){return isInline(SugarElement.fromDom(elm))&&!isInSameBlock(from,to,root)};return getRelativeCefElm(!forward,from).fold((function(){return getRelativeCefElm(forward,to).fold(never,inSameBlock)}),inSameBlock)},deleteEmptyBlockOrMoveToCef=function(root,forward,from,to){var toCefElm=to.getNode(!1===forward);return getParentBlock$1(SugarElement.fromDom(root),SugarElement.fromDom(from.getNode())).map((function(blockElm){return isEmpty(blockElm)?DeleteAction.remove(blockElm.dom):DeleteAction.moveToElement(toCefElm)})).orThunk((function(){return Optional.some(DeleteAction.moveToElement(toCefElm))}))},findCefPosition=function(root,forward,from){return fromPosition(forward,root,from).bind((function(to){return isCompoundElement(to.getNode())?Optional.none():isDeleteFromCefDifferentBlocks(root,forward,from,to)?Optional.none():forward&&isContentEditableFalse(to.getNode())?deleteEmptyBlockOrMoveToCef(root,forward,from,to):!1===forward&&isContentEditableFalse(to.getNode(!0))?deleteEmptyBlockOrMoveToCef(root,forward,from,to):forward&&isAfterContentEditableFalse(from)?Optional.some(DeleteAction.moveToPosition(to)):!1===forward&&isBeforeContentEditableFalse(from)?Optional.some(DeleteAction.moveToPosition(to)):Optional.none()}))},getContentEditableBlockAction=function(forward,elm){return forward&&isContentEditableFalse(elm.nextSibling)?Optional.some(DeleteAction.moveToElement(elm.nextSibling)):!1===forward&&isContentEditableFalse(elm.previousSibling)?Optional.some(DeleteAction.moveToElement(elm.previousSibling)):Optional.none()},skipMoveToActionFromInlineCefToContent=function(root,from,deleteAction){return deleteAction.fold((function(elm){return Optional.some(DeleteAction.remove(elm))}),(function(elm){return Optional.some(DeleteAction.moveToElement(elm))}),(function(to){return isInSameBlock(from,to,root)?Optional.none():Optional.some(DeleteAction.moveToPosition(to))}))},getContentEditableAction=function(root,forward,from){return isAtContentEditableBlockCaret(forward,from)?getContentEditableBlockAction(forward,from.getNode(!1===forward)).fold((function(){return findCefPosition(root,forward,from)}),Optional.some):findCefPosition(root,forward,from).bind((function(deleteAction){return skipMoveToActionFromInlineCefToContent(root,from,deleteAction)}))},read$4=function(root,forward,rng){var normalizedRange=normalizeRange(forward?1:-1,root,rng),from=CaretPosition.fromRangeStart(normalizedRange),rootElement=SugarElement.fromDom(root);return!1===forward&&isAfterContentEditableFalse(from)?Optional.some(DeleteAction.remove(from.getNode(!0))):forward&&isBeforeContentEditableFalse(from)?Optional.some(DeleteAction.remove(from.getNode())):!1===forward&&isBeforeContentEditableFalse(from)&&isAfterBr(rootElement,from)?findPreviousBr(rootElement,from).map((function(br){return DeleteAction.remove(br.getNode())})):forward&&isAfterContentEditableFalse(from)&&isBeforeBr(rootElement,from)?findNextBr(rootElement,from).map((function(br){return DeleteAction.remove(br.getNode())})):getContentEditableAction(root,forward,from)},deleteElement$1=function(editor,forward){return function(element){return editor._selectionOverrides.hideFakeCaret(),deleteElement(editor,forward,SugarElement.fromDom(element)),!0}},moveToElement=function(editor,forward){return function(element){var pos=forward?CaretPosition.before(element):CaretPosition.after(element);return editor.selection.setRng(pos.toRange()),!0}},moveToPosition=function(editor){return function(pos){return editor.selection.setRng(pos.toRange()),!0}},getAncestorCe=function(editor,node){return Optional.from(getContentEditableRoot(editor.getBody(),node))},backspaceDeleteCaret=function(editor,forward){var selectedNode=editor.selection.getNode();return getAncestorCe(editor,selectedNode).filter(isContentEditableFalse).fold((function(){return read$4(editor.getBody(),forward,editor.selection.getRng()).exists((function(deleteAction){return deleteAction.fold(deleteElement$1(editor,forward),moveToElement(editor,forward),moveToPosition(editor))}))}),always)},deleteOffscreenSelection=function(rootElement){each(descendants$1(rootElement,".mce-offscreen-selection"),remove)},backspaceDeleteRange=function(editor,forward){var selectedNode=editor.selection.getNode(),hasCefAncestor;return!!isContentEditableFalse(selectedNode)&&getAncestorCe(editor,selectedNode.parentNode).filter(isContentEditableFalse).fold((function(){return deleteOffscreenSelection(SugarElement.fromDom(editor.getBody())),deleteElement(editor,forward,SugarElement.fromDom(editor.selection.getNode())),paddEmptyBody(editor),!0}),always)},paddEmptyElement=function(editor){var dom=editor.dom,selection=editor.selection,ceRoot=getContentEditableRoot(editor.getBody(),selection.getNode());if(isContentEditableTrue(ceRoot)&&dom.isBlock(ceRoot)&&dom.isEmpty(ceRoot)){var br=dom.create("br",{"data-mce-bogus":"1"});dom.setHTML(ceRoot,""),ceRoot.appendChild(br),selection.setRng(CaretPosition.before(br).toRange())}return!0},backspaceDelete$4=function(editor,forward){return editor.selection.isCollapsed()?backspaceDeleteCaret(editor,forward):backspaceDeleteRange(editor,forward)},deleteCaret$1=function(editor,forward){var fromPos=CaretPosition.fromRangeStart(editor.selection.getRng());return fromPosition(forward,editor.getBody(),fromPos).filter((function(pos){return forward?isBeforeImageBlock(pos):isAfterImageBlock(pos)})).bind((function(pos){return Optional.from(getChildNodeAtRelativeOffset(forward?0:-1,pos))})).exists((function(elm){return editor.selection.select(elm),!0}))},backspaceDelete$5=function(editor,forward){return!!editor.selection.isCollapsed()&&deleteCaret$1(editor,forward)},isText$8=isText$1,startsWithCaretContainer$1=function(node){return isText$8(node)&&node.data[0]===ZWSP},endsWithCaretContainer$1=function(node){return isText$8(node)&&node.data[node.data.length-1]===ZWSP},createZwsp=function(node){return node.ownerDocument.createTextNode(ZWSP)},insertBefore$1=function(node){if(isText$8(node.previousSibling))return endsWithCaretContainer$1(node.previousSibling)?node.previousSibling:(node.previousSibling.appendData(ZWSP),node.previousSibling);if(isText$8(node))return startsWithCaretContainer$1(node)?node:(node.insertData(0,ZWSP),node);var newNode=createZwsp(node);return node.parentNode.insertBefore(newNode,node),newNode},insertAfter$1=function(node){if(isText$8(node.nextSibling))return startsWithCaretContainer$1(node.nextSibling)?node.nextSibling:(node.nextSibling.insertData(0,ZWSP),node.nextSibling);if(isText$8(node))return endsWithCaretContainer$1(node)?node:(node.appendData(ZWSP),node);var newNode=createZwsp(node);return node.nextSibling?node.parentNode.insertBefore(newNode,node.nextSibling):node.parentNode.appendChild(newNode),newNode},insertInline$1=function(before,node){return before?insertBefore$1(node):insertAfter$1(node)},insertInlineBefore=curry(insertInline$1,!0),insertInlineAfter=curry(insertInline$1,!1),insertInlinePos=function(pos,before){return isText$1(pos.container())?insertInline$1(before,pos.container()):insertInline$1(before,pos.getNode())},isPosCaretContainer=function(pos,caret){var caretNode=caret.get();return caretNode&&pos.container()===caretNode&&isCaretContainerInline(caretNode)},renderCaret=function(caret,location){return location.fold((function(element){remove$5(caret.get());var text=insertInlineBefore(element);return caret.set(text),Optional.some(CaretPosition(text,text.length-1))}),(function(element){return firstPositionIn(element).map((function(pos){if(isPosCaretContainer(pos,caret))return CaretPosition(caret.get(),1);remove$5(caret.get());var text=insertInlinePos(pos,!0);return caret.set(text),CaretPosition(text,1)}))}),(function(element){return lastPositionIn(element).map((function(pos){if(isPosCaretContainer(pos,caret))return CaretPosition(caret.get(),caret.get().length-1);remove$5(caret.get());var text=insertInlinePos(pos,!1);return caret.set(text),CaretPosition(text,text.length-1)}))}),(function(element){remove$5(caret.get());var text=insertInlineAfter(element);return caret.set(text),Optional.some(CaretPosition(text,1))}))},evaluateUntil=function(fns,args){for(var i=0;i<fns.length;i++){var result=fns[i].apply(null,args);if(result.isSome())return result}return Optional.none()},Location=Adt_generate([{before:["element"]},{start:["element"]},{end:["element"]},{after:["element"]}]),rescope=function(rootNode,node){var parentBlock=getParentBlock(node,rootNode);return parentBlock||rootNode},before$4=function(isInlineTarget,rootNode,pos){var nPos=normalizeForwards(pos),scope=rescope(rootNode,nPos.container());return findRootInline(isInlineTarget,scope,nPos).fold((function(){return nextPosition(scope,nPos).bind(curry(findRootInline,isInlineTarget,scope)).map((function(inline){return Location.before(inline)}))}),Optional.none)},isNotInsideFormatCaretContainer=function(rootNode,elm){return null===getParentCaretContainer(rootNode,elm)},findInsideRootInline=function(isInlineTarget,rootNode,pos){return findRootInline(isInlineTarget,rootNode,pos).filter(curry(isNotInsideFormatCaretContainer,rootNode))},start=function(isInlineTarget,rootNode,pos){var nPos=normalizeBackwards(pos);return findInsideRootInline(isInlineTarget,rootNode,nPos).bind((function(inline){var prevPos;return prevPosition(inline,nPos).isNone()?Optional.some(Location.start(inline)):Optional.none()}))},end=function(isInlineTarget,rootNode,pos){var nPos=normalizeForwards(pos);return findInsideRootInline(isInlineTarget,rootNode,nPos).bind((function(inline){var nextPos;return nextPosition(inline,nPos).isNone()?Optional.some(Location.end(inline)):Optional.none()}))},after$3=function(isInlineTarget,rootNode,pos){var nPos=normalizeBackwards(pos),scope=rescope(rootNode,nPos.container());return findRootInline(isInlineTarget,scope,nPos).fold((function(){return prevPosition(scope,nPos).bind(curry(findRootInline,isInlineTarget,scope)).map((function(inline){return Location.after(inline)}))}),Optional.none)},isValidLocation=function(location){return!1===isRtl$1(getElement(location))},readLocation=function(isInlineTarget,rootNode,pos){var location;return evaluateUntil([before$4,start,end,after$3],[isInlineTarget,rootNode,pos]).filter(isValidLocation)},getElement=function(location){return location.fold(identity,identity,identity,identity)},getName=function(location){return location.fold(constant("before"),constant("start"),constant("end"),constant("after"))},outside=function(location){return location.fold(Location.before,Location.before,Location.after,Location.after)},inside=function(location){return location.fold(Location.start,Location.start,Location.end,Location.end)},isEq$5=function(location1,location2){return getName(location1)===getName(location2)&&getElement(location1)===getElement(location2)},betweenInlines=function(forward,isInlineTarget,rootNode,from,to,location){return lift2(findRootInline(isInlineTarget,rootNode,from),findRootInline(isInlineTarget,rootNode,to),(function(fromInline,toInline){return fromInline!==toInline&&hasSameParentBlock(rootNode,fromInline,toInline)?Location.after(forward?fromInline:toInline):location})).getOr(location)},skipNoMovement=function(fromLocation,toLocation){return fromLocation.fold(always,(function(fromLocation){return!isEq$5(fromLocation,toLocation)}))},findLocationTraverse=function(forward,isInlineTarget,rootNode,fromLocation,pos){var from=normalizePosition(forward,pos),to,location;return fromPosition(forward,rootNode,from).map(curry(normalizePosition,forward)).fold((function(){return fromLocation.map(outside)}),(function(to){return readLocation(isInlineTarget,rootNode,to).map(curry(betweenInlines,forward,isInlineTarget,rootNode,from,to)).filter(curry(skipNoMovement,fromLocation))})).filter(isValidLocation)},findLocationSimple=function(forward,location){return forward?location.fold(compose(Optional.some,Location.start),Optional.none,compose(Optional.some,Location.after),Optional.none):location.fold(Optional.none,compose(Optional.some,Location.before),Optional.none,compose(Optional.some,Location.end))},findLocation=function(forward,isInlineTarget,rootNode,pos){var from=normalizePosition(forward,pos),fromLocation=readLocation(isInlineTarget,rootNode,from);return readLocation(isInlineTarget,rootNode,from).bind(curry(findLocationSimple,forward)).orThunk((function(){return findLocationTraverse(forward,isInlineTarget,rootNode,fromLocation,pos)}))},prevLocation=curry(findLocation,!1),nextLocation=curry(findLocation,!0),hasSelectionModifyApi=function(editor){return isFunction(editor.selection.getSel().modify)},moveRel=function(forward,selection,pos){var delta=forward?1:-1;return selection.setRng(CaretPosition(pos.container(),pos.offset()+delta).toRange()),selection.getSel().modify("move",forward?"forward":"backward","word"),!0},moveByWord=function(forward,editor){var rng=editor.selection.getRng(),pos=forward?CaretPosition.fromRangeEnd(rng):CaretPosition.fromRangeStart(rng);return!!hasSelectionModifyApi(editor)&&(forward&&isBeforeInline(pos)?moveRel(!0,editor.selection,pos):!(forward||!isAfterInline(pos))&&moveRel(!1,editor.selection,pos))},setCaretPosition=function(editor,pos){var rng=editor.dom.createRng();rng.setStart(pos.container(),pos.offset()),rng.setEnd(pos.container(),pos.offset()),editor.selection.setRng(rng)},setSelected=function(state,elm){state?elm.setAttribute("data-mce-selected","inline-boundary"):elm.removeAttribute("data-mce-selected")},renderCaretLocation=function(editor,caret,location){return renderCaret(caret,location).map((function(pos){return setCaretPosition(editor,pos),location}))},findLocation$1=function(editor,caret,forward){var rootNode=editor.getBody(),from=CaretPosition.fromRangeStart(editor.selection.getRng()),isInlineTarget$1=curry(isInlineTarget,editor),location;return findLocation(forward,isInlineTarget$1,rootNode,from).bind((function(location){return renderCaretLocation(editor,caret,location)}))},toggleInlines=function(isInlineTarget,dom,elms){var inlineBoundaries=map(descendants$1(SugarElement.fromDom(dom.getRoot()),'*[data-mce-selected="inline-boundary"]'),(function(e){return e.dom})),selectedInlines=filter(inlineBoundaries,isInlineTarget),targetInlines=filter(elms,isInlineTarget);each(difference(selectedInlines,targetInlines),curry(setSelected,!1)),each(difference(targetInlines,selectedInlines),curry(setSelected,!0))},safeRemoveCaretContainer=function(editor,caret){if(editor.selection.isCollapsed()&&!0!==editor.composing&&caret.get()){var pos=CaretPosition.fromRangeStart(editor.selection.getRng());CaretPosition.isTextPosition(pos)&&!1===isAtZwsp(pos)&&(setCaretPosition(editor,removeAndReposition(caret.get(),pos)),caret.set(null))}},renderInsideInlineCaret=function(isInlineTarget,editor,caret,elms){if(editor.selection.isCollapsed()){var inlines=filter(elms,isInlineTarget);each(inlines,(function(_inline){var pos=CaretPosition.fromRangeStart(editor.selection.getRng());readLocation(isInlineTarget,editor.getBody(),pos).bind((function(location){return renderCaretLocation(editor,caret,location)}))}))}},move=function(editor,caret,forward){return!!isInlineBoundariesEnabled(editor)&&findLocation$1(editor,caret,forward).isSome()},moveWord=function(forward,editor,_caret){return!!isInlineBoundariesEnabled(editor)&&moveByWord(forward,editor)},setupSelectedState=function(editor){var caret=Cell(null),isInlineTarget$1=curry(isInlineTarget,editor);return editor.on("NodeChange",(function(e){!isInlineBoundariesEnabled(editor)||Env.browser.isIE()&&e.initial||(toggleInlines(isInlineTarget$1,editor.dom,e.parents),safeRemoveCaretContainer(editor,caret),renderInsideInlineCaret(isInlineTarget$1,editor,caret,e.parents))})),caret},moveNextWord=curry(moveWord,!0),movePrevWord=curry(moveWord,!1),rangeFromPositions=function(from,to){var range=document.createRange();return range.setStart(from.container(),from.offset()),range.setEnd(to.container(),to.offset()),range},hasOnlyTwoOrLessPositionsLeft=function(elm){return lift2(firstPositionIn(elm),lastPositionIn(elm),(function(firstPos,lastPos){var normalizedFirstPos=normalizePosition(!0,firstPos),normalizedLastPos=normalizePosition(!1,lastPos);return nextPosition(elm,normalizedFirstPos).forall((function(pos){return pos.isEqual(normalizedLastPos)}))})).getOr(!0)},setCaretLocation=function(editor,caret){return function(location){return renderCaret(caret,location).exists((function(pos){return setCaretPosition(editor,pos),!0}))}},deleteFromTo=function(editor,caret,from,to){var rootNode=editor.getBody(),isInlineTarget$1=curry(isInlineTarget,editor);editor.undoManager.ignore((function(){editor.selection.setRng(rangeFromPositions(from,to)),editor.execCommand("Delete"),readLocation(isInlineTarget$1,rootNode,CaretPosition.fromRangeStart(editor.selection.getRng())).map(inside).map(setCaretLocation(editor,caret))})),editor.nodeChanged()},rescope$1=function(rootNode,node){var parentBlock=getParentBlock(node,rootNode);return parentBlock||rootNode},backspaceDeleteCollapsed=function(editor,caret,forward,from){var rootNode=rescope$1(editor.getBody(),from.container()),isInlineTarget$1=curry(isInlineTarget,editor),fromLocation=readLocation(isInlineTarget$1,rootNode,from);return fromLocation.bind((function(location){return forward?location.fold(constant(Optional.some(inside(location))),Optional.none,constant(Optional.some(outside(location))),Optional.none):location.fold(Optional.none,constant(Optional.some(outside(location))),Optional.none,constant(Optional.some(inside(location))))})).map(setCaretLocation(editor,caret)).getOrThunk((function(){var toPosition=navigate(forward,rootNode,from),toLocation=toPosition.bind((function(pos){return readLocation(isInlineTarget$1,rootNode,pos)}));return lift2(fromLocation,toLocation,(function(){return findRootInline(isInlineTarget$1,rootNode,from).exists((function(elm){return!!hasOnlyTwoOrLessPositionsLeft(elm)&&(deleteElement(editor,forward,SugarElement.fromDom(elm)),!0)}))})).orThunk((function(){return toLocation.bind((function(_){return toPosition.map((function(to){return forward?deleteFromTo(editor,caret,from,to):deleteFromTo(editor,caret,to,from),!0}))}))})).getOr(!1)}))},backspaceDelete$6=function(editor,caret,forward){if(editor.selection.isCollapsed()&&isInlineBoundariesEnabled(editor)){var from=CaretPosition.fromRangeStart(editor.selection.getRng());return backspaceDeleteCollapsed(editor,caret,forward,from)}return!1},getParentInlines=function(rootElm,startElm){var parents=parentsAndSelf(startElm,rootElm);return findIndex(parents,isBlock).fold(constant(parents),(function(index){return parents.slice(0,index)}))},hasOnlyOneChild$1=function(elm){return 1===children(elm).length},deleteLastPosition=function(forward,editor,target,parentInlines){var isFormatElement$1=curry(isFormatElement,editor),formatNodes=map(filter(parentInlines,isFormatElement$1),(function(elm){return elm.dom}));if(0===formatNodes.length)deleteElement(editor,forward,target);else{var pos=replaceWithCaretFormat(target.dom,formatNodes);editor.selection.setRng(pos.toRange())}},deleteCaret$2=function(editor,forward){var rootElm=SugarElement.fromDom(editor.getBody()),startElm=SugarElement.fromDom(editor.selection.getStart()),parentInlines=filter(getParentInlines(rootElm,startElm),hasOnlyOneChild$1);return last(parentInlines).exists((function(target){var fromPos=CaretPosition.fromRangeStart(editor.selection.getRng());return!(!willDeleteLastPositionInElement(forward,fromPos,target.dom)||isEmptyCaretFormatElement(target))&&(deleteLastPosition(forward,editor,target,parentInlines),!0)}))},backspaceDelete$7=function(editor,forward){return!!editor.selection.isCollapsed()&&deleteCaret$2(editor,forward)},deleteElement$2=function(editor,forward,element){return editor._selectionOverrides.hideFakeCaret(),deleteElement(editor,forward,SugarElement.fromDom(element)),!0},deleteCaret$3=function(editor,forward){var isNearMedia=forward?isBeforeMedia:isAfterMedia,direction=forward?HDirection.Forwards:HDirection.Backwards,fromPos=getNormalizedRangeEndPoint(direction,editor.getBody(),editor.selection.getRng());return isNearMedia(fromPos)?deleteElement$2(editor,forward,fromPos.getNode(!forward)):Optional.from(normalizePosition(forward,fromPos)).filter((function(pos){return isNearMedia(pos)&&isMoveInsideSameBlock(fromPos,pos)})).exists((function(pos){return deleteElement$2(editor,forward,pos.getNode(!forward))}))},deleteRange$2=function(editor,forward){var selectedNode=editor.selection.getNode();return!!isMedia(selectedNode)&&deleteElement$2(editor,forward,selectedNode)},backspaceDelete$8=function(editor,forward){return editor.selection.isCollapsed()?deleteCaret$3(editor,forward):deleteRange$2(editor,forward)},isEditable$1=function(target){return closest(target,(function(elm){return isContentEditableTrue(elm.dom)||isContentEditableFalse(elm.dom)})).exists((function(elm){return isContentEditableTrue(elm.dom)}))},parseIndentValue=function(value){var number=parseInt(value,10);return isNaN(number)?0:number},getIndentStyleName=function(useMargin,element){var indentStyleName,suffix;return(useMargin||isTable$1(element)?"margin":"padding")+("rtl"===get$5(element,"direction")?"-right":"-left")},indentElement=function(dom,command,useMargin,value,unit,element){var indentStyleName=getIndentStyleName(useMargin,SugarElement.fromDom(element));if("outdent"===command){var styleValue=Math.max(0,parseIndentValue(element.style[indentStyleName])-value);dom.setStyle(element,indentStyleName,styleValue?styleValue+unit:"")}else{var styleValue=parseIndentValue(element.style[indentStyleName])+value+unit;dom.setStyle(element,indentStyleName,styleValue)}},validateBlocks=function(editor,blocks){return forall(blocks,(function(block){var indentStyleName=getIndentStyleName(shouldIndentUseMargin(editor),block),intentValue=getRaw(block,indentStyleName).map(parseIndentValue).getOr(0),contentEditable;return"false"!==editor.dom.getContentEditable(block.dom)&&intentValue>0}))},canOutdent=function(editor){var blocks=getBlocksToIndent(editor);return!editor.mode.isReadOnly()&&(blocks.length>1||validateBlocks(editor,blocks))},isListComponent=function(el){return isList(el)||isListItem(el)},parentIsListComponent=function(el){return parent(el).map(isListComponent).getOr(!1)},getBlocksToIndent=function(editor){return filter(map(editor.selection.getSelectedBlocks(),SugarElement.fromDom),(function(el){return!isListComponent(el)&&!parentIsListComponent(el)&&isEditable$1(el)}))},handle=function(editor,command){var dom=editor.dom,selection=editor.selection,formatter=editor.formatter,indentation=getIndentation(editor),indentUnit=/[a-z%]+$/i.exec(indentation)[0],indentValue=parseInt(indentation,10),useMargin=shouldIndentUseMargin(editor),forcedRootBlock=getForcedRootBlock(editor);editor.queryCommandState("InsertUnorderedList")||editor.queryCommandState("InsertOrderedList")||""!==forcedRootBlock||dom.getParent(selection.getNode(),dom.isBlock)||formatter.apply("div"),each(getBlocksToIndent(editor),(function(block){indentElement(dom,command,useMargin,indentValue,indentUnit,block.dom)}))},backspaceDelete$9=function(editor,_forward){if(editor.selection.isCollapsed()&&canOutdent(editor)){var dom=editor.dom,rng=editor.selection.getRng(),pos=CaretPosition.fromRangeStart(rng),block=dom.getParent(rng.startContainer,dom.isBlock);if(null!==block&&isAtStartOfBlock(SugarElement.fromDom(block),pos))return handle(editor,"outdent"),!0}return!1},nativeCommand=function(editor,command){editor.getDoc().execCommand(command,!1,null)},deleteCommand=function(editor,caret){backspaceDelete$9(editor)||backspaceDelete$4(editor,!1)||backspaceDelete$3(editor,!1)||backspaceDelete$6(editor,caret,!1)||backspaceDelete$1(editor,!1)||backspaceDelete(editor)||backspaceDelete$5(editor,!1)||backspaceDelete$8(editor,!1)||backspaceDelete$2(editor)||backspaceDelete$7(editor,!1)||(nativeCommand(editor,"Delete"),paddEmptyBody(editor))},forwardDeleteCommand=function(editor,caret){backspaceDelete$4(editor,!0)||backspaceDelete$3(editor,!0)||backspaceDelete$6(editor,caret,!0)||backspaceDelete$1(editor,!0)||backspaceDelete(editor)||backspaceDelete$5(editor,!0)||backspaceDelete$8(editor,!0)||backspaceDelete$2(editor)||backspaceDelete$7(editor,!0)||nativeCommand(editor,"ForwardDelete")},setup$8=function(editor,caret){editor.addCommand("delete",(function(){deleteCommand(editor,caret)})),editor.addCommand("forwardDelete",(function(){forwardDeleteCommand(editor,caret)}))},SIGNIFICANT_MOVE=5,LONGPRESS_DELAY=400,getTouch=function(event){return void 0===event.touches||1!==event.touches.length?Optional.none():Optional.some(event.touches[0])},isFarEnough=function(touch,data){var distX=Math.abs(touch.clientX-data.x),distY=Math.abs(touch.clientY-data.y);return distX>5||distY>5},setup$9=function(editor){var startData=Cell(Optional.none()),longpressFired=Cell(!1),debounceLongpress=last$2((function(e){editor.fire("longpress",__assign(__assign({},e),{type:"longpress"})),longpressFired.set(!0)}),400);editor.on("touchstart",(function(e){getTouch(e).each((function(touch){debounceLongpress.cancel();var data={x:touch.clientX,y:touch.clientY,target:e.target};debounceLongpress.throttle(e),longpressFired.set(!1),startData.set(Optional.some(data))}))}),!0),editor.on("touchmove",(function(e){debounceLongpress.cancel(),getTouch(e).each((function(touch){startData.get().each((function(data){isFarEnough(touch,data)&&(startData.set(Optional.none()),longpressFired.set(!1),editor.fire("longpresscancel"))}))}))}),!0),editor.on("touchend touchcancel",(function(e){debounceLongpress.cancel(),"touchcancel"!==e.type&&startData.get().filter((function(data){return data.target.isEqualNode(e.target)})).each((function(){longpressFired.get()?e.preventDefault():editor.fire("tap",__assign(__assign({},e),{type:"tap"}))}))}),!0)},isBlockElement=function(blockElements,node){return blockElements.hasOwnProperty(node.nodeName)},isValidTarget=function(blockElements,node){return!!isText$1(node)||!!isElement$1(node)&&(!isBlockElement(blockElements,node)&&!isBookmarkNode$1(node))},hasBlockParent=function(blockElements,root,node){return exists(parents$1(SugarElement.fromDom(node),SugarElement.fromDom(root)),(function(elm){return isBlockElement(blockElements,elm.dom)}))},shouldRemoveTextNode=function(blockElements,node){if(isText$1(node)){if(0===node.nodeValue.length)return!0;if(/^\s+$/.test(node.nodeValue)&&(!node.nextSibling||isBlockElement(blockElements,node.nextSibling)))return!0}return!1},addRootBlocks=function(editor){var dom=editor.dom,selection=editor.selection,schema=editor.schema,blockElements=schema.getBlockElements(),node=selection.getStart(),rootNode=editor.getBody(),rootBlockNode,tempNode,wrapped,forcedRootBlock=getForcedRootBlock(editor);if(node&&isElement$1(node)&&forcedRootBlock){var rootNodeName=rootNode.nodeName.toLowerCase();if(schema.isValidChild(rootNodeName,forcedRootBlock.toLowerCase())&&!hasBlockParent(blockElements,rootNode,node)){var rng=selection.getRng(),startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset,restoreSelection=hasFocus$1(editor);for(node=rootNode.firstChild;node;)if(isValidTarget(blockElements,node)){if(shouldRemoveTextNode(blockElements,node)){tempNode=node,node=node.nextSibling,dom.remove(tempNode);continue}rootBlockNode||(rootBlockNode=dom.create(forcedRootBlock,getForcedRootBlockAttrs(editor)),node.parentNode.insertBefore(rootBlockNode,node),wrapped=!0),tempNode=node,node=node.nextSibling,rootBlockNode.appendChild(tempNode)}else rootBlockNode=null,node=node.nextSibling;wrapped&&restoreSelection&&(rng.setStart(startContainer,startOffset),rng.setEnd(endContainer,endOffset),selection.setRng(rng),editor.nodeChanged())}}},setup$a=function(editor){getForcedRootBlock(editor)&&editor.on("NodeChange",curry(addRootBlocks,editor))},findBlockCaretContainer=function(editor){return descendant(SugarElement.fromDom(editor.getBody()),"*[data-mce-caret]").fold(constant(null),(function(elm){return elm.dom}))},removeIeControlRect=function(editor){editor.selection.setRng(editor.selection.getRng())},showBlockCaretContainer=function(editor,blockCaretContainer){blockCaretContainer.hasAttribute("data-mce-caret")&&(showCaretContainerBlock(blockCaretContainer),removeIeControlRect(editor),editor.selection.scrollIntoView(blockCaretContainer))},handleBlockContainer=function(editor,e){var blockCaretContainer=findBlockCaretContainer(editor);if(blockCaretContainer)return"compositionstart"===e.type?(e.preventDefault(),e.stopPropagation(),void showBlockCaretContainer(editor,blockCaretContainer)):void(hasContent(blockCaretContainer)&&(showBlockCaretContainer(editor,blockCaretContainer),editor.undoManager.add()))},setup$b=function(editor){editor.on("keyup compositionstart",curry(handleBlockContainer,editor))},BreakType;!function(BreakType){BreakType[BreakType.Br=0]="Br",BreakType[BreakType.Block=1]="Block",BreakType[BreakType.Wrap=2]="Wrap",BreakType[BreakType.Eol=3]="Eol"}(BreakType||(BreakType={}));var flip=function(direction,positions){return direction===HDirection.Backwards?reverse(positions):positions},walk$3=function(direction,caretWalker,pos){return direction===HDirection.Forwards?caretWalker.next(pos):caretWalker.prev(pos)},getBreakType=function(scope,direction,currentPos,nextPos){return isBr(nextPos.getNode(direction===HDirection.Forwards))?BreakType.Br:!1===isInSameBlock(currentPos,nextPos)?BreakType.Block:BreakType.Wrap},getPositionsUntil=function(predicate,direction,scope,start){for(var caretWalker=CaretWalker(scope),currentPos=start,nextPos,positions=[];currentPos&&(nextPos=walk$3(direction,caretWalker,currentPos));){if(isBr(nextPos.getNode(!1)))return direction===HDirection.Forwards?{positions:flip(direction,positions).concat([nextPos]),breakType:BreakType.Br,breakAt:Optional.some(nextPos)}:{positions:flip(direction,positions),breakType:BreakType.Br,breakAt:Optional.some(nextPos)};if(nextPos.isVisible()){if(predicate(currentPos,nextPos)){var breakType=getBreakType(scope,direction,currentPos,nextPos);return{positions:flip(direction,positions),breakType:breakType,breakAt:Optional.some(nextPos)}}positions.push(nextPos),currentPos=nextPos}else currentPos=nextPos}return{positions:flip(direction,positions),breakType:BreakType.Eol,breakAt:Optional.none()}},getAdjacentLinePositions=function(direction,getPositionsUntilBreak,scope,start){return getPositionsUntilBreak(scope,start).breakAt.map((function(pos){var positions=getPositionsUntilBreak(scope,pos).positions;return direction===HDirection.Backwards?positions.concat(pos):[pos].concat(positions)})).getOr([])},findClosestHorizontalPositionFromPoint=function(positions,x){return foldl(positions,(function(acc,newPos){return acc.fold((function(){return Optional.some(newPos)}),(function(lastPos){return lift2(head(lastPos.getClientRects()),head(newPos.getClientRects()),(function(lastRect,newRect){var lastDist=Math.abs(x-lastRect.left),newDist;return Math.abs(x-newRect.left)<=lastDist?newPos:lastPos})).or(acc)}))}),Optional.none())},findClosestHorizontalPosition=function(positions,pos){return head(pos.getClientRects()).bind((function(targetRect){return findClosestHorizontalPositionFromPoint(positions,targetRect.left)}))},getPositionsUntilPreviousLine=curry(getPositionsUntil,CaretPosition.isAbove,-1),getPositionsUntilNextLine=curry(getPositionsUntil,CaretPosition.isBelow,1),isAtFirstLine=function(scope,pos){return getPositionsUntilPreviousLine(scope,pos).breakAt.isNone()},isAtLastLine=function(scope,pos){return getPositionsUntilNextLine(scope,pos).breakAt.isNone()},getPositionsAbove=curry(getAdjacentLinePositions,-1,getPositionsUntilPreviousLine),getPositionsBelow=curry(getAdjacentLinePositions,1,getPositionsUntilNextLine),getFirstLinePositions=function(scope){return firstPositionIn(scope).map((function(pos){return[pos].concat(getPositionsUntilNextLine(scope,pos).positions)})).getOr([])},getLastLinePositions=function(scope){return lastPositionIn(scope).map((function(pos){return getPositionsUntilPreviousLine(scope,pos).positions.concat(pos)})).getOr([])},getNodeClientRects=function(node){var toArrayWithNode=function(clientRects){return map(clientRects,(function(clientRect){return(clientRect=clone$2(clientRect)).node=node,clientRect}))};if(isElement$1(node))return toArrayWithNode(node.getClientRects());if(isText$1(node)){var rng=node.ownerDocument.createRange();return rng.setStart(node,0),rng.setEnd(node,node.data.length),toArrayWithNode(rng.getClientRects())}},getClientRects=function(nodes){return bind(nodes,getNodeClientRects)},VDirection;!function(VDirection){VDirection[VDirection.Up=-1]="Up",VDirection[VDirection.Down=1]="Down"}(VDirection||(VDirection={}));var findUntil$1=function(direction,root,predicateFn,node){for(;node=findNode(node,direction,isEditableCaretCandidate,root);)if(predicateFn(node))return},walkUntil=function(direction,isAboveFn,isBeflowFn,root,predicateFn,caretPosition){var line=0,result=[],add=function(node){var i,clientRect,clientRects;for(clientRects=getClientRects([node]),-1===direction&&(clientRects=clientRects.reverse()),i=0;i<clientRects.length;i++)if(clientRect=clientRects[i],!isBeflowFn(clientRect,targetClientRect)){if(result.length>0&&isAboveFn(clientRect,last$1(result))&&line++,clientRect.line=line,predicateFn(clientRect))return!0;result.push(clientRect)}},targetClientRect=last$1(caretPosition.getClientRects());if(!targetClientRect)return result;var node=caretPosition.getNode();return add(node),findUntil$1(direction,root,add,node),result},aboveLineNumber=function(lineNumber,clientRect){return clientRect.line>lineNumber},isLineNumber=function(lineNumber,clientRect){return clientRect.line===lineNumber},upUntil=curry(walkUntil,VDirection.Up,isAbove,isBelow),downUntil=curry(walkUntil,VDirection.Down,isBelow,isAbove),positionsUntil=function(direction,root,predicateFn,node){var caretWalker=CaretWalker(root),walkFn,isBelowFn,isAboveFn,caretPosition,result=[],line=0,clientRect,getClientRect=function(caretPosition){return last$1(caretPosition.getClientRects())};1===direction?(walkFn=caretWalker.next,isBelowFn=isBelow,isAboveFn=isAbove,caretPosition=CaretPosition.after(node)):(walkFn=caretWalker.prev,isBelowFn=isAbove,isAboveFn=isBelow,caretPosition=CaretPosition.before(node));var targetClientRect=getClientRect(caretPosition);do{if(caretPosition.isVisible()&&!isAboveFn(clientRect=getClientRect(caretPosition),targetClientRect)){if(result.length>0&&isBelowFn(clientRect,last$1(result))&&line++,(clientRect=clone$2(clientRect)).position=caretPosition,clientRect.line=line,predicateFn(clientRect))return result;result.push(clientRect)}}while(caretPosition=walkFn(caretPosition));return result},isAboveLine=function(lineNumber){return function(clientRect){return aboveLineNumber(lineNumber,clientRect)}},isLine=function(lineNumber){return function(clientRect){return isLineNumber(lineNumber,clientRect)}},isContentEditableFalse$8=isContentEditableFalse,findNode$1=findNode,distanceToRectLeft=function(clientRect,clientX){return Math.abs(clientRect.left-clientX)},distanceToRectRight=function(clientRect,clientX){return Math.abs(clientRect.right-clientX)},isInsideX=function(clientX,clientRect){return clientX>=clientRect.left&&clientX<=clientRect.right},isInsideY=function(clientY,clientRect){return clientY>=clientRect.top&&clientY<=clientRect.bottom},findClosestClientRect=function(clientRects,clientX){return reduce(clientRects,(function(oldClientRect,clientRect){var oldDistance=Math.min(distanceToRectLeft(oldClientRect,clientX),distanceToRectRight(oldClientRect,clientX)),newDistance=Math.min(distanceToRectLeft(clientRect,clientX),distanceToRectRight(clientRect,clientX));return isInsideX(clientX,clientRect)?clientRect:isInsideX(clientX,oldClientRect)?oldClientRect:newDistance===oldDistance&&isContentEditableFalse$8(clientRect.node)?clientRect:newDistance<oldDistance?clientRect:oldClientRect}))},walkUntil$1=function(direction,root,predicateFn,startNode,includeChildren){var node=findNode$1(startNode,direction,isEditableCaretCandidate,root,!includeChildren);do{if(!node||predicateFn(node))return}while(node=findNode$1(node,direction,isEditableCaretCandidate,root))},findLineNodeRects=function(root,targetNodeRect,includeChildren){void 0===includeChildren&&(includeChildren=!0);var clientRects=[],collect=function(checkPosFn,node){var lineRects=filter(getClientRects([node]),(function(clientRect){return!checkPosFn(clientRect,targetNodeRect)}));return clientRects=clientRects.concat(lineRects),0===lineRects.length};return clientRects.push(targetNodeRect),walkUntil$1(VDirection.Up,root,curry(collect,isAbove),targetNodeRect.node,includeChildren),walkUntil$1(VDirection.Down,root,curry(collect,isBelow),targetNodeRect.node,includeChildren),clientRects},getFakeCaretTargets=function(root){return filter(from$1(root.getElementsByTagName("*")),isFakeCaretTarget)},caretInfo=function(clientRect,clientX){return{node:clientRect.node,before:distanceToRectLeft(clientRect,clientX)<distanceToRectRight(clientRect,clientX)}},closestFakeCaret=function(root,clientX,clientY){var fakeTargetNodeRects=getClientRects(getFakeCaretTargets(root)),targetNodeRects=filter(fakeTargetNodeRects,curry(isInsideY,clientY)),closestNodeRect=findClosestClientRect(targetNodeRects,clientX);if(closestNodeRect){var includeChildren=!isTable(closestNodeRect.node)&&!isMedia(closestNodeRect.node);if((closestNodeRect=findClosestClientRect(findLineNodeRects(root,closestNodeRect,includeChildren),clientX))&&isFakeCaretTarget(closestNodeRect.node))return caretInfo(closestNodeRect,clientX)}return null},moveToRange=function(editor,rng){editor.selection.setRng(rng),scrollRangeIntoView(editor,editor.selection.getRng())},renderRangeCaretOpt=function(editor,range,scrollIntoView){return Optional.some(renderRangeCaret(editor,range,scrollIntoView))},moveHorizontally=function(editor,direction,range,isBefore,isAfter,isElement){var forwards=direction===HDirection.Forwards,caretWalker=CaretWalker(editor.getBody()),getNextPosFn=curry(getVisualCaretPosition,forwards?caretWalker.next:caretWalker.prev),isBeforeFn=forwards?isBefore:isAfter;if(!range.collapsed){var node=getSelectedNode(range);if(isElement(node))return showCaret(direction,editor,node,direction===HDirection.Backwards,!1)}var caretPosition=getNormalizedRangeEndPoint(direction,editor.getBody(),range);if(isBeforeFn(caretPosition))return selectNode(editor,caretPosition.getNode(!forwards));var nextCaretPosition=normalizePosition(forwards,getNextPosFn(caretPosition)),rangeIsInContainerBlock=isRangeInCaretContainerBlock(range);if(!nextCaretPosition)return rangeIsInContainerBlock?Optional.some(range):Optional.none();if(isBeforeFn(nextCaretPosition))return showCaret(direction,editor,nextCaretPosition.getNode(!forwards),forwards,!1);var peekCaretPosition=getNextPosFn(nextCaretPosition);return peekCaretPosition&&isBeforeFn(peekCaretPosition)&&isMoveInsideSameBlock(nextCaretPosition,peekCaretPosition)?showCaret(direction,editor,peekCaretPosition.getNode(!forwards),forwards,!1):rangeIsInContainerBlock?renderRangeCaretOpt(editor,nextCaretPosition.toRange(),!1):Optional.none()},moveVertically=function(editor,direction,range,isBefore,isAfter,isElement){var caretPosition=getNormalizedRangeEndPoint(direction,editor.getBody(),range),caretClientRect=last$1(caretPosition.getClientRects()),forwards=direction===VDirection.Down;if(!caretClientRect)return Optional.none();var walkerFn,linePositions=(forwards?downUntil:upUntil)(editor.getBody(),isAboveLine(1),caretPosition),nextLinePositions=filter(linePositions,isLine(1)),clientX=caretClientRect.left,nextLineRect=findClosestClientRect(nextLinePositions,clientX),currentNode;if(nextLineRect&&isElement(nextLineRect.node)){var dist1=Math.abs(clientX-nextLineRect.left),dist2=Math.abs(clientX-nextLineRect.right);return showCaret(direction,editor,nextLineRect.node,dist1<dist2,!1)}if(currentNode=isBefore(caretPosition)?caretPosition.getNode():isAfter(caretPosition)?caretPosition.getNode(!0):getSelectedNode(range)){var caretPositions=positionsUntil(direction,editor.getBody(),isAboveLine(1),currentNode),closestNextLineRect=findClosestClientRect(filter(caretPositions,isLine(1)),clientX);if(closestNextLineRect)return renderRangeCaretOpt(editor,closestNextLineRect.position.toRange(),!1);if(closestNextLineRect=last$1(filter(caretPositions,isLine(0))))return renderRangeCaretOpt(editor,closestNextLineRect.position.toRange(),!1)}return 0===nextLinePositions.length?getLineEndPoint(editor,forwards).filter(forwards?isAfter:isBefore).map((function(pos){return renderRangeCaret(editor,pos.toRange(),!1)})):Optional.none()},getLineEndPoint=function(editor,forward){var rng=editor.selection.getRng(),body=editor.getBody();if(forward){var from=CaretPosition.fromRangeEnd(rng),result=getPositionsUntilNextLine(body,from);return last(result.positions)}var from=CaretPosition.fromRangeStart(rng),result=getPositionsUntilPreviousLine(body,from);return head(result.positions)},moveToLineEndPoint=function(editor,forward,isElementPosition){return getLineEndPoint(editor,forward).filter(isElementPosition).exists((function(pos){return editor.selection.setRng(pos.toRange()),!0}))},isContentEditableFalse$9=isContentEditableFalse,moveToCeFalseHorizontally=function(direction,editor,range){return moveHorizontally(editor,direction,range,isBeforeContentEditableFalse,isAfterContentEditableFalse,isContentEditableFalse$9)},moveToCeFalseVertically=function(direction,editor,range){var isBefore,isAfter;return moveVertically(editor,direction,range,(function(caretPosition){return isBeforeContentEditableFalse(caretPosition)||isBeforeTable(caretPosition)}),(function(caretPosition){return isAfterContentEditableFalse(caretPosition)||isAfterTable(caretPosition)}),isContentEditableFalse$9)},createTextBlock=function(editor){var textBlock=editor.dom.create(getForcedRootBlock(editor));return(!Env.ie||Env.ie>=11)&&(textBlock.innerHTML='<br data-mce-bogus="1">'),textBlock},exitPreBlock=function(editor,direction,range){var caretWalker=CaretWalker(editor.getBody()),getVisualCaretPosition$1=curry(getVisualCaretPosition,1===direction?caretWalker.next:caretWalker.prev);if(range.collapsed&&hasForcedRootBlock(editor)){var pre=editor.dom.getParent(range.startContainer,"PRE"),caretPos;if(!pre)return;if(!getVisualCaretPosition$1(CaretPosition.fromRangeStart(range))){var newBlock=createTextBlock(editor);1===direction?editor.$(pre).after(newBlock):editor.$(pre).before(newBlock),editor.selection.select(newBlock,!0),editor.selection.collapse()}}},getHorizontalRange=function(editor,forward){var direction=forward?HDirection.Forwards:HDirection.Backwards,range=editor.selection.getRng();return moveToCeFalseHorizontally(direction,editor,range).orThunk((function(){return exitPreBlock(editor,direction,range),Optional.none()}))},getVerticalRange=function(editor,down){var direction=down?1:-1,range=editor.selection.getRng();return moveToCeFalseVertically(direction,editor,range).orThunk((function(){return exitPreBlock(editor,direction,range),Optional.none()}))},moveH=function(editor,forward){return getHorizontalRange(editor,forward).exists((function(newRange){return moveToRange(editor,newRange),!0}))},moveV=function(editor,down){return getVerticalRange(editor,down).exists((function(newRange){return moveToRange(editor,newRange),!0}))},moveToLineEndPoint$1=function(editor,forward){var isCefPosition;return moveToLineEndPoint(editor,forward,forward?isAfterContentEditableFalse:isBeforeContentEditableFalse)},isTarget=function(node){return contains(["figcaption"],name(node))},rangeBefore=function(target){var rng=document.createRange();return rng.setStartBefore(target.dom),rng.setEndBefore(target.dom),rng},insertElement=function(root,elm,forward){forward?append(root,elm):prepend(root,elm)},insertBr=function(root,forward){var br=SugarElement.fromTag("br");return insertElement(root,br,forward),rangeBefore(br)},insertBlock$1=function(root,forward,blockName,attrs){var block=SugarElement.fromTag(blockName),br=SugarElement.fromTag("br");return setAll(block,attrs),append(block,br),insertElement(root,block,forward),rangeBefore(br)},insertEmptyLine=function(root,rootBlockName,attrs,forward){return""===rootBlockName?insertBr(root,forward):insertBlock$1(root,forward,rootBlockName,attrs)},getClosestTargetBlock=function(pos,root){var isRoot=curry(eq$2,root);return closest(SugarElement.fromDom(pos.container()),isBlock,isRoot).filter(isTarget)},isAtFirstOrLastLine=function(root,forward,pos){return forward?isAtLastLine(root.dom,pos):isAtFirstLine(root.dom,pos)},moveCaretToNewEmptyLine=function(editor,forward){var root=SugarElement.fromDom(editor.getBody()),pos=CaretPosition.fromRangeStart(editor.selection.getRng()),rootBlock=getForcedRootBlock(editor),rootBlockAttrs=getForcedRootBlockAttrs(editor);return getClosestTargetBlock(pos,root).exists((function(){if(isAtFirstOrLastLine(root,forward,pos)){var rng=insertEmptyLine(root,rootBlock,rootBlockAttrs,forward);return editor.selection.setRng(rng),!0}return!1}))},moveV$1=function(editor,forward){return!!editor.selection.isCollapsed()&&moveCaretToNewEmptyLine(editor,forward)},defaultPatterns=function(patterns){return map(patterns,(function(pattern){return __assign({shiftKey:!1,altKey:!1,ctrlKey:!1,metaKey:!1,keyCode:0,action:noop},pattern)}))},matchesEvent=function(pattern,evt){return evt.keyCode===pattern.keyCode&&evt.shiftKey===pattern.shiftKey&&evt.altKey===pattern.altKey&&evt.ctrlKey===pattern.ctrlKey&&evt.metaKey===pattern.metaKey},match$1=function(patterns,evt){return bind(defaultPatterns(patterns),(function(pattern){return matchesEvent(pattern,evt)?[pattern]:[]}))},action=function(f){for(var x=[],_i=1;_i<arguments.length;_i++)x[_i-1]=arguments[_i];return function(){return f.apply(null,x)}},execute=function(patterns,evt){return find(match$1(patterns,evt),(function(pattern){return pattern.action()}))},moveH$1=function(editor,forward){var direction=forward?HDirection.Forwards:HDirection.Backwards,range=editor.selection.getRng();return moveHorizontally(editor,direction,range,isBeforeMedia,isAfterMedia,isMedia).exists((function(newRange){return moveToRange(editor,newRange),!0}))},moveV$2=function(editor,down){var direction=down?1:-1,range=editor.selection.getRng();return moveVertically(editor,direction,range,isBeforeMedia,isAfterMedia,isMedia).exists((function(newRange){return moveToRange(editor,newRange),!0}))},moveToLineEndPoint$2=function(editor,forward){var isNearMedia;return moveToLineEndPoint(editor,forward,forward?isAfterMedia:isBeforeMedia)},deflate=function(rect,delta){return{left:rect.left-delta,top:rect.top-delta,right:rect.right+2*delta,bottom:rect.bottom+2*delta,width:rect.width+delta,height:rect.height+delta}},getCorners=function(getYAxisValue,tds){return bind(tds,(function(td){var rect=deflate(clone$2(td.getBoundingClientRect()),-1);return[{x:rect.left,y:getYAxisValue(rect),cell:td},{x:rect.right,y:getYAxisValue(rect),cell:td}]}))},findClosestCorner=function(corners,x,y){return foldl(corners,(function(acc,newCorner){return acc.fold((function(){return Optional.some(newCorner)}),(function(oldCorner){var oldDist=Math.sqrt(Math.abs(oldCorner.x-x)+Math.abs(oldCorner.y-y)),newDist=Math.sqrt(Math.abs(newCorner.x-x)+Math.abs(newCorner.y-y));return Optional.some(newDist<oldDist?newCorner:oldCorner)}))}),Optional.none())},getClosestCell$1=function(getYAxisValue,isTargetCorner,table,x,y){var cells=descendants$1(SugarElement.fromDom(table),"td,th,caption").map((function(e){return e.dom})),corners=filter(getCorners(getYAxisValue,cells),(function(corner){return isTargetCorner(corner,y)}));return findClosestCorner(corners,x,y).map((function(corner){return corner.cell}))},getBottomValue=function(rect){return rect.bottom},getTopValue=function(rect){return rect.top},isAbove$1=function(corner,y){return corner.y<y},isBelow$1=function(corner,y){return corner.y>y},getClosestCellAbove=curry(getClosestCell$1,getBottomValue,isAbove$1),getClosestCellBelow=curry(getClosestCell$1,getTopValue,isBelow$1),findClosestPositionInAboveCell=function(table,pos){return head(pos.getClientRects()).bind((function(rect){return getClosestCellAbove(table,rect.left,rect.top)})).bind((function(cell){return findClosestHorizontalPosition(getLastLinePositions(cell),pos)}))},findClosestPositionInBelowCell=function(table,pos){return last(pos.getClientRects()).bind((function(rect){return getClosestCellBelow(table,rect.left,rect.top)})).bind((function(cell){return findClosestHorizontalPosition(getFirstLinePositions(cell),pos)}))},hasNextBreak=function(getPositionsUntil,scope,lineInfo){return lineInfo.breakAt.exists((function(breakPos){return getPositionsUntil(scope,breakPos).breakAt.isSome()}))},startsWithWrapBreak=function(lineInfo){return lineInfo.breakType===BreakType.Wrap&&0===lineInfo.positions.length},startsWithBrBreak=function(lineInfo){return lineInfo.breakType===BreakType.Br&&1===lineInfo.positions.length},isAtTableCellLine=function(getPositionsUntil,scope,pos){var lineInfo=getPositionsUntil(scope,pos);return startsWithWrapBreak(lineInfo)||!isBr(pos.getNode())&&startsWithBrBreak(lineInfo)?!hasNextBreak(getPositionsUntil,scope,lineInfo):lineInfo.breakAt.isNone()},isAtFirstTableCellLine=curry(isAtTableCellLine,getPositionsUntilPreviousLine),isAtLastTableCellLine=curry(isAtTableCellLine,getPositionsUntilNextLine),isCaretAtStartOrEndOfTable=function(forward,rng,table){var caretPos=CaretPosition.fromRangeStart(rng);return positionIn(!forward,table).exists((function(pos){return pos.isEqual(caretPos)}))},navigateHorizontally=function(editor,forward,table,_td){var rng=editor.selection.getRng(),direction=forward?1:-1;return!(!isFakeCaretTableBrowser()||!isCaretAtStartOrEndOfTable(forward,rng,table))&&(showCaret(direction,editor,table,!forward,!1).each((function(newRng){moveToRange(editor,newRng)})),!0)},getClosestAbovePosition=function(root,table,start){return findClosestPositionInAboveCell(table,start).orThunk((function(){return head(start.getClientRects()).bind((function(rect){return findClosestHorizontalPositionFromPoint(getPositionsAbove(root,CaretPosition.before(table)),rect.left)}))})).getOr(CaretPosition.before(table))},getClosestBelowPosition=function(root,table,start){return findClosestPositionInBelowCell(table,start).orThunk((function(){return head(start.getClientRects()).bind((function(rect){return findClosestHorizontalPositionFromPoint(getPositionsBelow(root,CaretPosition.after(table)),rect.left)}))})).getOr(CaretPosition.after(table))},getTable=function(previous,pos){var node=pos.getNode(previous);return isElement$1(node)&&"TABLE"===node.nodeName?Optional.some(node):Optional.none()},renderBlock=function(down,editor,table,pos){var forcedRootBlock=getForcedRootBlock(editor);forcedRootBlock?editor.undoManager.transact((function(){var element=SugarElement.fromTag(forcedRootBlock);setAll(element,getForcedRootBlockAttrs(editor)),append(element,SugarElement.fromTag("br")),down?after(SugarElement.fromDom(table),element):before(SugarElement.fromDom(table),element);var rng=editor.dom.createRng();rng.setStart(element.dom,0),rng.setEnd(element.dom,0),moveToRange(editor,rng)})):moveToRange(editor,pos.toRange())},moveCaret=function(editor,down,pos){var table=getTable(!!down,pos),last=!1===down;table.fold((function(){return moveToRange(editor,pos.toRange())}),(function(table){return positionIn(last,editor.getBody()).filter((function(lastPos){return lastPos.isEqual(pos)})).fold((function(){return moveToRange(editor,pos.toRange())}),(function(_){return renderBlock(down,editor,table,pos)}))}))},navigateVertically=function(editor,down,table,td){var rng=editor.selection.getRng(),pos=CaretPosition.fromRangeStart(rng),root=editor.getBody();if(!down&&isAtFirstTableCellLine(td,pos)){var newPos=getClosestAbovePosition(root,table,pos);return moveCaret(editor,down,newPos),!0}if(down&&isAtLastTableCellLine(td,pos)){var newPos=getClosestBelowPosition(root,table,pos);return moveCaret(editor,down,newPos),!0}return!1},move$1=function(editor,forward,mover){return Optional.from(editor.dom.getParent(editor.selection.getNode(),"td,th")).bind((function(td){return Optional.from(editor.dom.getParent(td,"table")).map((function(table){return mover(editor,forward,table,td)}))})).getOr(!1)},moveH$2=function(editor,forward){return move$1(editor,forward,navigateHorizontally)},moveV$3=function(editor,forward){return move$1(editor,forward,navigateVertically)},executeKeydownOverride=function(editor,caret,evt){var os=detect$3().os;execute([{keyCode:VK.RIGHT,action:action(moveH,editor,!0)},{keyCode:VK.LEFT,action:action(moveH,editor,!1)},{keyCode:VK.UP,action:action(moveV,editor,!1)},{keyCode:VK.DOWN,action:action(moveV,editor,!0)},{keyCode:VK.RIGHT,action:action(moveH$2,editor,!0)},{keyCode:VK.LEFT,action:action(moveH$2,editor,!1)},{keyCode:VK.UP,action:action(moveV$3,editor,!1)},{keyCode:VK.DOWN,action:action(moveV$3,editor,!0)},{keyCode:VK.RIGHT,action:action(moveH$1,editor,!0)},{keyCode:VK.LEFT,action:action(moveH$1,editor,!1)},{keyCode:VK.UP,action:action(moveV$2,editor,!1)},{keyCode:VK.DOWN,action:action(moveV$2,editor,!0)},{keyCode:VK.RIGHT,action:action(move,editor,caret,!0)},{keyCode:VK.LEFT,action:action(move,editor,caret,!1)},{keyCode:VK.RIGHT,ctrlKey:!os.isOSX(),altKey:os.isOSX(),action:action(moveNextWord,editor,caret)},{keyCode:VK.LEFT,ctrlKey:!os.isOSX(),altKey:os.isOSX(),action:action(movePrevWord,editor,caret)},{keyCode:VK.UP,action:action(moveV$1,editor,!1)},{keyCode:VK.DOWN,action:action(moveV$1,editor,!0)}],evt).each((function(_){evt.preventDefault()}))},setup$c=function(editor,caret){editor.on("keydown",(function(evt){!1===evt.isDefaultPrevented()&&executeKeydownOverride(editor,caret,evt)}))},executeKeydownOverride$1=function(editor,caret,evt){execute([{keyCode:VK.BACKSPACE,action:action(backspaceDelete$9,editor,!1)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$4,editor,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$4,editor,!0)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$3,editor,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$3,editor,!0)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$6,editor,caret,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$6,editor,caret,!0)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete,editor,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete,editor,!0)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$5,editor,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$5,editor,!0)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$8,editor,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$8,editor,!0)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$2,editor,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$2,editor,!0)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$1,editor,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$1,editor,!0)},{keyCode:VK.BACKSPACE,action:action(backspaceDelete$7,editor,!1)},{keyCode:VK.DELETE,action:action(backspaceDelete$7,editor,!0)}],evt).each((function(_){evt.preventDefault()}))},executeKeyupOverride=function(editor,evt){execute([{keyCode:VK.BACKSPACE,action:action(paddEmptyElement,editor)},{keyCode:VK.DELETE,action:action(paddEmptyElement,editor)}],evt)},setup$d=function(editor,caret){editor.on("keydown",(function(evt){!1===evt.isDefaultPrevented()&&executeKeydownOverride$1(editor,caret,evt)})),editor.on("keyup",(function(evt){!1===evt.isDefaultPrevented()&&executeKeyupOverride(editor,evt)}))},firstNonWhiteSpaceNodeSibling=function(node){for(;node;){if(1===node.nodeType||3===node.nodeType&&node.data&&/[\r\n\s]/.test(node.data))return node;node=node.nextSibling}},moveToCaretPosition=function(editor,root){var node,lastNode=root,dom=editor.dom,moveCaretBeforeOnEnterElementsMap=editor.schema.getMoveCaretBeforeOnEnterElements();if(root){if(/^(LI|DT|DD)$/.test(root.nodeName)){var firstChild=firstNonWhiteSpaceNodeSibling(root.firstChild);firstChild&&/^(UL|OL|DL)$/.test(firstChild.nodeName)&&root.insertBefore(dom.doc.createTextNode(" "),root.firstChild)}var rng=dom.createRng();if(root.normalize(),root.hasChildNodes()){for(var walker=new DomTreeWalker(root,root);node=walker.current();){if(isText$1(node)){rng.setStart(node,0),rng.setEnd(node,0);break}if(moveCaretBeforeOnEnterElementsMap[node.nodeName.toLowerCase()]){rng.setStartBefore(node),rng.setEndBefore(node);break}lastNode=node,node=walker.next()}node||(rng.setStart(lastNode,0),rng.setEnd(lastNode,0))}else isBr(root)?root.nextSibling&&dom.isBlock(root.nextSibling)?(rng.setStartBefore(root),rng.setEndBefore(root)):(rng.setStartAfter(root),rng.setEndAfter(root)):(rng.setStart(root,0),rng.setEnd(root,0));editor.selection.setRng(rng),scrollRangeIntoView(editor,rng)}},getEditableRoot=function(dom,node){var root=dom.getRoot(),parent,editableRoot;for(parent=node;parent!==root&&"false"!==dom.getContentEditable(parent);)"true"===dom.getContentEditable(parent)&&(editableRoot=parent),parent=parent.parentNode;return parent!==root?editableRoot:root},getParentBlock$2=function(editor){return Optional.from(editor.dom.getParent(editor.selection.getStart(!0),editor.dom.isBlock))},getParentBlockName=function(editor){return getParentBlock$2(editor).fold(constant(""),(function(parentBlock){return parentBlock.nodeName.toUpperCase()}))},isListItemParentBlock=function(editor){return getParentBlock$2(editor).filter((function(elm){return isListItem(SugarElement.fromDom(elm))})).isSome()},hasFirstChild=function(elm,name){return elm.firstChild&&elm.firstChild.nodeName===name},isFirstChild=function(elm){var _a;return(null===(_a=elm.parentNode)||void 0===_a?void 0:_a.firstChild)===elm},hasParent$1=function(elm,parentName){return elm&&elm.parentNode&&elm.parentNode.nodeName===parentName},isListBlock=function(elm){return elm&&/^(OL|UL|LI)$/.test(elm.nodeName)},isNestedList=function(elm){return isListBlock(elm)&&isListBlock(elm.parentNode)},getContainerBlock=function(containerBlock){var containerBlockParent=containerBlock.parentNode;return/^(LI|DT|DD)$/.test(containerBlockParent.nodeName)?containerBlockParent:containerBlock},isFirstOrLastLi=function(containerBlock,parentBlock,first){for(var node=containerBlock[first?"firstChild":"lastChild"];node&&!isElement$1(node);)node=node[first?"nextSibling":"previousSibling"];return node===parentBlock},insert=function(editor,createNewBlock,containerBlock,parentBlock,newBlockName){var dom=editor.dom,rng=editor.selection.getRng();if(containerBlock!==editor.getBody()){isNestedList(containerBlock)&&(newBlockName="LI");var newBlock=newBlockName?createNewBlock(newBlockName):dom.create("BR");if(isFirstOrLastLi(containerBlock,parentBlock,!0)&&isFirstOrLastLi(containerBlock,parentBlock,!1))if(hasParent$1(containerBlock,"LI")){var containerBlockParent=getContainerBlock(containerBlock);dom.insertAfter(newBlock,containerBlockParent),isFirstChild(containerBlock)?dom.remove(containerBlockParent):dom.remove(containerBlock)}else dom.replace(newBlock,containerBlock);else if(isFirstOrLastLi(containerBlock,parentBlock,!0))hasParent$1(containerBlock,"LI")?(dom.insertAfter(newBlock,getContainerBlock(containerBlock)),newBlock.appendChild(dom.doc.createTextNode(" ")),newBlock.appendChild(containerBlock)):containerBlock.parentNode.insertBefore(newBlock,containerBlock),dom.remove(parentBlock);else if(isFirstOrLastLi(containerBlock,parentBlock,!1))dom.insertAfter(newBlock,getContainerBlock(containerBlock)),dom.remove(parentBlock);else{containerBlock=getContainerBlock(containerBlock);var tmpRng=rng.cloneRange();tmpRng.setStartAfter(parentBlock),tmpRng.setEndAfter(containerBlock);var fragment=tmpRng.extractContents();"LI"===newBlockName&&hasFirstChild(fragment,"LI")?(newBlock=fragment.firstChild,dom.insertAfter(fragment,containerBlock)):(dom.insertAfter(fragment,containerBlock),dom.insertAfter(newBlock,containerBlock)),dom.remove(parentBlock)}moveToCaretPosition(editor,newBlock)}},trimZwsp=function(fragment){each(descendants(SugarElement.fromDom(fragment),isText),(function(text){var rawNode=text.dom;rawNode.nodeValue=trim$2(rawNode.nodeValue)}))},isEmptyAnchor=function(dom,elm){return elm&&"A"===elm.nodeName&&dom.isEmpty(elm)},isTableCell$5=function(node){return node&&/^(TD|TH|CAPTION)$/.test(node.nodeName)},emptyBlock=function(elm){elm.innerHTML='<br data-mce-bogus="1">'},containerAndSiblingName=function(container,nodeName){return container.nodeName===nodeName||container.previousSibling&&container.previousSibling.nodeName===nodeName},canSplitBlock=function(dom,node){return node&&dom.isBlock(node)&&!/^(TD|TH|CAPTION|FORM)$/.test(node.nodeName)&&!/^(fixed|absolute)/i.test(node.style.position)&&"true"!==dom.getContentEditable(node)},trimInlineElementsOnLeftSideOfBlock=function(dom,nonEmptyElementsMap,block){var node=block,firstChilds=[],i;if(node){for(;node=node.firstChild;){if(dom.isBlock(node))return;isElement$1(node)&&!nonEmptyElementsMap[node.nodeName.toLowerCase()]&&firstChilds.push(node)}for(i=firstChilds.length;i--;)!(node=firstChilds[i]).hasChildNodes()||node.firstChild===node.lastChild&&""===node.firstChild.nodeValue?dom.remove(node):isEmptyAnchor(dom,node)&&dom.remove(node)}},normalizeZwspOffset=function(start,container,offset){return!1===isText$1(container)?offset:start?1===offset&&container.data.charAt(offset-1)===ZWSP?0:offset:offset===container.data.length-1&&container.data.charAt(offset)===ZWSP?container.data.length:offset},includeZwspInRange=function(rng){var newRng=rng.cloneRange();return newRng.setStart(rng.startContainer,normalizeZwspOffset(!0,rng.startContainer,rng.startOffset)),newRng.setEnd(rng.endContainer,normalizeZwspOffset(!1,rng.endContainer,rng.endOffset)),newRng},trimLeadingLineBreaks=function(node){do{isText$1(node)&&(node.nodeValue=node.nodeValue.replace(/^[\r\n]+/,"")),node=node.firstChild}while(node)},getEditableRoot$1=function(dom,node){var root=dom.getRoot(),parent,editableRoot;for(parent=node;parent!==root&&"false"!==dom.getContentEditable(parent);)"true"===dom.getContentEditable(parent)&&(editableRoot=parent),parent=parent.parentNode;return parent!==root?editableRoot:root},applyAttributes=function(editor,node,forcedRootBlockAttrs){var dom=editor.dom;Optional.from(forcedRootBlockAttrs.style).map(dom.parseStyle).each((function(attrStyles){var currentStyles=getAllRaw(SugarElement.fromDom(node)),newStyles=__assign(__assign({},currentStyles),attrStyles);dom.setStyles(node,newStyles)}));var attrClassesOpt=Optional.from(forcedRootBlockAttrs.class).map((function(attrClasses){return attrClasses.split(/\s+/)})),currentClassesOpt=Optional.from(node.className).map((function(currentClasses){return filter(currentClasses.split(/\s+/),(function(clazz){return""!==clazz}))}));lift2(attrClassesOpt,currentClassesOpt,(function(attrClasses,currentClasses){var filteredClasses=filter(currentClasses,(function(clazz){return!contains(attrClasses,clazz)})),newClasses=__spreadArrays(attrClasses,filteredClasses);dom.setAttrib(node,"class",newClasses.join(" "))}));var appliedAttrs=["style","class"],remainingAttrs=filter$1(forcedRootBlockAttrs,(function(_,attrs){return!contains(appliedAttrs,attrs)}));dom.setAttribs(node,remainingAttrs)},setForcedBlockAttrs=function(editor,node){var forcedRootBlockName=getForcedRootBlock(editor);if(forcedRootBlockName&&forcedRootBlockName.toLowerCase()===node.tagName.toLowerCase()){var forcedRootBlockAttrs=getForcedRootBlockAttrs(editor);applyAttributes(editor,node,forcedRootBlockAttrs)}},wrapSelfAndSiblingsInDefaultBlock=function(editor,newBlockName,rng,container,offset){var newBlock,parentBlock,startNode,node,next,rootBlockName,blockName=newBlockName||"P",dom=editor.dom,editableRoot=getEditableRoot$1(dom,container);if(!(parentBlock=dom.getParent(container,dom.isBlock))||!canSplitBlock(dom,parentBlock)){if(rootBlockName=(parentBlock=parentBlock||editableRoot)===editor.getBody()||isTableCell$5(parentBlock)?parentBlock.nodeName.toLowerCase():parentBlock.parentNode.nodeName.toLowerCase(),!parentBlock.hasChildNodes())return newBlock=dom.create(blockName),setForcedBlockAttrs(editor,newBlock),parentBlock.appendChild(newBlock),rng.setStart(newBlock,0),rng.setEnd(newBlock,0),newBlock;for(node=container;node.parentNode!==parentBlock;)node=node.parentNode;for(;node&&!dom.isBlock(node);)startNode=node,node=node.previousSibling;if(startNode&&editor.schema.isValidChild(rootBlockName,blockName.toLowerCase())){for(newBlock=dom.create(blockName),setForcedBlockAttrs(editor,newBlock),startNode.parentNode.insertBefore(newBlock,startNode),node=startNode;node&&!dom.isBlock(node);)next=node.nextSibling,newBlock.appendChild(node),node=next;rng.setStart(container,offset),rng.setEnd(container,offset)}}return container},addBrToBlockIfNeeded=function(dom,block){block.normalize();var lastChild=block.lastChild;lastChild&&!/^(left|right)$/gi.test(dom.getStyle(lastChild,"float",!0))||dom.add(block,"br")},insert$1=function(editor,evt){var tmpRng,container,offset,parentBlock,newBlock,fragment,containerBlock,parentBlockName,newBlockName,isAfterLastNodeInContainer,dom=editor.dom,schema=editor.schema,nonEmptyElementsMap=schema.getNonEmptyElements(),rng=editor.selection.getRng(),createNewBlock=function(name){var node=container,block,clonedNode,caretNode,textInlineElements=schema.getTextInlineElements();if(caretNode=block=name||"TABLE"===parentBlockName||"HR"===parentBlockName?dom.create(name||newBlockName):parentBlock.cloneNode(!1),!1===shouldKeepStyles(editor))dom.setAttrib(block,"style",null),dom.setAttrib(block,"class",null);else do{if(textInlineElements[node.nodeName]){if(isCaretNode(node)||isBookmarkNode$1(node))continue;clonedNode=node.cloneNode(!1),dom.setAttrib(clonedNode,"id",""),block.hasChildNodes()?(clonedNode.appendChild(block.firstChild),block.appendChild(clonedNode)):(caretNode=clonedNode,block.appendChild(clonedNode))}}while((node=node.parentNode)&&node!==editableRoot);return setForcedBlockAttrs(editor,block),emptyBlock(caretNode),block},isCaretAtStartOrEndOfBlock=function(start){var node,name,normalizedOffset=normalizeZwspOffset(start,container,offset);if(isText$1(container)&&(start?normalizedOffset>0:normalizedOffset<container.nodeValue.length))return!1;if(container.parentNode===parentBlock&&isAfterLastNodeInContainer&&!start)return!0;if(start&&isElement$1(container)&&container===parentBlock.firstChild)return!0;if(containerAndSiblingName(container,"TABLE")||containerAndSiblingName(container,"HR"))return isAfterLastNodeInContainer&&!start||!isAfterLastNodeInContainer&&start;var walker=new DomTreeWalker(container,parentBlock);for(isText$1(container)&&(start&&0===normalizedOffset?walker.prev():start||normalizedOffset!==container.nodeValue.length||walker.next());node=walker.current();){if(isElement$1(node)){if(!node.getAttribute("data-mce-bogus")&&(name=node.nodeName.toLowerCase(),nonEmptyElementsMap[name]&&"br"!==name))return!1}else if(isText$1(node)&&!isWhitespaceText(node.nodeValue))return!1;start?walker.prev():walker.next()}return!0},insertNewBlockAfter=function(){newBlock=/^(H[1-6]|PRE|FIGURE)$/.test(parentBlockName)&&"HGROUP"!==containerBlockName?createNewBlock(newBlockName):createNewBlock(),shouldEndContainerOnEmptyBlock(editor)&&canSplitBlock(dom,containerBlock)&&dom.isEmpty(parentBlock)?newBlock=dom.split(containerBlock,parentBlock):dom.insertAfter(newBlock,parentBlock),moveToCaretPosition(editor,newBlock)};normalize(dom,rng).each((function(normRng){rng.setStart(normRng.startContainer,normRng.startOffset),rng.setEnd(normRng.endContainer,normRng.endOffset)})),container=rng.startContainer,offset=rng.startOffset,newBlockName=getForcedRootBlock(editor);var shiftKey=!(!evt||!evt.shiftKey),ctrlKey=!(!evt||!evt.ctrlKey);isElement$1(container)&&container.hasChildNodes()&&(isAfterLastNodeInContainer=offset>container.childNodes.length-1,container=container.childNodes[Math.min(offset,container.childNodes.length-1)]||container,offset=isAfterLastNodeInContainer&&isText$1(container)?container.nodeValue.length:0);var editableRoot=getEditableRoot$1(dom,container);if(editableRoot){(newBlockName&&!shiftKey||!newBlockName&&shiftKey)&&(container=wrapSelfAndSiblingsInDefaultBlock(editor,newBlockName,rng,container,offset)),parentBlock=dom.getParent(container,dom.isBlock),containerBlock=parentBlock?dom.getParent(parentBlock.parentNode,dom.isBlock):null,parentBlockName=parentBlock?parentBlock.nodeName.toUpperCase():"";var containerBlockName=containerBlock?containerBlock.nodeName.toUpperCase():"";"LI"!==containerBlockName||ctrlKey||(parentBlock=containerBlock,containerBlock=containerBlock.parentNode,parentBlockName=containerBlockName),/^(LI|DT|DD)$/.test(parentBlockName)&&dom.isEmpty(parentBlock)?insert(editor,createNewBlock,containerBlock,parentBlock,newBlockName):newBlockName&&parentBlock===editor.getBody()||(newBlockName=newBlockName||"P",isCaretContainerBlock(parentBlock)?(newBlock=showCaretContainerBlock(parentBlock),dom.isEmpty(parentBlock)&&emptyBlock(parentBlock),setForcedBlockAttrs(editor,newBlock),moveToCaretPosition(editor,newBlock)):isCaretAtStartOrEndOfBlock()?insertNewBlockAfter():isCaretAtStartOrEndOfBlock(!0)?(newBlock=parentBlock.parentNode.insertBefore(createNewBlock(),parentBlock),moveToCaretPosition(editor,containerAndSiblingName(parentBlock,"HR")?newBlock:parentBlock)):((tmpRng=includeZwspInRange(rng).cloneRange()).setEndAfter(parentBlock),fragment=tmpRng.extractContents(),trimZwsp(fragment),trimLeadingLineBreaks(fragment),newBlock=fragment.firstChild,dom.insertAfter(fragment,parentBlock),trimInlineElementsOnLeftSideOfBlock(dom,nonEmptyElementsMap,newBlock),addBrToBlockIfNeeded(dom,parentBlock),dom.isEmpty(parentBlock)&&emptyBlock(parentBlock),newBlock.normalize(),dom.isEmpty(newBlock)?(dom.remove(newBlock),insertNewBlockAfter()):(setForcedBlockAttrs(editor,newBlock),moveToCaretPosition(editor,newBlock))),dom.setAttrib(newBlock,"id",""),editor.fire("NewBlock",{newBlock:newBlock}))}},hasRightSideContent=function(schema,container,parentBlock){for(var walker=new DomTreeWalker(container,parentBlock),node,nonEmptyElementsMap=schema.getNonEmptyElements();node=walker.next();)if(nonEmptyElementsMap[node.nodeName.toLowerCase()]||node.length>0)return!0},moveSelectionToBr=function(editor,brElm,extraBr){var rng=editor.dom.createRng();extraBr?(rng.setStartBefore(brElm),rng.setEndBefore(brElm)):(rng.setStartAfter(brElm),rng.setEndAfter(brElm)),editor.selection.setRng(rng),scrollRangeIntoView(editor,rng)},insertBrAtCaret=function(editor,evt){var selection=editor.selection,dom=editor.dom,rng=selection.getRng(),brElm,extraBr;normalize(dom,rng).each((function(normRng){rng.setStart(normRng.startContainer,normRng.startOffset),rng.setEnd(normRng.endContainer,normRng.endOffset)}));var offset=rng.startOffset,container=rng.startContainer;if(1===container.nodeType&&container.hasChildNodes()){var isAfterLastNodeInContainer=offset>container.childNodes.length-1;container=container.childNodes[Math.min(offset,container.childNodes.length-1)]||container,offset=isAfterLastNodeInContainer&&3===container.nodeType?container.nodeValue.length:0}var parentBlock=dom.getParent(container,dom.isBlock),containerBlock=parentBlock?dom.getParent(parentBlock.parentNode,dom.isBlock):null,containerBlockName=containerBlock?containerBlock.nodeName.toUpperCase():"",isControlKey=!(!evt||!evt.ctrlKey);"LI"!==containerBlockName||isControlKey||(parentBlock=containerBlock),container&&3===container.nodeType&&offset>=container.nodeValue.length&&(hasRightSideContent(editor.schema,container,parentBlock)||(brElm=dom.create("br"),rng.insertNode(brElm),rng.setStartAfter(brElm),rng.setEndAfter(brElm),extraBr=!0)),brElm=dom.create("br"),rangeInsertNode(dom,rng,brElm),moveSelectionToBr(editor,brElm,extraBr),editor.undoManager.add()},insertBrBefore=function(editor,inline){var br=SugarElement.fromTag("br");before(SugarElement.fromDom(inline),br),editor.undoManager.add()},insertBrAfter=function(editor,inline){hasBrAfter(editor.getBody(),inline)||after(SugarElement.fromDom(inline),SugarElement.fromTag("br"));var br=SugarElement.fromTag("br");after(SugarElement.fromDom(inline),br),moveSelectionToBr(editor,br.dom,!1),editor.undoManager.add()},isBeforeBr$1=function(pos){return isBr(pos.getNode())},hasBrAfter=function(rootNode,startNode){return!!isBeforeBr$1(CaretPosition.after(startNode))||nextPosition(rootNode,CaretPosition.after(startNode)).map((function(pos){return isBr(pos.getNode())})).getOr(!1)},isAnchorLink=function(elm){return elm&&"A"===elm.nodeName&&"href"in elm},isInsideAnchor=function(location){return location.fold(never,isAnchorLink,isAnchorLink,never)},readInlineAnchorLocation=function(editor){var isInlineTarget$1=curry(isInlineTarget,editor),position=CaretPosition.fromRangeStart(editor.selection.getRng());return readLocation(isInlineTarget$1,editor.getBody(),position).filter(isInsideAnchor)},insertBrOutsideAnchor=function(editor,location){location.fold(noop,curry(insertBrBefore,editor),curry(insertBrAfter,editor),noop)},insert$2=function(editor,evt){var anchorLocation=readInlineAnchorLocation(editor);anchorLocation.isSome()?anchorLocation.each(curry(insertBrOutsideAnchor,editor)):insertBrAtCaret(editor,evt)},matchesSelector=function(editor,selector){return getParentBlock$2(editor).filter((function(parentBlock){return selector.length>0&&is$1(SugarElement.fromDom(parentBlock),selector)})).isSome()},shouldInsertBr=function(editor){return matchesSelector(editor,getBrNewLineSelector(editor))},shouldBlockNewLine=function(editor){return matchesSelector(editor,getNoNewLineSelector(editor))},newLineAction=Adt_generate([{br:[]},{block:[]},{none:[]}]),shouldBlockNewLine$1=function(editor,_shiftKey){return shouldBlockNewLine(editor)},isBrMode=function(requiredState){return function(editor,_shiftKey){var brMode;return""===getForcedRootBlock(editor)===requiredState}},inListBlock=function(requiredState){return function(editor,_shiftKey){return isListItemParentBlock(editor)===requiredState}},inBlock=function(blockName,requiredState){return function(editor,_shiftKey){var state;return getParentBlockName(editor)===blockName.toUpperCase()===requiredState}},inPreBlock=function(requiredState){return inBlock("pre",requiredState)},inSummaryBlock=function(){return inBlock("summary",!0)},shouldPutBrInPre$1=function(requiredState){return function(editor,_shiftKey){return shouldPutBrInPre(editor)===requiredState}},inBrContext=function(editor,_shiftKey){return shouldInsertBr(editor)},hasShiftKey=function(_editor,shiftKey){return shiftKey},canInsertIntoEditableRoot=function(editor){var forcedRootBlock=getForcedRootBlock(editor),rootEditable=getEditableRoot(editor.dom,editor.selection.getStart());return rootEditable&&editor.schema.isValidChild(rootEditable.nodeName,forcedRootBlock||"P")},match$2=function(predicates,action){return function(editor,shiftKey){var isMatch;return foldl(predicates,(function(res,p){return res&&p(editor,shiftKey)}),!0)?Optional.some(action):Optional.none()}},getAction$1=function(editor,evt){return evaluateUntil([match$2([shouldBlockNewLine$1],newLineAction.none()),match$2([inSummaryBlock()],newLineAction.br()),match$2([inPreBlock(!0),shouldPutBrInPre$1(!1),hasShiftKey],newLineAction.br()),match$2([inPreBlock(!0),shouldPutBrInPre$1(!1)],newLineAction.block()),match$2([inPreBlock(!0),shouldPutBrInPre$1(!0),hasShiftKey],newLineAction.block()),match$2([inPreBlock(!0),shouldPutBrInPre$1(!0)],newLineAction.br()),match$2([inListBlock(!0),hasShiftKey],newLineAction.br()),match$2([inListBlock(!0)],newLineAction.block()),match$2([isBrMode(!0),hasShiftKey,canInsertIntoEditableRoot],newLineAction.block()),match$2([isBrMode(!0)],newLineAction.br()),match$2([inBrContext],newLineAction.br()),match$2([isBrMode(!1),hasShiftKey],newLineAction.br()),match$2([canInsertIntoEditableRoot],newLineAction.block())],[editor,!(!evt||!evt.shiftKey)]).getOr(newLineAction.none())},insert$3=function(editor,evt){getAction$1(editor,evt).fold((function(){insert$2(editor,evt)}),(function(){insert$1(editor,evt)}),noop)},handleEnterKeyEvent=function(editor,event){event.isDefaultPrevented()||(event.preventDefault(),endTypingLevelIgnoreLocks(editor.undoManager),editor.undoManager.transact((function(){!1===editor.selection.isCollapsed()&&editor.execCommand("Delete"),insert$3(editor,event)})))},setup$e=function(editor){editor.on("keydown",(function(event){event.keyCode===VK.ENTER&&handleEnterKeyEvent(editor,event)}))},executeKeydownOverride$2=function(editor,evt){execute([{keyCode:VK.END,action:action(moveToLineEndPoint$1,editor,!0)},{keyCode:VK.HOME,action:action(moveToLineEndPoint$1,editor,!1)},{keyCode:VK.END,action:action(moveToLineEndPoint$2,editor,!0)},{keyCode:VK.HOME,action:action(moveToLineEndPoint$2,editor,!1)}],evt).each((function(_){evt.preventDefault()}))},setup$f=function(editor){editor.on("keydown",(function(evt){!1===evt.isDefaultPrevented()&&executeKeydownOverride$2(editor,evt)}))},browser$4=detect$3().browser,setupIeInput=function(editor){var keypressThrotter=first((function(){editor.composing||normalizeNbspsInEditor(editor)}),0);browser$4.isIE()&&(editor.on("keypress",(function(_e){keypressThrotter.throttle()})),editor.on("remove",(function(_e){keypressThrotter.cancel()})))},setup$g=function(editor){setupIeInput(editor),editor.on("input",(function(e){!1===e.isComposing&&normalizeNbspsInEditor(editor)}))},insertTextAtPosition=function(text,pos){var container=pos.container(),offset=pos.offset();return isText$1(container)?(container.insertData(offset,text),Optional.some(CaretPosition(container,offset+text.length))):getElementFromPosition(pos).map((function(elm){var textNode=SugarElement.fromText(text);return pos.isAtEnd()?after(elm,textNode):before(elm,textNode),CaretPosition(textNode.dom,text.length)}))},insertNbspAtPosition=curry(insertTextAtPosition," "),insertSpaceAtPosition=curry(insertTextAtPosition," "),locationToCaretPosition=function(root){return function(location){return location.fold((function(element){return prevPosition(root.dom,CaretPosition.before(element))}),(function(element){return firstPositionIn(element)}),(function(element){return lastPositionIn(element)}),(function(element){return nextPosition(root.dom,CaretPosition.after(element))}))}},insertInlineBoundarySpaceOrNbsp=function(root,pos){return function(checkPos){return needsToHaveNbsp(root,checkPos)?insertNbspAtPosition(pos):insertSpaceAtPosition(pos)}},setSelection$1=function(editor){return function(pos){return editor.selection.setRng(pos.toRange()),editor.nodeChanged(),!0}},insertSpaceOrNbspAtSelection=function(editor){var pos=CaretPosition.fromRangeStart(editor.selection.getRng()),root=SugarElement.fromDom(editor.getBody());if(editor.selection.isCollapsed()){var isInlineTarget$1=curry(isInlineTarget,editor),caretPosition=CaretPosition.fromRangeStart(editor.selection.getRng());return readLocation(isInlineTarget$1,editor.getBody(),caretPosition).bind(locationToCaretPosition(root)).bind(insertInlineBoundarySpaceOrNbsp(root,pos)).exists(setSelection$1(editor))}return!1},executeKeydownOverride$3=function(editor,evt){execute([{keyCode:VK.SPACEBAR,action:action(insertSpaceOrNbspAtSelection,editor)}],evt).each((function(_){evt.preventDefault()}))},setup$h=function(editor){editor.on("keydown",(function(evt){!1===evt.isDefaultPrevented()&&executeKeydownOverride$3(editor,evt)}))},registerKeyboardOverrides=function(editor){var caret=setupSelectedState(editor);return setup$b(editor),setup$c(editor,caret),setup$d(editor,caret),setup$e(editor),setup$h(editor),setup$g(editor),setup$f(editor),caret},setup$i=function(editor){return isRtc(editor)?Cell(null):registerKeyboardOverrides(editor)},NodeChange=function(){function NodeChange(editor){var lastRng;this.lastPath=[],this.editor=editor;var self=this;"onselectionchange"in editor.getDoc()||editor.on("NodeChange click mouseup keyup focus",(function(e){var nativeRng=editor.selection.getRng(),fakeRng={startContainer:nativeRng.startContainer,startOffset:nativeRng.startOffset,endContainer:nativeRng.endContainer,endOffset:nativeRng.endOffset};"nodechange"!==e.type&&isEq$1(fakeRng,lastRng)||editor.fire("SelectionChange"),lastRng=fakeRng})),editor.on("contextmenu",(function(){editor.fire("SelectionChange")})),editor.on("SelectionChange",(function(){var startElm=editor.selection.getStart(!0);!startElm||!Env.range&&editor.selection.isCollapsed()||hasAnyRanges(editor)&&!self.isSameElementPath(startElm)&&editor.dom.isChildOf(startElm,editor.getBody())&&editor.nodeChanged({selectionChange:!0})})),editor.on("mouseup",(function(e){!e.isDefaultPrevented()&&hasAnyRanges(editor)&&("IMG"===editor.selection.getNode().nodeName?Delay.setEditorTimeout(editor,(function(){editor.nodeChanged()})):editor.nodeChanged())}))}return NodeChange.prototype.nodeChanged=function(args){var selection=this.editor.selection,node,parents,root;this.editor.initialized&&selection&&!shouldDisableNodeChange(this.editor)&&!this.editor.mode.isReadOnly()&&(root=this.editor.getBody(),(node=selection.getStart(!0)||root).ownerDocument===this.editor.getDoc()&&this.editor.dom.isChildOf(node,root)||(node=root),parents=[],this.editor.dom.getParent(node,(function(node){if(node===root)return!0;parents.push(node)})),(args=args||{}).element=node,args.parents=parents,this.editor.fire("NodeChange",args))},NodeChange.prototype.isSameElementPath=function(startElm){var i,currentPath=this.editor.$(startElm).parentsUntil(this.editor.getBody()).add(startElm);if(currentPath.length===this.lastPath.length){for(i=currentPath.length;i>=0&&currentPath[i]===this.lastPath[i];i--);if(-1===i)return this.lastPath=currentPath,!0}return this.lastPath=currentPath,!1},NodeChange}(),preventSummaryToggle=function(editor){editor.on("click",(function(e){editor.dom.getParent(e.target,"details")&&e.preventDefault()}))},filterDetails=function(editor){editor.parser.addNodeFilter("details",(function(elms){each(elms,(function(details){details.attr("data-mce-open",details.attr("open")),details.attr("open","open")}))})),editor.serializer.addNodeFilter("details",(function(elms){each(elms,(function(details){var open=details.attr("data-mce-open");details.attr("open",isString(open)?open:null),details.attr("data-mce-open",null)}))}))},setup$j=function(editor){preventSummaryToggle(editor),filterDetails(editor)},isTextBlockNode=function(node){return isElement$1(node)&&isTextBlock(SugarElement.fromDom(node))},normalizeSelection$1=function(editor){var rng=editor.selection.getRng(),startPos=CaretPosition.fromRangeStart(rng),endPos=CaretPosition.fromRangeEnd(rng);if(CaretPosition.isElementPosition(startPos)){var container=startPos.container();isTextBlockNode(container)&&firstPositionIn(container).each((function(pos){return rng.setStart(pos.container(),pos.offset())}))}if(CaretPosition.isElementPosition(endPos)){var container=startPos.container();isTextBlockNode(container)&&lastPositionIn(container).each((function(pos){return rng.setEnd(pos.container(),pos.offset())}))}editor.selection.setRng(normalize$2(rng))},setup$k=function(editor){editor.on("click",(function(e){e.detail>=3&&normalizeSelection$1(editor)}))},value$1=function(){var subject=Cell(Optional.none()),clear,set,isSet,on;return{clear:function(){return subject.set(Optional.none())},set:function(s){return subject.set(Optional.some(s))},isSet:function(){return subject.get().isSome()},on:function(f){return subject.get().each(f)}}},getAbsolutePosition=function(elm){var clientRect=elm.getBoundingClientRect(),doc=elm.ownerDocument,docElem=doc.documentElement,win=doc.defaultView;return{top:clientRect.top+win.pageYOffset-docElem.clientTop,left:clientRect.left+win.pageXOffset-docElem.clientLeft}},getBodyPosition=function(editor){return editor.inline?getAbsolutePosition(editor.getBody()):{left:0,top:0}},getScrollPosition=function(editor){var body=editor.getBody();return editor.inline?{left:body.scrollLeft,top:body.scrollTop}:{left:0,top:0}},getBodyScroll=function(editor){var body=editor.getBody(),docElm=editor.getDoc().documentElement,inlineScroll={left:body.scrollLeft,top:body.scrollTop},iframeScroll={left:body.scrollLeft||docElm.scrollLeft,top:body.scrollTop||docElm.scrollTop};return editor.inline?inlineScroll:iframeScroll},getMousePosition=function(editor,event){if(event.target.ownerDocument!==editor.getDoc()){var iframePosition=getAbsolutePosition(editor.getContentAreaContainer()),scrollPosition=getBodyScroll(editor);return{left:event.pageX-iframePosition.left+scrollPosition.left,top:event.pageY-iframePosition.top+scrollPosition.top}}return{left:event.pageX,top:event.pageY}},calculatePosition=function(bodyPosition,scrollPosition,mousePosition){return{pageX:mousePosition.left-bodyPosition.left+scrollPosition.left,pageY:mousePosition.top-bodyPosition.top+scrollPosition.top}},calc=function(editor,event){return calculatePosition(getBodyPosition(editor),getScrollPosition(editor),getMousePosition(editor,event))},isContentEditableFalse$a=isContentEditableFalse,isContentEditableTrue$3=isContentEditableTrue,isDraggable=function(rootElm,elm){return isContentEditableFalse$a(elm)&&elm!==rootElm},isValidDropTarget=function(editor,targetElement,dragElement){return targetElement!==dragElement&&!editor.dom.isChildOf(targetElement,dragElement)&&!isContentEditableFalse$a(targetElement)},cloneElement=function(elm){var cloneElm=elm.cloneNode(!0);return cloneElm.removeAttribute("data-mce-selected"),cloneElm},createGhost=function(editor,elm,width,height){var dom=editor.dom,clonedElm=elm.cloneNode(!0);dom.setStyles(clonedElm,{width:width,height:height}),dom.setAttrib(clonedElm,"data-mce-selected",null);var ghostElm=dom.create("div",{class:"mce-drag-container","data-mce-bogus":"all",unselectable:"on",contenteditable:"false"});return dom.setStyles(ghostElm,{position:"absolute",opacity:.5,overflow:"hidden",border:0,padding:0,margin:0,width:width,height:height}),dom.setStyles(clonedElm,{margin:0,boxSizing:"border-box"}),ghostElm.appendChild(clonedElm),ghostElm},appendGhostToBody=function(ghostElm,bodyElm){ghostElm.parentNode!==bodyElm&&bodyElm.appendChild(ghostElm)},moveGhost=function(ghostElm,position,width,height,maxX,maxY){var overflowX=0,overflowY=0;ghostElm.style.left=position.pageX+"px",ghostElm.style.top=position.pageY+"px",position.pageX+width>maxX&&(overflowX=position.pageX+width-maxX),position.pageY+height>maxY&&(overflowY=position.pageY+height-maxY),ghostElm.style.width=width-overflowX+"px",ghostElm.style.height=height-overflowY+"px"},removeElement=function(elm){elm&&elm.parentNode&&elm.parentNode.removeChild(elm)},isLeftMouseButtonPressed=function(e){return 0===e.button},applyRelPos=function(state,position){return{pageX:position.pageX-state.relX,pageY:position.pageY+5}},start$1=function(state,editor){return function(e){if(isLeftMouseButtonPressed(e)){var ceElm=find(editor.dom.getParents(e.target),or(isContentEditableFalse$a,isContentEditableTrue$3)).getOr(null);if(isDraggable(editor.getBody(),ceElm)){var elmPos=editor.dom.getPos(ceElm),bodyElm=editor.getBody(),docElm=editor.getDoc().documentElement;state.set({element:ceElm,dragging:!1,screenX:e.screenX,screenY:e.screenY,maxX:(editor.inline?bodyElm.scrollWidth:docElm.offsetWidth)-2,maxY:(editor.inline?bodyElm.scrollHeight:docElm.offsetHeight)-2,relX:e.pageX-elmPos.x,relY:e.pageY-elmPos.y,width:ceElm.offsetWidth,height:ceElm.offsetHeight,ghost:createGhost(editor,ceElm,ceElm.offsetWidth,ceElm.offsetHeight)})}}}},move$2=function(state,editor){var throttledPlaceCaretAt=Delay.throttle((function(clientX,clientY){editor._selectionOverrides.hideFakeCaret(),editor.selection.placeCaretAt(clientX,clientY)}),0);return editor.on("remove",throttledPlaceCaretAt.stop),function(e){return state.on((function(state){var movement=Math.max(Math.abs(e.screenX-state.screenX),Math.abs(e.screenY-state.screenY));if(!state.dragging&&movement>10){var args;if(editor.fire("dragstart",{target:state.element}).isDefaultPrevented())return;state.dragging=!0,editor.focus()}if(state.dragging){var targetPos=applyRelPos(state,calc(editor,e));appendGhostToBody(state.ghost,editor.getBody()),moveGhost(state.ghost,targetPos,state.width,state.height,state.maxX,state.maxY),throttledPlaceCaretAt(e.clientX,e.clientY)}}))}},getRawTarget=function(selection){var rng,startContainer=selection.getSel().getRangeAt(0).startContainer;return 3===startContainer.nodeType?startContainer.parentNode:startContainer},drop=function(state,editor){return function(e){state.on((function(state){if(state.dragging&&isValidDropTarget(editor,getRawTarget(editor.selection),state.element)){var targetClone_1=cloneElement(state.element),args;editor.fire("drop",{clientX:e.clientX,clientY:e.clientY}).isDefaultPrevented()||editor.undoManager.transact((function(){removeElement(state.element),editor.insertContent(editor.dom.getOuterHTML(targetClone_1)),editor._selectionOverrides.hideFakeCaret()}))}})),removeDragState(state)}},stop=function(state,editor){return function(){state.on((function(state){state.dragging&&editor.fire("dragend")})),removeDragState(state)}},removeDragState=function(state){state.on((function(state){removeElement(state.ghost)})),state.clear()},bindFakeDragEvents=function(editor){var state=value$1(),pageDom=DOMUtils.DOM,rootDocument=document,dragStartHandler=start$1(state,editor),dragHandler=move$2(state,editor),dropHandler=drop(state,editor),dragEndHandler=stop(state,editor);editor.on("mousedown",dragStartHandler),editor.on("mousemove",dragHandler),editor.on("mouseup",dropHandler),pageDom.bind(rootDocument,"mousemove",dragHandler),pageDom.bind(rootDocument,"mouseup",dragEndHandler),editor.on("remove",(function(){pageDom.unbind(rootDocument,"mousemove",dragHandler),pageDom.unbind(rootDocument,"mouseup",dragEndHandler)}))},blockIeDrop=function(editor){editor.on("drop",(function(e){var realTarget=void 0!==e.clientX?editor.getDoc().elementFromPoint(e.clientX,e.clientY):null;(isContentEditableFalse$a(realTarget)||"false"===editor.dom.getContentEditableParent(realTarget))&&e.preventDefault()}))},blockUnsupportedFileDrop=function(editor){var preventFileDrop=function(e){if(!e.isDefaultPrevented()){var dataTransfer=e.dataTransfer;dataTransfer&&(contains(dataTransfer.types,"Files")||dataTransfer.files.length>0)&&(e.preventDefault(),e.type)}},preventFileDropIfUIElement=function(e){isUIElement(editor,e.target)&&preventFileDrop(e)},setup=function(){var pageDom=DOMUtils.DOM,dom=editor.dom,doc=document,editorRoot=editor.inline?editor.getBody():editor.getDoc(),eventNames=["drop","dragover"];each(eventNames,(function(name){pageDom.bind(doc,name,preventFileDropIfUIElement),dom.bind(editorRoot,name,preventFileDrop)})),editor.on("remove",(function(){each(eventNames,(function(name){pageDom.unbind(doc,name,preventFileDropIfUIElement),dom.unbind(editorRoot,name,preventFileDrop)}))}))};editor.on("init",(function(){Delay.setEditorTimeout(editor,setup,0)}))},init=function(editor){bindFakeDragEvents(editor),blockIeDrop(editor),shouldBlockUnsupportedDrop(editor)&&blockUnsupportedFileDrop(editor)},setup$l=function(editor){var renderFocusCaret=first((function(){if(!editor.removed&&editor.getBody().contains(document.activeElement)){var rng=editor.selection.getRng();if(rng.collapsed){var caretRange=renderRangeCaret(editor,rng,!1);editor.selection.setRng(caretRange)}}}),0);editor.on("focus",(function(){renderFocusCaret.throttle()})),editor.on("blur",(function(){renderFocusCaret.cancel()}))},setup$m=function(editor){editor.on("init",(function(){editor.on("focusin",(function(e){var target=e.target;if(isMedia(target)){var ceRoot=getContentEditableRoot(editor.getBody(),target),node=isContentEditableFalse(ceRoot)?ceRoot:target;editor.selection.getNode()!==node&&selectNode(editor,node).each((function(rng){return editor.selection.setRng(rng)}))}}))}))},isContentEditableTrue$4=isContentEditableTrue,isContentEditableFalse$b=isContentEditableFalse,getContentEditableRoot$1=function(editor,node){return getContentEditableRoot(editor.getBody(),node)},SelectionOverrides=function(editor){var selection=editor.selection,dom=editor.dom,isBlock=dom.isBlock,rootNode=editor.getBody(),fakeCaret=FakeCaret(editor,rootNode,isBlock,(function(){return hasFocus$1(editor)})),realSelectionId="sel-"+dom.uniqueId(),elementSelectionAttr="data-mce-selected",selectedElement,isFakeSelectionElement=function(node){return dom.hasClass(node,"mce-offscreen-selection")},isFakeSelectionTargetElement=function(node){return node!==rootNode&&(isContentEditableFalse$b(node)||isMedia(node))&&dom.isChildOf(node,rootNode)},isNearFakeSelectionElement=function(pos){return isBeforeContentEditableFalse(pos)||isAfterContentEditableFalse(pos)||isBeforeMedia(pos)||isAfterMedia(pos)},getRealSelectionElement=function(){var container=dom.get(realSelectionId);return container?container.getElementsByTagName("*")[0]:container},setRange=function(range){range&&selection.setRng(range)},getRange=selection.getRng,showCaret=function(direction,node,before,scrollIntoView){var e;return void 0===scrollIntoView&&(scrollIntoView=!0),editor.fire("ShowCaret",{target:node,direction:direction,before:before}).isDefaultPrevented()?null:(scrollIntoView&&selection.scrollIntoView(node,-1===direction),fakeCaret.show(before,node))},showBlockCaretContainer=function(blockCaretContainer){blockCaretContainer.hasAttribute("data-mce-caret")&&(showCaretContainerBlock(blockCaretContainer),setRange(getRange()),selection.scrollIntoView(blockCaretContainer))},registerEvents=function(){editor.on("mouseup",(function(e){var range=getRange();range.collapsed&&isXYInContentArea(editor,e.clientX,e.clientY)&&renderCaretAtRange(editor,range,!1).each(setRange)})),editor.on("click",(function(e){var contentEditableRoot=getContentEditableRoot$1(editor,e.target);contentEditableRoot&&(isContentEditableFalse$b(contentEditableRoot)&&(e.preventDefault(),editor.focus()),isContentEditableTrue$4(contentEditableRoot)&&dom.isChildOf(contentEditableRoot,selection.getNode())&&removeElementSelection())})),editor.on("blur NewBlock",removeElementSelection),editor.on("ResizeWindow FullscreenStateChanged",fakeCaret.reposition);var hasNormalCaretPosition=function(elm){var caretWalker=CaretWalker(elm);if(!elm.firstChild)return!1;var startPos=CaretPosition.before(elm.firstChild),newPos=caretWalker.next(startPos);return newPos&&!isNearFakeSelectionElement(newPos)},isInSameBlock=function(node1,node2){var block1,block2;return dom.getParent(node1,isBlock)===dom.getParent(node2,isBlock)},hasBetterMouseTarget=function(targetNode,caretNode){var targetBlock=dom.getParent(targetNode,isBlock),caretBlock=dom.getParent(caretNode,isBlock);return!(!targetBlock||targetNode===caretBlock||!dom.isChildOf(targetBlock,caretBlock)||!1!==isContentEditableFalse$b(getContentEditableRoot$1(editor,targetBlock)))||targetBlock&&!isInSameBlock(targetBlock,caretBlock)&&hasNormalCaretPosition(targetBlock)};editor.on("tap",(function(e){var targetElm=e.target,contentEditableRoot=getContentEditableRoot$1(editor,targetElm);isContentEditableFalse$b(contentEditableRoot)?(e.preventDefault(),selectNode(editor,contentEditableRoot).each(setElementSelection)):isFakeSelectionTargetElement(targetElm)&&selectNode(editor,targetElm).each(setElementSelection)}),!0),editor.on("mousedown",(function(e){var targetElm=e.target;if((targetElm===rootNode||"HTML"===targetElm.nodeName||dom.isChildOf(targetElm,rootNode))&&!1!==isXYInContentArea(editor,e.clientX,e.clientY)){var contentEditableRoot=getContentEditableRoot$1(editor,targetElm);if(contentEditableRoot)isContentEditableFalse$b(contentEditableRoot)?(e.preventDefault(),selectNode(editor,contentEditableRoot).each(setElementSelection)):(removeElementSelection(),isContentEditableTrue$4(contentEditableRoot)&&e.shiftKey||isXYWithinRange(e.clientX,e.clientY,selection.getRng())||(hideFakeCaret(),selection.placeCaretAt(e.clientX,e.clientY)));else if(isFakeSelectionTargetElement(targetElm))selectNode(editor,targetElm).each(setElementSelection);else if(!1===isFakeCaretTarget(targetElm)){removeElementSelection(),hideFakeCaret();var fakeCaretInfo=closestFakeCaret(rootNode,e.clientX,e.clientY);if(fakeCaretInfo&&!hasBetterMouseTarget(targetElm,fakeCaretInfo.node)){e.preventDefault();var range=showCaret(1,fakeCaretInfo.node,fakeCaretInfo.before,!1);editor.getBody().focus(),setRange(range)}}}})),editor.on("keypress",(function(e){VK.modifierPressed(e)||isContentEditableFalse$b(selection.getNode())&&e.preventDefault()})),editor.on("GetSelectionRange",(function(e){var rng=e.range;if(selectedElement){if(!selectedElement.parentNode)return void(selectedElement=null);(rng=rng.cloneRange()).selectNode(selectedElement),e.range=rng}})),editor.on("SetSelectionRange",(function(e){e.range=normalizeShortEndedElementSelection(e.range);var rng=setElementSelection(e.range,e.forward);rng&&(e.range=rng)}));var isPasteBin=function(node){return"mcepastebin"===node.id};editor.on("AfterSetSelectionRange",(function(e){var rng=e.range,parentNode=rng.startContainer.parentNode;isRangeInCaretContainer(rng)||isPasteBin(parentNode)||hideFakeCaret(),isFakeSelectionElement(parentNode)||removeElementSelection()})),editor.on("copy",(function(e){var clipboardData=e.clipboardData;if(!e.isDefaultPrevented()&&e.clipboardData&&!Env.ie){var realSelectionElement=getRealSelectionElement();realSelectionElement&&(e.preventDefault(),clipboardData.clearData(),clipboardData.setData("text/html",realSelectionElement.outerHTML),clipboardData.setData("text/plain",realSelectionElement.outerText||realSelectionElement.innerText))}})),init(editor),setup$l(editor),setup$m(editor)},isWithinCaretContainer=function(node){return isCaretContainer(node)||startsWithCaretContainer(node)||endsWithCaretContainer(node)},isRangeInCaretContainer=function(rng){return isWithinCaretContainer(rng.startContainer)||isWithinCaretContainer(rng.endContainer)},normalizeShortEndedElementSelection=function(rng){var shortEndedElements=editor.schema.getShortEndedElements(),newRng=dom.createRng(),startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset;return has(shortEndedElements,startContainer.nodeName.toLowerCase())?0===startOffset?newRng.setStartBefore(startContainer):newRng.setStartAfter(startContainer):newRng.setStart(startContainer,startOffset),has(shortEndedElements,endContainer.nodeName.toLowerCase())?0===endOffset?newRng.setEndBefore(endContainer):newRng.setEndAfter(endContainer):newRng.setEnd(endContainer,endOffset),newRng},setupOffscreenSelection=function(node,targetClone,origTargetClone){var $=editor.$,$realSelectionContainer=descendant(SugarElement.fromDom(editor.getBody()),"#"+realSelectionId).fold((function(){return $([])}),(function(elm){return $([elm.dom])}));0===$realSelectionContainer.length&&($realSelectionContainer=$('<div data-mce-bogus="all" class="mce-offscreen-selection"></div>').attr("id",realSelectionId)).appendTo(editor.getBody());var newRange=dom.createRng();targetClone===origTargetClone&&Env.ie?($realSelectionContainer.empty().append('<p style="font-size: 0" data-mce-bogus="all"> </p>').append(targetClone),newRange.setStartAfter($realSelectionContainer[0].firstChild.firstChild),newRange.setEndAfter(targetClone)):($realSelectionContainer.empty().append(" ").append(targetClone).append(" "),newRange.setStart($realSelectionContainer[0].firstChild,1),newRange.setEnd($realSelectionContainer[0].lastChild,0)),$realSelectionContainer.css({top:dom.getPos(node,editor.getBody()).y}),$realSelectionContainer[0].focus();var sel=selection.getSel();return sel.removeAllRanges(),sel.addRange(newRange),newRange},selectElement=function(elm){var targetClone=elm.cloneNode(!0),e=editor.fire("ObjectSelected",{target:elm,targetClone:targetClone});if(e.isDefaultPrevented())return null;var range=setupOffscreenSelection(elm,e.targetClone,targetClone),nodeElm=SugarElement.fromDom(elm);return each(descendants$1(SugarElement.fromDom(editor.getBody()),"*[data-mce-selected]"),(function(elm){eq$2(nodeElm,elm)||remove$1(elm,"data-mce-selected")})),dom.getAttrib(elm,"data-mce-selected")||elm.setAttribute("data-mce-selected","1"),selectedElement=elm,hideFakeCaret(),range},setElementSelection=function(range,forward){if(!range)return null;if(range.collapsed){if(!isRangeInCaretContainer(range)){var dir=forward?1:-1,caretPosition=getNormalizedRangeEndPoint(dir,rootNode,range),beforeNode=caretPosition.getNode(!forward);if(isFakeCaretTarget(beforeNode))return showCaret(dir,beforeNode,!!forward&&!caretPosition.isAtEnd(),!1);var afterNode=caretPosition.getNode(forward);if(isFakeCaretTarget(afterNode))return showCaret(dir,afterNode,!forward&&!caretPosition.isAtEnd(),!1)}return null}var startContainer=range.startContainer,startOffset=range.startOffset,endOffset=range.endOffset;if(3===startContainer.nodeType&&0===startOffset&&isContentEditableFalse$b(startContainer.parentNode)&&(startContainer=startContainer.parentNode,startOffset=dom.nodeIndex(startContainer),startContainer=startContainer.parentNode),1!==startContainer.nodeType)return null;if(endOffset===startOffset+1&&startContainer===range.endContainer){var node=startContainer.childNodes[startOffset];if(isFakeSelectionTargetElement(node))return selectElement(node)}return null},removeElementSelection=function(){selectedElement&&selectedElement.removeAttribute("data-mce-selected"),descendant(SugarElement.fromDom(editor.getBody()),"#"+realSelectionId).each(remove),selectedElement=null},destroy=function(){fakeCaret.destroy(),selectedElement=null},hideFakeCaret=function(){fakeCaret.hide()};return Env.ceFalse&&registerEvents(),{showCaret:showCaret,showBlockCaretContainer:showBlockCaretContainer,hideFakeCaret:hideFakeCaret,destroy:destroy}},Quirks=function(editor){var each=Tools.each,BACKSPACE=VK.BACKSPACE,DELETE=VK.DELETE,dom=editor.dom,selection=editor.selection,parser=editor.parser,isGecko=Env.gecko,isIE=Env.ie,isWebKit=Env.webkit,mceInternalUrlPrefix="data:text/mce-internal,",mceInternalDataType=isIE?"Text":"URL",setEditorCommandState=function(cmd,state){try{editor.getDoc().execCommand(cmd,!1,state)}catch(ex){}},isDefaultPrevented=function(e){return e.isDefaultPrevented()},setMceInternalContent=function(e){var selectionHtml,internalContent;e.dataTransfer&&(editor.selection.isCollapsed()&&"IMG"===e.target.tagName&&selection.select(e.target),(selectionHtml=editor.selection.getContent()).length>0&&(internalContent=mceInternalUrlPrefix+escape(editor.id)+","+escape(selectionHtml),e.dataTransfer.setData(mceInternalDataType,internalContent)))},getMceInternalContent=function(e){var internalContent;return e.dataTransfer&&(internalContent=e.dataTransfer.getData(mceInternalDataType))&&internalContent.indexOf(mceInternalUrlPrefix)>=0?(internalContent=internalContent.substr(mceInternalUrlPrefix.length).split(","),{id:unescape(internalContent[0]),html:unescape(internalContent[1])}):null},insertClipboardContents=function(content,internal){editor.queryCommandSupported("mceInsertClipboardContent")?editor.execCommand("mceInsertClipboardContent",!1,{content:content,internal:internal}):editor.execCommand("mceInsertContent",!1,content)},emptyEditorWhenDeleting=function(){var serializeRng=function(rng){var body=dom.create("body"),contents=rng.cloneContents();return body.appendChild(contents),selection.serializer.serialize(body,{format:"html"})},allContentsSelected=function(rng){var selection=serializeRng(rng),allRng=dom.createRng(),allSelection;return allRng.selectNode(editor.getBody()),selection===serializeRng(allRng)};editor.on("keydown",(function(e){var keyCode=e.keyCode,isCollapsed,body;if(!isDefaultPrevented(e)&&(keyCode===DELETE||keyCode===BACKSPACE)){if(isCollapsed=editor.selection.isCollapsed(),body=editor.getBody(),isCollapsed&&!dom.isEmpty(body))return;if(!isCollapsed&&!allContentsSelected(editor.selection.getRng()))return;e.preventDefault(),editor.setContent(""),body.firstChild&&dom.isBlock(body.firstChild)?editor.selection.setCursorLocation(body.firstChild,0):editor.selection.setCursorLocation(body,0),editor.nodeChanged()}}))},selectAll=function(){editor.shortcuts.add("meta+a",null,"SelectAll")},inputMethodFocus=function(){editor.inline||dom.bind(editor.getDoc(),"mousedown mouseup",(function(e){var rng;if(e.target===editor.getDoc().documentElement)if(rng=selection.getRng(),editor.getBody().focus(),"mousedown"===e.type){if(isCaretContainer(rng.startContainer))return;selection.placeCaretAt(e.clientX,e.clientY)}else selection.setRng(rng)}))},removeHrOnBackspace=function(){editor.on("keydown",(function(e){if(!isDefaultPrevented(e)&&e.keyCode===BACKSPACE){if(!editor.getBody().getElementsByTagName("hr").length)return;if(selection.isCollapsed()&&0===selection.getRng().startOffset){var node=selection.getNode(),previousSibling=node.previousSibling;if("HR"===node.nodeName)return dom.remove(node),void e.preventDefault();previousSibling&&previousSibling.nodeName&&"hr"===previousSibling.nodeName.toLowerCase()&&(dom.remove(previousSibling),e.preventDefault())}}}))},focusBody=function(){Range.prototype.getClientRects||editor.on("mousedown",(function(e){if(!isDefaultPrevented(e)&&"HTML"===e.target.nodeName){var body_1=editor.getBody();body_1.blur(),Delay.setEditorTimeout(editor,(function(){body_1.focus()}))}}))},selectControlElements=function(){editor.on("click",(function(e){var target=e.target;/^(IMG|HR)$/.test(target.nodeName)&&"false"!==dom.getContentEditableParent(target)&&(e.preventDefault(),editor.selection.select(target),editor.nodeChanged()),"A"===target.nodeName&&dom.hasClass(target,"mce-item-anchor")&&(e.preventDefault(),selection.select(target))}))},removeStylesWhenDeletingAcrossBlockElements=function(){var getAttributeApplyFunction=function(){var template=dom.getAttribs(selection.getStart().cloneNode(!1));return function(){var target=selection.getStart();target!==editor.getBody()&&(dom.setAttrib(target,"style",null),each(template,(function(attr){target.setAttributeNode(attr.cloneNode(!0))})))}},isSelectionAcrossElements=function(){return!selection.isCollapsed()&&dom.getParent(selection.getStart(),dom.isBlock)!==dom.getParent(selection.getEnd(),dom.isBlock)};editor.on("keypress",(function(e){var applyAttributes;if(!isDefaultPrevented(e)&&(8===e.keyCode||46===e.keyCode)&&isSelectionAcrossElements())return applyAttributes=getAttributeApplyFunction(),editor.getDoc().execCommand("delete",!1,null),applyAttributes(),e.preventDefault(),!1})),dom.bind(editor.getDoc(),"cut",(function(e){var applyAttributes;!isDefaultPrevented(e)&&isSelectionAcrossElements()&&(applyAttributes=getAttributeApplyFunction(),Delay.setEditorTimeout(editor,(function(){applyAttributes()})))}))},disableBackspaceIntoATable=function(){editor.on("keydown",(function(e){if(!isDefaultPrevented(e)&&e.keyCode===BACKSPACE&&selection.isCollapsed()&&0===selection.getRng().startOffset){var previousSibling=selection.getNode().previousSibling;if(previousSibling&&previousSibling.nodeName&&"table"===previousSibling.nodeName.toLowerCase())return e.preventDefault(),!1}}))},removeBlockQuoteOnBackSpace,setGeckoEditingOptions=function(){var setOpts=function(){setEditorCommandState("StyleWithCSS",!1),setEditorCommandState("enableInlineTableEditing",!1),getObjectResizing(editor)||setEditorCommandState("enableObjectResizing",!1)};isReadOnly(editor)||editor.on("BeforeExecCommand mousedown",setOpts)},addBrAfterLastLinks=function(){var fixLinks=function(){each(dom.select("a"),(function(node){var parentNode=node.parentNode,root=dom.getRoot();if(parentNode.lastChild===node){for(;parentNode&&!dom.isBlock(parentNode);){if(parentNode.parentNode.lastChild!==parentNode||parentNode===root)return;parentNode=parentNode.parentNode}dom.add(parentNode,"br",{"data-mce-bogus":1})}}))};editor.on("SetContent ExecCommand",(function(e){"setcontent"!==e.type&&"mceInsertLink"!==e.command||fixLinks()}))},setDefaultBlockType=function(){getForcedRootBlock(editor)&&editor.on("init",(function(){setEditorCommandState("DefaultParagraphSeparator",getForcedRootBlock(editor))}))},normalizeSelection=function(){editor.on("keyup focusin mouseup",(function(e){VK.modifierPressed(e)||selection.normalize()}),!0)},showBrokenImageIcon=function(){editor.contentStyles.push("img:-moz-broken {-moz-force-broken-image-icon:1;min-width:24px;min-height:24px}")},restoreFocusOnKeyDown=function(){editor.inline||editor.on("keydown",(function(){document.activeElement===document.body&&editor.getWin().focus()}))},bodyHeight=function(){editor.inline||(editor.contentStyles.push("body {min-height: 150px}"),editor.on("click",(function(e){var rng;if("HTML"===e.target.nodeName){if(Env.ie>11)return void editor.getBody().focus();rng=editor.selection.getRng(),editor.getBody().focus(),editor.selection.setRng(rng),editor.selection.normalize(),editor.nodeChanged()}})))},blockCmdArrowNavigation=function(){Env.mac&&editor.on("keydown",(function(e){var selection_1;!VK.metaKeyPressed(e)||e.shiftKey||37!==e.keyCode&&39!==e.keyCode||(e.preventDefault(),editor.selection.getSel().modify("move",37===e.keyCode?"backward":"forward","lineboundary"))}))},disableAutoUrlDetect=function(){setEditorCommandState("AutoUrlDetect",!1)},tapLinksAndImages=function(){editor.on("click",(function(e){var elm=e.target;do{if("A"===elm.tagName)return void e.preventDefault()}while(elm=elm.parentNode)})),editor.contentStyles.push(".mce-content-body {-webkit-touch-callout: none}")},blockFormSubmitInsideEditor=function(){editor.on("init",(function(){editor.dom.bind(editor.getBody(),"submit",(function(e){e.preventDefault()}))}))},removeAppleInterchangeBrs=function(){parser.addNodeFilter("br",(function(nodes){for(var i=nodes.length;i--;)"Apple-interchange-newline"===nodes[i].attr("class")&&nodes[i].remove()}))},ieInternalDragAndDrop=function(){editor.on("dragstart",(function(e){setMceInternalContent(e)})),editor.on("drop",(function(e){if(!isDefaultPrevented(e)){var internalContent=getMceInternalContent(e);if(internalContent&&internalContent.id!==editor.id){e.preventDefault();var rng=fromPoint$1(e.x,e.y,editor.getDoc());selection.setRng(rng),insertClipboardContents(internalContent.html,!0)}}}))},refreshContentEditable=noop,isHidden=function(){if(!isGecko||editor.removed)return!1;var sel=editor.selection.getSel();return!sel||!sel.rangeCount||0===sel.rangeCount};return function(){editor.on("keydown",(function(e){var rng,parent;if(!isDefaultPrevented(e)&&e.keyCode===VK.BACKSPACE){var container=(rng=selection.getRng()).startContainer,offset=rng.startOffset,root=dom.getRoot();if(parent=container,rng.collapsed&&0===offset){for(;parent&&parent.parentNode&&parent.parentNode.firstChild===parent&&parent.parentNode!==root;)parent=parent.parentNode;"BLOCKQUOTE"===parent.tagName&&(editor.formatter.toggle("blockquote",null,parent),(rng=dom.createRng()).setStart(container,0),rng.setEnd(container,0),selection.setRng(rng))}}}))}(),emptyEditorWhenDeleting(),Env.windowsPhone||normalizeSelection(),isWebKit&&(inputMethodFocus(),selectControlElements(),setDefaultBlockType(),blockFormSubmitInsideEditor(),disableBackspaceIntoATable(),removeAppleInterchangeBrs(),Env.iOS?(restoreFocusOnKeyDown(),bodyHeight(),tapLinksAndImages()):selectAll()),Env.ie>=11&&(bodyHeight(),disableBackspaceIntoATable()),Env.ie&&(selectAll(),disableAutoUrlDetect(),ieInternalDragAndDrop()),isGecko&&(removeHrOnBackspace(),focusBody(),removeStylesWhenDeletingAcrossBlockElements(),setGeckoEditingOptions(),addBrAfterLastLinks(),showBrokenImageIcon(),blockCmdArrowNavigation(),disableBackspaceIntoATable()),{refreshContentEditable:refreshContentEditable,isHidden:isHidden}},DOM$4=DOMUtils.DOM,appendStyle=function(editor,text){var body=SugarElement.fromDom(editor.getBody()),container=getStyleContainer(getRootNode(body)),style=SugarElement.fromTag("style");set(style,"type","text/css"),append(style,SugarElement.fromText(text)),append(container,style),editor.on("remove",(function(){remove(style)}))},getRootName=function(editor){return editor.inline?editor.getElement().nodeName.toLowerCase():void 0},removeUndefined=function(obj){return filter$1(obj,(function(v){return!1===isUndefined(v)}))},mkParserSettings=function(editor){var settings=editor.settings,blobCache=editor.editorUpload.blobCache;return removeUndefined({allow_conditional_comments:settings.allow_conditional_comments,allow_html_data_urls:settings.allow_html_data_urls,allow_svg_data_urls:settings.allow_svg_data_urls,allow_html_in_named_anchor:settings.allow_html_in_named_anchor,allow_script_urls:settings.allow_script_urls,allow_unsafe_link_target:settings.allow_unsafe_link_target,convert_fonts_to_spans:settings.convert_fonts_to_spans,fix_list_elements:settings.fix_list_elements,font_size_legacy_values:settings.font_size_legacy_values,forced_root_block:settings.forced_root_block,forced_root_block_attrs:settings.forced_root_block_attrs,padd_empty_with_br:settings.padd_empty_with_br,preserve_cdata:settings.preserve_cdata,remove_trailing_brs:settings.remove_trailing_brs,inline_styles:settings.inline_styles,root_name:getRootName(editor),validate:!0,blob_cache:blobCache,images_dataimg_filter:settings.images_dataimg_filter})},mkSerializerSettings=function(editor){var settings=editor.settings;return __assign(__assign({},mkParserSettings(editor)),removeUndefined({url_converter:settings.url_converter,url_converter_scope:settings.url_converter_scope,element_format:settings.element_format,entities:settings.entities,entity_encoding:settings.entity_encoding,indent:settings.indent,indent_after:settings.indent_after,indent_before:settings.indent_before,block_elements:settings.block_elements,boolean_attributes:settings.boolean_attributes,custom_elements:settings.custom_elements,extended_valid_elements:settings.extended_valid_elements,invalid_elements:settings.invalid_elements,invalid_styles:settings.invalid_styles,move_caret_before_on_enter_elements:settings.move_caret_before_on_enter_elements,non_empty_elements:settings.non_empty_elements,schema:settings.schema,self_closing_elements:settings.self_closing_elements,short_ended_elements:settings.short_ended_elements,special:settings.special,text_block_elements:settings.text_block_elements,text_inline_elements:settings.text_inline_elements,valid_children:settings.valid_children,valid_classes:settings.valid_classes,valid_elements:settings.valid_elements,valid_styles:settings.valid_styles,verify_html:settings.verify_html,whitespace_elements:settings.whitespace_elements}))},createParser=function(editor){var parser=DomParser(mkParserSettings(editor),editor.schema);return parser.addAttributeFilter("src,href,style,tabindex",(function(nodes,name){for(var i=nodes.length,node,value,dom=editor.dom,internalName="data-mce-"+name;i--;)if((value=(node=nodes[i]).attr(name))&&!node.attr(internalName)){if(0===value.indexOf("data:")||0===value.indexOf("blob:"))continue;"style"===name?((value=dom.serializeStyle(dom.parseStyle(value),node.name)).length||(value=null),node.attr(internalName,value),node.attr(name,value)):"tabindex"===name?(node.attr(internalName,value),node.attr(name,null)):node.attr(internalName,editor.convertURL(value,name,node.name))}})),parser.addNodeFilter("script",(function(nodes){for(var i=nodes.length;i--;){var node=nodes[i],type=node.attr("type")||"no/type";0!==type.indexOf("mce-")&&node.attr("type","mce-"+type)}})),editor.settings.preserve_cdata&&parser.addNodeFilter("#cdata",(function(nodes){for(var i=nodes.length;i--;){var node=nodes[i];node.type=8,node.name="#comment",node.value="[CDATA["+editor.dom.encode(node.value)+"]]"}})),parser.addNodeFilter("p,h1,h2,h3,h4,h5,h6,div",(function(nodes){for(var i=nodes.length,nonEmptyElements=editor.schema.getNonEmptyElements();i--;){var node=nodes[i];node.isEmpty(nonEmptyElements)&&0===node.getAll("br").length&&(node.append(new AstNode("br",1)).shortEnded=!0)}})),parser},autoFocus=function(editor){editor.settings.auto_focus&&Delay.setEditorTimeout(editor,(function(){var focusEditor;(focusEditor=!0===editor.settings.auto_focus?editor:editor.editorManager.get(editor.settings.auto_focus)).destroyed||focusEditor.focus()}),100)},moveSelectionToFirstCaretPosition=function(editor){var root=editor.dom.getRoot();editor.inline||hasAnyRanges(editor)&&editor.selection.getStart(!0)!==root||firstPositionIn(root).each((function(pos){var node=pos.getNode(),caretPos=isTable(node)?firstPositionIn(node).getOr(pos):pos;Env.browser.isIE()?storeNative(editor,caretPos.toRange()):editor.selection.setRng(caretPos.toRange())}))},initEditor=function(editor){editor.bindPendingEventDelegates(),editor.initialized=!0,fireInit(editor),editor.focus(!0),moveSelectionToFirstCaretPosition(editor),editor.nodeChanged({initial:!0}),editor.execCallback("init_instance_callback",editor),autoFocus(editor)},getStyleSheetLoader=function(editor){return editor.inline?editor.ui.styleSheetLoader:editor.dom.styleSheetLoader},makeStylesheetLoadingPromises=function(editor,css,framedFonts){var promises=[new promiseObj((function(resolve,reject){return getStyleSheetLoader(editor).loadAll(css,resolve,reject)}))];return editor.inline?promises:promises.concat([new promiseObj((function(resolve,reject){return editor.ui.styleSheetLoader.loadAll(framedFonts,resolve,reject)}))])},loadContentCss=function(editor,css){var styleSheetLoader=getStyleSheetLoader(editor),fontCss=getFontCss(editor),removeCss=function(){styleSheetLoader.unloadAll(css),editor.inline||editor.ui.styleSheetLoader.unloadAll(fontCss)},loaded=function(){editor.removed?removeCss():(editor.on("remove",removeCss),initEditor(editor))};promiseObj.all(makeStylesheetLoadingPromises(editor,css,fontCss)).then(loaded).catch(loaded)},preInit=function(editor,rtcMode){var settings=editor.settings,doc=editor.getDoc(),body=editor.getBody();settings.browser_spellcheck||settings.gecko_spellcheck||(doc.body.spellcheck=!1,DOM$4.setAttrib(body,"spellcheck","false")),editor.quirks=Quirks(editor),firePostRender(editor);var directionality=getDirectionality(editor);if(void 0!==directionality&&(body.dir=directionality),settings.protect&&editor.on("BeforeSetContent",(function(e){Tools.each(settings.protect,(function(pattern){e.content=e.content.replace(pattern,(function(str){return"\x3c!--mce:protected "+escape(str)+"--\x3e"}))}))})),editor.on("SetContent",(function(){editor.addVisual(editor.getBody())})),!1===rtcMode&&editor.load({initial:!0,format:"html"}),editor.startContent=editor.getContent({format:"raw"}),editor.on("compositionstart compositionend",(function(e){editor.composing="compositionstart"===e.type})),editor.contentStyles.length>0){var contentCssText_1="";Tools.each(editor.contentStyles,(function(style){contentCssText_1+=style+"\r\n"})),editor.dom.addStyle(contentCssText_1)}loadContentCss(editor,editor.contentCSS),settings.content_style&&appendStyle(editor,settings.content_style)},initContentBody=function(editor,skipWrite){var settings=editor.settings,targetElm=editor.getElement(),doc=editor.getDoc();settings.inline||(editor.getElement().style.visibility=editor.orgVisibility),skipWrite||editor.inline||(doc.open(),doc.write(editor.iframeHTML),doc.close()),editor.inline&&(DOM$4.addClass(targetElm,"mce-content-body"),editor.contentDocument=doc=document,editor.contentWindow=window,editor.bodyElement=targetElm,editor.contentAreaContainer=targetElm);var body=editor.getBody();body.disabled=!0,editor.readonly=!!settings.readonly,editor.readonly||(editor.inline&&"static"===DOM$4.getStyle(body,"position",!0)&&(body.style.position="relative"),body.contentEditable=editor.getParam("content_editable_state",!0)),body.disabled=!1,editor.editorUpload=EditorUpload(editor),editor.schema=Schema(settings),editor.dom=DOMUtils(doc,{keep_values:!0,url_converter:editor.convertURL,url_converter_scope:editor,hex_colors:settings.force_hex_style_colors,update_styles:!0,root_element:editor.inline?editor.getBody():null,collect:function(){return editor.inline},schema:editor.schema,contentCssCors:shouldUseContentCssCors(editor),referrerPolicy:getReferrerPolicy(editor),onSetAttrib:function(e){editor.fire("SetAttrib",e)}}),editor.parser=createParser(editor),editor.serializer=DomSerializer(mkSerializerSettings(editor),editor),editor.selection=EditorSelection(editor.dom,editor.getWin(),editor.serializer,editor),editor.annotator=Annotator(editor),editor.formatter=Formatter(editor),editor.undoManager=UndoManager(editor),editor._nodeChangeDispatcher=new NodeChange(editor),editor._selectionOverrides=SelectionOverrides(editor),setup$9(editor),setup$j(editor),isRtc(editor)||setup$k(editor);var caret=setup$i(editor);setup$8(editor,caret),setup$a(editor),setup$7(editor),firePreInit(editor),setup$5(editor).fold((function(){preInit(editor,!1)}),(function(loadingRtc){editor.setProgressState(!0),loadingRtc.then((function(rtcMode){editor.setProgressState(!1),preInit(editor,rtcMode)}),(function(err){editor.notificationManager.open({type:"error",text:String(err)}),preInit(editor,!0)}))}))},DOM$5=DOMUtils.DOM,relaxDomain=function(editor,ifr){if(document.domain!==window.location.hostname&&Env.browser.isIE()){var bodyUuid=uuid("mce");editor[bodyUuid]=function(){initContentBody(editor)};var domainRelaxUrl='javascript:(function(){document.open();document.domain="'+document.domain+'";var ed = window.parent.tinymce.get("'+editor.id+'");document.write(ed.iframeHTML);document.close();ed.'+bodyUuid+"(true);})()";return DOM$5.setAttrib(ifr,"src",domainRelaxUrl),!0}return!1},createIframeElement=function(id,title,height,customAttrs){var iframe=SugarElement.fromTag("iframe");return setAll(iframe,customAttrs),setAll(iframe,{id:id+"_ifr",frameBorder:"0",allowTransparency:"true",title:title}),add$3(iframe,"tox-edit-area__iframe"),iframe},getIframeHtml=function(editor){var iframeHTML=getDocType(editor)+"<html><head>";getDocumentBaseUrl(editor)!==editor.documentBaseUrl&&(iframeHTML+='<base href="'+editor.documentBaseURI.getURI()+'" />'),iframeHTML+='<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />';var bodyId=getBodyId(editor),bodyClass=getBodyClass(editor);return getContentSecurityPolicy(editor)&&(iframeHTML+='<meta http-equiv="Content-Security-Policy" content="'+getContentSecurityPolicy(editor)+'" />'),iframeHTML+='</head><body id="'+bodyId+'" class="mce-content-body '+bodyClass+'" data-id="'+editor.id+'"><br></body></html>'},createIframe=function(editor,o){var title=editor.editorManager.translate("Rich Text Area. Press ALT-0 for help."),ifr=createIframeElement(editor.id,title,o.height,getIframeAttrs(editor)).dom;ifr.onload=function(){ifr.onload=null,editor.fire("load")};var isDomainRelaxed=relaxDomain(editor,ifr);return editor.contentAreaContainer=o.iframeContainer,editor.iframeElement=ifr,editor.iframeHTML=getIframeHtml(editor),DOM$5.add(o.iframeContainer,ifr),isDomainRelaxed},init$1=function(editor,boxInfo){var isDomainRelaxed=createIframe(editor,boxInfo);boxInfo.editorContainer&&(DOM$5.get(boxInfo.editorContainer).style.display=editor.orgDisplay,editor.hidden=DOM$5.isHidden(boxInfo.editorContainer)),editor.getElement().style.display="none",DOM$5.setAttrib(editor.id,"aria-hidden","true"),isDomainRelaxed||initContentBody(editor)},DOM$6=DOMUtils.DOM,initPlugin=function(editor,initializedPlugins,plugin){var Plugin=PluginManager.get(plugin),pluginUrl=PluginManager.urls[plugin]||editor.documentBaseUrl.replace(/\/$/,"");if(plugin=Tools.trim(plugin),Plugin&&-1===Tools.inArray(initializedPlugins,plugin)){if(Tools.each(PluginManager.dependencies(plugin),(function(dep){initPlugin(editor,initializedPlugins,dep)})),editor.plugins[plugin])return;try{var pluginInstance=new Plugin(editor,pluginUrl,editor.$);editor.plugins[plugin]=pluginInstance,pluginInstance.init&&(pluginInstance.init(editor,pluginUrl),initializedPlugins.push(plugin))}catch(e){pluginInitError(editor,plugin,e)}}},trimLegacyPrefix=function(name){return name.replace(/^\-/,"")},initPlugins=function(editor){var initializedPlugins=[];Tools.each(getPlugins(editor).split(/[ ,]/),(function(name){initPlugin(editor,initializedPlugins,trimLegacyPrefix(name))}))},initIcons=function(editor){var iconPackName=Tools.trim(getIconPackName(editor)),currentIcons=editor.ui.registry.getAll().icons,loadIcons=__assign(__assign({},IconManager.get("default").icons),IconManager.get(iconPackName).icons);each$1(loadIcons,(function(svgData,icon){has(currentIcons,icon)||editor.ui.registry.addIcon(icon,svgData)}))},initTheme=function(editor){var theme=getTheme(editor);if(isString(theme)){editor.settings.theme=trimLegacyPrefix(theme);var Theme=ThemeManager.get(theme);editor.theme=new Theme(editor,ThemeManager.urls[theme]),editor.theme.init&&editor.theme.init(editor,ThemeManager.urls[theme]||editor.documentBaseUrl.replace(/\/$/,""),editor.$)}else editor.theme={}},renderFromLoadedTheme=function(editor){return editor.theme.renderUI()},renderFromThemeFunc=function(editor){var elm=editor.getElement(),theme,info=getTheme(editor)(editor,elm);return info.editorContainer.nodeType&&(info.editorContainer.id=info.editorContainer.id||editor.id+"_parent"),info.iframeContainer&&info.iframeContainer.nodeType&&(info.iframeContainer.id=info.iframeContainer.id||editor.id+"_iframecontainer"),info.height=info.iframeHeight?info.iframeHeight:elm.offsetHeight,info},createThemeFalseResult=function(element){return{editorContainer:element,iframeContainer:element,api:{}}},renderThemeFalseIframe=function(targetElement){var iframeContainer=DOM$6.create("div");return DOM$6.insertAfter(iframeContainer,targetElement),createThemeFalseResult(iframeContainer)},renderThemeFalse=function(editor){var targetElement=editor.getElement();return editor.inline?createThemeFalseResult(null):renderThemeFalseIframe(targetElement)},renderThemeUi=function(editor){var elm=editor.getElement();return editor.orgDisplay=elm.style.display,isString(getTheme(editor))?renderFromLoadedTheme(editor):isFunction(getTheme(editor))?renderFromThemeFunc(editor):renderThemeFalse(editor)},augmentEditorUiApi=function(editor,api){var uiApiFacade={show:Optional.from(api.show).getOr(noop),hide:Optional.from(api.hide).getOr(noop),disable:Optional.from(api.disable).getOr(noop),isDisabled:Optional.from(api.isDisabled).getOr(never),enable:function(){editor.mode.isReadOnly()||Optional.from(api.enable).map(call)}};editor.ui=__assign(__assign({},editor.ui),uiApiFacade)},init$2=function(editor){editor.fire("ScriptsLoaded"),initIcons(editor),initTheme(editor),initPlugins(editor);var renderInfo=renderThemeUi(editor);augmentEditorUiApi(editor,Optional.from(renderInfo.api).getOr({}));var boxInfo={editorContainer:renderInfo.editorContainer,iframeContainer:renderInfo.iframeContainer};return editor.editorContainer=boxInfo.editorContainer?boxInfo.editorContainer:null,appendContentCssFromSettings(editor),editor.inline?initContentBody(editor):init$1(editor,boxInfo)},DOM$7=DOMUtils.DOM,hasSkipLoadPrefix=function(name){return"-"===name.charAt(0)},loadLanguage=function(scriptLoader,editor){var languageCode=getLanguageCode(editor),languageUrl=getLanguageUrl(editor);if(!1===I18n.hasCode(languageCode)&&"en"!==languageCode){var url_1=""!==languageUrl?languageUrl:editor.editorManager.baseURL+"/langs/"+languageCode+".js";scriptLoader.add(url_1,noop,void 0,(function(){languageLoadError(editor,url_1,languageCode)}))}},loadTheme=function(scriptLoader,editor,suffix,callback){var theme=getTheme(editor);if(isString(theme)){if(!hasSkipLoadPrefix(theme)&&!ThemeManager.urls.hasOwnProperty(theme)){var themeUrl=getThemeUrl(editor);themeUrl?ThemeManager.load(theme,editor.documentBaseURI.toAbsolute(themeUrl)):ThemeManager.load(theme,"themes/"+theme+"/theme"+suffix+".js")}scriptLoader.loadQueue((function(){ThemeManager.waitFor(theme,callback)}))}else callback()},loadCustomJs=function(scriptLoader,editor,suffix,callback){var done=function(){};["custom_js/format.js"].map((function(url){return AddOnManager.baseURL+"/"+url})).forEach((function(urlString){ScriptLoader.ScriptLoader.add(urlString,done,void 0,(function(){customJsLoadError(editor,urlString,languageCode)}))}))},getIconsUrlMetaFromUrl=function(editor){return Optional.from(getIconsUrl(editor)).filter((function(url){return url.length>0})).map((function(url){return{url:url,name:Optional.none()}}))},getIconsUrlMetaFromName=function(editor,name,suffix){return Optional.from(name).filter((function(name){return name.length>0&&!IconManager.has(name)})).map((function(name){return{url:editor.editorManager.baseURL+"/icons/"+name+"/icons"+suffix+".js",name:Optional.some(name)}}))},loadIcons=function(scriptLoader,editor,suffix){var defaultIconsUrl=getIconsUrlMetaFromName(editor,"default",suffix),customIconsUrl=getIconsUrlMetaFromUrl(editor).orThunk((function(){return getIconsUrlMetaFromName(editor,getIconPackName(editor),"")}));each(cat([defaultIconsUrl,customIconsUrl]),(function(urlMeta){scriptLoader.add(urlMeta.url,noop,void 0,(function(){iconsLoadError(editor,urlMeta.url,urlMeta.name.getOrUndefined())}))}))},loadPlugins=function(editor,suffix){Tools.each(getExternalPlugins(editor),(function(url,name){PluginManager.load(name,url,noop,void 0,(function(){pluginLoadError(editor,url,name)})),editor.settings.plugins+=" "+name})),Tools.each(getPlugins(editor).split(/[ ,]/),(function(plugin){if((plugin=Tools.trim(plugin))&&!PluginManager.urls[plugin])if(hasSkipLoadPrefix(plugin)){plugin=plugin.substr(1,plugin.length);var dependencies=PluginManager.dependencies(plugin);Tools.each(dependencies,(function(depPlugin){var defaultSettings={prefix:"plugins/",resource:depPlugin,suffix:"/plugin"+suffix+".js"},dep=PluginManager.createUrl(defaultSettings,depPlugin);PluginManager.load(dep.resource,dep,noop,void 0,(function(){pluginLoadError(editor,dep.prefix+dep.resource+dep.suffix,dep.resource)}))}))}else{var url_2={prefix:"plugins/",resource:plugin,suffix:"/plugin"+suffix+".js"};PluginManager.load(plugin,url_2,noop,void 0,(function(){pluginLoadError(editor,url_2.prefix+url_2.resource+url_2.suffix,plugin)}))}}))},loadScripts=function(editor,suffix){var scriptLoader=ScriptLoader.ScriptLoader;loadTheme(scriptLoader,editor,suffix,(function(){loadCustomJs(scriptLoader,editor),loadLanguage(scriptLoader,editor),loadIcons(scriptLoader,editor,suffix),loadPlugins(editor,suffix),scriptLoader.loadQueue((function(){editor.removed||init$2(editor)}),editor,(function(){editor.removed||init$2(editor)}))}))},getStyleSheetLoader$1=function(element,editor){return instance.forElement(element,{contentCssCors:hasContentCssCors(editor),referrerPolicy:getReferrerPolicy(editor)})},render=function(editor){var id=editor.id;I18n.setCode(getLanguageCode(editor));var readyHandler=function(){DOM$7.unbind(window,"ready",readyHandler),editor.render()};if(EventUtils.Event.domLoaded){if(editor.getElement()&&Env.contentEditable){var element=SugarElement.fromDom(editor.getElement()),snapshot=clone(element);editor.on("remove",(function(){eachr(element.dom.attributes,(function(attr){return remove$1(element,attr.name)})),setAll(element,snapshot)})),editor.ui.styleSheetLoader=getStyleSheetLoader$1(element,editor),isInline$1(editor)?editor.inline=!0:(editor.orgVisibility=editor.getElement().style.visibility,editor.getElement().style.visibility="hidden");var form=editor.getElement().form||DOM$7.getParent(id,"form");form&&(editor.formElement=form,hasHiddenInput(editor)&&!isTextareaOrInput(editor.getElement())&&(DOM$7.insertAfter(DOM$7.create("input",{type:"hidden",name:id}),id),editor.hasHiddenInput=!0),editor.formEventDelegate=function(e){editor.fire(e.type,e)},DOM$7.bind(form,"submit reset",editor.formEventDelegate),editor.on("reset",(function(){editor.resetContent()})),!shouldPatchSubmit(editor)||form.submit.nodeType||form.submit.length||form._mceOldSubmit||(form._mceOldSubmit=form.submit,form.submit=function(){return editor.editorManager.triggerSave(),editor.setDirty(!1),form._mceOldSubmit(form)})),editor.windowManager=WindowManager(editor),editor.notificationManager=NotificationManager(editor),isEncodingXml(editor)&&editor.on("GetContent",(function(e){e.save&&(e.content=DOM$7.encode(e.content))})),shouldAddFormSubmitTrigger(editor)&&editor.on("submit",(function(){editor.initialized&&editor.save()})),shouldAddUnloadTrigger(editor)&&(editor._beforeUnload=function(){!editor.initialized||editor.destroyed||editor.isHidden()||editor.save({format:"raw",no_events:!0,set_dirty:!1})},editor.editorManager.on("BeforeUnload",editor._beforeUnload)),editor.editorManager.add(editor),loadScripts(editor,editor.suffix)}}else DOM$7.bind(window,"ready",readyHandler)},addVisual$1=function(editor,elm){return addVisual(editor,elm)},legacyPropNames={"font-size":"size","font-family":"face"},getSpecifiedFontProp=function(propName,rootElm,elm){var getProperty=function(elm){return getRaw(elm,propName).orThunk((function(){return"font"===name(elm)?get$1(legacyPropNames,propName).bind((function(legacyPropName){return getOpt(elm,legacyPropName)})):Optional.none()}))},isRoot=function(elm){return eq$2(SugarElement.fromDom(rootElm),elm)};return closest$2(SugarElement.fromDom(elm),(function(elm){return getProperty(elm)}),isRoot)},normalizeFontFamily=function(fontFamily){return fontFamily.replace(/[\'\"\\]/g,"").replace(/,\s+/g,",")},getComputedFontProp=function(propName,elm){return Optional.from(DOMUtils.DOM.getStyle(elm,propName,!0))},getFontProp=function(propName){return function(rootElm,elm){return Optional.from(elm).map(SugarElement.fromDom).filter(isElement).bind((function(element){return getSpecifiedFontProp(propName,rootElm,element.dom).or(getComputedFontProp(propName,element.dom))})).getOr("")}},getFontSize=getFontProp("font-size"),getFontFamily=compose(normalizeFontFamily,getFontProp("font-family")),findFirstCaretElement=function(editor){return firstPositionIn(editor.getBody()).map((function(caret){var container=caret.container();return isText$1(container)?container.parentNode:container}))},getCaretElement=function(editor){return Optional.from(editor.selection.getRng()).bind((function(rng){var root=editor.getBody(),atStartOfNode;return rng.startContainer===root&&0===rng.startOffset?Optional.none():Optional.from(editor.selection.getStart(!0))}))},mapRange=function(editor,mapper){return getCaretElement(editor).orThunk(curry(findFirstCaretElement,editor)).map(SugarElement.fromDom).filter(isElement).map(mapper)},fromFontSizeNumber=function(editor,value){if(/^[0-9.]+$/.test(value)){var fontSizeNumber=parseInt(value,10);if(fontSizeNumber>=1&&fontSizeNumber<=7){var fontSizes=getFontStyleValues(editor),fontClasses=getFontSizeClasses(editor);return fontClasses?fontClasses[fontSizeNumber-1]||value:fontSizes[fontSizeNumber-1]||value}return value}return value},normalizeFontNames=function(font){var fonts=font.split(/\s*,\s*/);return map(fonts,(function(font){return-1===font.indexOf(" ")||startsWith(font,'"')||startsWith(font,"'")?font:"'"+font+"'"})).join(",")},fontNameAction=function(editor,value){var font=fromFontSizeNumber(editor,value);editor.formatter.toggle("fontname",{value:normalizeFontNames(font)}),editor.nodeChanged()},fontNameQuery=function(editor){return mapRange(editor,(function(elm){return getFontFamily(editor.getBody(),elm.dom)})).getOr("")},fontSizeAction=function(editor,value){editor.formatter.toggle("fontsize",{value:fromFontSizeNumber(editor,value)}),editor.nodeChanged()},fontSizeQuery=function(editor){return mapRange(editor,(function(elm){return getFontSize(editor.getBody(),elm.dom)})).getOr("")},lineHeightQuery=function(editor){return mapRange(editor,(function(elm){var root=SugarElement.fromDom(editor.getBody()),specifiedStyle,computedStyle=function(){var lineHeight=parseFloat(get$5(elm,"line-height")),fontSize=parseFloat(get$5(elm,"font-size"));return String(lineHeight/fontSize)};return closest$2(elm,(function(elm){console.log("line-heightline-height",parseFloat(get$5(elm,"line-height")));var blocks=editor.selection.getSelectedBlocks(),firstLineHeight="",different=!1;return Tools.each(blocks,(function(elm){firstLineHeight?firstLineHeight.getOr("")!==getRaw({dom:elm},"line-height").getOr("")&&(different=!0):firstLineHeight=getRaw({dom:elm},"line-height")})),different||!firstLineHeight?Optional.some("4"):""===firstLineHeight.getOr("")?Optional.some("1.5"):firstLineHeight}),curry(eq$2,root)).getOrThunk(computedStyle)})).getOr("")},lineHeightAction=function(editor,lineHeight){editor.undoManager.transact((function(){editor.formatter.toggle("lineheight",{value:String(lineHeight)}),editor.nodeChanged()}))},processValue=function(value){var details;return"string"!=typeof value?(details=Tools.extend({paste:value.paste,data:{paste:value.paste}},value),{content:value.content,details:details}):{content:value,details:{}}},insertAtCaret$1=function(editor,value){var result=processValue(value);insertContent(editor,result.content,result.details)},each$f=Tools.each,map$3=Tools.map,inArray$2=Tools.inArray,EditorCommands=function(){function EditorCommands(editor){this.commands={state:{},exec:{},value:{}},this.editor=editor,this.setupCommands(editor)}return EditorCommands.prototype.execCommand=function(command,ui,value,args){var func,state=!1,self=this;if(!self.editor.removed){if(/^(mceAddUndoLevel|mceEndUndoLevel|mceBeginUndoLevel|mceRepaint)$/.test(command)||args&&args.skip_focus?restore(self.editor):self.editor.focus(),(args=self.editor.fire("BeforeExecCommand",{command:command,ui:ui,value:value})).isDefaultPrevented())return!1;var customCommand=command.toLowerCase();if(func=self.commands.exec[customCommand])return func(customCommand,ui,value),self.editor.fire("ExecCommand",{command:command,ui:ui,value:value}),!0;if(each$f(this.editor.plugins,(function(p){if(p.execCommand&&p.execCommand(command,ui,value))return self.editor.fire("ExecCommand",{command:command,ui:ui,value:value}),state=!0,!1})),state)return state;if(self.editor.theme&&self.editor.theme.execCommand&&self.editor.theme.execCommand(command,ui,value))return self.editor.fire("ExecCommand",{command:command,ui:ui,value:value}),!0;try{state=self.editor.getDoc().execCommand(command,ui,value)}catch(ex){}return!!state&&(self.editor.fire("ExecCommand",{command:command,ui:ui,value:value}),!0)}},EditorCommands.prototype.queryCommandState=function(command){var func;if(!this.editor.quirks.isHidden()&&!this.editor.removed){if(command=command.toLowerCase(),func=this.commands.state[command])return func(command);try{return this.editor.getDoc().queryCommandState(command)}catch(ex){}return!1}},EditorCommands.prototype.queryCommandValue=function(command){var func;if(!this.editor.quirks.isHidden()&&!this.editor.removed){if(command=command.toLowerCase(),func=this.commands.value[command])return func(command);try{return this.editor.getDoc().queryCommandValue(command)}catch(ex){}}},EditorCommands.prototype.addCommands=function(commandList,type){void 0===type&&(type="exec");var self=this;each$f(commandList,(function(callback,command){each$f(command.toLowerCase().split(","),(function(command){self.commands[type][command]=callback}))}))},EditorCommands.prototype.addCommand=function(command,callback,scope){var _this=this;command=command.toLowerCase(),this.commands.exec[command]=function(command,ui,value,args){return callback.call(scope||_this.editor,ui,value,args)}},EditorCommands.prototype.queryCommandSupported=function(command){if(command=command.toLowerCase(),this.commands.exec[command])return!0;try{return this.editor.getDoc().queryCommandSupported(command)}catch(ex){}return!1},EditorCommands.prototype.addQueryStateHandler=function(command,callback,scope){var _this=this;command=command.toLowerCase(),this.commands.state[command]=function(){return callback.call(scope||_this.editor)}},EditorCommands.prototype.addQueryValueHandler=function(command,callback,scope){var _this=this;command=command.toLowerCase(),this.commands.value[command]=function(){return callback.call(scope||_this.editor)}},EditorCommands.prototype.hasCustomCommand=function(command){return command=command.toLowerCase(),!!this.commands.exec[command]},EditorCommands.prototype.execNativeCommand=function(command,ui,value){return void 0===ui&&(ui=!1),void 0===value&&(value=null),this.editor.getDoc().execCommand(command,ui,value)},EditorCommands.prototype.isFormatMatch=function(name){return this.editor.formatter.match(name)},EditorCommands.prototype.toggleFormat=function(name,value){this.editor.formatter.toggle(name,value?{value:value}:void 0),this.editor.nodeChanged()},EditorCommands.prototype.storeSelection=function(type){this.selectionBookmark=this.editor.selection.getBookmark(type)},EditorCommands.prototype.restoreSelection=function(){this.editor.selection.moveToBookmark(this.selectionBookmark)},EditorCommands.prototype.setupCommands=function(editor){var self=this;this.addCommands({"mceResetDesignMode,mceBeginUndoLevel":noop,"mceEndUndoLevel,mceAddUndoLevel":function(){editor.undoManager.add()},"Cut,Copy,Paste":function(command){var doc=editor.getDoc(),failed;try{self.execNativeCommand(command)}catch(ex){failed=!0}if("paste"!==command||doc.queryCommandEnabled(command)||(failed=!0),failed||!doc.queryCommandSupported(command)){var msg=editor.translate("Your browser doesn't support direct access to the clipboard. Please use the Ctrl+X/C/V keyboard shortcuts instead.");Env.mac&&(msg=msg.replace(/Ctrl\+/g,"⌘+")),editor.notificationManager.open({text:msg,type:"error"})}},unlink:function(){if(editor.selection.isCollapsed()){var elm=editor.dom.getParent(editor.selection.getStart(),"a");elm&&editor.dom.remove(elm,!0)}else editor.formatter.remove("link")},"JustifyLeft,JustifyCenter,JustifyRight,JustifyFull,JustifyNone":function(command){var align=command.substring(7);"full"===align&&(align="justify"),each$f("left,center,right,justify".split(","),(function(name){align!==name&&editor.formatter.remove("align"+name)})),"none"!==align&&self.toggleFormat("align"+align)},"InsertUnorderedList,InsertOrderedList":function(command){var listParent;self.execNativeCommand(command);var listElm=editor.dom.getParent(editor.selection.getNode(),"ol,ul");listElm&&(listParent=listElm.parentNode,/^(H[1-6]|P|ADDRESS|PRE)$/.test(listParent.nodeName)&&(self.storeSelection(),editor.dom.split(listParent,listElm),self.restoreSelection()))},"Bold,Italic,Underline,Strikethrough,Superscript,Subscript":function(command){self.toggleFormat(command)},"ForeColor,HiliteColor":function(command,ui,value){self.toggleFormat(command,value)},FontName:function(command,ui,value){fontNameAction(editor,value)},FontSize:function(command,ui,value){fontSizeAction(editor,value)},LineHeight:function(command,ui,value){lineHeightAction(editor,value)},RemoveFormat:function(command){editor.formatter.remove(command)},mceBlockQuote:function(){self.toggleFormat("blockquote")},FormatBlock:function(command,ui,value){return self.toggleFormat(value||"p")},mceCleanup:function(){var bookmark=editor.selection.getBookmark();editor.setContent(editor.getContent()),editor.selection.moveToBookmark(bookmark)},mceRemoveNode:function(command,ui,value){var node=value||editor.selection.getNode();node!==editor.getBody()&&(self.storeSelection(),editor.dom.remove(node,!0),self.restoreSelection())},mceSelectNodeDepth:function(command,ui,value){var counter=0;editor.dom.getParent(editor.selection.getNode(),(function(node){if(1===node.nodeType&&counter++===value)return editor.selection.select(node),!1}),editor.getBody())},mceSelectNode:function(command,ui,value){editor.selection.select(value)},mceInsertContent:function(command,ui,value){insertAtCaret$1(editor,value)},mceInsertRawHTML:function(command,ui,value){editor.selection.setContent("tiny_mce_marker");var content=editor.getContent();editor.setContent(content.replace(/tiny_mce_marker/g,(function(){return value})))},mceInsertNewLine:function(command,ui,value){insert$3(editor,value)},mceToggleFormat:function(command,ui,value){self.toggleFormat(value)},mceSetContent:function(command,ui,value){editor.setContent(value)},"Indent,Outdent":function(command){handle(editor,command)},mceRepaint:noop,InsertHorizontalRule:function(){editor.execCommand("mceInsertContent",!1,"<hr />")},mceToggleVisualAid:function(){editor.hasVisual=!editor.hasVisual,editor.addVisual()},mceReplaceContent:function(command,ui,value){editor.execCommand("mceInsertContent",!1,value.replace(/\{\$selection\}/g,editor.selection.getContent({format:"text"})))},mceInsertLink:function(command,ui,value){"string"==typeof value&&(value={href:value});var anchor=editor.dom.getParent(editor.selection.getNode(),"a");value.href=value.href.replace(/ /g,"%20"),anchor&&value.href||editor.formatter.remove("link"),value.href&&editor.formatter.apply("link",value,anchor)},selectAll:function(){var editingHost=editor.dom.getParent(editor.selection.getStart(),isContentEditableTrue);if(editingHost){var rng=editor.dom.createRng();rng.selectNodeContents(editingHost),editor.selection.setRng(rng)}},mceNewDocument:function(){editor.setContent("")},InsertLineBreak:function(command,ui,value){return insert$2(editor,value),!0}});var alignStates=function(name){return function(){var selection=editor.selection,nodes=selection.isCollapsed()?[editor.dom.getParent(selection.getNode(),editor.dom.isBlock)]:selection.getSelectedBlocks(),matches=map$3(nodes,(function(node){return!!editor.formatter.matchNode(node,name)}));return-1!==inArray$2(matches,!0)}};self.addCommands({JustifyLeft:alignStates("alignleft"),JustifyCenter:alignStates("aligncenter"),JustifyRight:alignStates("alignright"),JustifyFull:alignStates("alignjustify"),"Bold,Italic,Underline,Strikethrough,Superscript,Subscript":function(command){return self.isFormatMatch(command)},mceBlockQuote:function(){return self.isFormatMatch("blockquote")},Outdent:function(){return canOutdent(editor)},"InsertUnorderedList,InsertOrderedList":function(command){var list=editor.dom.getParent(editor.selection.getNode(),"ul,ol");return list&&("insertunorderedlist"===command&&"UL"===list.tagName||"insertorderedlist"===command&&"OL"===list.tagName)}},"state"),self.addCommands({Undo:function(){editor.undoManager.undo()},Redo:function(){editor.undoManager.redo()}}),self.addQueryValueHandler("FontName",(function(){return fontNameQuery(editor)}),this),self.addQueryValueHandler("FontSize",(function(){return fontSizeQuery(editor)}),this),self.addQueryValueHandler("LineHeight",(function(){return lineHeightQuery(editor)}),this)},EditorCommands}(),internalContentEditableAttr="data-mce-contenteditable",toggleClass=function(elm,cls,state){has$2(elm,cls)&&!1===state?remove$4(elm,cls):state&&add$3(elm,cls)},setEditorCommandState=function(editor,cmd,state){try{editor.getDoc().execCommand(cmd,!1,String(state))}catch(ex){}},setContentEditable=function(elm,state){elm.dom.contentEditable=state?"true":"false"},switchOffContentEditableTrue=function(elm){each(descendants$1(elm,'*[contenteditable="true"]'),(function(elm){set(elm,"data-mce-contenteditable","true"),setContentEditable(elm,!1)}))},switchOnContentEditableTrue=function(elm){each(descendants$1(elm,'*[data-mce-contenteditable="true"]'),(function(elm){remove$1(elm,"data-mce-contenteditable"),setContentEditable(elm,!0)}))},removeFakeSelection=function(editor){Optional.from(editor.selection.getNode()).each((function(elm){elm.removeAttribute("data-mce-selected")}))},restoreFakeSelection=function(editor){editor.selection.setRng(editor.selection.getRng())},toggleReadOnly=function(editor,state){var body=SugarElement.fromDom(editor.getBody());toggleClass(body,"mce-content-readonly",state),state?(editor.selection.controlSelection.hideResizeRect(),editor._selectionOverrides.hideFakeCaret(),removeFakeSelection(editor),editor.readonly=!0,setContentEditable(body,!1),switchOffContentEditableTrue(body)):(editor.readonly=!1,setContentEditable(body,!0),switchOnContentEditableTrue(body),setEditorCommandState(editor,"StyleWithCSS",!1),setEditorCommandState(editor,"enableInlineTableEditing",!1),setEditorCommandState(editor,"enableObjectResizing",!1),hasEditorOrUiFocus(editor)&&editor.focus(),restoreFakeSelection(editor),editor.nodeChanged())},isReadOnly$1=function(editor){return editor.readonly},registerFilters=function(editor){editor.parser.addAttributeFilter("contenteditable",(function(nodes){isReadOnly$1(editor)&&each(nodes,(function(node){node.attr("data-mce-contenteditable",node.attr("contenteditable")),node.attr("contenteditable","false")}))})),editor.serializer.addAttributeFilter("data-mce-contenteditable",(function(nodes){isReadOnly$1(editor)&&each(nodes,(function(node){node.attr("contenteditable",node.attr("data-mce-contenteditable"))}))})),editor.serializer.addTempAttr("data-mce-contenteditable")},registerReadOnlyContentFilters=function(editor){editor.serializer?registerFilters(editor):editor.on("PreInit",(function(){registerFilters(editor)}))},isClickEvent=function(e){return"click"===e.type},getAnchorHrefOpt=function(editor,elm){var isRoot;return closest$1(elm,"a",(function(elm){return eq$2(elm,SugarElement.fromDom(editor.getBody()))})).bind((function(a){return getOpt(a,"href")}))},processReadonlyEvents=function(editor,e){if(isClickEvent(e)&&!VK.metaKeyPressed(e)){var elm=SugarElement.fromDom(e.target);getAnchorHrefOpt(editor,elm).each((function(href){if(e.preventDefault(),/^#/.test(href)){var targetEl=editor.dom.select(href+',[name="'+removeLeading(href,"#")+'"]');targetEl.length&&editor.selection.scrollIntoView(targetEl[0],!0)}else window.open(href,"_blank","rel=noopener noreferrer,menubar=yes,toolbar=yes,location=yes,status=yes,resizable=yes,scrollbars=yes")}))}},registerReadOnlySelectionBlockers=function(editor){editor.on("ShowCaret",(function(e){isReadOnly$1(editor)&&e.preventDefault()})),editor.on("ObjectSelected",(function(e){isReadOnly$1(editor)&&e.preventDefault()}))},nativeEvents=Tools.makeMap("focus blur focusin focusout click dblclick mousedown mouseup mousemove mouseover beforepaste paste cut copy selectionchange mouseout mouseenter mouseleave wheel keydown keypress keyup input beforeinput contextmenu dragstart dragend dragover draggesture dragdrop drop drag submit compositionstart compositionend compositionupdate touchstart touchmove touchend touchcancel"," "),EventDispatcher=function(){function EventDispatcher(settings){this.bindings={},this.settings=settings||{},this.scope=this.settings.scope||this,this.toggleEvent=this.settings.toggleEvent||never}return EventDispatcher.isNative=function(name){return!!nativeEvents[name.toLowerCase()]},EventDispatcher.prototype.fire=function(nameIn,argsIn){var name=nameIn.toLowerCase(),args=argsIn||{};args.type=name,args.target||(args.target=this.scope),args.preventDefault||(args.preventDefault=function(){args.isDefaultPrevented=always},args.stopPropagation=function(){args.isPropagationStopped=always},args.stopImmediatePropagation=function(){args.isImmediatePropagationStopped=always},args.isDefaultPrevented=never,args.isPropagationStopped=never,args.isImmediatePropagationStopped=never),this.settings.beforeFire&&this.settings.beforeFire(args);var handlers=this.bindings[name];if(handlers)for(var i=0,l=handlers.length;i<l;i++){var callback=handlers[i];if(callback.once&&this.off(name,callback.func),args.isImmediatePropagationStopped())return args.stopPropagation(),args;if(!1===callback.func.call(this.scope,args))return args.preventDefault(),args}return args},EventDispatcher.prototype.on=function(name,callback,prepend,extra){if(!1===callback&&(callback=never),callback){var wrappedCallback={func:callback};extra&&Tools.extend(wrappedCallback,extra);for(var names=name.toLowerCase().split(" "),i=names.length;i--;){var currentName=names[i],handlers=this.bindings[currentName];handlers||(handlers=this.bindings[currentName]=[],this.toggleEvent(currentName,!0)),prepend?handlers.unshift(wrappedCallback):handlers.push(wrappedCallback)}}return this},EventDispatcher.prototype.off=function(name,callback){var _this=this;if(name)for(var names=name.toLowerCase().split(" "),i=names.length;i--;){var currentName=names[i],handlers=this.bindings[currentName];if(!currentName)return each$1(this.bindings,(function(_value,bindingName){_this.toggleEvent(bindingName,!1),delete _this.bindings[bindingName]})),this;if(handlers){if(callback)for(var hi=handlers.length;hi--;)handlers[hi].func===callback&&(handlers=handlers.slice(0,hi).concat(handlers.slice(hi+1)),this.bindings[currentName]=handlers);else handlers.length=0;handlers.length||(this.toggleEvent(name,!1),delete this.bindings[currentName])}}else each$1(this.bindings,(function(_value,name){_this.toggleEvent(name,!1)})),this.bindings={};return this},EventDispatcher.prototype.once=function(name,callback,prepend){return this.on(name,callback,prepend,{once:!0})},EventDispatcher.prototype.has=function(name){return name=name.toLowerCase(),!(!this.bindings[name]||0===this.bindings[name].length)},EventDispatcher}(),getEventDispatcher=function(obj){return obj._eventDispatcher||(obj._eventDispatcher=new EventDispatcher({scope:obj,toggleEvent:function(name,state){EventDispatcher.isNative(name)&&obj.toggleNativeEvent&&obj.toggleNativeEvent(name,state)}})),obj._eventDispatcher},Observable={fire:function(name,args,bubble){var self=this;if(this.removed&&"remove"!==name&&"detach"!==name)return args;var dispatcherArgs=getEventDispatcher(this).fire(name,args);if(!1!==bubble&&this.parent)for(var parent_1=this.parent();parent_1&&!dispatcherArgs.isPropagationStopped();)parent_1.fire(name,dispatcherArgs,!1),parent_1=parent_1.parent();return dispatcherArgs},on:function(name,callback,prepend){return getEventDispatcher(this).on(name,callback,prepend)},off:function(name,callback){return getEventDispatcher(this).off(name,callback)},once:function(name,callback){return getEventDispatcher(this).once(name,callback)},hasEventListeners:function(name){return getEventDispatcher(this).has(name)}},DOM$8=DOMUtils.DOM,customEventRootDelegates,getEventTarget=function(editor,eventName){if("selectionchange"===eventName)return editor.getDoc();if(!editor.inline&&/^mouse|touch|click|contextmenu|drop|dragover|dragend/.test(eventName))return editor.getDoc().documentElement;var eventRoot=getEventRoot(editor);return eventRoot?(editor.eventRoot||(editor.eventRoot=DOM$8.select(eventRoot)[0]),editor.eventRoot):editor.getBody()},isListening=function(editor){return!editor.hidden&&!isReadOnly$1(editor)},fireEvent=function(editor,eventName,e){isListening(editor)?editor.fire(eventName,e):isReadOnly$1(editor)&&processReadonlyEvents(editor,e)},bindEventDelegate=function(editor,eventName){var delegate;if(editor.delegates||(editor.delegates={}),!editor.delegates[eventName]&&!editor.removed){var eventRootElm=getEventTarget(editor,eventName);if(getEventRoot(editor)){if(customEventRootDelegates||(customEventRootDelegates={},editor.editorManager.on("removeEditor",(function(){editor.editorManager.activeEditor||customEventRootDelegates&&(each$1(customEventRootDelegates,(function(_value,name){editor.dom.unbind(getEventTarget(editor,name))})),customEventRootDelegates=null)}))),customEventRootDelegates[eventName])return;delegate=function(e){for(var target=e.target,editors=editor.editorManager.get(),i=editors.length;i--;){var body=editors[i].getBody();(body===target||DOM$8.isChildOf(target,body))&&fireEvent(editors[i],eventName,e)}},customEventRootDelegates[eventName]=delegate,DOM$8.bind(eventRootElm,eventName,delegate)}else delegate=function(e){fireEvent(editor,eventName,e)},DOM$8.bind(eventRootElm,eventName,delegate),editor.delegates[eventName]=delegate}},EditorObservable=__assign(__assign({},Observable),{bindPendingEventDelegates:function(){var self=this;Tools.each(self._pendingNativeEvents,(function(name){bindEventDelegate(self,name)}))},toggleNativeEvent:function(name,state){var self=this;"focus"!==name&&"blur"!==name&&(state?this.initialized?bindEventDelegate(this,name):this._pendingNativeEvents?this._pendingNativeEvents.push(name):this._pendingNativeEvents=[name]:this.initialized&&(this.dom.unbind(getEventTarget(this,name),name,this.delegates[name]),delete this.delegates[name]))},unbindAllNativeEvents:function(){var self=this,body=self.getBody(),dom=self.dom;self.delegates&&(each$1(self.delegates,(function(value,name){self.dom.unbind(getEventTarget(self,name),name,value)})),delete self.delegates),!self.inline&&body&&dom&&(body.onload=null,dom.unbind(self.getWin()),dom.unbind(self.getDoc())),dom&&(dom.unbind(body),dom.unbind(self.getContainer()))}}),defaultModes=["design","readonly"],switchToMode=function(editor,activeMode,availableModes,mode){var oldMode=availableModes[activeMode.get()],newMode=availableModes[mode];try{newMode.activate()}catch(e){return void console.error("problem while activating editor mode "+mode+":",e)}oldMode.deactivate(),oldMode.editorReadOnly!==newMode.editorReadOnly&&toggleReadOnly(editor,newMode.editorReadOnly),activeMode.set(mode),fireSwitchMode(editor,mode)},setMode=function(editor,availableModes,activeMode,mode){if(mode!==activeMode.get()){if(!has(availableModes,mode))throw new Error("Editor mode '"+mode+"' is invalid");editor.initialized?switchToMode(editor,activeMode,availableModes,mode):editor.on("init",(function(){return switchToMode(editor,activeMode,availableModes,mode)}))}},registerMode=function(availableModes,mode,api){var _a;if(contains(defaultModes,mode))throw new Error("Cannot override default mode "+mode);return __assign(__assign({},availableModes),((_a={})[mode]=__assign(__assign({},api),{deactivate:function(){try{api.deactivate()}catch(e){console.error("problem while deactivating editor mode "+mode+":",e)}}}),_a))},create$5=function(editor){var activeMode=Cell("design"),availableModes=Cell({design:{activate:noop,deactivate:noop,editorReadOnly:!1},readonly:{activate:noop,deactivate:noop,editorReadOnly:!0}});return registerReadOnlyContentFilters(editor),registerReadOnlySelectionBlockers(editor),{isReadOnly:function(){return isReadOnly$1(editor)},set:function(mode){return setMode(editor,availableModes.get(),activeMode,mode)},get:function(){return activeMode.get()},register:function(mode,api){availableModes.set(registerMode(availableModes.get(),mode,api))}}},each$g=Tools.each,explode$3=Tools.explode,keyCodeLookup={f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123},modifierNames=Tools.makeMap("alt,ctrl,shift,meta,access"),parseShortcut=function(pattern){var key,shortcut={};each$g(explode$3(pattern.toLowerCase(),"+"),(function(value){value in modifierNames?shortcut[value]=!0:/^[0-9]{2,}$/.test(value)?shortcut.keyCode=parseInt(value,10):(shortcut.charCode=value.charCodeAt(0),shortcut.keyCode=keyCodeLookup[value]||value.toUpperCase().charCodeAt(0))}));var id=[shortcut.keyCode];for(key in modifierNames)shortcut[key]?id.push(key):shortcut[key]=!1;return shortcut.id=id.join(","),shortcut.access&&(shortcut.alt=!0,Env.mac?shortcut.ctrl=!0:shortcut.shift=!0),shortcut.meta&&(Env.mac?shortcut.meta=!0:(shortcut.ctrl=!0,shortcut.meta=!1)),shortcut},Shortcuts=function(){function Shortcuts(editor){this.shortcuts={},this.pendingPatterns=[],this.editor=editor;var self=this;editor.on("keyup keypress keydown",(function(e){!self.hasModifier(e)&&!self.isFunctionKey(e)||e.isDefaultPrevented()||(each$g(self.shortcuts,(function(shortcut){if(self.matchShortcut(e,shortcut))return self.pendingPatterns=shortcut.subpatterns.slice(0),"keydown"===e.type&&self.executeShortcutAction(shortcut),!0})),self.matchShortcut(e,self.pendingPatterns[0])&&(1===self.pendingPatterns.length&&"keydown"===e.type&&self.executeShortcutAction(self.pendingPatterns[0]),self.pendingPatterns.shift()))}))}return Shortcuts.prototype.add=function(pattern,desc,cmdFunc,scope){var self=this,func=self.normalizeCommandFunc(cmdFunc);return each$g(explode$3(Tools.trim(pattern)),(function(pattern){var shortcut=self.createShortcut(pattern,desc,func,scope);self.shortcuts[shortcut.id]=shortcut})),!0},Shortcuts.prototype.remove=function(pattern){var shortcut=this.createShortcut(pattern);return!!this.shortcuts[shortcut.id]&&(delete this.shortcuts[shortcut.id],!0)},Shortcuts.prototype.normalizeCommandFunc=function(cmdFunc){var self=this,cmd=cmdFunc;return"string"==typeof cmd?function(){self.editor.execCommand(cmd,!1,null)}:Tools.isArray(cmd)?function(){self.editor.execCommand(cmd[0],cmd[1],cmd[2])}:cmd},Shortcuts.prototype.createShortcut=function(pattern,desc,cmdFunc,scope){var shortcuts=Tools.map(explode$3(pattern,">"),parseShortcut);return shortcuts[shortcuts.length-1]=Tools.extend(shortcuts[shortcuts.length-1],{func:cmdFunc,scope:scope||this.editor}),Tools.extend(shortcuts[0],{desc:this.editor.translate(desc),subpatterns:shortcuts.slice(1)})},Shortcuts.prototype.hasModifier=function(e){return e.altKey||e.ctrlKey||e.metaKey},Shortcuts.prototype.isFunctionKey=function(e){return"keydown"===e.type&&e.keyCode>=112&&e.keyCode<=123},Shortcuts.prototype.matchShortcut=function(e,shortcut){return!!shortcut&&(shortcut.ctrl===e.ctrlKey&&shortcut.meta===e.metaKey&&(shortcut.alt===e.altKey&&shortcut.shift===e.shiftKey&&(!!(e.keyCode===shortcut.keyCode||e.charCode&&e.charCode===shortcut.charCode)&&(e.preventDefault(),!0))))},Shortcuts.prototype.executeShortcutAction=function(shortcut){return shortcut.func?shortcut.func.call(shortcut.scope):null},Shortcuts}(),create$6=function(){var buttons={},menuItems={},popups={},icons={},contextMenus={},contextToolbars={},sidebars={},add=function(collection,type){return function(name,spec){return collection[name.toLowerCase()]=__assign(__assign({},spec),{type:type})}},addIcon=function(name,svgData){return icons[name.toLowerCase()]=svgData};return{addButton:add(buttons,"button"),addGroupToolbarButton:add(buttons,"grouptoolbarbutton"),addToggleButton:add(buttons,"togglebutton"),addMenuButton:add(buttons,"menubutton"),addSplitButton:add(buttons,"splitbutton"),addMenuItem:add(menuItems,"menuitem"),addNestedMenuItem:add(menuItems,"nestedmenuitem"),addToggleMenuItem:add(menuItems,"togglemenuitem"),addAutocompleter:add(popups,"autocompleter"),addContextMenu:add(contextMenus,"contextmenu"),addContextToolbar:add(contextToolbars,"contexttoolbar"),addContextForm:add(contextToolbars,"contextform"),addSidebar:add(sidebars,"sidebar"),addIcon:addIcon,getAll:function(){return{buttons:buttons,menuItems:menuItems,icons:icons,popups:popups,contextMenus:contextMenus,contextToolbars:contextToolbars,sidebars:sidebars}}}},registry=function(){var bridge=create$6();return{addAutocompleter:bridge.addAutocompleter,addButton:bridge.addButton,addContextForm:bridge.addContextForm,addContextMenu:bridge.addContextMenu,addContextToolbar:bridge.addContextToolbar,addIcon:bridge.addIcon,addMenuButton:bridge.addMenuButton,addMenuItem:bridge.addMenuItem,addNestedMenuItem:bridge.addNestedMenuItem,addSidebar:bridge.addSidebar,addSplitButton:bridge.addSplitButton,addToggleButton:bridge.addToggleButton,addGroupToolbarButton:bridge.addGroupToolbarButton,addToggleMenuItem:bridge.addToggleMenuItem,getAll:bridge.getAll}},each$h=Tools.each,trim$4=Tools.trim,queryParts="source protocol authority userInfo user password host port relative path directory file query anchor".split(" "),DEFAULT_PORTS={ftp:21,http:80,https:443,mailto:25},URI=function(){function URI(url,settings){url=trim$4(url),this.settings=settings||{};var baseUri=this.settings.base_uri,self=this;if(/^([\w\-]+):([^\/]{2})/i.test(url)||/^\s*#/.test(url))self.source=url;else{var isProtocolRelative=0===url.indexOf("//");if(0!==url.indexOf("/")||isProtocolRelative||(url=(baseUri&&baseUri.protocol||"http")+"://mce_host"+url),!/^[\w\-]*:?\/\//.test(url)){var baseUrl=this.settings.base_uri?this.settings.base_uri.path:new URI(document.location.href).directory;if(this.settings.base_uri&&""==this.settings.base_uri.protocol)url="//mce_host"+self.toAbsPath(baseUrl,url);else{var match=/([^#?]*)([#?]?.*)/.exec(url);url=(baseUri&&baseUri.protocol||"http")+"://mce_host"+self.toAbsPath(baseUrl,match[1])+match[2]}}url=url.replace(/@@/g,"(mce_at)");var urlMatch=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*):?([^:@\/]*))?@)?(\[[a-zA-Z0-9:.%]+\]|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(url);each$h(queryParts,(function(v,i){var part=urlMatch[i];part&&(part=part.replace(/\(mce_at\)/g,"@@")),self[v]=part})),baseUri&&(self.protocol||(self.protocol=baseUri.protocol),self.userInfo||(self.userInfo=baseUri.userInfo),self.port||"mce_host"!==self.host||(self.port=baseUri.port),self.host&&"mce_host"!==self.host||(self.host=baseUri.host),self.source=""),isProtocolRelative&&(self.protocol="")}}return URI.parseDataUri=function(uri){var type,uriComponents=decodeURIComponent(uri).split(","),matches=/data:([^;]+)/.exec(uriComponents[0]);return matches&&(type=matches[1]),{type:type,data:uriComponents[1]}},URI.getDocumentBaseUrl=function(loc){var baseUrl;return baseUrl=0!==loc.protocol.indexOf("http")&&"file:"!==loc.protocol?loc.href:loc.protocol+"//"+loc.host+loc.pathname,/^[^:]+:\/\/\/?[^\/]+\//.test(baseUrl)&&(baseUrl=baseUrl.replace(/[\?#].*$/,"").replace(/[\/\\][^\/]+$/,""),/[\/\\]$/.test(baseUrl)||(baseUrl+="/")),baseUrl},URI.prototype.setPath=function(path){var pathMatch=/^(.*?)\/?(\w+)?$/.exec(path);this.path=pathMatch[0],this.directory=pathMatch[1],this.file=pathMatch[2],this.source="",this.getURI()},URI.prototype.toRelative=function(uri){var output;if("./"===uri)return uri;var relativeUri=new URI(uri,{base_uri:this});if("mce_host"!==relativeUri.host&&this.host!==relativeUri.host&&relativeUri.host||this.port!==relativeUri.port||this.protocol!==relativeUri.protocol&&""!==relativeUri.protocol)return relativeUri.getURI();var tu=this.getURI(),uu=relativeUri.getURI();return tu===uu||"/"===tu.charAt(tu.length-1)&&tu.substr(0,tu.length-1)===uu?tu:(output=this.toRelPath(this.path,relativeUri.path),relativeUri.query&&(output+="?"+relativeUri.query),relativeUri.anchor&&(output+="#"+relativeUri.anchor),output)},URI.prototype.toAbsolute=function(uri,noHost){var absoluteUri=new URI(uri,{base_uri:this});return absoluteUri.getURI(noHost&&this.isSameOrigin(absoluteUri))},URI.prototype.isSameOrigin=function(uri){if(this.host==uri.host&&this.protocol==uri.protocol){if(this.port==uri.port)return!0;var defaultPort=DEFAULT_PORTS[this.protocol];if(defaultPort&&(this.port||defaultPort)==(uri.port||defaultPort))return!0}return!1},URI.prototype.toRelPath=function(base,path){var breakPoint=0,out="",i,l,normalizedBase=base.substring(0,base.lastIndexOf("/")).split("/"),items=path.split("/");if(normalizedBase.length>=items.length)for(i=0,l=normalizedBase.length;i<l;i++)if(i>=items.length||normalizedBase[i]!==items[i]){breakPoint=i+1;break}if(normalizedBase.length<items.length)for(i=0,l=items.length;i<l;i++)if(i>=normalizedBase.length||normalizedBase[i]!==items[i]){breakPoint=i+1;break}if(1===breakPoint)return path;for(i=0,l=normalizedBase.length-(breakPoint-1);i<l;i++)out+="../";for(i=breakPoint-1,l=items.length;i<l;i++)out+=i!==breakPoint-1?"/"+items[i]:items[i];return out},URI.prototype.toAbsPath=function(base,path){var i,nb=0,o=[],outPath,tr=/\/$/.test(path)?"/":"",normalizedBase=base.split("/"),normalizedPath=path.split("/");for(each$h(normalizedBase,(function(k){k&&o.push(k)})),normalizedBase=o,i=normalizedPath.length-1,o=[];i>=0;i--)0!==normalizedPath[i].length&&"."!==normalizedPath[i]&&(".."!==normalizedPath[i]?nb>0?nb--:o.push(normalizedPath[i]):nb++);return 0!==(outPath=(i=normalizedBase.length-nb)<=0?reverse(o).join("/"):normalizedBase.slice(0,i).join("/")+"/"+reverse(o).join("/")).indexOf("/")&&(outPath="/"+outPath),tr&&outPath.lastIndexOf("/")!==outPath.length-1&&(outPath+=tr),outPath},URI.prototype.getURI=function(noProtoHost){var s;return void 0===noProtoHost&&(noProtoHost=!1),this.source&&!noProtoHost||(s="",noProtoHost||(this.protocol?s+=this.protocol+"://":s+="//",this.userInfo&&(s+=this.userInfo+"@"),this.host&&(s+=this.host),this.port&&(s+=":"+this.port)),this.path&&(s+=this.path),this.query&&(s+="?"+this.query),this.anchor&&(s+="#"+this.anchor),this.source=s),this.source},URI}(),DOM$9=DOMUtils.DOM,extend$3=Tools.extend,each$i=Tools.each,resolve$3=Tools.resolve,ie$1=Env.ie,Editor=function(){function Editor(id,settings,editorManager){var _this=this;this.plugins={},this.contentCSS=[],this.contentStyles=[],this.loadedCSS={},this.isNotDirty=!1,this.editorManager=editorManager,this.documentBaseUrl=editorManager.documentBaseURL,extend$3(this,EditorObservable),this.settings=getEditorSettings(this,id,this.documentBaseUrl,editorManager.defaultSettings,settings),this.settings.suffix&&(editorManager.suffix=this.settings.suffix),this.suffix=editorManager.suffix,this.settings.base_url&&editorManager._setBaseUrl(this.settings.base_url),this.baseUri=editorManager.baseURI,this.settings.referrer_policy&&(ScriptLoader.ScriptLoader._setReferrerPolicy(this.settings.referrer_policy),DOMUtils.DOM.styleSheetLoader._setReferrerPolicy(this.settings.referrer_policy)),AddOnManager.languageLoad=this.settings.language_load,AddOnManager.baseURL=editorManager.baseURL,this.id=id,this.setDirty(!1),this.documentBaseURI=new URI(this.settings.document_base_url,{base_uri:this.baseUri}),this.baseURI=this.baseUri,this.inline=!!this.settings.inline,this.shortcuts=new Shortcuts(this),this.editorCommands=new EditorCommands(this),this.settings.cache_suffix&&(Env.cacheSuffix=this.settings.cache_suffix.replace(/^[\?\&]+/,"")),this.ui={registry:registry(),styleSheetLoader:void 0,show:noop,hide:noop,enable:noop,disable:noop,isDisabled:never};var self=this,modeInstance=create$5(this);this.mode=modeInstance,this.setMode=modeInstance.set,editorManager.fire("SetupEditor",{editor:this}),this.execCallback("setup",this),this.$=DomQuery.overrideDefaults((function(){return{context:_this.inline?_this.getBody():_this.getDoc(),element:_this.getBody()}}))}return Editor.prototype.render=function(){render(this)},Editor.prototype.focus=function(skipFocus){focus$1(this,skipFocus)},Editor.prototype.hasFocus=function(){return hasFocus$1(this)},Editor.prototype.execCallback=function(name){for(var x=[],_i=1;_i<arguments.length;_i++)x[_i-1]=arguments[_i];var self=this,callback=self.settings[name],scope;if(callback)return self.callbackLookup&&(scope=self.callbackLookup[name])&&(callback=scope.func,scope=scope.scope),"string"==typeof callback&&(scope=(scope=callback.replace(/\.\w+$/,""))?resolve$3(scope):0,callback=resolve$3(callback),self.callbackLookup=self.callbackLookup||{},self.callbackLookup[name]={func:callback,scope:scope}),callback.apply(scope||self,x)},Editor.prototype.translate=function(text){return I18n.translate(text)},Editor.prototype.CaretPosition=CaretPosition,Editor.prototype.getParam=function(name,defaultVal,type){return getParam(this,name,defaultVal,type)},Editor.prototype.hasPlugin=function(name,loaded){var hasPlugin;return!!contains(getPlugins(this).split(/[ ,]/),name)&&(!loaded||void 0!==PluginManager.get(name))},Editor.prototype.nodeChanged=function(args){this._nodeChangeDispatcher.nodeChanged(args)},Editor.prototype.addCommand=function(name,callback,scope){this.editorCommands.addCommand(name,callback,scope)},Editor.prototype.addQueryStateHandler=function(name,callback,scope){this.editorCommands.addQueryStateHandler(name,callback,scope)},Editor.prototype.addQueryValueHandler=function(name,callback,scope){this.editorCommands.addQueryValueHandler(name,callback,scope)},Editor.prototype.addShortcut=function(pattern,desc,cmdFunc,scope){this.shortcuts.add(pattern,desc,cmdFunc,scope)},Editor.prototype.execCommand=function(cmd,ui,value,args){return this.editorCommands.execCommand(cmd,ui,value,args)},Editor.prototype.queryCommandState=function(cmd){return this.editorCommands.queryCommandState(cmd)},Editor.prototype.queryCommandValue=function(cmd){return this.editorCommands.queryCommandValue(cmd)},Editor.prototype.queryCommandSupported=function(cmd){return this.editorCommands.queryCommandSupported(cmd)},Editor.prototype.show=function(){var self=this;this.hidden&&(this.hidden=!1,this.inline?this.getBody().contentEditable="true":(DOM$9.show(this.getContainer()),DOM$9.hide(this.id)),this.load(),this.fire("show"))},Editor.prototype.hide=function(){var self=this,doc=this.getDoc();this.hidden||(ie$1&&doc&&!this.inline&&doc.execCommand("SelectAll"),this.save(),this.inline?(this.getBody().contentEditable="false",this===this.editorManager.focusedEditor&&(this.editorManager.focusedEditor=null)):(DOM$9.hide(this.getContainer()),DOM$9.setStyle(this.id,"display",this.orgDisplay)),this.hidden=!0,this.fire("hide"))},Editor.prototype.isHidden=function(){return!!this.hidden},Editor.prototype.setProgressState=function(state,time){this.fire("ProgressState",{state:state,time:time})},Editor.prototype.load=function(args){var self=this,elm=this.getElement(),html;if(this.removed)return"";if(elm){(args=args||{}).load=!0;var value=isTextareaOrInput(elm)?elm.value:elm.innerHTML;return html=this.setContent(value,args),args.element=elm,args.no_events||this.fire("LoadContent",args),args.element=elm=null,html}},Editor.prototype.save=function(args){var self=this,elm=self.getElement(),html,form;if(elm&&self.initialized&&!self.removed)return(args=args||{}).save=!0,args.element=elm,html=args.content=self.getContent(args),args.no_events||self.fire("SaveContent",args),"raw"===args.format&&self.fire("RawSaveContent",args),html=args.content,isTextareaOrInput(elm)?elm.value=html:(!args.is_removing&&self.inline||(elm.innerHTML=html),(form=DOM$9.getParent(self.id,"form"))&&each$i(form.elements,(function(elm){if(elm.name===self.id)return elm.value=html,!1}))),args.element=elm=null,!1!==args.set_dirty&&self.setDirty(!1),html},Editor.prototype.setContent=function(content,args){return setContent$2(this,content,args)},Editor.prototype.getContent=function(args){return getContent$2(this,args)},Editor.prototype.insertContent=function(content,args){if(args){let paste={};this.settings.nonFormat&&(paste={paste:!1}),content=extend$3({content:content},args,paste)}this.execCommand("mceInsertContent",!1,content)},Editor.prototype.resetContent=function(initialContent){void 0===initialContent?setContent$2(this,this.startContent,{format:"raw"}):setContent$2(this,initialContent),this.undoManager.reset(),this.setDirty(!1),this.nodeChanged()},Editor.prototype.isDirty=function(){return!this.isNotDirty},Editor.prototype.setDirty=function(state){var oldState=!this.isNotDirty;this.isNotDirty=!state,state&&state!==oldState&&this.fire("dirty")},Editor.prototype.getContainer=function(){var self=this;return this.container||(this.container=DOM$9.get(this.editorContainer||this.id+"_parent")),this.container},Editor.prototype.getContentAreaContainer=function(){return this.contentAreaContainer},Editor.prototype.getElement=function(){return this.targetElm||(this.targetElm=DOM$9.get(this.id)),this.targetElm},Editor.prototype.getWin=function(){var self=this,elm;return this.contentWindow||(elm=this.iframeElement)&&(this.contentWindow=elm.contentWindow),this.contentWindow},Editor.prototype.getDoc=function(){var self=this,win;return this.contentDocument||(win=this.getWin())&&(this.contentDocument=win.document),this.contentDocument},Editor.prototype.getBody=function(){var doc=this.getDoc();return this.bodyElement||(doc?doc.body:null)},Editor.prototype.convertURL=function(url,name,elm){var self=this,settings=this.settings;return settings.urlconverter_callback?this.execCallback("urlconverter_callback",url,elm,!0,name):!settings.convert_urls||elm&&"LINK"===elm.nodeName||0===url.indexOf("file:")||0===url.length?url:settings.relative_urls?this.documentBaseURI.toRelative(url):url=this.documentBaseURI.toAbsolute(url,settings.remove_script_host)},Editor.prototype.addVisual=function(elm){addVisual$1(this,elm)},Editor.prototype.remove=function(){remove$7(this)},Editor.prototype.destroy=function(automatic){destroy(this,automatic)},Editor.prototype.uploadImages=function(callback){return this.editorUpload.uploadImages(callback)},Editor.prototype._scanForImages=function(){return this.editorUpload.scanForImages()},Editor.prototype.addButton=function(){throw new Error("editor.addButton has been removed in tinymce 5x, use editor.ui.registry.addButton or editor.ui.registry.addToggleButton or editor.ui.registry.addSplitButton instead")},Editor.prototype.addSidebar=function(){throw new Error("editor.addSidebar has been removed in tinymce 5x, use editor.ui.registry.addSidebar instead")},Editor.prototype.addMenuItem=function(){throw new Error("editor.addMenuItem has been removed in tinymce 5x, use editor.ui.registry.addMenuItem instead")},Editor.prototype.addContextToolbar=function(){throw new Error("editor.addContextToolbar has been removed in tinymce 5x, use editor.ui.registry.addContextToolbar instead")},Editor}(),DOM$a=DOMUtils.DOM,explode$4=Tools.explode,each$j=Tools.each,extend$4=Tools.extend,instanceCounter=0,boundGlobalEvents=!1,beforeUnloadDelegate,legacyEditors=[],editors=[],isValidLegacyKey=function(id){return"length"!==id},globalEventDelegate=function(e){var type=e.type;each$j(EditorManager.get(),(function(editor){switch(type){case"scroll":editor.fire("ScrollWindow",e);break;case"resize":editor.fire("ResizeWindow",e)}}))},toggleGlobalEvents=function(state){state!==boundGlobalEvents&&(state?DomQuery(window).on("resize scroll",globalEventDelegate):DomQuery(window).off("resize scroll",globalEventDelegate),boundGlobalEvents=state)},removeEditorFromList=function(targetEditor){var oldEditors=editors;delete legacyEditors[targetEditor.id];for(var i=0;i<legacyEditors.length;i++)if(legacyEditors[i]===targetEditor){legacyEditors.splice(i,1);break}return editors=filter(editors,(function(editor){return targetEditor!==editor})),EditorManager.activeEditor===targetEditor&&(EditorManager.activeEditor=editors.length>0?editors[0]:null),EditorManager.focusedEditor===targetEditor&&(EditorManager.focusedEditor=null),oldEditors.length!==editors.length},purgeDestroyedEditor=function(editor){return editor&&editor.initialized&&!(editor.getContainer()||editor.getBody()).parentNode&&(removeEditorFromList(editor),editor.unbindAllNativeEvents(),editor.destroy(!0),editor.removed=!0,editor=null),editor},isQuirksMode="CSS1Compat"!==document.compatMode,EditorManager=__assign(__assign({},Observable),{baseURI:null,baseURL:null,defaultSettings:{},documentBaseURL:null,suffix:null,$:DomQuery,majorVersion:"5",minorVersion:"7.0",releaseDate:"2021-02-10",editors:legacyEditors,i18n:I18n,activeEditor:null,focusedEditor:null,settings:{},setup:function(){var self=this,baseURL,documentBaseURL,suffix="";documentBaseURL=URI.getDocumentBaseUrl(document.location),/^[^:]+:\/\/\/?[^\/]+\//.test(documentBaseURL)&&(documentBaseURL=documentBaseURL.replace(/[\?#].*$/,"").replace(/[\/\\][^\/]+$/,""),/[\/\\]$/.test(documentBaseURL)||(documentBaseURL+="/"));var preInit=window.tinymce||window.tinyMCEPreInit;if(preInit)baseURL=preInit.base||preInit.baseURL,suffix=preInit.suffix;else{for(var scripts=document.getElementsByTagName("script"),i=0,src;i<scripts.length;i++){var src;if(""!==(src=scripts[i].src||"")){var srcScript=src.substring(src.lastIndexOf("/"));if(/tinymce(\.full|\.jquery|)(\.min|\.dev|)\.js/.test(src)){-1!==srcScript.indexOf(".min")&&(suffix=".min"),baseURL=src.substring(0,src.lastIndexOf("/"));break}}}if(!baseURL&&document.currentScript)-1!==(src=document.currentScript.src).indexOf(".min")&&(suffix=".min"),baseURL=src.substring(0,src.lastIndexOf("/"))}this.baseURL=new URI(documentBaseURL).toAbsolute(baseURL),this.documentBaseURL=documentBaseURL,this.baseURI=new URI(this.baseURL),this.suffix=suffix,setup$2(this)},overrideDefaults:function(defaultSettings){var baseUrl=defaultSettings.base_url;baseUrl&&this._setBaseUrl(baseUrl);var suffix=defaultSettings.suffix;defaultSettings.suffix&&(this.suffix=suffix),this.defaultSettings=defaultSettings;var pluginBaseUrls=defaultSettings.plugin_base_urls;void 0!==pluginBaseUrls&&each$1(pluginBaseUrls,(function(pluginBaseUrl,pluginName){AddOnManager.PluginManager.urls[pluginName]=pluginBaseUrl}))},init:function(settings){var self=this,result,invalidInlineTargets=Tools.makeMap("area base basefont br col frame hr img input isindex link meta param embed source wbr track colgroup option table tbody tfoot thead tr th td script noscript style textarea video audio iframe object menu"," "),isInvalidInlineTarget=function(settings,elm){return settings.inline&&elm.tagName.toLowerCase()in invalidInlineTargets},createId=function(elm){var id=elm.id;return id||(id=get$1(elm,"name").filter((function(name){return!DOM$a.get(name)})).getOrThunk(DOM$a.uniqueId),elm.setAttribute("id",id)),id},execCallback=function(name){var callback=settings[name];if(callback)return callback.apply(self,[])},hasClass=function(elm,className){return className.constructor===RegExp?className.test(elm.className):DOM$a.hasClass(elm,className)},findTargets=function(settings){var targets=[];if(Env.browser.isIE()&&Env.browser.version.major<11)return initError("TinyMCE does not support the browser you are using. For a list of supported browsers please see: https://www.tinymce.com/docs/get-started/system-requirements/"),[];if(isQuirksMode)return initError("Failed to initialize the editor as the document is not in standards mode. TinyMCE requires standards mode."),[];if(settings.types)return each$j(settings.types,(function(type){targets=targets.concat(DOM$a.select(type.selector))})),targets;if(settings.selector)return DOM$a.select(settings.selector);if(settings.target)return[settings.target];switch(settings.mode){case"exact":var l=settings.elements||"";l.length>0&&each$j(explode$4(l),(function(id){var elm=DOM$a.get(id);elm?targets.push(elm):each$j(document.forms,(function(f){each$j(f.elements,(function(e){e.name===id&&(id="mce_editor_"+instanceCounter++,DOM$a.setAttrib(e,"id",id),targets.push(e))}))}))}));break;case"textareas":case"specific_textareas":each$j(DOM$a.select("textarea"),(function(elm){settings.editor_deselector&&hasClass(elm,settings.editor_deselector)||settings.editor_selector&&!hasClass(elm,settings.editor_selector)||targets.push(elm)}))}return targets},provideResults=function(editors){result=editors},initEditors=function(){var initCount=0,editors=[],targets,createEditor=function(id,settings,targetElm){var editor=new Editor(id,settings,self);editors.push(editor),editor.on("init",(function(){++initCount===targets.length&&provideResults(editors)})),editor.targetElm=editor.targetElm||targetElm,editor.render()};DOM$a.unbind(window,"ready",initEditors),execCallback("onpageload"),targets=DomQuery.unique(findTargets(settings)),settings.types?each$j(settings.types,(function(type){Tools.each(targets,(function(elm){return!DOM$a.is(elm,type.selector)||(createEditor(createId(elm),extend$4({},settings,type),elm),!1)}))})):(Tools.each(targets,(function(elm){purgeDestroyedEditor(self.get(elm.id))})),0===(targets=Tools.grep(targets,(function(elm){return!self.get(elm.id)}))).length?provideResults([]):each$j(targets,(function(elm){isInvalidInlineTarget(settings,elm)?initError("Could not initialize inline editor on invalid inline target element",elm):createEditor(createId(elm),settings,elm)})))};return self.settings=settings,DOM$a.bind(window,"ready",initEditors),new promiseObj((function(resolve){result?resolve(result):provideResults=function(editors){resolve(editors)}}))},get:function(id){return 0===arguments.length?editors.slice(0):isString(id)?find(editors,(function(editor){return editor.id===id})).getOr(null):isNumber(id)&&editors[id]?editors[id]:null},add:function(editor){var self=this,existingEditor;return legacyEditors[editor.id]===editor?editor:(null===self.get(editor.id)&&(isValidLegacyKey(editor.id)&&(legacyEditors[editor.id]=editor),legacyEditors.push(editor),editors.push(editor)),toggleGlobalEvents(!0),self.activeEditor=editor,self.fire("AddEditor",{editor:editor}),beforeUnloadDelegate||(beforeUnloadDelegate=function(e){var event=self.fire("BeforeUnload");if(event.returnValue)return e.preventDefault(),e.returnValue=event.returnValue,event.returnValue},window.addEventListener("beforeunload",beforeUnloadDelegate)),editor)},createEditor:function(id,settings){return this.add(new Editor(id,settings,this))},remove:function(selector){var self=this,i,editor;if(selector){if(!isString(selector))return editor=selector,isNull(self.get(editor.id))?null:(removeEditorFromList(editor)&&self.fire("RemoveEditor",{editor:editor}),0===editors.length&&window.removeEventListener("beforeunload",beforeUnloadDelegate),editor.remove(),toggleGlobalEvents(editors.length>0),editor);each$j(DOM$a.select(selector),(function(elm){(editor=self.get(elm.id))&&self.remove(editor)}))}else for(i=editors.length-1;i>=0;i--)self.remove(editors[i])},execCommand:function(cmd,ui,value){var self=this,editor=this.get(value);switch(cmd){case"mceAddEditor":return this.get(value)||new Editor(value,this.settings,this).render(),!0;case"mceRemoveEditor":return editor&&editor.remove(),!0;case"mceToggleEditor":return editor?(editor.isHidden()?editor.show():editor.hide(),!0):(this.execCommand("mceAddEditor",!1,value),!0)}return!!this.activeEditor&&this.activeEditor.execCommand(cmd,ui,value)},triggerSave:function(){each$j(editors,(function(editor){editor.save()}))},addI18n:function(code,items){I18n.add(code,items)},translate:function(text){return I18n.translate(text)},setActive:function(editor){var activeEditor=this.activeEditor;this.activeEditor!==editor&&(activeEditor&&activeEditor.fire("deactivate",{relatedTarget:editor}),editor.fire("activate",{relatedTarget:activeEditor})),this.activeEditor=editor},_setBaseUrl:function(baseUrl){this.baseURL=new URI(this.documentBaseURL).toAbsolute(baseUrl.replace(/\/+$/,"")),this.baseURI=new URI(this.baseURL)}});EditorManager.setup();var min=Math.min,max=Math.max,round$1=Math.round,relativePosition=function(rect,targetRect,rel){var x=targetRect.x,y=targetRect.y,w=rect.w,h=rect.h,targetW=targetRect.w,targetH=targetRect.h,relChars=(rel||"").split("");return"b"===relChars[0]&&(y+=targetH),"r"===relChars[1]&&(x+=targetW),"c"===relChars[0]&&(y+=round$1(targetH/2)),"c"===relChars[1]&&(x+=round$1(targetW/2)),"b"===relChars[3]&&(y-=h),"r"===relChars[4]&&(x-=w),"c"===relChars[3]&&(y-=round$1(h/2)),"c"===relChars[4]&&(x-=round$1(w/2)),create$7(x,y,w,h)},findBestRelativePosition=function(rect,targetRect,constrainRect,rels){var pos,i;for(i=0;i<rels.length;i++)if((pos=relativePosition(rect,targetRect,rels[i])).x>=constrainRect.x&&pos.x+pos.w<=constrainRect.w+constrainRect.x&&pos.y>=constrainRect.y&&pos.y+pos.h<=constrainRect.h+constrainRect.y)return rels[i];return null},inflate=function(rect,w,h){return create$7(rect.x-w,rect.y-h,rect.w+2*w,rect.h+2*h)},intersect=function(rect,cropRect){var x1=max(rect.x,cropRect.x),y1=max(rect.y,cropRect.y),x2=min(rect.x+rect.w,cropRect.x+cropRect.w),y2=min(rect.y+rect.h,cropRect.y+cropRect.h);return x2-x1<0||y2-y1<0?null:create$7(x1,y1,x2-x1,y2-y1)},clamp$1=function(rect,clampRect,fixedSize){var x1=rect.x,y1=rect.y,x2=rect.x+rect.w,y2=rect.y+rect.h,cx2=clampRect.x+clampRect.w,cy2=clampRect.y+clampRect.h,underflowX1=max(0,clampRect.x-x1),underflowY1=max(0,clampRect.y-y1),overflowX2=max(0,x2-cx2),overflowY2=max(0,y2-cy2);return x1+=underflowX1,y1+=underflowY1,fixedSize&&(x2+=underflowX1,y2+=underflowY1,x1-=overflowX2,y1-=overflowY2),create$7(x1,y1,(x2-=overflowX2)-x1,(y2-=overflowY2)-y1)},create$7=function(x,y,w,h){return{x:x,y:y,w:w,h:h}},fromClientRect=function(clientRect){return create$7(clientRect.left,clientRect.top,clientRect.width,clientRect.height)},Rect={inflate:inflate,relativePosition:relativePosition,findBestRelativePosition:findBestRelativePosition,intersect:intersect,clamp:clamp$1,create:create$7,fromClientRect:fromClientRect},awaiter=function(resolveCb,rejectCb,timeout){void 0===timeout&&(timeout=1e3);var done=!1,timer=null,complete=function(completer){return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];done||(done=!0,null!==timer&&(clearTimeout(timer),timer=null),completer.apply(null,args))}},resolve=complete(resolveCb),reject=complete(rejectCb),start;return{start:function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];done||null!==timer||(timer=setTimeout((function(){return reject.apply(null,args)}),timeout))},resolve:resolve,reject:reject}},create$8,Resource=function(){var tasks={},resultFns={},load,add;return{load:function(id,url){var loadErrMsg='Script at URL "'+url+'" failed to load',runErrMsg='Script at URL "'+url+"\" did not call `tinymce.Resource.add('"+id+"', data)` within 1 second";if(void 0!==tasks[id])return tasks[id];var task=new promiseObj((function(resolve,reject){var waiter=awaiter(resolve,reject);resultFns[id]=waiter.resolve,ScriptLoader.ScriptLoader.loadScript(url,(function(){return waiter.start(runErrMsg)}),(function(){return waiter.reject(loadErrMsg)}))}));return tasks[id]=task,task},add:function(id,data){void 0!==resultFns[id]&&(resultFns[id](data),delete resultFns[id]),tasks[id]=promiseObj.resolve(data)}}}(),each$k=Tools.each,extend$5=Tools.extend,extendClass,initializing,Class=function(){};Class.extend=extendClass=function(props){var self=this,_super=this.prototype,Class=function(){var i,mixins,mixin,self=this;if(!initializing&&(self.init&&self.init.apply(self,arguments),mixins=self.Mixins))for(i=mixins.length;i--;)(mixin=mixins[i]).init&&mixin.init.apply(self,arguments)},dummy=function(){return this},createMethod=function(name,fn){return function(){var self=this,tmp=self._super;self._super=_super[name];var ret=fn.apply(self,arguments);return self._super=tmp,ret}};initializing=!0;var prototype=new this;return initializing=!1,props.Mixins&&(each$k(props.Mixins,(function(mixin){for(var name_1 in mixin)"init"!==name_1&&(props[name_1]=mixin[name_1])})),_super.Mixins&&(props.Mixins=_super.Mixins.concat(props.Mixins))),props.Methods&&each$k(props.Methods.split(","),(function(name){props[name]=dummy})),props.Properties&&each$k(props.Properties.split(","),(function(name){var fieldName="_"+name;props[name]=function(value){var self=this;return void 0!==value?(this[fieldName]=value,this):this[fieldName]}})),props.Statics&&each$k(props.Statics,(function(func,name){Class[name]=func})),props.Defaults&&_super.Defaults&&(props.Defaults=extend$5({},_super.Defaults,props.Defaults)),each$1(props,(function(member,name){"function"==typeof member&&_super[name]?prototype[name]=createMethod(name,member):prototype[name]=member})),Class.prototype=prototype,Class.constructor=Class,Class.extend=extendClass,Class};var min$1=Math.min,max$1=Math.max,round$2=Math.round,Color=function(value){var self={},r=0,g=0,b=0,rgb2hsv=function(r,g,b){var h,s,v;h=0,s=0,v=0;var minRGB=min$1(r/=255,min$1(g/=255,b/=255)),maxRGB=max$1(r,max$1(g,b)),d;return minRGB===maxRGB?{h:0,s:0,v:100*(v=minRGB)}:(s=(maxRGB-minRGB)/maxRGB,v=maxRGB,{h:round$2(h=60*((h=r===minRGB?3:b===minRGB?1:5)-(r===minRGB?g-b:b===minRGB?r-g:b-r)/(maxRGB-minRGB))),s:round$2(100*s),v:round$2(100*v)})},hsvToRgb=function(hue,saturation,brightness){if(hue=(parseInt(hue,10)||0)%360,saturation=parseInt(saturation,10)/100,brightness=parseInt(brightness,10)/100,saturation=max$1(0,min$1(saturation,1)),brightness=max$1(0,min$1(brightness,1)),0!==saturation){var side=hue/60,chroma=brightness*saturation,x=chroma*(1-Math.abs(side%2-1)),match=brightness-chroma;switch(Math.floor(side)){case 0:r=chroma,g=x,b=0;break;case 1:r=x,g=chroma,b=0;break;case 2:r=0,g=chroma,b=x;break;case 3:r=0,g=x,b=chroma;break;case 4:r=x,g=0,b=chroma;break;case 5:r=chroma,g=0,b=x;break;default:r=g=b=0}r=round$2(255*(r+match)),g=round$2(255*(g+match)),b=round$2(255*(b+match))}else r=g=b=round$2(255*brightness)},toHex=function(){var hex=function(val){return(val=parseInt(val,10).toString(16)).length>1?val:"0"+val};return"#"+hex(r)+hex(g)+hex(b)},toRgb=function(){return{r:r,g:g,b:b}},toHsv=function(){return rgb2hsv(r,g,b)},parse=function(value){var matches;return"object"==typeof value?"r"in value?(r=value.r,g=value.g,b=value.b):"v"in value&&hsvToRgb(value.h,value.s,value.v):(matches=/rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)[^\)]*\)/gi.exec(value))?(r=parseInt(matches[1],10),g=parseInt(matches[2],10),b=parseInt(matches[3],10)):(matches=/#([0-F]{2})([0-F]{2})([0-F]{2})/gi.exec(value))?(r=parseInt(matches[1],16),g=parseInt(matches[2],16),b=parseInt(matches[3],16)):(matches=/#([0-F])([0-F])([0-F])/gi.exec(value))&&(r=parseInt(matches[1]+matches[1],16),g=parseInt(matches[2]+matches[2],16),b=parseInt(matches[3]+matches[3],16)),r=r<0?0:r>255?255:r,g=g<0?0:g>255?255:g,b=b<0?0:b>255?255:b,self};return value&&parse(value),self.toRgb=toRgb,self.toHsv=toHsv,self.toHex=toHex,self.parse=parse,self},serialize,JSONUtils={serialize:function(obj){var data=JSON.stringify(obj);return isString(data)?data.replace(/[\u0080-\uFFFF]/g,(function(match){var hexCode=match.charCodeAt(0).toString(16);return"\\u"+"0000".substring(hexCode.length)+hexCode})):data},parse:function(text){try{return JSON.parse(text)}catch(ex){}}},JSONP={callbacks:{},count:0,send:function(settings){var self=this,dom=DOMUtils.DOM,count=void 0!==settings.count?settings.count:self.count,id="tinymce_jsonp_"+count;self.callbacks[count]=function(json){dom.remove(id),delete self.callbacks[count],settings.callback(json)},dom.add(dom.doc.body,"script",{id:id,src:settings.url,type:"text/javascript"}),self.count++}},XHR=__assign(__assign({},Observable),{send:function(settings){var xhr,count=0,ready=function(){!settings.async||4===xhr.readyState||count++>1e4?(settings.success&&count<1e4&&200===xhr.status?settings.success.call(settings.success_scope,""+xhr.responseText,xhr,settings):settings.error&&settings.error.call(settings.error_scope,count>1e4?"TIMED_OUT":"GENERAL",xhr,settings),xhr=null):Delay.setTimeout(ready,10)};if(settings.scope=settings.scope||this,settings.success_scope=settings.success_scope||settings.scope,settings.error_scope=settings.error_scope||settings.scope,settings.async=!1!==settings.async,settings.data=settings.data||"",XHR.fire("beforeInitialize",{settings:settings}),(xhr=new XMLHttpRequest).overrideMimeType&&xhr.overrideMimeType(settings.content_type),xhr.open(settings.type||(settings.data?"POST":"GET"),settings.url,settings.async),settings.crossDomain&&(xhr.withCredentials=!0),settings.content_type&&xhr.setRequestHeader("Content-Type",settings.content_type),settings.requestheaders&&Tools.each(settings.requestheaders,(function(header){xhr.setRequestHeader(header.key,header.value)})),xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),(xhr=XHR.fire("beforeSend",{xhr:xhr,settings:settings}).xhr).send(settings.data),!settings.async)return ready();Delay.setTimeout(ready,10)}}),extend$6=Tools.extend,JSONRequest=function(){function JSONRequest(settings){this.settings=extend$6({},settings),this.count=0}return JSONRequest.sendRPC=function(o){return(new JSONRequest).send(o)},JSONRequest.prototype.send=function(args){var ecb=args.error,scb=args.success,xhrArgs=extend$6(this.settings,args);xhrArgs.success=function(c,x){void 0===(c=JSONUtils.parse(c))&&(c={error:"JSON Parse error."}),c.error?ecb.call(xhrArgs.error_scope||xhrArgs.scope,c.error,x):scb.call(xhrArgs.success_scope||xhrArgs.scope,c.result)},xhrArgs.error=function(ty,x){ecb&&ecb.call(xhrArgs.error_scope||xhrArgs.scope,ty,x)},xhrArgs.data=JSONUtils.serialize({id:args.id||"c"+this.count++,method:args.method,params:args.params}),xhrArgs.content_type="application/json",XHR.send(xhrArgs)},JSONRequest}(),create$9=function(){return function(){var data={},keys=[],storage={getItem:function(key){var item=data[key];return item||null},setItem:function(key,value){keys.push(key),data[key]=String(value)},key:function(index){return keys[index]},removeItem:function(key){keys=keys.filter((function(k){return k===key})),delete data[key]},clear:function(){keys=[],data={}},length:0};return Object.defineProperty(storage,"length",{get:function(){return keys.length},configurable:!1,enumerable:!1}),storage}()},localStorage;try{var test="__storage_test__";(localStorage=window.localStorage).setItem(test,test),localStorage.removeItem(test)}catch(e){localStorage=create$9()}var LocalStorage,publicApi={geom:{Rect:Rect},util:{Promise:promiseObj,Delay:Delay,Tools:Tools,VK:VK,URI:URI,Class:Class,EventDispatcher:EventDispatcher,Observable:Observable,I18n:I18n,XHR:XHR,JSON:JSONUtils,JSONRequest:JSONRequest,JSONP:JSONP,LocalStorage:localStorage,Color:Color,ImageUploader:ImageUploader},dom:{EventUtils:EventUtils,Sizzle:Sizzle,DomQuery:DomQuery,TreeWalker:DomTreeWalker,TextSeeker:TextSeeker,DOMUtils:DOMUtils,ScriptLoader:ScriptLoader,RangeUtils:RangeUtils,Serializer:DomSerializer,StyleSheetLoader:StyleSheetLoader,ControlSelection:ControlSelection,BookmarkManager:BookmarkManager,Selection:EditorSelection,Event:EventUtils.Event},html:{Styles:Styles,Entities:Entities,Node:AstNode,Schema:Schema,SaxParser:SaxParser,DomParser:DomParser,Writer:Writer,Serializer:HtmlSerializer},Env:Env,AddOnManager:AddOnManager,Annotator:Annotator,Formatter:Formatter,UndoManager:UndoManager,EditorCommands:EditorCommands,WindowManager:WindowManager,NotificationManager:NotificationManager,EditorObservable:EditorObservable,Shortcuts:Shortcuts,Editor:Editor,FocusManager:FocusManager,EditorManager:EditorManager,DOM:DOMUtils.DOM,ScriptLoader:ScriptLoader.ScriptLoader,PluginManager:PluginManager,ThemeManager:ThemeManager,IconManager:IconManager,Resource:Resource,trim:Tools.trim,isArray:Tools.isArray,is:Tools.is,toArray:Tools.toArray,makeMap:Tools.makeMap,each:Tools.each,map:Tools.map,grep:Tools.grep,inArray:Tools.inArray,extend:Tools.extend,create:Tools.create,walk:Tools.walk,createNS:Tools.createNS,resolve:Tools.resolve,explode:Tools.explode,_addCacheSuffix:Tools._addCacheSuffix,isOpera:Env.opera,isWebKit:Env.webkit,isIE:Env.ie,isGecko:Env.gecko,isMac:Env.mac},tinymce=Tools.extend(EditorManager,publicApi),exportToModuleLoaders=function(tinymce){if("object"==typeof module)try{module.exports=tinymce}catch(_){}},exportToWindowGlobal;(function(tinymce){window.tinymce=tinymce,window.tinyMCE=tinymce})(tinymce),exportToModuleLoaders(tinymce)}();